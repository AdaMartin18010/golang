# 3.1 å¾®æœåŠ¡åŸºç¡€

<!-- TOC START -->
- [3.1 å¾®æœåŠ¡åŸºç¡€](#å¾®æœåŠ¡åŸºç¡€)
  - [3.1.1 ğŸ“š **ç†è®ºåˆ†æ**](#ğŸ“š-**ç†è®ºåˆ†æ**)
    - [3.1.1.1 **å¾®æœåŠ¡å®šä¹‰**](#**å¾®æœåŠ¡å®šä¹‰**)
    - [3.1.1.2 **æ ¸å¿ƒæ¶æ„æ¨¡å¼**](#**æ ¸å¿ƒæ¶æ„æ¨¡å¼**)
    - [3.1.1.3 **Goå¾®æœåŠ¡ç”Ÿæ€**](#**goå¾®æœåŠ¡ç”Ÿæ€**)
  - [3.1.2 ğŸ’» **ä»£ç ç¤ºä¾‹**](#ğŸ’»-**ä»£ç ç¤ºä¾‹**)
    - [3.1.2.1 **æœ€å°å¾®æœåŠ¡ï¼ˆGin+Consulæ³¨å†Œï¼‰**](#**æœ€å°å¾®æœåŠ¡ï¼ˆgin+consulæ³¨å†Œï¼‰**)
    - [3.1.2.2 **gRPCå¾®æœåŠ¡å®šä¹‰ä¸å®ç°**](#**grpcå¾®æœåŠ¡å®šä¹‰ä¸å®ç°**)
  - [3.1.3 ğŸ¯ **æœ€ä½³å®è·µ**](#ğŸ¯-**æœ€ä½³å®è·µ**)
  - [3.1.4 ğŸ” **å¸¸è§é—®é¢˜**](#ğŸ”-**å¸¸è§é—®é¢˜**)
  - [3.1.5 ğŸ“š **æ‰©å±•é˜…è¯»**](#ğŸ“š-**æ‰©å±•é˜…è¯»**)
<!-- TOC END -->














## 3.1.1 ğŸ“š **ç†è®ºåˆ†æ**

### 3.1.1.1 **å¾®æœåŠ¡å®šä¹‰**

- å¾®æœåŠ¡æ˜¯ä¸€ç§å°†åº”ç”¨æ‹†åˆ†ä¸ºä¸€ç»„å°å‹ã€è‡ªæ²»ã€å¯ç‹¬ç«‹éƒ¨ç½²çš„æœåŠ¡çš„æ¶æ„é£æ ¼ã€‚
- æ¯ä¸ªæœåŠ¡å›´ç»•ç‰¹å®šä¸šåŠ¡èƒ½åŠ›æ„å»ºï¼Œç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œæ‰©å±•ã€‚

### 3.1.1.2 **æ ¸å¿ƒæ¶æ„æ¨¡å¼**

- æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆConsulã€etcdã€Eurekaï¼‰
- APIç½‘å…³ï¼ˆç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±ã€è®¤è¯ã€é™æµï¼‰
- æœåŠ¡é—´é€šä¿¡ï¼ˆHTTP/gRPCã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
- é…ç½®ä¸­å¿ƒã€åˆ†å¸ƒå¼è¿½è¸ªã€ç†”æ–­ä¸é™æµ

### 3.1.1.3 **Goå¾®æœåŠ¡ç”Ÿæ€**

- å¸¸ç”¨åº“ï¼šgo-microã€kratosã€kitã€grpc-goã€gin+consul
- æ”¯æŒé«˜å¹¶å‘ã€æ˜“éƒ¨ç½²ã€äº‘åŸç”Ÿå‹å¥½

## 3.1.2 ğŸ’» **ä»£ç ç¤ºä¾‹**

### 3.1.2.1 **æœ€å°å¾®æœåŠ¡ï¼ˆGin+Consulæ³¨å†Œï¼‰**

```go
package main
import (
    "github.com/gin-gonic/gin"
    "github.com/hashicorp/consul/api"
    "log"
)
func main() {
    // æ³¨å†Œåˆ°Consul
    client, _ := api.NewClient(api.DefaultConfig())
    reg := &api.AgentServiceRegistration{
        Name: "user-service",
        Port: 8080,
        Check: &api.AgentServiceCheck{HTTP: "http://localhost:8080/health", Interval: "10s"},
    }
    client.Agent().ServiceRegister(reg)
    // å¯åŠ¨æœåŠ¡
    r := gin.Default()
    r.GET("/health", func(c *gin.Context) { c.String(200, "ok") })
    r.GET("/user/:id", func(c *gin.Context) { c.JSON(200, gin.H{"id": c.Param("id")}) })
    log.Fatal(r.Run(":8080"))
}
```

### 3.1.2.2 **gRPCå¾®æœåŠ¡å®šä¹‰ä¸å®ç°**

```proto
// user.proto
syntax = "proto3";
service UserService {
  rpc GetUser (UserRequest) returns (UserReply) {}
}
message UserRequest { string id = 1; }
message UserReply { string id = 1; string name = 2; }
```

```go
// server.go
import (
    "context"
    "google.golang.org/grpc"
    pb "path/to/proto"
    "net"
)
type server struct{ pb.UnimplementedUserServiceServer }
func (s *server) GetUser(ctx context.Context, req *pb.UserRequest) (*pb.UserReply, error) {
    return &pb.UserReply{Id: req.Id, Name: "Alice"}, nil
}
func main() {
    lis, _ := net.Listen("tcp", ":50051")
    s := grpc.NewServer()
    pb.RegisterUserServiceServer(s, &server{})
    s.Serve(lis)
}
```

## 3.1.3 ğŸ¯ **æœ€ä½³å®è·µ**

- æœåŠ¡å•ä¸€èŒè´£ï¼Œæ¥å£æ¸…æ™°
- å¥åº·æ£€æŸ¥ã€æ³¨å†Œå‘ç°ã€è‡ªåŠ¨æ‰©ç¼©å®¹
- é…ç½®ä¸­å¿ƒã€é“¾è·¯è¿½è¸ªã€æ—¥å¿—ç›‘æ§
- ç»Ÿä¸€APIç½‘å…³ï¼Œå®‰å…¨è®¤è¯ä¸é™æµ

## 3.1.4 ğŸ” **å¸¸è§é—®é¢˜**

- Q: å¾®æœåŠ¡å’Œå•ä½“åº”ç”¨åŒºåˆ«ï¼Ÿ
  A: å¾®æœåŠ¡å¯ç‹¬ç«‹éƒ¨ç½²ã€æ‰©å±•ï¼Œå•ä½“è€¦åˆåº¦é«˜
- Q: æœåŠ¡é—´å¦‚ä½•é€šä¿¡ï¼Ÿ
  A: HTTP/gRPCã€æ¶ˆæ¯é˜Ÿåˆ—
- Q: å¦‚ä½•åšæœåŠ¡å‘ç°ï¼Ÿ
  A: Consulã€etcdã€Eurekaç­‰

## 3.1.5 ğŸ“š **æ‰©å±•é˜…è¯»**

- [Goå¾®æœåŠ¡æœ€ä½³å®è·µ](https://github.com/micro/go-micro)
- [gRPCå®˜æ–¹æ–‡æ¡£](https://grpc.io/docs/languages/go/quickstart/)
- [Consulå®˜æ–¹æ–‡æ¡£](https://www.consul.io/docs)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AI Assistant  
**æœ€åæ›´æ–°**: 2024å¹´6æœˆ27æ—¥  
**æ–‡æ¡£çŠ¶æ€**: å®Œæˆ
