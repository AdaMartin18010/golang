# Goè¯­è¨€å…­è¾¹å½¢æ¶æ„ (Hexagonal Architecture) å®ç°

## ğŸ¯ **æ ¸å¿ƒæ¦‚å¿µ**

å…­è¾¹å½¢æ¶æ„ï¼ˆä¹Ÿç§°ä¸ºç«¯å£å’Œé€‚é…å™¨æ¶æ„ï¼‰ç”±Alistair Cockburnæå‡ºï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å¤–éƒ¨ä¾èµ–ï¼ˆå¦‚æ•°æ®åº“ã€Webç•Œé¢ã€å¤–éƒ¨æœåŠ¡ç­‰ï¼‰å®Œå…¨åˆ†ç¦»ã€‚åœ¨Goè¯­è¨€ä¸­å®ç°æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡æ¥å£ï¼ˆç«¯å£ï¼‰å’Œå…·ä½“å®ç°ï¼ˆé€‚é…å™¨ï¼‰æ¥å®ç°è¿™ç§åˆ†ç¦»ã€‚

## ğŸ—ï¸ **æ¶æ„å±‚æ¬¡**

### **1. åº”ç”¨æ ¸å¿ƒ (Application Core)**

- åŒ…å«ä¸šåŠ¡é€»è¾‘å’Œé¢†åŸŸæ¨¡å‹
- å®šä¹‰ç«¯å£ï¼ˆæ¥å£ï¼‰
- ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æ¡†æ¶

### **2. ä¸»è¦ç«¯å£ (Primary Ports)**

- åº”ç”¨å¯¹å¤–æä¾›çš„æœåŠ¡æ¥å£
- é€šå¸¸ç”±HTTPå¤„ç†å™¨ã€CLIå‘½ä»¤ç­‰å®ç°

### **3. ä¸»è¦é€‚é…å™¨ (Primary Adapters)**

- å®ç°ä¸»è¦ç«¯å£çš„é€‚é…å™¨
- HTTPå¤„ç†å™¨ã€CLIå‘½ä»¤ã€WebSocketå¤„ç†å™¨ç­‰

### **4. æ¬¡è¦ç«¯å£ (Secondary Ports)**

- åº”ç”¨éœ€è¦çš„å¤–éƒ¨æœåŠ¡æ¥å£
- æ•°æ®è®¿é—®ã€å¤–éƒ¨APIè°ƒç”¨ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰

### **5. æ¬¡è¦é€‚é…å™¨ (Secondary Adapters)**

- å®ç°æ¬¡è¦ç«¯å£çš„é€‚é…å™¨
- æ•°æ®åº“å®ç°ã€å¤–éƒ¨æœåŠ¡å®¢æˆ·ç«¯ã€æ–‡ä»¶ç³»ç»Ÿç­‰

## âœ¨ **Goè¯­è¨€å®ç°ç‰¹ç‚¹**

### **1. ç«¯å£å®šä¹‰**

```go
// ä¸»è¦ç«¯å£ - åº”ç”¨å¯¹å¤–æä¾›çš„æœåŠ¡
type UserService interface {
    CreateUser(email, name string, age int) (*User, error)
    GetUserByID(id string) (*User, error)
    UpdateUser(id string, name string, age int) (*User, error)
    DeleteUser(id string) error
}

// æ¬¡è¦ç«¯å£ - åº”ç”¨éœ€è¦çš„å¤–éƒ¨æœåŠ¡
type UserRepository interface {
    Save(user *User) error
    FindByID(id string) (*User, error)
    Update(user *User) error
    Delete(id string) error
}
```

### **2. ä¾èµ–æ³¨å…¥**

```go
// åº”ç”¨æ ¸å¿ƒ
type Application struct {
    userService UserService
    userRepo    UserRepository
}

func NewApplication(userRepo UserRepository) *Application {
    return &Application{
        userService: NewUserService(userRepo),
        userRepo:    userRepo,
    }
}
```

### **3. é€‚é…å™¨å®ç°**

```go
// HTTPé€‚é…å™¨ï¼ˆä¸»è¦é€‚é…å™¨ï¼‰
type HTTPHandler struct {
    app *Application
}

func (h *HTTPHandler) CreateUser(w http.ResponseWriter, r *http.Request) {
    // HTTPè¯·æ±‚å¤„ç†é€»è¾‘
    user, err := h.app.userService.CreateUser(email, name, age)
    // å“åº”å¤„ç†
}

// å†…å­˜ä»“å‚¨é€‚é…å™¨ï¼ˆæ¬¡è¦é€‚é…å™¨ï¼‰
type MemoryUserRepository struct {
    users map[string]*User
    mutex sync.RWMutex
}

func (r *MemoryUserRepository) Save(user *User) error {
    // å†…å­˜å­˜å‚¨å®ç°
}
```

## ğŸ“ **é¡¹ç›®ç»“æ„**

```text
hexagonal-architecture/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go                    # åº”ç”¨å…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ core/                      # åº”ç”¨æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ domain/                # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go
â”‚   â”‚   â”‚   â””â”€â”€ errors.go
â”‚   â”‚   â”œâ”€â”€ ports/                 # ç«¯å£å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ primary.go         # ä¸»è¦ç«¯å£
â”‚   â”‚   â”‚   â””â”€â”€ secondary.go       # æ¬¡è¦ç«¯å£
â”‚   â”‚   â””â”€â”€ services/              # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚       â””â”€â”€ user_service.go
â”‚   â”œâ”€â”€ adapters/                  # é€‚é…å™¨å®ç°
â”‚   â”‚   â”œâ”€â”€ primary/               # ä¸»è¦é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ http/              # HTTPé€‚é…å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handlers.go
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ router.go
â”‚   â”‚   â”‚   â””â”€â”€ cli/               # CLIé€‚é…å™¨
â”‚   â”‚   â”‚       â””â”€â”€ commands.go
â”‚   â”‚   â””â”€â”€ secondary/             # æ¬¡è¦é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ memory/            # å†…å­˜ä»“å‚¨
â”‚   â”‚       â”‚   â””â”€â”€ user_repository.go
â”‚   â”‚       â”œâ”€â”€ postgres/          # PostgreSQLä»“å‚¨
â”‚   â”‚       â”‚   â””â”€â”€ user_repository.go
â”‚   â”‚       â””â”€â”€ external/          # å¤–éƒ¨æœåŠ¡
â”‚   â”‚           â””â”€â”€ email_service.go
â”‚   â””â”€â”€ application/               # åº”ç”¨ç»„è£…
â”‚       â””â”€â”€ app.go
â””â”€â”€ go.mod
```

## ğŸš€ **æ ¸å¿ƒä¼˜åŠ¿**

1. **æŠ€æœ¯æ— å…³æ€§**: ä¸šåŠ¡é€»è¾‘ä¸ä¾èµ–ç‰¹å®šçš„æŠ€æœ¯æ ˆ
2. **å¯æµ‹è¯•æ€§**: å¯ä»¥è½»æ¾æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–è¿›è¡Œæµ‹è¯•
3. **å¯æ›¿æ¢æ€§**: å¯ä»¥è½»æ¾æ›¿æ¢ä»»ä½•é€‚é…å™¨å®ç°
4. **å¯æ‰©å±•æ€§**: æ–°åŠŸèƒ½å¯ä»¥é€šè¿‡å®ç°ç«¯å£è½»æ¾æ·»åŠ 

## ğŸ’¡ **æœ€ä½³å®è·µ**

1. **æ¥å£è®¾è®¡**: å®šä¹‰æ¸…æ™°ã€ç¨³å®šçš„ç«¯å£æ¥å£
2. **ä¾èµ–æ–¹å‘**: ä¾èµ–å…³ç³»ä»å¤–å‘å†…ï¼Œæ ¸å¿ƒä¸ä¾èµ–å¤–éƒ¨
3. **é€‚é…å™¨éš”ç¦»**: æ¯ä¸ªé€‚é…å™¨åªè´Ÿè´£ä¸€ç§å¤–éƒ¨ä¾èµ–
4. **é”™è¯¯å¤„ç†**: åœ¨ç«¯å£å±‚å®šä¹‰ç»Ÿä¸€çš„é”™è¯¯ç±»å‹
5. **é…ç½®ç®¡ç†**: é€šè¿‡ä¾èµ–æ³¨å…¥ç®¡ç†é…ç½®

## ğŸ”„ **ä¸Goè¯­è¨€ç”Ÿæ€çš„é›†æˆ**

- **ä¾èµ–ç®¡ç†**: ä½¿ç”¨Go moduleså’Œä¾èµ–æ³¨å…¥
- **HTTPæ¡†æ¶**: æ ‡å‡†åº“net/httpæˆ–è½»é‡çº§æ¡†æ¶
- **æ•°æ®åº“**: ä½¿ç”¨database/sqlæ¥å£
- **æµ‹è¯•**: ä½¿ç”¨æ ‡å‡†åº“testingåŒ…å’Œmockåº“
- **é…ç½®**: ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶

## ğŸ¯ **å®é™…åº”ç”¨åœºæ™¯**

1. **å¾®æœåŠ¡æ¶æ„**: æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„å…­è¾¹å½¢
2. **APIç½‘å…³**: ç»Ÿä¸€çš„å…¥å£é€‚é…å™¨
3. **äº‹ä»¶é©±åŠ¨**: é€šè¿‡æ¶ˆæ¯é€‚é…å™¨å¤„ç†äº‹ä»¶
4. **å¤šç§Ÿæˆ·**: é€šè¿‡é€‚é…å™¨éš”ç¦»ä¸åŒç§Ÿæˆ·çš„æ•°æ®

---

è¿™ä¸ªå®ç°ä¿æŒäº†å…­è¾¹å½¢æ¶æ„çš„æ ¸å¿ƒåŸåˆ™ï¼ŒåŒæ—¶å……åˆ†åˆ©ç”¨äº†Goè¯­è¨€çš„æ¥å£å’Œä¾èµ–æ³¨å…¥ç‰¹æ€§ï¼Œç¡®ä¿äº†ä»£ç çš„æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤æ€§ã€‚
