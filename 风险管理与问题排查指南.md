# ⚠️ 风险管理与问题排查指南

> **项目**: Golang文档重构  
> **版本**: v1.0  
> **日期**: 2025-10-22

---

## 🎯 目录

- [常见风险](#常见风险)
- [问题排查](#问题排查)
- [应急预案](#应急预案)
- [回滚方案](#回滚方案)

---

## ⚠️ 常见风险

### 风险1: 数据丢失

**概率**: 低  
**影响**: 高  
**风险等级**: 🔴 高

**预防措施**:

- ✅ 执行多次备份
- ✅ 使用Git版本控制
- ✅ 异地备份副本
- ✅ 定期验证备份完整性

**发生时应对**:

```powershell
# 1. 停止所有操作
# 2. 检查Git历史
git log --oneline

# 3. 从最近备份恢复
Copy-Item -Path "docs-backup-latest/*" -Destination "docs/" -Recurse -Force

# 4. 验证恢复结果
```

---

### 风险2: 链接大量失效

**概率**: 高  
**影响**: 中  
**风险等级**: 🟡 中

**预防措施**:

- ✅ 使用相对路径
- ✅ 阶段性链接检查
- ✅ 自动化修复脚本
- ✅ 建立链接映射表

**发生时应对**:

```powershell
# 1. 运行链接检查
lychee "docs/**/*.md" --output broken-links.txt

# 2. 批量修复
.\scripts\fix_links.ps1

# 3. 人工验证关键链接
```

---

### 风险3: 进度严重延期

**概率**: 中  
**影响**: 中  
**风险等级**: 🟡 中

**预防措施**:

- ✅ 每日进度跟踪
- ✅ 及时调整计划
- ✅ 预留缓冲时间
- ✅ 分阶段验收

**发生时应对**:

1. 评估延期原因
2. 调整优先级
3. 增加资源投入
4. 压缩非关键任务
5. 分批发布

---

### 风险4: 内容质量不达标

**概率**: 中  
**影响**: 高  
**风险等级**: 🟡 中

**预防措施**:

- ✅ 制定质量标准
- ✅ 同行评审机制
- ✅ 自动化质量检查
- ✅ 持续监控指标

**发生时应对**:

1. 运行质量检查脚本
2. 标记问题文档
3. 安排专人修改
4. 二次评审验收

---

### 风险5: 团队成员变动

**概率**: 低  
**影响**: 中  
**风险等级**: 🟢 低

**预防措施**:

- ✅ 详细文档记录
- ✅ 知识交接文档
- ✅ 明确任务分工
- ✅ 关键节点备份

**发生时应对**:

1. 快速知识交接
2. 重新分配任务
3. 调整时间计划
4. 必要时寻求外援

---

## 🔍 问题排查

### 问题1: 脚本执行失败

**症状**: PowerShell脚本报错

**可能原因**:

- 执行策略限制
- 路径不存在
- 权限不足
- 编码问题

**排查步骤**:

```powershell
# 1. 检查执行策略
Get-ExecutionPolicy

# 2. 临时允许执行
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass

# 3. 检查路径
Test-Path ".\scripts\backup_current_docs.ps1"

# 4. 以管理员身份运行
# 右键 PowerShell → 以管理员身份运行

# 5. 查看详细错误
.\scripts\backup_current_docs.ps1 -Verbose
```

**解决方案**:

- 设置执行策略: `Set-ExecutionPolicy RemoteSigned`
- 使用完整路径
- 以管理员运行
- 检查文件编码(UTF-8)

---

### 问题2: 备份失败

**症状**: 备份命令报错或备份不完整

**排查步骤**:

```powershell
# 1. 检查磁盘空间
Get-PSDrive C | Select-Object Used,Free

# 2. 检查源目录
Test-Path "docs"
Get-ChildItem "docs" -Recurse | Measure-Object

# 3. 检查目标权限
New-Item -ItemType Directory -Path "test-backup" -Force
```

**解决方案**:

- 清理磁盘空间
- 更换备份位置
- 检查文件权限
- 分批备份

---

### 问题3: 创建结构失败

**症状**: 目录创建不完整或失败

**排查步骤**:

```powershell
# 1. DryRun模式测试
.\scripts\create_new_structure.ps1 -DryRun

# 2. 检查路径长度
# Windows路径限制: 260字符

# 3. 检查特殊字符
# 避免在目录名中使用: < > : " | ? * \

# 4. 逐个创建测试
New-Item -ItemType Directory -Path "docs-new/01-语言基础" -Force
```

**解决方案**:

- 缩短路径长度
- 避免特殊字符
- 手动创建问题目录
- 检查文件系统限制

---

### 问题4: 链接检查工具失败

**症状**: lychee或其他工具无法运行

**排查步骤**:

```powershell
# 1. 检查是否安装
lychee --version

# 2. 安装lychee (如果未安装)
# 方式1: Cargo
cargo install lychee

# 方式2: 下载二进制
# https://github.com/lycheeverse/lychee/releases

# 3. 测试单个文件
lychee "README.md"
```

**解决方案**:

- 安装lychee
- 使用在线工具替代
- 手动检查关键链接
- 使用VS Code链接检查插件

---

### 问题5: Git提交冲突

**症状**: 多人协作时出现冲突

**排查步骤**:

```bash
# 1. 查看状态
git status

# 2. 查看冲突文件
git diff

# 3. 查看冲突详情
cat conflicted-file.md
```

**解决方案**:

```bash
# 1. 拉取最新代码
git pull origin main

# 2. 手动解决冲突
# 编辑冲突文件,删除冲突标记

# 3. 标记解决
git add conflicted-file.md

# 4. 提交
git commit -m "解决冲突"

# 5. 推送
git push origin main
```

---

## 🚨 应急预案

### 场景1: 重大错误需要回滚

**操作步骤**:

```powershell
# 1. 立即停止所有操作
# 通知所有团队成员

# 2. 评估影响范围
git status
git diff

# 3. 从备份恢复
$backupDir = "docs-backup-20251022-120000"
Remove-Item -Path "docs" -Recurse -Force
Copy-Item -Path "$backupDir\*" -Destination "docs\" -Recurse -Force

# 4. 验证恢复
.\scripts\check_quality.ps1
.\scripts\generate_statistics.ps1

# 5. 记录事故
# 在风险日志中记录
```

---

### 场景2: 关键人员临时缺席

**应对措施**:

1. **立即**: 查看任务交接文档
2. **1小时内**: 重新分配任务
3. **当天**: 召开紧急会议
4. **后续**: 调整进度计划

**任务交接清单**:

- [ ] 当前任务状态
- [ ] 完成的工作
- [ ] 遇到的问题
- [ ] 后续计划
- [ ] 重要文件位置

---

### 场景3: 发现重大质量问题

**操作步骤**:

1. **暂停发布**: 停止Phase 6
2. **问题评估**: 确定影响范围
3. **快速修复**: 集中资源修复
4. **全面检查**: 扩大检查范围
5. **二次验收**: 严格验收标准

---

## 🔄 回滚方案

### 完全回滚

**使用场景**: 发现重大问题,需要从头开始

```powershell
# 1. 删除新结构
Remove-Item -Path "docs-new" -Recurse -Force

# 2. 从Git恢复
git checkout -- docs/

# 3. 或从备份恢复
$latestBackup = Get-ChildItem "docs-backup-*" | Sort-Object Name -Descending | Select-Object -First 1
Copy-Item -Path "$($latestBackup.FullName)\*" -Destination "docs\" -Recurse -Force

# 4. 验证
git status
```

---

### 部分回滚

**使用场景**: 某个模块有问题,其他正常

```powershell
# 1. 识别问题模块
$problemModule = "08-架构设计"

# 2. 从备份恢复该模块
Copy-Item -Path "docs-backup-latest\$problemModule\*" `
          -Destination "docs-new\$problemModule\" `
          -Recurse -Force

# 3. 验证
Test-Path "docs-new\$problemModule"
```

---

### Git版本回滚

```bash
# 1. 查看提交历史
git log --oneline

# 2. 回滚到指定版本
git reset --hard <commit-hash>

# 3. 或创建还原提交(推荐)
git revert <commit-hash>

# 4. 推送
git push origin main
```

---

## 📋 检查清单

### 每日检查

- [ ] 备份是否完成
- [ ] 进度是否正常
- [ ] 是否有新问题
- [ ] 团队状态正常

### 每阶段检查

- [ ] 验收标准是否达成
- [ ] 质量指标是否达标
- [ ] 文档备份已更新
- [ ] 问题已记录和解决

### 发布前检查

- [ ] 所有Phase完成
- [ ] 所有问题已解决
- [ ] 最终验收通过
- [ ] 回滚方案已准备

---

## 📞 紧急联系

| 类型 | 联系人 | 联系方式 | 可用时间 |
|------|--------|---------|---------|
| 项目问题 | ___ | ___ | 工作时间 |
| 技术问题 | ___ | ___ | 随时 |
| 紧急情况 | ___ | ___ | 24/7 |

---

## 📝 事故记录模板

```markdown
### 事故 #001

**日期**: 2025-__-__
**报告人**: ___
**严重性**: 🔴/🟡/🟢

**问题描述**:
(详细描述问题)

**影响范围**:
(哪些模块/文件受影响)

**根本原因**:
(分析根本原因)

**解决方案**:
(采取的解决措施)

**预防措施**:
(如何避免再次发生)

**经验教训**:
(总结的经验)
```

---

**维护者**: Risk Management Team  
**最后更新**: 2025-10-22  
**版本**: v1.0
