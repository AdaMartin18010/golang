# å®‰å…¨æœ€ä½³å®è·µ

**éš¾åº¦**: ä¸­çº§ | **é¢„è®¡é˜…è¯»**: 20åˆ†é’Ÿ | **å‰ç½®çŸ¥è¯†**: å‰é¢æ‰€æœ‰å®‰å…¨ä¸»é¢˜

---

## ğŸ“‹ ç›®å½•



- [1. ğŸ“– æ¦‚å¿µä»‹ç»](#1--æ¦‚å¿µä»‹ç»)
- [2. ğŸ¯ å¼€å‘é˜¶æ®µ](#2--å¼€å‘é˜¶æ®µ)
  - [1. å®‰å…¨ç¼–ç è§„èŒƒ](#1-å®‰å…¨ç¼–ç è§„èŒƒ)
  - [2. è¾“å…¥éªŒè¯æ¸…å•](#2-è¾“å…¥éªŒè¯æ¸…å•)
  - [3. ä¾èµ–ç®¡ç†](#3-ä¾èµ–ç®¡ç†)
- [ğŸ” éƒ¨ç½²é˜¶æ®µ](#-éƒ¨ç½²é˜¶æ®µ)
  - [1. ç¯å¢ƒé…ç½®](#1-ç¯å¢ƒé…ç½®)
  - [2. Dockerå®‰å…¨](#2-dockerå®‰å…¨)
  - [3. Kuberneteså®‰å…¨](#3-kuberneteså®‰å…¨)
- [ğŸ›¡ï¸ è¿è¡Œæ—¶å®‰å…¨](#-è¿è¡Œæ—¶å®‰å…¨)
  - [1. é™æµä¸é˜²æŠ¤](#1-é™æµä¸é˜²æŠ¤)
  - [2. è¶…æ—¶æ§åˆ¶](#2-è¶…æ—¶æ§åˆ¶)
  - [3. ä¼˜é›…å…³é—­](#3-ä¼˜é›…å…³é—­)
- [ğŸ“‹ å®‰å…¨æ£€æŸ¥æ¸…å•](#-å®‰å…¨æ£€æŸ¥æ¸…å•)
- [ğŸ”§ å·¥å…·æ¨è](#-å·¥å…·æ¨è)
- [3. ğŸ“š ç›¸å…³èµ„æº](#3--ç›¸å…³èµ„æº)

## 1. ğŸ“– æ¦‚å¿µä»‹ç»

æœ¬æ–‡æ€»ç»“Goå®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©æ„å»ºå®‰å…¨ã€å¯é çš„åº”ç”¨ç¨‹åºã€‚

---

## 2. ğŸ¯ å¼€å‘é˜¶æ®µ

### 1. å®‰å…¨ç¼–ç è§„èŒƒ

```go
// âœ… ä½¿ç”¨å¸¸é‡è€Œéç¡¬ç¼–ç 
const (
    MaxLoginAttempts = 5
    SessionTimeout   = 30 * time.Minute
    BCryptCost       = 14
)

// âŒ é¿å…ç¡¬ç¼–ç å‡­è¯
// const APIKey = "sk-1234567890"

// âœ… ä»ç¯å¢ƒå˜é‡è¯»å–
var APIKey = os.Getenv("API_KEY")

// âœ… é”™è¯¯å¤„ç†ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯
func safeErrorHandler(w http.ResponseWriter, err error) {
    log.Printf("Internal error: %v", err) // è¯¦ç»†æ—¥å¿—
    http.Error(w, "Internal server error", http.StatusInternalServerError) // é€šç”¨æ¶ˆæ¯
}

// âŒ é¿å…æ³„éœ²å†…éƒ¨ä¿¡æ¯
func badErrorHandler(w http.ResponseWriter, err error) {
    http.Error(w, err.Error(), http.StatusInternalServerError)
}
```

---

### 2. è¾“å…¥éªŒè¯æ¸…å•

```go
type InputValidator struct{}

// éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥
func (iv *InputValidator) ValidateUserInput(input string) error {
    // 1. é•¿åº¦æ£€æŸ¥
    if len(input) > 1000 {
        return errors.New("input too long")
    }
    
    // 2. å­—ç¬¦é›†æ£€æŸ¥
    if !isValidCharset(input) {
        return errors.New("invalid characters")
    }
    
    // 3. æ ¼å¼æ£€æŸ¥
    if !matchesExpectedFormat(input) {
        return errors.New("invalid format")
    }
    
    return nil
}

// ç™½åå•éªŒè¯
func validateWithWhitelist(input string, allowed []string) bool {
    for _, item := range allowed {
        if input == item {
            return true
        }
    }
    return false
}
```

---

### 3. ä¾èµ–ç®¡ç†

```go
// go.mod: å›ºå®šä¾èµ–ç‰ˆæœ¬
/*
require (
    github.com/gorilla/mux v1.8.0
    github.com/golang-jwt/jwt/v5 v5.0.0
)
*/

// å®šæœŸæ›´æ–°ä¾èµ–
// $ go get -u ./...
// $ go mod tidy

// å®‰å…¨æ‰«æ
// $ go install github.com/securego/gosec/v2/cmd/gosec@latest
// $ gosec ./...
```

---

## ğŸ” éƒ¨ç½²é˜¶æ®µ

### 1. ç¯å¢ƒé…ç½®

```go
type SecureConfig struct {
    // å¼€å‘ç¯å¢ƒ
    Dev struct {
        Debug       bool
        LogLevel    string
        AllowOrigin string
    }
    
    // ç”Ÿäº§ç¯å¢ƒ
    Prod struct {
        Debug       bool   // å¿…é¡»ä¸ºfalse
        LogLevel    string // åº”ä¸º"error"
        AllowOrigin string // å…·ä½“åŸŸå
        TLSEnabled  bool   // å¿…é¡»ä¸ºtrue
    }
}

// ç¯å¢ƒç‰¹å®šé…ç½®
func loadConfig() *SecureConfig {
    env := os.Getenv("ENV")
    
    config := &SecureConfig{}
    
    if env == "production" {
        config.Prod.Debug = false
        config.Prod.LogLevel = "error"
        config.Prod.TLSEnabled = true
    }
    
    return config
}
```

---

### 2. Dockerå®‰å…¨

```dockerfile
# âœ… ä½¿ç”¨æœ€å°åŸºç¡€é•œåƒ
FROM golang:1.21-alpine AS builder

# âœ… ä½¿ç”¨érootç”¨æˆ·
RUN adduser -D -u 10000 appuser

# æ„å»ºåº”ç”¨
WORKDIR /app
COPY . .
RUN go build -o main .

# âœ… å¤šé˜¶æ®µæ„å»º
FROM alpine:latest
RUN adduser -D -u 10000 appuser

COPY --from=builder /app/main /app/main

# âœ… åˆ‡æ¢åˆ°érootç”¨æˆ·
USER appuser

# âœ… åªæš´éœ²å¿…è¦ç«¯å£
EXPOSE 8080

CMD ["/app/main"]
```

---

### 3. Kuberneteså®‰å…¨

```yaml
# âœ… å®‰å…¨ä¸Šä¸‹æ–‡
apiVersion: apps/v1
kind: Deployment
metadata:
  name: secure-app
spec:
  template:
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 10000
      
      containers:
      - name: app
        image: myapp:latest
        
        # âœ… èµ„æºé™åˆ¶
        resources:
          limits:
            memory: "512Mi"
            cpu: "500m"
          requests:
            memory: "256Mi"
            cpu: "250m"
        
        # âœ… åªè¯»æ–‡ä»¶ç³»ç»Ÿ
        securityContext:
          readOnlyRootFilesystem: true
          allowPrivilegeEscalation: false
        
        # âœ… å¥åº·æ£€æŸ¥
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        
        # âœ… ä½¿ç”¨Secrets
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: password
```

---

## ğŸ›¡ï¸ è¿è¡Œæ—¶å®‰å…¨

### 1. é™æµä¸é˜²æŠ¤

```go
import "golang.org/x/time/rate"

type RateLimiter struct {
    limiter *rate.Limiter
}

func NewRateLimiter(r rate.Limit, b int) *RateLimiter {
    return &RateLimiter{
        limiter: rate.NewLimiter(r, b),
    }
}

func (rl *RateLimiter) Middleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        if !rl.limiter.Allow() {
            http.Error(w, "Too many requests", http.StatusTooManyRequests)
            return
        }
        next.ServeHTTP(w, r)
    })
}

// ä½¿ç”¨ç¤ºä¾‹
func main() {
    limiter := NewRateLimiter(10, 20) // æ¯ç§’10ä¸ªè¯·æ±‚ï¼Œçªå‘20ä¸ª
    
    mux := http.NewServeMux()
    mux.HandleFunc("/api", handler)
    
    http.ListenAndServe(":8080", limiter.Middleware(mux))
}
```

---

### 2. è¶…æ—¶æ§åˆ¶

```go
// âœ… è®¾ç½®åˆç†è¶…æ—¶
func createSecureHTTPClient() *http.Client {
    return &http.Client{
        Timeout: 30 * time.Second,
        Transport: &http.Transport{
            DialContext: (&net.Dialer{
                Timeout:   10 * time.Second,
                KeepAlive: 30 * time.Second,
            }).DialContext,
            TLSHandshakeTimeout:   10 * time.Second,
            ResponseHeaderTimeout: 10 * time.Second,
            ExpectContinueTimeout: 1 * time.Second,
        },
    }
}

// âœ… è¯·æ±‚çº§åˆ«è¶…æ—¶
func makeRequestWithTimeout(url string) error {
    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
    defer cancel()
    
    req, _ := http.NewRequestWithContext(ctx, "GET", url, nil)
    _, err := http.DefaultClient.Do(req)
    return err
}
```

---

### 3. ä¼˜é›…å…³é—­

```go
func startServerWithGracefulShutdown() {
    srv := &http.Server{
        Addr:         ":8080",
        Handler:      router,
        ReadTimeout:  15 * time.Second,
        WriteTimeout: 15 * time.Second,
        IdleTimeout:  60 * time.Second,
    }
    
    // å¯åŠ¨æœåŠ¡å™¨
    go func() {
        if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed {
            log.Fatalf("Server error: %v", err)
        }
    }()
    
    // ç­‰å¾…ä¸­æ–­ä¿¡å·
    quit := make(chan os.Signal, 1)
    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
    <-quit
    
    log.Println("Shutting down server...")
    
    // ä¼˜é›…å…³é—­
    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()
    
    if err := srv.Shutdown(ctx); err != nil {
        log.Fatalf("Server forced to shutdown: %v", err)
    }
    
    log.Println("Server exited")
}
```

---

## ğŸ“‹ å®‰å…¨æ£€æŸ¥æ¸…å•

```
å¼€å‘é˜¶æ®µ:
â˜ ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆGo
â˜ å¯ç”¨go vetå’Œgolint
â˜ è¿è¡Œgosecå®‰å…¨æ‰«æ
â˜ æ‰€æœ‰è¾“å…¥éƒ½ç»è¿‡éªŒè¯
â˜ ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
â˜ æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
â˜ é”™è¯¯å¤„ç†ä¸æ³„éœ²ä¿¡æ¯
â˜ ä¾èµ–é¡¹å®šæœŸæ›´æ–°

éƒ¨ç½²é˜¶æ®µ:
â˜ ç¦ç”¨Debugæ¨¡å¼
â˜ ä½¿ç”¨HTTPS
â˜ é…ç½®å®‰å…¨HTTPå¤´éƒ¨
â˜ å®ç°é€Ÿç‡é™åˆ¶
â˜ è®¾ç½®åˆç†è¶…æ—¶
â˜ ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ
â˜ æœ€å°æƒé™åŸåˆ™
â˜ ç§˜å¯†ç®¡ç†ç³»ç»Ÿ

ç›‘æ§é˜¶æ®µ:
â˜ å¯ç”¨å®¡è®¡æ—¥å¿—
â˜ ç›‘æ§å¼‚å¸¸è¡Œä¸º
â˜ å®šæœŸå®‰å…¨å®¡æŸ¥
â˜ æ¼æ´æ‰«æ
â˜ åº”æ€¥å“åº”è®¡åˆ’
```

---

## ğŸ”§ å·¥å…·æ¨è

```bash
# å®‰å…¨æ‰«æ
go install github.com/securego/gosec/v2/cmd/gosec@latest
gosec ./...

# ä¾èµ–æ£€æŸ¥
go install golang.org/x/vuln/cmd/govulncheck@latest
govulncheck ./...

# ä»£ç è´¨é‡
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
golangci-lint run

# é™æ€åˆ†æ
go vet ./...
```

---

## 3. ğŸ“š ç›¸å…³èµ„æº

- [Go Security Policy](https://go.dev/security)
- [OWASP Go Security Cheat Sheet](https://cheatsheetseries.owasp.org/)
- [Awesome Go Security](https://github.com/guardrailsio/awesome-golang-security)

---

**æœ€åæ›´æ–°**: 2025-10-28

