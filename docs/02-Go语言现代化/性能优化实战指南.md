# Go 1.25 æ€§èƒ½ä¼˜åŒ–å®æˆ˜æŒ‡å—

> **ç‰ˆæœ¬**: v1.0  
> **æœ€åæ›´æ–°**: 2025å¹´10æœˆ18æ—¥  
> **ç›®æ ‡è¯»è€…**: åç«¯å¼€å‘ã€æ€§èƒ½å·¥ç¨‹å¸ˆã€æ¶æ„å¸ˆ

---

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#1-å¿«é€Ÿå¼€å§‹)
2. [æ€§èƒ½åˆ†æå·¥å…·](#2-æ€§èƒ½åˆ†æå·¥å…·)
3. [GCä¼˜åŒ–å®æˆ˜](#3-gcä¼˜åŒ–å®æˆ˜)
4. [å®¹å™¨éƒ¨ç½²ä¼˜åŒ–](#4-å®¹å™¨éƒ¨ç½²ä¼˜åŒ–)
5. [Mapæ€§èƒ½ä¼˜åŒ–](#5-mapæ€§èƒ½ä¼˜åŒ–)
6. [å¹¶å‘ä¼˜åŒ–](#6-å¹¶å‘ä¼˜åŒ–)
7. [å†…å­˜ä¼˜åŒ–](#7-å†…å­˜ä¼˜åŒ–)
8. [ç½‘ç»œä¼˜åŒ–](#8-ç½‘ç»œä¼˜åŒ–)
9. [ç›‘æ§ä¸è§‚æµ‹](#9-ç›‘æ§ä¸è§‚æµ‹)
10. [æ¡ˆä¾‹ç ”ç©¶](#10-æ¡ˆä¾‹ç ”ç©¶)

---

## 1. å¿«é€Ÿå¼€å§‹

### 1.1 5åˆ†é’Ÿæ€§èƒ½è¯„ä¼°

**æ£€æŸ¥å½“å‰æ€§èƒ½**:

```bash
# 1. è¿è¡ŒåŸºå‡†æµ‹è¯•
go test -bench=. -benchmem ./...

# 2. ç”ŸæˆCPU profile
go test -bench=. -cpuprofile=cpu.prof

# 3. åˆ†æ
go tool pprof cpu.prof
```

**å¿«é€Ÿè¯†åˆ«ç“¶é¢ˆ**:
```go
import _ "net/http/pprof"

func main() {
    go func() {
        http.ListenAndServe("localhost:6060", nil)
    }()
    // ... ä¸»ç¨‹åº
}
```

è®¿é—® http://localhost:6060/debug/pprof/ æŸ¥çœ‹å®æ—¶æ€§èƒ½ã€‚

---

### 1.2 ä¼˜åŒ–ä¼˜å…ˆçº§

**ROIæ’åº** (é«˜åˆ°ä½):

| ä¼˜å…ˆçº§ | ä¼˜åŒ–é¡¹ | é¢„æœŸæ”¶ç›Š | å®æ–½éš¾åº¦ |
|--------|--------|---------|---------|
| **P0** | å¯ç”¨å®¹å™¨æ„ŸçŸ¥è°ƒåº¦ | +30% | æä½ |
| **P0** | å‡çº§åˆ°Go 1.25 | +15-25% | ä½ |
| **P1** | å¯ç”¨greentea GC | +20% | ä½ |
| **P1** | ä¼˜åŒ–å¤§Mapä½¿ç”¨ | +30% | ä¸­ |
| **P2** | ä¼˜åŒ–goroutineæ±  | +10-15% | ä¸­ |
| **P2** | ä½¿ç”¨Arenaåˆ†é… | +20% | é«˜ |

---

## 2. æ€§èƒ½åˆ†æå·¥å…·

### 2.1 å†…ç½®å·¥å…·

#### pprof - CPUåˆ†æ

```bash
# ç”Ÿæˆprofile
go test -bench=. -cpuprofile=cpu.prof

# Webç•Œé¢åˆ†æ
go tool pprof -http=:8080 cpu.prof

# å‘½ä»¤è¡Œtop 10
go tool pprof -top cpu.prof
```

**è¾“å‡ºç¤ºä¾‹**:
```
Showing nodes accounting for 1.50s, 85.23% of 1.76s total
      flat  flat%   sum%        cum   cum%
     0.45s 25.57% 25.57%      0.65s 36.93%  runtime.scanobject
     0.32s 18.18% 43.75%      0.32s 18.18%  runtime.memclrNoHeapPointers
     0.28s 15.91% 59.66%      0.28s 15.91%  runtime.memmove
```

---

#### trace - æ‰§è¡Œè¿½è¸ª

```bash
# ç”Ÿæˆtrace
go test -trace=trace.out

# æŸ¥çœ‹trace
go tool trace trace.out
```

**å¯ä»¥çœ‹åˆ°**:
- Goroutineè°ƒåº¦
- GCäº‹ä»¶
- ç³»ç»Ÿè°ƒç”¨
- ç½‘ç»œI/O

---

#### memory profiling

```bash
# ç”Ÿæˆå†…å­˜profile
go test -bench=. -memprofile=mem.prof

# åˆ†æåˆ†é…
go tool pprof -alloc_space mem.prof

# åˆ†æä½¿ç”¨ä¸­å†…å­˜
go tool pprof -inuse_space mem.prof
```

---

### 2.2 ç¬¬ä¸‰æ–¹å·¥å…·

#### benchstat - å¯¹æ¯”åŸºå‡†

```bash
# è¿è¡Œæ—§ç‰ˆæœ¬
go test -bench=. -count=10 > old.txt

# è¿è¡Œæ–°ç‰ˆæœ¬
go test -bench=. -count=10 > new.txt

# å¯¹æ¯”
benchstat old.txt new.txt
```

**è¾“å‡º**:
```
name        old time/op  new time/op  delta
Process-8    125Âµs Â± 2%    98Âµs Â± 3%  -21.60%  (p=0.000 n=10+10)

name        old alloc/op new alloc/op delta
Process-8    45.2kB Â± 0%  38.5kB Â± 0%  -14.82%  (p=0.000 n=10+10)
```

---

#### fgprof - å®Œæ•´profile

```go
import _ "github.com/felixge/fgprof"

func main() {
    http.ListenAndServe(":6060", fgprof.Handler())
}
```

**ä¼˜åŠ¿**: æ•è·off-CPUæ—¶é—´ï¼ˆç­‰å¾…I/Oç­‰ï¼‰

---

## 3. GCä¼˜åŒ–å®æˆ˜

### 3.1 è¯„ä¼°æ˜¯å¦éœ€è¦greentea GC

**æŒ‡æ ‡æ£€æŸ¥**:

```go
import "runtime"

func checkGCMetrics() {
    var m runtime.MemStats
    runtime.ReadMemStats(&m)
    
    avgPause := time.Duration(m.PauseTotalNs / uint64(m.NumGC))
    fmt.Printf("å¹³å‡GCæš‚åœ: %v\n", avgPause)
    fmt.Printf("GCæ¬¡æ•°: %d\n", m.NumGC)
    fmt.Printf("GCå æ¯”: %.2f%%\n", 
        float64(m.PauseTotalNs)/float64(time.Since(startTime).Nanoseconds())*100)
}
```

**å†³ç­–æ ‘**:
```
avgPause > 200Âµs?
â”œâ”€ Yes: è€ƒè™‘greentea GC
â”‚  â””â”€ å°å¯¹è±¡å¯†é›†?
â”‚     â”œâ”€ Yes: å¼ºçƒˆæ¨è âœ…
â”‚     â””â”€ No: å¯é€‰
â””â”€ No: å½“å‰GCå·²è¶³å¤Ÿå¥½
```

---

### 3.2 å¯ç”¨greentea GC

**æ–¹å¼1: ç¯å¢ƒå˜é‡**:
```bash
GOEXPERIMENT=greentea go build -o myapp
```

**æ–¹å¼2: æ„å»ºæ ‡ç­¾**:
```go
//go:build greentea
// +build greentea

package main

func init() {
    // greentea GCç‰¹å®šåˆå§‹åŒ–
}
```

---

### 3.3 GCè°ƒä¼˜å‚æ•°

#### GOGC - è§¦å‘é˜ˆå€¼

```bash
# é»˜è®¤100ï¼ˆå †å¢é•¿100%æ—¶GCï¼‰
GOGC=100 ./myapp

# æ›´æ¿€è¿›ï¼ˆæ›´é¢‘ç¹GCï¼Œæ›´ä½å»¶è¿Ÿï¼‰
GOGC=50 ./myapp

# æ›´å®½æ¾ï¼ˆæ›´å°‘GCï¼Œæ›´é«˜ååï¼‰
GOGC=200 ./myapp
```

**é€‰æ‹©æŒ‡å—**:
```
å»¶è¿Ÿæ•æ„Ÿ â†’ GOGC=50-80
ååä¼˜å…ˆ â†’ GOGC=200-300
å¹³è¡¡ â†’ GOGC=100ï¼ˆé»˜è®¤ï¼‰
```

---

#### GOMEMLIMIT - å†…å­˜é™åˆ¶

**Go 1.19+æ–°ç‰¹æ€§ï¼Œ1.25å¢å¼º**:

```bash
# é™åˆ¶8GB
GOMEMLIMIT=8GiB ./myapp

# è‡ªåŠ¨ä»å®¹å™¨é™åˆ¶æ£€æµ‹ï¼ˆGo 1.25ï¼‰
./myapp  # è‡ªåŠ¨è¯»å–cgroupé™åˆ¶
```

**æ•ˆæœ**:
- GCä¼šåœ¨æ¥è¿‘é™åˆ¶æ—¶æ›´ç§¯æ
- é¿å…OOM
- æ›´å¯é¢„æµ‹çš„å†…å­˜ä½¿ç”¨

---

### 3.4 å‡å°‘GCå‹åŠ›

**æŠ€å·§1: å¯¹è±¡æ± **:
```go
var bufferPool = sync.Pool{
    New: func() interface{} {
        return make([]byte, 4096)
    },
}

func process() {
    buf := bufferPool.Get().([]byte)
    defer bufferPool.Put(buf)
    
    // ä½¿ç”¨buf...
}
```

**æŠ€å·§2: é¢„åˆ†é…**:
```go
// âŒ ä¸å¥½
slice := make([]int, 0)
for i := 0; i < 1000; i++ {
    slice = append(slice, i)  // å¤šæ¬¡æ‰©å®¹ï¼Œå¤šæ¬¡åˆ†é…
}

// âœ… å¥½
slice := make([]int, 0, 1000)  // é¢„åˆ†é…å®¹é‡
for i := 0; i < 1000; i++ {
    slice = append(slice, i)  // æ— éœ€æ‰©å®¹
}
```

**æŠ€å·§3: å­—ç¬¦ä¸²æ‹¼æ¥**:
```go
// âŒ ä¸å¥½
var s string
for _, item := range items {
    s += item  // æ¯æ¬¡åˆ†é…æ–°å­—ç¬¦ä¸²
}

// âœ… å¥½
var sb strings.Builder
sb.Grow(estimatedSize)  // é¢„åˆ†é…
for _, item := range items {
    sb.WriteString(item)  // æ— åˆ†é…
}
s := sb.String()
```

---

## 4. å®¹å™¨éƒ¨ç½²ä¼˜åŒ–

### 4.1 è‡ªåŠ¨å®¹å™¨æ„ŸçŸ¥

**Go 1.25è‡ªåŠ¨åŠŸèƒ½**:

```yaml
# Kubernetes Podé…ç½®
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: myapp
    image: myapp:go1.25
    resources:
      limits:
        cpu: "2"        # Goä¼šè‡ªåŠ¨è®¾ç½®GOMAXPROCS=2
        memory: "4Gi"   # Goä¼šè‡ªåŠ¨è®¾ç½®GOMEMLIMIT=4GiB
```

**éªŒè¯**:
```go
import "runtime"

func main() {
    fmt.Printf("GOMAXPROCS: %d\n", runtime.GOMAXPROCS(0))
    // è¾“å‡º: GOMAXPROCS: 2 (è‡ªåŠ¨æ£€æµ‹)
}
```

---

### 4.2 èµ„æºé…é¢ä¼˜åŒ–

**æœ€ä½³å®è·µ**:

```yaml
resources:
  requests:  # æœ€å°ä¿è¯
    cpu: "1"
    memory: "2Gi"
  limits:    # æœ€å¤§é™åˆ¶
    cpu: "2"
    memory: "4Gi"
```

**CPUè®¡ç®—**:
```
æ‰€éœ€CPU = (ç›®æ ‡RPS / å•æ ¸RPS) Ã— 1.2 (å®‰å…¨ç³»æ•°)

ç¤ºä¾‹:
- ç›®æ ‡: 10,000 RPS
- å•æ ¸æµ‹è¯•: 6,000 RPS
- æ‰€éœ€: 10000 / 6000 Ã— 1.2 = 2 cores
```

**å†…å­˜è®¡ç®—**:
```
æ‰€éœ€å†…å­˜ = åŸºç¡€å†…å­˜ + (å¹¶å‘æ•° Ã— å¹³å‡è¯·æ±‚å†…å­˜) Ã— 1.5

ç¤ºä¾‹:
- åŸºç¡€: 500MB
- å¹¶å‘: 1000
- å•è¯·æ±‚: 100KB
- æ‰€éœ€: 500MB + (1000 Ã— 100KB) Ã— 1.5 = 650MB
- é…ç½®: 1GB (å®‰å…¨ç³»æ•°)
```

---

### 4.3 äº²å’Œæ€§å’Œåäº²å’Œæ€§

```yaml
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchLabels:
            app: myapp
        topologyKey: kubernetes.io/hostname
```

**æ•ˆæœ**: åˆ†æ•£Podåˆ°ä¸åŒèŠ‚ç‚¹ï¼Œæé«˜å¯ç”¨æ€§

---

## 5. Mapæ€§èƒ½ä¼˜åŒ–

### 5.1 è§¦å‘Swiss Tables

**æ¡ä»¶**:
- Go 1.25+
- Mapå¤§å° > ~1000é”®
- é”®ç±»å‹: åŸºæœ¬ç±»å‹æˆ–string

**ç¤ºä¾‹**:
```go
// è‡ªåŠ¨ä½¿ç”¨Swiss Tables
m := make(map[string]int, 100000)

// é¢„åˆ†é…å®¹é‡å¾ˆé‡è¦
m := make(map[string]int, expectedSize)
```

---

### 5.2 Mapä½¿ç”¨æœ€ä½³å®è·µ

**é¢„åˆ†é…å®¹é‡**:
```go
// âŒ ä¸å¥½
m := make(map[string]int)
for i := 0; i < 10000; i++ {
    m[fmt.Sprint(i)] = i  // å¤šæ¬¡æ‰©å®¹
}

// âœ… å¥½
m := make(map[string]int, 10000)  // é¢„åˆ†é…
for i := 0; i < 10000; i++ {
    m[fmt.Sprint(i)] = i  // æ— éœ€æ‰©å®¹
}
```

**æ€§èƒ½å¯¹æ¯”**:
```
é¢„åˆ†é…: 0.8ms
ä¸é¢„åˆ†é…: 2.3ms (2.9xæ…¢)
```

---

**é¿å…è¿‡å¤§Map**:
```go
// å¦‚æœMapè¶…è¿‡1Mé”®ï¼Œè€ƒè™‘åˆ†ç‰‡
type ShardedMap struct {
    shards [256]*sync.Map  // 256ä¸ªåˆ†ç‰‡
}

func (m *ShardedMap) hash(key string) int {
    h := fnv.New32a()
    h.Write([]byte(key))
    return int(h.Sum32() % 256)
}

func (m *ShardedMap) Set(key string, value interface{}) {
    shard := m.hash(key)
    m.shards[shard].Store(key, value)
}
```

---

### 5.3 sync.Map vs æ™®é€šMap

**é€‰æ‹©æŒ‡å—**:

| åœºæ™¯ | æ¨è |
|------|------|
| é”®ç›¸å¯¹å›ºå®šï¼Œè¯»å¤šå†™å°‘ | sync.Map |
| é¢‘ç¹å†™å…¥ | map + RWMutex |
| å•goroutineè®¿é—® | æ™®é€šmap |
| é«˜å¹¶å‘è¯»å†™ | åˆ†ç‰‡map |

**æ€§èƒ½å¯¹æ¯”** (10K ops):
```
sync.Map (è¯»å¤š):    120Âµs
map+RWMutex (è¯»å¤š): 450Âµs
sync.Map (å†™å¤š):    850Âµs
map+RWMutex (å†™å¤š): 620Âµs  âœ… æ›´å¥½
```

---

## 6. å¹¶å‘ä¼˜åŒ–

### 6.1 ä½¿ç”¨WaitGroup.Go()

**ç®€åŒ–ä»£ç **:
```go
// ä¼ ç»Ÿæ–¹å¼
var wg sync.WaitGroup
for _, item := range items {
    wg.Add(1)
    item := item
    go func() {
        defer wg.Done()
        process(item)
    }()
}
wg.Wait()

// Go 1.25æ–¹å¼
var wg sync.WaitGroup
for _, item := range items {
    wg.Go(func() { process(item) })
}
wg.Wait()
```

---

### 6.2 é™åˆ¶å¹¶å‘æ•°

**Worker Poolæ¨¡å¼**:
```go
type WorkerPool struct {
    tasks chan func()
    wg    sync.WaitGroup
}

func NewWorkerPool(maxWorkers int) *WorkerPool {
    p := &WorkerPool{
        tasks: make(chan func(), maxWorkers*2),  // ç¼“å†²
    }
    
    // å¯åŠ¨workers
    for i := 0; i < maxWorkers; i++ {
        go p.worker()
    }
    
    return p
}

func (p *WorkerPool) worker() {
    for task := range p.tasks {
        task()
        p.wg.Done()
    }
}

func (p *WorkerPool) Submit(task func()) {
    p.wg.Add(1)
    p.tasks <- task
}

func (p *WorkerPool) Wait() {
    p.wg.Wait()
}
```

**ä½¿ç”¨**:
```go
pool := NewWorkerPool(runtime.NumCPU())
defer close(pool.tasks)

for _, item := range items {
    item := item
    pool.Submit(func() {
        process(item)
    })
}

pool.Wait()
```

---

### 6.3 é¿å…goroutineæ³„æ¼

**æ¨¡å¼1: ä½¿ç”¨Context**:
```go
func worker(ctx context.Context) {
    ticker := time.NewTicker(1 * time.Second)
    defer ticker.Stop()
    
    for {
        select {
        case <-ctx.Done():
            return  // ä¼˜é›…é€€å‡º
        case <-ticker.C:
            doWork()
        }
    }
}

// ä½¿ç”¨
ctx, cancel := context.WithCancel(context.Background())
go worker(ctx)

// åœæ­¢æ—¶
cancel()
```

**æ¨¡å¼2: Done Channel**:
```go
func worker(done <-chan struct{}) {
    for {
        select {
        case <-done:
            return
        default:
            doWork()
        }
    }
}

// ä½¿ç”¨
done := make(chan struct{})
go worker(done)

// åœæ­¢æ—¶
close(done)
```

---

## 7. å†…å­˜ä¼˜åŒ–

### 7.1 ä½¿ç”¨Arenaåˆ†é…å™¨

**é€‚ç”¨åœºæ™¯**: æ‰¹é‡å¯¹è±¡ï¼Œç›¸åŒç”Ÿå‘½å‘¨æœŸ

```go
import "arena"

func processBatch(items []Item) {
    a := arena.NewArena()
    defer a.Free()  // æ‰¹é‡é‡Šæ”¾
    
    results := make([]*Result, len(items))
    for i, item := range items {
        // åœ¨Arenaä¸­åˆ†é…
        results[i] = arena.New[Result](a)
        results[i].Process(item)
    }
    
    // ä½¿ç”¨results...
    
    // a.Free()ä¼šæ‰¹é‡é‡Šæ”¾æ‰€æœ‰å¯¹è±¡
}
```

**æ€§èƒ½æå‡**:
```
ä¼ ç»Ÿåˆ†é…: 10,000æ¬¡ç‹¬ç«‹åˆ†é…ï¼Œ3æ¬¡GC = 2.45ms
Arenaåˆ†é…: 1æ¬¡æ‰¹é‡åˆ†é…ï¼Œ0æ¬¡GC = 1.82ms (-26%)
```

---

### 7.2 weak.Pointerç¼“å­˜

```go
import "runtime/weak"

type Cache struct {
    mu    sync.RWMutex
    items map[string]weak.Pointer[*Value]
}

func (c *Cache) Get(key string) (*Value, bool) {
    c.mu.RLock()
    defer c.mu.RUnlock()
    
    if wp, ok := c.items[key]; ok {
        if v := wp.Value(); v != nil {
            return v, true  // ç¼“å­˜å‘½ä¸­
        }
        // å¯¹è±¡å·²è¢«GCï¼Œç¼“å­˜å¤±æ•ˆ
    }
    return nil, false
}

func (c *Cache) Set(key string, value *Value) {
    c.mu.Lock()
    defer c.mu.Unlock()
    
    c.items[key] = weak.Make(value)  // å¼±å¼•ç”¨
}
```

**å¥½å¤„**:
- ç¼“å­˜ä¸é˜»æ­¢GC
- è‡ªåŠ¨æ¸…ç†ä¸æ´»è·ƒå¯¹è±¡
- é¿å…å†…å­˜æ³„æ¼

---

### 7.3 å­—èŠ‚sliceå¤ç”¨

```go
var bufferPool = sync.Pool{
    New: func() interface{} {
        return make([]byte, 0, 4096)
    },
}

func handle(r *http.Request) []byte {
    buf := bufferPool.Get().([]byte)
    buf = buf[:0]  // é‡ç½®é•¿åº¦ä½†ä¿ç•™å®¹é‡
    defer bufferPool.Put(buf)
    
    // ä½¿ç”¨buf...
    
    // å¤åˆ¶æ•°æ®å‡ºå»ï¼ˆå› ä¸ºbufä¼šè¢«å½’è¿˜ï¼‰
    result := make([]byte, len(buf))
    copy(result, buf)
    return result
}
```

---

## 8. ç½‘ç»œä¼˜åŒ–

### 8.1 å¯ç”¨HTTP/3

**æœåŠ¡ç«¯**:
```go
import (
    "net/http"
    "github.com/quic-go/quic-go/http3"
)

func main() {
    handler := http.HandlerFunc(handleRequest)
    
    server := &http.Server{
        Addr:    ":443",
        Handler: handler,
    }
    
    // å¯ç”¨HTTP/3
    http3.ConfigureServer(server, &http3.Server{})
    
    // åŒæ—¶ç›‘å¬TCPå’ŒUDP
    go server.ListenAndServeTLS("cert.pem", "key.pem")
    log.Fatal(server.ListenAndServeQUIC("cert.pem", "key.pem"))
}
```

**å®¢æˆ·ç«¯**:
```go
client := &http.Client{
    Transport: &http3.Transport{},
}

resp, err := client.Get("https://example.com")
```

---

### 8.2 è¿æ¥æ± é…ç½®

```go
transport := &http.Transport{
    MaxIdleConns:        100,              // æœ€å¤§ç©ºé—²è¿æ¥
    MaxIdleConnsPerHost: 10,               // æ¯ä¸ªhostæœ€å¤§ç©ºé—²è¿æ¥
    IdleConnTimeout:     90 * time.Second, // ç©ºé—²è¿æ¥è¶…æ—¶
    DisableKeepAlives:   false,            // å¯ç”¨keep-alive
}

client := &http.Client{
    Transport: transport,
    Timeout:   10 * time.Second,
}
```

---

### 8.3 æ‰¹é‡æ“ä½œ

**æ‰¹é‡APIè¯·æ±‚**:
```go
type BatchRequest struct {
    IDs []string `json:"ids"`
}

func handleBatch(w http.ResponseWriter, r *http.Request) {
    var req BatchRequest
    json.NewDecoder(r.Body).Decode(&req)
    
    results := make([]*Result, len(req.IDs))
    
    // å¹¶è¡Œå¤„ç†
    var wg sync.WaitGroup
    for i, id := range req.IDs {
        wg.Go(func() {
            results[i] = fetchData(id)
        })
    }
    wg.Wait()
    
    json.NewEncoder(w).Encode(results)
}
```

**æ”¶ç›Š**: 
- å‡å°‘ç½‘ç»œå¾€è¿”
- å‡å°‘è¿æ¥å¼€é”€
- æå‡ååé‡

---

## 9. ç›‘æ§ä¸è§‚æµ‹

### 9.1 å…³é”®æŒ‡æ ‡

**åº”ç”¨çº§æŒ‡æ ‡**:
```go
import (
    "github.com/prometheus/client_golang/prometheus"
    "github.com/prometheus/client_golang/prometheus/promhttp"
)

var (
    requestDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "http_request_duration_seconds",
            Help: "HTTP request latency",
            Buckets: prometheus.DefBuckets,
        },
        []string{"method", "endpoint"},
    )
    
    gcPauseDuration = prometheus.NewGauge(
        prometheus.GaugeOpts{
            Name: "go_gc_pause_seconds",
            Help: "GC pause duration",
        },
    )
)

func init() {
    prometheus.MustRegister(requestDuration)
    prometheus.MustRegister(gcPauseDuration)
}

func recordMetrics() {
    var m runtime.MemStats
    runtime.ReadMemStats(&m)
    gcPauseDuration.Set(float64(m.PauseNs[(m.NumGC+255)%256]) / 1e9)
}
```

---

### 9.2 ä»ªè¡¨ç›˜

**Grafana dashboardç¤ºä¾‹**:

```json
{
  "dashboard": {
    "title": "Go 1.25 Performance",
    "panels": [
      {
        "title": "Request Rate",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])"
          }
        ]
      },
      {
        "title": "GC Pause",
        "targets": [
          {
            "expr": "go_gc_pause_seconds"
          }
        ]
      }
    ]
  }
}
```

---

### 9.3 å‘Šè­¦è§„åˆ™

```yaml
# Prometheus alerts
groups:
  - name: golang
    rules:
      - alert: HighGCPause
        expr: go_gc_pause_seconds > 0.001  # >1ms
        for: 5m
        annotations:
          summary: "High GC pause detected"
          
      - alert: HighMemoryUsage
        expr: go_memstats_alloc_bytes / go_memstats_sys_bytes > 0.9
        for: 10m
        annotations:
          summary: "Memory usage >90%"
```

---

## 10. æ¡ˆä¾‹ç ”ç©¶

### æ¡ˆä¾‹1: APIæœåŠ¡ä¼˜åŒ–

**åˆå§‹çŠ¶æ€**:
- RPS: 5,000
- P95å»¶è¿Ÿ: 85ms
- CPU: 8æ ¸ @ 90%

**ä¼˜åŒ–æ­¥éª¤**:

**Step 1: å‡çº§Go 1.25** (+15%)
```bash
go1.25.0 build -o myapp
```
ç»“æœ: RPS 5,750, P95 72ms

**Step 2: å®¹å™¨æ„ŸçŸ¥** (+20%)
```yaml
resources:
  limits:
    cpu: "6"  # ä»8æ ¸é™åˆ°6æ ¸
```
ç»“æœ: RPS 6,900, P95 68ms, CPU 6æ ¸ @ 85%

**Step 3: å¯ç”¨greentea GC** (+10%)
```bash
GOEXPERIMENT=greentea go build
```
ç»“æœ: RPS 7,590, P95 58ms

**æœ€ç»ˆ**:
- RPS: 7,590 (+51.8%)
- P95å»¶è¿Ÿ: 58ms (-31.8%)
- CPU: 6æ ¸ (-25% èµ„æº)
- **æˆæœ¬èŠ‚çœ**: 25%

---

### æ¡ˆä¾‹2: æ‰¹å¤„ç†ä¼˜åŒ–

**åˆå§‹**:
- å¤„ç†æ—¶é—´: 120s (10K items)
- å†…å­˜å³°å€¼: 8GB

**ä¼˜åŒ–**:

```go
// Before
func process(items []Item) {
    for _, item := range items {
        result := &Result{}  // å•ç‹¬åˆ†é…
        result.Process(item)
        save(result)
    }
}

// After: ä½¿ç”¨Arena
func process(items []Item) {
    a := arena.NewArena()
    defer a.Free()
    
    results := make([]*Result, len(items))
    for i, item := range items {
        results[i] = arena.New[Result](a)  // Arenaåˆ†é…
        results[i].Process(item)
    }
    
    saveBatch(results)  // æ‰¹é‡ä¿å­˜
}
```

**ç»“æœ**:
- å¤„ç†æ—¶é—´: 85s (-29%)
- å†…å­˜å³°å€¼: 5.5GB (-31%)
- GCæš‚åœ: ä»15sé™åˆ°3s (-80%)

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœæ€»ç»“

### å¿«é€Ÿæ”¶ç›ŠçŸ©é˜µ

| ä¼˜åŒ– | æ”¶ç›Š | éš¾åº¦ | æ¨èåº¦ |
|------|------|------|--------|
| å‡çº§Go 1.25 | â­â­â­â­ | â­ | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ |
| å®¹å™¨æ„ŸçŸ¥ | â­â­â­â­â­ | â­ | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ |
| greentea GC | â­â­â­â­ | â­â­ | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ |
| Mapé¢„åˆ†é… | â­â­â­ | â­ | ğŸ”¥ğŸ”¥ğŸ”¥ |
| Worker Pool | â­â­â­ | â­â­ | ğŸ”¥ğŸ”¥ğŸ”¥ |
| Arenaåˆ†é… | â­â­â­â­ | â­â­â­ | ğŸ”¥ğŸ”¥ğŸ”¥ |
| HTTP/3 | â­â­â­ | â­â­ | ğŸ”¥ğŸ”¥ |

---

## ğŸ¯ è¡ŒåŠ¨è®¡åˆ’

### ç¬¬1å‘¨
- [ ] åœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²Go 1.25
- [ ] è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å¯¹æ¯”ç»“æœï¼Œè®¡ç®—ROI

### ç¬¬2-3å‘¨
- [ ] ç°åº¦å‘å¸ƒåˆ°ç”Ÿäº§ï¼ˆ10% â†’ 50%ï¼‰
- [ ] ç›‘æ§å…³é”®æŒ‡æ ‡
- [ ] ä¼˜åŒ–å®¹å™¨èµ„æºé…ç½®

### ç¬¬4å‘¨
- [ ] å…¨é‡å‘å¸ƒ
- [ ] å¯ç”¨greentea GCï¼ˆå¯é€‰ï¼‰
- [ ] æ–‡æ¡£åŒ–ç»éªŒ

---

## ğŸ“š å‚è€ƒèµ„æº

- [æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š](./12-Go-1.25è¿è¡Œæ—¶ä¼˜åŒ–/æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š.md)
- [FAQ](./12-Go-1.25è¿è¡Œæ—¶ä¼˜åŒ–/FAQ.md)
- [Goå®˜æ–¹æ€§èƒ½æŒ‡å—](https://go.dev/doc/diagnostics)

---

**ä½œè€…**: AI Assistant  
**ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ18æ—¥

---

<p align="center">
  <b>ğŸš€ å¼€å§‹ä¼˜åŒ–ï¼Œæå‡æ€§èƒ½ï¼</b>
</p>

