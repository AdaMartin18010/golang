# éƒ¨ç½²æ¶æ„ä¸ç­–ç•¥

> **ç‰ˆæœ¬**: v1.0
> **æ—¥æœŸ**: 2025-01-XX

---

## ğŸ“‹ ç›®å½•

- [éƒ¨ç½²æ¶æ„ä¸ç­–ç•¥](#éƒ¨ç½²æ¶æ„ä¸ç­–ç•¥)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. éƒ¨ç½²æ¶æ„æ¦‚è¿°](#1-éƒ¨ç½²æ¶æ„æ¦‚è¿°)
    - [1.1 éƒ¨ç½²æ¶æ„å›¾](#11-éƒ¨ç½²æ¶æ„å›¾)
    - [1.2 éƒ¨ç½²å±‚æ¬¡](#12-éƒ¨ç½²å±‚æ¬¡)
  - [2. éƒ¨ç½²ç­–ç•¥](#2-éƒ¨ç½²ç­–ç•¥)
    - [2.1 éƒ¨ç½²æ¨¡å¼](#21-éƒ¨ç½²æ¨¡å¼)
    - [2.2 æ‰©å±•ç­–ç•¥](#22-æ‰©å±•ç­–ç•¥)
  - [3. éƒ¨ç½²æ–¹å¼](#3-éƒ¨ç½²æ–¹å¼)
    - [3.1 Docker éƒ¨ç½²](#31-docker-éƒ¨ç½²)
      - [3.1.1 Docker Compose](#311-docker-compose)
      - [3.1.2 HAProxy é…ç½®](#312-haproxy-é…ç½®)
    - [3.2 Kubernetes éƒ¨ç½²](#32-kubernetes-éƒ¨ç½²)
      - [3.2.1 Deployment](#321-deployment)
      - [3.2.2 Service](#322-service)
      - [3.2.3 HorizontalPodAutoscaler](#323-horizontalpodautoscaler)
  - [4. éƒ¨ç½²é…ç½®](#4-éƒ¨ç½²é…ç½®)
    - [4.1 ç¯å¢ƒå˜é‡é…ç½®](#41-ç¯å¢ƒå˜é‡é…ç½®)
    - [4.2 å¥åº·æ£€æŸ¥é…ç½®](#42-å¥åº·æ£€æŸ¥é…ç½®)
    - [4.3 èµ„æºé™åˆ¶é…ç½®](#43-èµ„æºé™åˆ¶é…ç½®)
  - [5. éƒ¨ç½²æœ€ä½³å®è·µ](#5-éƒ¨ç½²æœ€ä½³å®è·µ)
    - [5.1 å®¹å™¨åŒ–æœ€ä½³å®è·µ](#51-å®¹å™¨åŒ–æœ€ä½³å®è·µ)
    - [5.2 Kubernetes æœ€ä½³å®è·µ](#52-kubernetes-æœ€ä½³å®è·µ)
    - [5.3 ç›‘æ§å’Œè¿½è¸ª](#53-ç›‘æ§å’Œè¿½è¸ª)

---

## 1. éƒ¨ç½²æ¶æ„æ¦‚è¿°

### 1.1 éƒ¨ç½²æ¶æ„å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éƒ¨ç½²æ¶æ„å›¾                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Load       â”‚
                    â”‚   Balancer   â”‚
                    â”‚  (HAProxy)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Service â”‚       â”‚ Service â”‚       â”‚ Service â”‚
   â”‚  Pod 1  â”‚       â”‚  Pod 2  â”‚       â”‚  Pod 3  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚Database â”‚       â”‚  Cache  â”‚       â”‚   MQ    â”‚
   â”‚(PostgreSQL)     â”‚ (Redis) â”‚       â”‚ (Kafka) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 éƒ¨ç½²å±‚æ¬¡

| å±‚æ¬¡ | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| **è´Ÿè½½å‡è¡¡å±‚** | HAProxy/Nginx | è¯·æ±‚åˆ†å‘ã€å¥åº·æ£€æŸ¥ |
| **åº”ç”¨å±‚** | æœåŠ¡ Pod | åº”ç”¨å®ä¾‹ï¼ˆå¯æ°´å¹³æ‰©å±•ï¼‰ |
| **æ•°æ®å±‚** | æ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ— | æ•°æ®å­˜å‚¨å’Œæ¶ˆæ¯ä¼ é€’ |
| **ç›‘æ§å±‚** | Prometheusã€Grafana | ç›‘æ§å’Œå¯è§†åŒ– |
| **è¿½è¸ªå±‚** | Jaegerã€Tempo | åˆ†å¸ƒå¼è¿½è¸ª |

---

## 2. éƒ¨ç½²ç­–ç•¥

### 2.1 éƒ¨ç½²æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **å•å®ä¾‹éƒ¨ç½²** | å•ä¸ªæœåŠ¡å®ä¾‹ | å¼€å‘ã€æµ‹è¯•ç¯å¢ƒ |
| **å¤šå®ä¾‹éƒ¨ç½²** | å¤šä¸ªæœåŠ¡å®ä¾‹ | ç”Ÿäº§ç¯å¢ƒã€é«˜å¯ç”¨ |
| **è“ç»¿éƒ¨ç½²** | ä¸¤å¥—ç¯å¢ƒåˆ‡æ¢ | é›¶åœæœºéƒ¨ç½² |
| **é‡‘ä¸é›€éƒ¨ç½²** | é€æ­¥æµé‡åˆ‡æ¢ | ç°åº¦å‘å¸ƒ |
| **æ»šåŠ¨æ›´æ–°** | é€æ­¥æ›¿æ¢å®ä¾‹ | Kubernetes é»˜è®¤ç­–ç•¥ |

### 2.2 æ‰©å±•ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **æ°´å¹³æ‰©å±•** | å¢åŠ å®ä¾‹æ•°é‡ | é«˜å¹¶å‘åœºæ™¯ |
| **å‚ç›´æ‰©å±•** | å¢åŠ èµ„æºé…é¢ | èµ„æºå¯†é›†å‹åœºæ™¯ |
| **è‡ªåŠ¨æ‰©å±•** | æ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´ | åŠ¨æ€è´Ÿè½½åœºæ™¯ |

---

## 3. éƒ¨ç½²æ–¹å¼

### 3.1 Docker éƒ¨ç½²

#### 3.1.1 Docker Compose

```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=postgres://user:pass@db:5432/dbname
      - REDIS_URL=redis://cache:6379
    depends_on:
      - db
      - cache

  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=dbname
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data

  cache:
    image: redis:7
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

#### 3.1.2 HAProxy é…ç½®

```cfg
global
    daemon
    maxconn 4096

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http_front
    bind *:80
    default_backend http_back

backend http_back
    balance roundrobin
    option httpchk GET /health
    server app1 app1:8080 check
    server app2 app2:8080 check
    server app3 app3:8080 check
```

### 3.2 Kubernetes éƒ¨ç½²

#### 3.2.1 Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: app
  template:
    metadata:
      labels:
        app: app
    spec:
      containers:
      - name: app
        image: app:latest
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
```

#### 3.2.2 Service

```yaml
apiVersion: v1
kind: Service
metadata:
  name: app-service
spec:
  selector:
    app: app
  ports:
  - port: 80
    targetPort: 8080
  type: LoadBalancer
```

#### 3.2.3 HorizontalPodAutoscaler

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: app-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: app
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

---

## 4. éƒ¨ç½²é…ç½®

### 4.1 ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ | å¿…éœ€ |
|------|------|--------|------|
| `DATABASE_URL` | æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² | - | âœ… |
| `REDIS_URL` | Redis è¿æ¥å­—ç¬¦ä¸² | - | âŒ |
| `KAFKA_BROKERS` | Kafka Broker åœ°å€ | - | âŒ |
| `OTLP_ENDPOINT` | OTLP ç«¯ç‚¹åœ°å€ | - | âŒ |
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | `info` | âŒ |
| `PORT` | æœåŠ¡ç«¯å£ | `8080` | âŒ |

### 4.2 å¥åº·æ£€æŸ¥é…ç½®

```go
// å¥åº·æ£€æŸ¥ç«¯ç‚¹
GET /health   - å­˜æ´»æ¢é’ˆï¼ˆLiveness Probeï¼‰
GET /ready    - å°±ç»ªæ¢é’ˆï¼ˆReadiness Probeï¼‰
GET /startup  - å¯åŠ¨æ¢é’ˆï¼ˆStartup Probeï¼‰
```

### 4.3 èµ„æºé™åˆ¶é…ç½®

```yaml
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi
```

---

## 5. éƒ¨ç½²æœ€ä½³å®è·µ

### 5.1 å®¹å™¨åŒ–æœ€ä½³å®è·µ

1. **å¤šé˜¶æ®µæ„å»º**ï¼šå‡å°‘é•œåƒå¤§å°
2. **é root ç”¨æˆ·**ï¼šæé«˜å®‰å…¨æ€§
3. **å¥åº·æ£€æŸ¥**ï¼šç¡®ä¿æœåŠ¡å¯ç”¨æ€§
4. **èµ„æºé™åˆ¶**ï¼šé˜²æ­¢èµ„æºè€—å°½
5. **æ—¥å¿—æ”¶é›†**ï¼šç»Ÿä¸€æ—¥å¿—ç®¡ç†

### 5.2 Kubernetes æœ€ä½³å®è·µ

1. **ä½¿ç”¨ Deployment**ï¼šæ”¯æŒæ»šåŠ¨æ›´æ–°
2. **é…ç½® ConfigMap å’Œ Secret**ï¼šç®¡ç†é…ç½®å’Œå¯†é’¥
3. **ä½¿ç”¨ Service**ï¼šæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
4. **é…ç½® HPA**ï¼šè‡ªåŠ¨æ‰©å±•
5. **ä½¿ç”¨ Ingress**ï¼šå¤–éƒ¨è®¿é—®ç®¡ç†

### 5.3 ç›‘æ§å’Œè¿½è¸ª

1. **é›†æˆ Prometheus**ï¼šæŒ‡æ ‡æ”¶é›†
2. **é›†æˆ Grafana**ï¼šå¯è§†åŒ–
3. **é›†æˆ Jaeger/Tempo**ï¼šåˆ†å¸ƒå¼è¿½è¸ª
4. **é…ç½®å‘Šè­¦**ï¼šåŠæ—¶å‘ç°é—®é¢˜

---

**æœ€åæ›´æ–°**: 2025-01-XX
