# å·¥ä½œæµä½¿ç”¨æŒ‡å—

> **ç®€ä»‹**: æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨æœ¬é¡¹ç›®ä¸­çš„ Temporal å·¥ä½œæµåŠŸèƒ½ï¼ŒåŒ…æ‹¬å¿«é€Ÿå¼€å§‹ã€API ä½¿ç”¨å’Œå·¥ä½œæµå®šä¹‰ã€‚

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-11
**é€‚ç”¨äº**: Go 1.25.3

---

## ğŸ“‹ ç›®å½•

- [å·¥ä½œæµä½¿ç”¨æŒ‡å—](#å·¥ä½œæµä½¿ç”¨æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. ğŸ“š æ¦‚è¿°](#1--æ¦‚è¿°)
    - [1.1 ç»„ä»¶](#11-ç»„ä»¶)
    - [1.2 å·¥ä½œæµç±»å‹](#12-å·¥ä½œæµç±»å‹)
  - [2. ğŸš€ å¿«é€Ÿå¼€å§‹](#2--å¿«é€Ÿå¼€å§‹)
    - [2.1 å¯åŠ¨ Temporal Server](#21-å¯åŠ¨-temporal-server)
    - [2.2 å¯åŠ¨ Worker](#22-å¯åŠ¨-worker)
    - [2.3 å¯åŠ¨åº”ç”¨](#23-å¯åŠ¨åº”ç”¨)
    - [2.4 è®¿é—® Temporal UI](#24-è®¿é—®-temporal-ui)
  - [3. ğŸ’» ä½¿ç”¨å·¥ä½œæµ](#3--ä½¿ç”¨å·¥ä½œæµ)
    - [3.1 å¯åŠ¨å·¥ä½œæµ](#31-å¯åŠ¨å·¥ä½œæµ)
    - [3.2 æŸ¥è¯¢å·¥ä½œæµç»“æœ](#32-æŸ¥è¯¢å·¥ä½œæµç»“æœ)
  - [4. ğŸ”§ å·¥ä½œæµå®šä¹‰](#4--å·¥ä½œæµå®šä¹‰)
    - [4.1 UserWorkflow](#41-userworkflow)
    - [4.2 æ´»åŠ¨ï¼ˆActivitiesï¼‰](#42-æ´»åŠ¨activities)
  - [5. âš™ï¸ é…ç½®](#5-ï¸-é…ç½®)
    - [5.1 é…ç½®æ–‡ä»¶](#51-é…ç½®æ–‡ä»¶)
    - [5.2 ç¯å¢ƒå˜é‡](#52-ç¯å¢ƒå˜é‡)
  - [6. ğŸ” ç›‘æ§å’Œè°ƒè¯•](#6--ç›‘æ§å’Œè°ƒè¯•)
    - [6.1 Temporal UI](#61-temporal-ui)
    - [6.2 æŒ‡æ ‡](#62-æŒ‡æ ‡)
    - [6.3 æ•…éšœæ’é™¤](#63-æ•…éšœæ’é™¤)
      - [Worker æ— æ³•è¿æ¥](#worker-æ— æ³•è¿æ¥)
      - [å·¥ä½œæµæ‰§è¡Œå¤±è´¥](#å·¥ä½œæµæ‰§è¡Œå¤±è´¥)
  - [7. ğŸ“š æ‰©å±•é˜…è¯»](#7--æ‰©å±•é˜…è¯»)

---

## 1. ğŸ“š æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ [Temporal](https://temporal.io/) ä½œä¸ºå·¥ä½œæµç¼–æ’å¼•æ“ï¼Œç”¨äºæ„å»ºå¯é çš„åˆ†å¸ƒå¼åº”ç”¨ã€‚

### 1.1 ç»„ä»¶

1. **Temporal Server** - å·¥ä½œæµå¼•æ“
2. **Worker** - æ‰§è¡Œå·¥ä½œæµå’Œæ´»åŠ¨
3. **Client** - å¯åŠ¨å’ŒæŸ¥è¯¢å·¥ä½œæµ

### 1.2 å·¥ä½œæµç±»å‹

- **UserWorkflow** - ç”¨æˆ·ç›¸å…³æ“ä½œå·¥ä½œæµ
  - åˆ›å»ºç”¨æˆ·
  - æ›´æ–°ç”¨æˆ·
  - åˆ é™¤ç”¨æˆ·

---

## 2. ğŸš€ å¿«é€Ÿå¼€å§‹

### 2.1 å¯åŠ¨ Temporal Server

ä½¿ç”¨ Docker Composeï¼š

```bash
cd deployments/docker
docker-compose up -d temporal temporal-db temporal-ui
```

### 2.2 å¯åŠ¨ Worker

```bash
go run ./cmd/temporal-worker
```

### 2.3 å¯åŠ¨åº”ç”¨

```bash
go run ./cmd/server
```

### 2.4 è®¿é—® Temporal UI

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š<http://localhost:8088>

---

## 3. ğŸ’» ä½¿ç”¨å·¥ä½œæµ

### 3.1 å¯åŠ¨å·¥ä½œæµ

```bash
curl -X POST http://localhost:8080/api/v1/workflows/user \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user-123",
    "email": "test@example.com",
    "name": "Test User",
    "action": "create"
  }'
```

### 3.2 æŸ¥è¯¢å·¥ä½œæµç»“æœ

```bash
curl http://localhost:8080/api/v1/workflows/user/{workflow_id}?run_id={run_id}
```

---

## 4. ğŸ”§ å·¥ä½œæµå®šä¹‰

### 4.1 UserWorkflow

ç”¨æˆ·å·¥ä½œæµå¤„ç†ç”¨æˆ·ç›¸å…³çš„æ“ä½œï¼ŒåŒ…æ‹¬ï¼š

1. **åˆ›å»ºç”¨æˆ·**
   - éªŒè¯ç”¨æˆ·ä¿¡æ¯
   - åˆ›å»ºç”¨æˆ·
   - å‘é€é€šçŸ¥

2. **æ›´æ–°ç”¨æˆ·**
   - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
   - å‘é€é€šçŸ¥

3. **åˆ é™¤ç”¨æˆ·**
   - åˆ é™¤ç”¨æˆ·
   - å‘é€é€šçŸ¥

### 4.2 æ´»åŠ¨ï¼ˆActivitiesï¼‰

- `ValidateUserActivity` - éªŒè¯ç”¨æˆ·ä¿¡æ¯
- `CreateUserActivity` - åˆ›å»ºç”¨æˆ·
- `UpdateUserActivity` - æ›´æ–°ç”¨æˆ·
- `DeleteUserActivity` - åˆ é™¤ç”¨æˆ·
- `SendNotificationActivity` - å‘é€é€šçŸ¥

---

## 5. âš™ï¸ é…ç½®

åœ¨ `configs/config.yaml` ä¸­é…ç½®ï¼š

```yaml
workflow:
  temporal:
    address: "localhost:7233"
    task_queue: "user-task-queue"
    namespace: "default"
```

### 5.1 é…ç½®æ–‡ä»¶

åœ¨ `configs/config.yaml` ä¸­é…ç½®ï¼š

```yaml
workflow:
  temporal:
    address: "localhost:7233"
    task_queue: "user-task-queue"
    namespace: "default"
```

### 5.2 ç¯å¢ƒå˜é‡

ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š

```bash
export TEMPORAL_ADDRESS=localhost:7233
export TEMPORAL_TASK_QUEUE=user-task-queue
```

---

## 6. ğŸ” ç›‘æ§å’Œè°ƒè¯•

### 6.1 Temporal UI

è®¿é—® <http://localhost:8088> æŸ¥çœ‹ï¼š

- å·¥ä½œæµæ‰§è¡Œå†å²
- æ´»åŠ¨æ‰§è¡ŒçŠ¶æ€
- å·¥ä½œæµæŸ¥è¯¢å’Œä¿¡å·

### 6.2 æŒ‡æ ‡

Temporal æä¾›ä¸°å¯Œçš„æŒ‡æ ‡ï¼Œå¯ä»¥é›†æˆåˆ° Prometheus å’Œ Grafanaã€‚

### 6.3 æ•…éšœæ’é™¤

#### Worker æ— æ³•è¿æ¥

- æ£€æŸ¥ Temporal Server æ˜¯å¦è¿è¡Œ
- éªŒè¯è¿æ¥åœ°å€é…ç½®
- æ£€æŸ¥ç½‘ç»œè¿æ¥

#### å·¥ä½œæµæ‰§è¡Œå¤±è´¥

- æŸ¥çœ‹ Temporal UI ä¸­çš„é”™è¯¯ä¿¡æ¯
- æ£€æŸ¥æ´»åŠ¨æ—¥å¿—
- éªŒè¯è¾“å…¥å‚æ•°

---

## 7. ğŸ“š æ‰©å±•é˜…è¯»

- [Temporal å®˜æ–¹æ–‡æ¡£](https://docs.temporal.io/)
- [Temporal Go SDK](https://docs.temporal.io/dev-guide/go)
- [å·¥ä½œæµæ¨¡å¼](https://docs.temporal.io/workflows)
- [å·¥ä½œæµæ¶æ„è®¾è®¡](../architecture/workflow.md) - æ¶æ„è®¾è®¡è¯¦è§£

---

> ğŸ“š **ç®€ä»‹**
> æœ¬æ–‡æ·±å…¥æ¢è®¨ Temporal å·¥ä½œæµçš„ä½¿ç”¨æ–¹æ³•ï¼Œç³»ç»Ÿè®²è§£å¿«é€Ÿå¼€å§‹ã€API ä½¿ç”¨ã€å·¥ä½œæµå®šä¹‰å’Œæœ€ä½³å®è·µã€‚é€šè¿‡æœ¬æ–‡ï¼Œæ‚¨å°†å…¨é¢æŒæ¡å·¥ä½œæµçš„ä½¿ç”¨æ–¹æ³•ã€‚
