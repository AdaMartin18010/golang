# æµ‹è¯•æœ€ä½³å®è·µ

**éš¾åº¦**: ä¸­çº§ | **é¢„è®¡é˜…è¯»**: 15åˆ†é’Ÿ | **å‰ç½®çŸ¥è¯†**: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•

---

## ğŸ“‹ ç›®å½•

- [1. ğŸ“– æ¦‚å¿µä»‹ç»](#1--æ¦‚å¿µä»‹ç»)
- [2. ğŸ¯ æ ¸å¿ƒåŸåˆ™](#2--æ ¸å¿ƒåŸåˆ™)
- [3. ğŸ’¡ æœ€ä½³å®è·µæ¸…å•](#3--æœ€ä½³å®è·µæ¸…å•)
- [4. ğŸ”§ å·¥å…·æ¨è](#4--å·¥å…·æ¨è)
- [5. ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•](#5--æµ‹è¯•æ£€æŸ¥æ¸…å•)
- [6. âš ï¸ å¸¸è§é™·é˜±](#6-ï¸-å¸¸è§é™·é˜±)
- [7. ğŸ“š ç›¸å…³èµ„æº](#7--ç›¸å…³èµ„æº)

---

## 1. ğŸ“– æ¦‚å¿µä»‹ç»

æµ‹è¯•æœ€ä½³å®è·µæ˜¯ç»è¿‡éªŒè¯çš„æµ‹è¯•æ–¹æ³•å’ŒåŸåˆ™ï¼Œéµå¾ªè¿™äº›å®è·µå¯ä»¥ç¼–å†™å‡ºé«˜è´¨é‡ã€å¯ç»´æŠ¤çš„æµ‹è¯•ä»£ç ã€‚

---

## 2. ğŸ¯ æ ¸å¿ƒåŸåˆ™

### 2.1 æµ‹è¯•é‡‘å­—å¡”

```
        /\
       /  \
      / E2E \       å°‘é‡ï¼šç«¯åˆ°ç«¯æµ‹è¯•
     /-------\
    /é›†æˆæµ‹è¯• \      é€‚é‡ï¼šé›†æˆæµ‹è¯•
   /-----------\
  /  å•å…ƒæµ‹è¯•   \    å¤§é‡ï¼šå•å…ƒæµ‹è¯•
 /--------------\
```

**æ¯”ä¾‹å»ºè®®**: 70% å•å…ƒ + 20% é›†æˆ + 10% E2E

---

### 2.2 FIRSTåŸåˆ™

- **F**ast - å¿«é€Ÿï¼šæµ‹è¯•åº”è¯¥å¿«é€Ÿæ‰§è¡Œ
- **I**solated - éš”ç¦»ï¼šæµ‹è¯•äº’ä¸ä¾èµ–
- **R**epeatable - å¯é‡å¤ï¼šæ¯æ¬¡è¿è¡Œç»“æœä¸€è‡´
- **S**elf-validating - è‡ªéªŒè¯ï¼šè‡ªåŠ¨åˆ¤æ–­é€šè¿‡/å¤±è´¥
- **T**imely - åŠæ—¶ï¼šä¸ç”Ÿäº§ä»£ç åŒæ­¥ç¼–å†™

---

### 2.3 AAAæ¨¡å¼

```go
func TestUserService_Create(t *testing.T) {
    // Arrangeï¼ˆå‡†å¤‡ï¼‰
    repo := setupMockRepository()
    service := NewUserService(repo)
    user := &User{Name: "Alice", Email: "alice@example.com"}
    
    // Actï¼ˆæ‰§è¡Œï¼‰
    err := service.Create(user)
    
    // Assertï¼ˆæ–­è¨€ï¼‰
    if err != nil {
        t.Errorf("Create() failed: %v", err)
    }
}
```

---

## 3. ğŸ’¡ æœ€ä½³å®è·µæ¸…å•

### 3.1 æµ‹è¯•å‘½å

```go
// âœ… å¥½ï¼šæè¿°æµ‹è¯•åœºæ™¯
func TestUserService_Create_WithValidData_Succeeds(t *testing.T)
func TestUserService_Create_WithDuplicateEmail_ReturnsError(t *testing.T)

// âŒ å·®ï¼šä¸æ¸…æ™°
func TestCreate(t *testing.T)
func TestCreate2(t *testing.T)
```

---

### 3.2 æµ‹è¯•ç‹¬ç«‹æ€§

```go
// âœ… å¥½ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹
func TestAdd(t *testing.T) {
    result := Add(2, 3)
    assert.Equal(t, 5, result)
}

func TestSubtract(t *testing.T) {
    result := Subtract(5, 3)
    assert.Equal(t, 2, result)
}

// âŒ å·®ï¼šæµ‹è¯•ä¾èµ–å…¨å±€çŠ¶æ€
var globalCounter int

func TestIncrement(t *testing.T) {
    globalCounter++ // ä¾èµ–æ‰§è¡Œé¡ºåº
    assert.Equal(t, 1, globalCounter)
}
```

---

### 3.3 ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªæ–­è¨€

```go
// âœ… å¥½ï¼šå…³æ³¨ç‚¹å•ä¸€
func TestUser_Name(t *testing.T) {
    user := User{Name: "Alice"}
    assert.Equal(t, "Alice", user.Name)
}

func TestUser_Email(t *testing.T) {
    user := User{Email: "alice@example.com"}
    assert.Equal(t, "alice@example.com", user.Email)
}

// âŒ å·®ï¼šå¤šä¸ªæ–­è¨€
func TestUser(t *testing.T) {
    user := User{Name: "Alice", Email: "alice@example.com"}
    assert.Equal(t, "Alice", user.Name)
    assert.Equal(t, "alice@example.com", user.Email) // ç¬¬ä¸€ä¸ªå¤±è´¥åä¸ä¼šæ‰§è¡Œ
}
```

---

### 3.4 æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯

```go
// âœ… å¥½ï¼šæ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
func TestAdd(t *testing.T) {
    got := Add(2, 3)
    want := 5
    if got != want {
        t.Errorf("Add(2, 3) = %d; want %d", got, want)
    }
}

// âŒ å·®ï¼šä¸æ¸…æ™°
func TestAdd(t *testing.T) {
    if Add(2, 3) != 5 {
        t.Error("failed")
    }
}
```

---

### 3.5 æµ‹è¯•è¾¹ç•Œæ¡ä»¶

```go
func TestDivide(t *testing.T) {
    tests := []struct {
        name string
        a, b float64
        want float64
        wantErr bool
    }{
        {"æ­£å¸¸æƒ…å†µ", 10, 2, 5, false},
        {"é™¤ä»¥é›¶", 10, 0, 0, true},          // è¾¹ç•Œ
        {"è´Ÿæ•°", -10, 2, -5, false},
        {"é›¶é™¤ä»¥æ•°", 0, 5, 0, false},        // è¾¹ç•Œ
        {"æå¤§æ•°", math.MaxFloat64, 2, math.MaxFloat64/2, false}, // è¾¹ç•Œ
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got, err := Divide(tt.a, tt.b)
            if (err != nil) != tt.wantErr {
                t.Errorf("wantErr %v, got err %v", tt.wantErr, err)
            }
            if !tt.wantErr && got != tt.want {
                t.Errorf("got %v, want %v", got, tt.want)
            }
        })
    }
}
```

---

### 3.6 ä½¿ç”¨Table-Driven Tests

```go
// âœ… å¥½ï¼šè¡¨æ ¼é©±åŠ¨
func TestValidateEmail(t *testing.T) {
    tests := []struct {
        email string
        valid bool
    }{
        {"valid@example.com", true},
        {"invalid", false},
        {"@example.com", false},
        {"user@", false},
        {"", false},
    }
    
    for _, tt := range tests {
        t.Run(tt.email, func(t *testing.T) {
            got := ValidateEmail(tt.email)
            if got != tt.valid {
                t.Errorf("ValidateEmail(%q) = %v; want %v", tt.email, got, tt.valid)
            }
        })
    }
}
```

---

### 3.7 æµ‹è¯•åº”è¯¥å¿«é€Ÿ

```go
// âœ… å¥½ï¼šå¿«é€Ÿæµ‹è¯•
func TestQuickOperation(t *testing.T) {
    result := QuickCalculation(10)
    assert.Equal(t, 100, result)
}

// âŒ å·®ï¼šæ…¢æµ‹è¯•
func TestSlowOperation(t *testing.T) {
    time.Sleep(5 * time.Second) // é¿å…
    // ...
}

// âœ… æ”¹è¿›ï¼šä½¿ç”¨Shortæ¨¡å¼è·³è¿‡æ…¢æµ‹è¯•
func TestSlowOperation(t *testing.T) {
    if testing.Short() {
        t.Skip("Skipping slow test in short mode")
    }
    // ... æ…¢æ“ä½œ
}

// è¿è¡Œï¼šgo test -short
```

---

### 3.8 æ­£ç¡®ä½¿ç”¨t.Helper()

```go
func assertEqual(t *testing.T, got, want int) {
    t.Helper() // æ ‡è®°ä¸ºè¾…åŠ©å‡½æ•°
    if got != want {
        t.Errorf("got %d, want %d", got, want) // é”™è¯¯ä¼šæŒ‡å‘è°ƒç”¨è€…
    }
}

func TestSomething(t *testing.T) {
    result := Calculate(10)
    assertEqual(t, result, 100) // å¦‚æœå¤±è´¥ï¼Œé”™è¯¯æŒ‡å‘è¿™ä¸€è¡Œ
}
```

---

### 3.9 æ¸…ç†èµ„æº

```go
func TestWithCleanup(t *testing.T) {
    // Setup
    file, err := os.Create("test.txt")
    if err != nil {
        t.Fatal(err)
    }
    
    // æ³¨å†Œæ¸…ç†å‡½æ•°
    t.Cleanup(func() {
        file.Close()
        os.Remove("test.txt")
    })
    
    // æµ‹è¯•é€»è¾‘
    _, err = file.WriteString("test data")
    if err != nil {
        t.Fatal(err)
    }
}
```

---

### 3.10 æµ‹è¯•é”™è¯¯æƒ…å†µ

```go
func TestUserService_Create_ErrorCases(t *testing.T) {
    tests := []struct {
        name    string
        user    *User
        wantErr string
    }{
        {
            name:    "ç©ºç”¨æˆ·å",
            user:    &User{Name: "", Email: "test@example.com"},
            wantErr: "name is required",
        },
        {
            name:    "æ— æ•ˆé‚®ç®±",
            user:    &User{Name: "Alice", Email: "invalid"},
            wantErr: "invalid email format",
        },
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            service := NewUserService(mockRepo)
            err := service.Create(tt.user)
            
            if err == nil {
                t.Error("expected error, got nil")
            } else if err.Error() != tt.wantErr {
                t.Errorf("error = %q, want %q", err.Error(), tt.wantErr)
            }
        })
    }
}
```

---

## 4. ğŸ”§ å·¥å…·æ¨è

### 4.1 testify
```go
import "github.com/stretchr/testify/assert"

func TestSomething(t *testing.T) {
    assert.Equal(t, expected, actual)
    assert.NoError(t, err)
    assert.True(t, condition)
}
```

### 4.2 gomock
```bash
go install github.com/golang/mock/mockgen@latest
```

### 4.3 golangci-lint
```bash
golangci-lint run --enable=testpackage
```

---

## 5. ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

### ç¼–å†™æµ‹è¯•å‰
- [ ] æ˜ç¡®æµ‹è¯•ç›®æ ‡
- [ ] è¯†åˆ«è¾¹ç•Œæ¡ä»¶
- [ ] è§„åˆ’æµ‹è¯•ç”¨ä¾‹

### ç¼–å†™æµ‹è¯•æ—¶
- [ ] ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- [ ] éµå¾ªAAAæ¨¡å¼
- [ ] ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªå…³æ³¨ç‚¹
- [ ] åŒ…å«æ­£å¸¸å’Œé”™è¯¯æƒ…å†µ
- [ ] æµ‹è¯•è¾¹ç•Œå€¼

### ç¼–å†™æµ‹è¯•å
- [ ] æµ‹è¯•èƒ½ç‹¬ç«‹è¿è¡Œ
- [ ] æµ‹è¯•è¿è¡Œå¿«é€Ÿ
- [ ] æœ‰æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
- [ ] èµ„æºæ­£ç¡®æ¸…ç†
- [ ] è¦†ç›–ç‡è¾¾æ ‡

---

## 6. âš ï¸ å¸¸è§é™·é˜±

### 6.1 æµ‹è¯•å®ç°è€Œéè¡Œä¸º
```go
// âŒ å·®ï¼šæµ‹è¯•å®ç°ç»†èŠ‚
func TestUserService_Create(t *testing.T) {
    // æµ‹è¯•å†…éƒ¨å¦‚ä½•è°ƒç”¨æ•°æ®åº“
}

// âœ… å¥½ï¼šæµ‹è¯•è¡Œä¸º
func TestUserService_Create(t *testing.T) {
    // æµ‹è¯•ç”¨æˆ·æ˜¯å¦è¢«æ­£ç¡®åˆ›å»º
}
```

### 6.2 è¿‡åº¦Mock
```go
// âŒ å·®ï¼šMockå¤ªå¤š
mockRepo := NewMockRepo()
mockCache := NewMockCache()
mockLogger := NewMockLogger()
mockMetrics := NewMockMetrics()
// ... å¤ªå¤šMock

// âœ… å¥½ï¼šåªMockå¿…è¦çš„
mockRepo := NewMockRepo()
service := NewUserService(mockRepo)
```

### 6.3 æµ‹è¯•é—´æœ‰ä¾èµ–
```go
// âŒ å·®ï¼šæµ‹è¯•ä¾èµ–é¡ºåº
func TestA(t *testing.T) {
    setupGlobalState()
}

func TestB(t *testing.T) {
    useGlobalState() // ä¾èµ–TestA
}
```

---

## 7. ğŸ“š ç›¸å…³èµ„æº

- [Go Testing Guide](https://go.dev/doc/code#Testing)
- [Table Driven Tests](https://go.dev/wiki/TableDrivenTests)
- [testify](https://github.com/stretchr/testify)

---

**æœ€åæ›´æ–°**: 2025-10-28
