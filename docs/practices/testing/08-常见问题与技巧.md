# å¸¸è§é—®é¢˜ä¸æŠ€å·§

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-29
**é€‚ç”¨äº**: Go 1.25.3

---

## ğŸ“‹ ç›®å½•

- [å¸¸è§é—®é¢˜ä¸æŠ€å·§](#å¸¸è§é—®é¢˜ä¸æŠ€å·§)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. ğŸ“– æ¦‚å¿µä»‹ç»](#1--æ¦‚å¿µä»‹ç»)
  - [2. âš ï¸ å¸¸è§é—®é¢˜](#2-ï¸-å¸¸è§é—®é¢˜)
    - [2.1 Q1: å¦‚ä½•æµ‹è¯•unexportedå‡½æ•°ï¼Ÿ](#21-q1-å¦‚ä½•æµ‹è¯•unexportedå‡½æ•°)
    - [2.2 Q2: å¦‚ä½•å¤„ç†time.Now()ï¼Ÿ](#22-q2-å¦‚ä½•å¤„ç†timenow)
    - [2.3 Q3: æµ‹è¯•panicæ€ä¹ˆåŠï¼Ÿ](#23-q3-æµ‹è¯•panicæ€ä¹ˆåŠ)
    - [2.4 Q4: å¦‚ä½•æµ‹è¯•goroutineï¼Ÿ](#24-q4-å¦‚ä½•æµ‹è¯•goroutine)
    - [2.5 Q5: å¹¶å‘æµ‹è¯•å¦‚ä½•æ£€æµ‹ç«æ€ï¼Ÿ](#25-q5-å¹¶å‘æµ‹è¯•å¦‚ä½•æ£€æµ‹ç«æ€)
    - [2.6 Q6: å¦‚ä½•è·³è¿‡é•¿æ—¶é—´æµ‹è¯•ï¼Ÿ](#26-q6-å¦‚ä½•è·³è¿‡é•¿æ—¶é—´æµ‹è¯•)
    - [2.7 Q7: æµ‹è¯•æ–‡ä»¶åº”è¯¥æ”¾å“ªé‡Œï¼Ÿ](#27-q7-æµ‹è¯•æ–‡ä»¶åº”è¯¥æ”¾å“ªé‡Œ)
    - [2.8 Q8: å¦‚ä½•æµ‹è¯•æ ‡å‡†è¾“å‡ºï¼Ÿ](#28-q8-å¦‚ä½•æµ‹è¯•æ ‡å‡†è¾“å‡º)
  - [3. ğŸ’¡ å®ç”¨æŠ€å·§](#3--å®ç”¨æŠ€å·§)
    - [3.1 æŠ€å·§1: ä½¿ç”¨TestMainè‡ªå®šä¹‰æµ‹è¯•æµç¨‹](#31-æŠ€å·§1-ä½¿ç”¨testmainè‡ªå®šä¹‰æµ‹è¯•æµç¨‹)
    - [3.2 æŠ€å·§2: ç”Ÿæˆæµ‹è¯•æ•°æ®](#32-æŠ€å·§2-ç”Ÿæˆæµ‹è¯•æ•°æ®)
    - [3.3 æŠ€å·§3: å¹¶è¡Œæµ‹è¯•](#33-æŠ€å·§3-å¹¶è¡Œæµ‹è¯•)
    - [3.4 æŠ€å·§4: ä¸´æ—¶ç›®å½•](#34-æŠ€å·§4-ä¸´æ—¶ç›®å½•)
    - [3.5 æŠ€å·§5: æ¡ä»¶ç¼–è¯‘æµ‹è¯•](#35-æŠ€å·§5-æ¡ä»¶ç¼–è¯‘æµ‹è¯•)
    - [3.6 æŠ€å·§6: æµ‹è¯•ç‰¹å®šå‡½æ•°](#36-æŠ€å·§6-æµ‹è¯•ç‰¹å®šå‡½æ•°)
    - [3.7 æŠ€å·§7: è¯¦ç»†è¾“å‡º](#37-æŠ€å·§7-è¯¦ç»†è¾“å‡º)
    - [3.8 æŠ€å·§8: æµ‹è¯•è¶…æ—¶](#38-æŠ€å·§8-æµ‹è¯•è¶…æ—¶)
  - [4. ğŸ”§ è°ƒè¯•æŠ€å·§](#4--è°ƒè¯•æŠ€å·§)
    - [4.1 æ‰“å°è°ƒè¯•ä¿¡æ¯](#41-æ‰“å°è°ƒè¯•ä¿¡æ¯)
    - [4.2 ä½¿ç”¨Delveè°ƒè¯•å™¨](#42-ä½¿ç”¨delveè°ƒè¯•å™¨)
    - [4.3 ç”Ÿæˆæµ‹è¯•å¤±è´¥æŠ¥å‘Š](#43-ç”Ÿæˆæµ‹è¯•å¤±è´¥æŠ¥å‘Š)
  - [5. ğŸ“Š æ€§èƒ½åˆ†ææŠ€å·§](#5--æ€§èƒ½åˆ†ææŠ€å·§)
    - [5.1 æŸ¥æ‰¾æ…¢æµ‹è¯•](#51-æŸ¥æ‰¾æ…¢æµ‹è¯•)
    - [5.2 åˆ†ææµ‹è¯•è¦†ç›–ç‡](#52-åˆ†ææµ‹è¯•è¦†ç›–ç‡)
  - [6. ğŸ“š å·¥å…·æ¨è](#6--å·¥å…·æ¨è)
  - [7. ğŸ¯ æµ‹è¯•ä¼˜åŒ–æ¸…å•](#7--æµ‹è¯•ä¼˜åŒ–æ¸…å•)
  - [8. ğŸ“š ç›¸å…³èµ„æº](#8--ç›¸å…³èµ„æº)

## 1. ğŸ“– æ¦‚å¿µä»‹ç»

æœ¬æ–‡æ±‡æ€»Goæµ‹è¯•ä¸­çš„å¸¸è§é—®é¢˜ã€è§£å†³æ–¹æ¡ˆå’Œå®ç”¨æŠ€å·§ï¼Œå¸®åŠ©ä½ å¿«é€Ÿè§£å†³æµ‹è¯•ä¸­é‡åˆ°çš„é—®é¢˜ã€‚

---

## 2. âš ï¸ å¸¸è§é—®é¢˜

### 2.1 Q1: å¦‚ä½•æµ‹è¯•unexportedå‡½æ•°ï¼Ÿ

**é—®é¢˜**: ç§æœ‰å‡½æ•°æ— æ³•åœ¨_test.goä¸­è®¿é—®

**è§£å†³æ–¹æ¡ˆ**:

```go
// æ–¹æ¡ˆ1ï¼šé€šè¿‡å…¬æœ‰å‡½æ•°é—´æ¥æµ‹è¯•ï¼ˆæ¨èï¼‰
func TestPublicFunc(t *testing.T) {
    // å…¬æœ‰å‡½æ•°å†…éƒ¨è°ƒç”¨ç§æœ‰å‡½æ•°
}

// æ–¹æ¡ˆ2ï¼šåœ¨åŒåŒ…çš„_test.goä¸­æµ‹è¯•ï¼ˆå¯è®¿é—®ç§æœ‰æˆå‘˜ï¼‰
// math.go
package math

func add(a, b int) int { return a + b }

// math_test.go
package math // åŒåŒ…ï¼Œå¯è®¿é—®ç§æœ‰å‡½æ•°

func TestAdd(t *testing.T) {
    result := add(2, 3)
    if result != 5 {
        t.Error("failed")
    }
}

// æ–¹æ¡ˆ3ï¼šä½¿ç”¨export_test.goï¼ˆç‰¹æ®Šæƒ…å†µï¼‰
// export_test.go
package math

var Add = add // å¯¼å‡ºç§æœ‰å‡½æ•°ä¾›æµ‹è¯•ä½¿ç”¨
```

---

### 2.2 Q2: å¦‚ä½•å¤„ç†time.Now()ï¼Ÿ

**é—®é¢˜**: æ—¶é—´ç›¸å…³ä»£ç éš¾ä»¥æµ‹è¯•

**è§£å†³æ–¹æ¡ˆ**:

```go
// å®šä¹‰æ—¶é—´æ¥å£
type Clock interface {
    Now() time.Time
}

type RealClock struct{}
func (RealClock) Now() time.Time { return time.Now() }

type MockClock struct{ T time.Time }
func (m MockClock) Now() time.Time { return m.T }

// ä½¿ç”¨ä¾èµ–æ³¨å…¥
type Service struct {
    clock Clock
}

// æµ‹è¯•
func TestService(t *testing.T) {
    fixedTime := time.Date(2025, 10, 28, 12, 0, 0, 0, time.UTC)
    service := &Service{clock: MockClock{T: fixedTime}}
    // æµ‹è¯•é€»è¾‘
}
```

---

### 2.3 Q3: æµ‹è¯•panicæ€ä¹ˆåŠï¼Ÿ

```go
func TestPanic(t *testing.T) {
    defer func() {
        if r := recover(); r == nil {
            t.Error("Expected panic")
        }
    }()

    FunctionThatPanics()
}

// æˆ–ä½¿ç”¨testify
func TestPanicWithTestify(t *testing.T) {
    assert.Panics(t, func() {
        FunctionThatPanics()
    })
}
```

---

### 2.4 Q4: å¦‚ä½•æµ‹è¯•goroutineï¼Ÿ

```go
func TestGoroutine(t *testing.T) {
    done := make(chan bool)

    go func() {
        // goroutineé€»è¾‘
        result := doWork()

        if result != expected {
            t.Error("failed")
        }
        done <- true
    }()

    select {
    case <-done:
        // æµ‹è¯•å®Œæˆ
    case <-time.After(2 * time.Second):
        t.Fatal("timeout")
    }
}
```

---

### 2.5 Q5: å¹¶å‘æµ‹è¯•å¦‚ä½•æ£€æµ‹ç«æ€ï¼Ÿ

```bash
# ä½¿ç”¨-raceæ ‡å¿—
go test -race

# ç¤ºä¾‹
func TestConcurrent(t *testing.T) {
    counter := 0
    var wg sync.WaitGroup

    for i := 0; i < 100; i++ {
        wg.Add(1)
        go func() {
            counter++ // ç«æ€æ¡ä»¶ï¼
            wg.Done()
        }()
    }
    wg.Wait()
}
```

---

### 2.6 Q6: å¦‚ä½•è·³è¿‡é•¿æ—¶é—´æµ‹è¯•ï¼Ÿ

```go
func TestLongRunning(t *testing.T) {
    if testing.Short() {
        t.Skip("Skipping in short mode")
    }

    // é•¿æ—¶é—´æµ‹è¯•é€»è¾‘
}

// è¿è¡Œï¼š
// go test        # è¿è¡Œæ‰€æœ‰æµ‹è¯•
// go test -short # è·³è¿‡é•¿æ—¶é—´æµ‹è¯•
```

---

### 2.7 Q7: æµ‹è¯•æ–‡ä»¶åº”è¯¥æ”¾å“ªé‡Œï¼Ÿ

```go
// æ–¹æ¡ˆ1ï¼šåŒåŒ…æµ‹è¯•ï¼ˆæ¨èï¼‰
package mypackage
// mypackage_test.go å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜

// æ–¹æ¡ˆ2ï¼šé»‘ç›’æµ‹è¯•
package mypackage_test  // æ³¨æ„åç¼€_test
// åªèƒ½è®¿é—®å…¬æœ‰æ¥å£
```

---

### 2.8 Q8: å¦‚ä½•æµ‹è¯•æ ‡å‡†è¾“å‡ºï¼Ÿ

```go
func TestPrint(t *testing.T) {
    // æ•è·stdout
    old := os.Stdout
    r, w, _ := os.Pipe()
    os.Stdout = w

    // æ‰§è¡Œæ‰“å°
    fmt.Println("Hello")

    // æ¢å¤stdout
    w.Close()
    os.Stdout = old

    // è¯»å–è¾“å‡º
    var buf bytes.Buffer
    io.Copy(&buf, r)

    output := buf.String()
    if output != "Hello\n" {
        t.Errorf("got %q", output)
    }
}
```

---

## 3. ğŸ’¡ å®ç”¨æŠ€å·§

### 3.1 æŠ€å·§1: ä½¿ç”¨TestMainè‡ªå®šä¹‰æµ‹è¯•æµç¨‹

```go
func TestMain(m *testing.M) {
    // Setup
    fmt.Println("Before all tests")
    setupDatabase()

    // è¿è¡Œæµ‹è¯•
    code := m.Run()

    // Teardown
    fmt.Println("After all tests")
    teardownDatabase()

    os.Exit(code)
}
```

---

### 3.2 æŠ€å·§2: ç”Ÿæˆæµ‹è¯•æ•°æ®

```go
// ä½¿ç”¨testing/quickç”Ÿæˆéšæœºæµ‹è¯•æ•°æ®
func TestQuick(t *testing.T) {
    f := func(x int) bool {
        return Abs(x) >= 0
    }

    if err := quick.Check(f, nil); err != nil {
        t.Error(err)
    }
}
```

---

### 3.3 æŠ€å·§3: å¹¶è¡Œæµ‹è¯•

```go
func TestParallel(t *testing.T) {
    tests := []struct {
        name string
        // ...
    }{
        // test cases
    }

    for _, tt := range tests {
        tt := tt // æ•è·rangeå˜é‡
        t.Run(tt.name, func(t *testing.T) {
            t.Parallel() // å¹¶è¡Œè¿è¡Œ
            // æµ‹è¯•é€»è¾‘
        })
    }
}
```

---

### 3.4 æŠ€å·§4: ä¸´æ—¶ç›®å½•

```go
func TestWithTempDir(t *testing.T) {
    dir := t.TempDir() // è‡ªåŠ¨åˆ›å»ºä¸´æ—¶ç›®å½•

    // ä½¿ç”¨ä¸´æ—¶ç›®å½•
    file := filepath.Join(dir, "test.txt")
    os.WriteFile(file, []byte("data"), 0644)

    // æµ‹è¯•ç»“æŸåè‡ªåŠ¨æ¸…ç†
}
```

---

### 3.5 æŠ€å·§5: æ¡ä»¶ç¼–è¯‘æµ‹è¯•

```go
// +build integration

package mypackage

import "testing"

func TestIntegration(t *testing.T) {
    // åªåœ¨integration tagæ—¶è¿è¡Œ
}

// è¿è¡Œï¼šgo test -tags=integration
```

---

### 3.6 æŠ€å·§6: æµ‹è¯•ç‰¹å®šå‡½æ•°

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•
go test -run TestAdd

# è¿è¡Œç‰¹å®šå­æµ‹è¯•
go test -run TestAdd/positive

# ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
go test -run "Test.*Positive"
```

---

### 3.7 æŠ€å·§7: è¯¦ç»†è¾“å‡º

```bash
# è¯¦ç»†è¾“å‡º
go test -v

# æ˜¾ç¤ºæ¯ä¸ªæµ‹è¯•çš„æ—¶é—´
go test -v -json | jq '.Elapsed'

# æ˜¾ç¤ºè¦†ç›–ç‡
go test -v -cover
```

---

### 3.8 æŠ€å·§8: æµ‹è¯•è¶…æ—¶

```bash
# è®¾ç½®æ•´ä½“è¶…æ—¶
go test -timeout 30s

# å•ä¸ªæµ‹è¯•è¶…æ—¶
func TestTimeout(t *testing.T) {
    timer := time.After(5 * time.Second)
    done := make(chan bool)

    go func() {
        // æµ‹è¯•é€»è¾‘
        done <- true
    }()

    select {
    case <-done:
        // å®Œæˆ
    case <-timer:
        t.Fatal("timeout")
    }
}
```

---

## 4. ğŸ”§ è°ƒè¯•æŠ€å·§

### 4.1 æ‰“å°è°ƒè¯•ä¿¡æ¯

```go
func TestDebug(t *testing.T) {
    t.Log("Debug info")  // åªåœ¨-væ—¶æ˜¾ç¤º
    t.Logf("Value: %v", value)

    // è°ƒè¯•æ—¶ä¸´æ—¶ä½¿ç”¨
    fmt.Printf("Debug: %+v\n", obj)
}
```

---

### 4.2 ä½¿ç”¨Delveè°ƒè¯•å™¨

```bash
# å®‰è£…Delve
go install github.com/go-delve/delve/cmd/dlv@latest

# è°ƒè¯•æµ‹è¯•
dlv test -- -test.run TestSomething

# è®¾ç½®æ–­ç‚¹
(dlv) break TestSomething
(dlv) continue
(dlv) print variable
```

---

### 4.3 ç”Ÿæˆæµ‹è¯•å¤±è´¥æŠ¥å‘Š

```bash
# ç”ŸæˆJSONæŠ¥å‘Š
go test -json > test-report.json

# ç”ŸæˆXMLæŠ¥å‘Šï¼ˆéœ€è¦go-junit-reportï¼‰
go test -v 2>&1 | go-junit-report > report.xml
```

---

## 5. ğŸ“Š æ€§èƒ½åˆ†ææŠ€å·§

### 5.1 æŸ¥æ‰¾æ…¢æµ‹è¯•

```bash
# æ˜¾ç¤ºæ¯ä¸ªæµ‹è¯•çš„æ—¶é—´
go test -v | grep -E "PASS|FAIL"

# ä½¿ç”¨go test json
go test -json | jq 'select(.Action=="pass") | {Test, Elapsed}'
```

---

### 5.2 åˆ†ææµ‹è¯•è¦†ç›–ç‡

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test -coverprofile=coverage.out
go tool cover -html=coverage.out

# æŸ¥çœ‹æœªè¦†ç›–çš„ä»£ç 
go tool cover -func=coverage.out | grep -v "100.0%"
```

---

## 6. ğŸ“š å·¥å…·æ¨è

1. **testify** - æ–­è¨€åº“

   ```bash
   go get github.com/stretchr/testify
   ```

2. **gomock** - Mockç”Ÿæˆ

   ```bash
   go install github.com/golang/mock/mockgen@latest
   ```

3. **gotests** - æµ‹è¯•ç”Ÿæˆ

   ```bash
   go install github.com/cweill/gotests/...@latest
   gotests -all -w file.go
   ```

4. **go-cmp** - æ·±åº¦æ¯”è¾ƒ

   ```bash
   go get github.com/google/go-cmp/cmp
   ```

---

## 7. ğŸ¯ æµ‹è¯•ä¼˜åŒ–æ¸…å•

- [ ] ç§»é™¤ä¸å¿…è¦çš„sleep
- [ ] ä½¿ç”¨t.Parallel()åŠ é€Ÿ
- [ ] å¤ç”¨æ˜‚è´µçš„setup
- [ ] å‡å°‘å¤–éƒ¨ä¾èµ–
- [ ] ä½¿ç”¨-shortæ ‡å¿—è·³è¿‡æ…¢æµ‹è¯•
- [ ] ä¼˜åŒ–è¡¨æ ¼é©±åŠ¨æµ‹è¯•çš„æ•°æ®é‡
- [ ] è€ƒè™‘ä½¿ç”¨ç¼“å­˜ï¼ˆgo test -cacheï¼‰

---

## 8. ğŸ“š ç›¸å…³èµ„æº

- [Go Testing Tips](https://github.com/golang/go/wiki/TestComments)
- [Advanced Testing](https://dave.cheney.net/2019/05/07/prefer-table-driven-tests)

---
