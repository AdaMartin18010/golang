# Goå•å…ƒæµ‹è¯•

> **ç®€ä»‹**: Goå•å…ƒæµ‹è¯•å®Œæ•´æŒ‡å—ï¼ŒåŒ…æ‹¬testingåŒ…ã€æµ‹è¯•ç¼–å†™ã€æ–­è¨€å’Œæœ€ä½³å®è·µ

> **ç‰ˆæœ¬**: Go 1.25.3  
> **éš¾åº¦**: â­â­â­  
> **æ ‡ç­¾**: #æµ‹è¯• #å•å…ƒæµ‹è¯• #testing #TDD

---

## ğŸ“‹ ç›®å½•

- [1. å•å…ƒæµ‹è¯•åŸºç¡€](#1-å•å…ƒæµ‹è¯•åŸºç¡€)
  - [æµ‹è¯•æ–‡ä»¶å‘½å](#æµ‹è¯•æ–‡ä»¶å‘½å)
  - [åŸºæœ¬æµ‹è¯•å‡½æ•°](#åŸºæœ¬æµ‹è¯•å‡½æ•°)
  - [è¿è¡Œæµ‹è¯•](#è¿è¡Œæµ‹è¯•)
- [2. æµ‹è¯•å‡½æ•°ç¼–å†™](#2-æµ‹è¯•å‡½æ•°ç¼–å†™)
  - [æµ‹è¯•å‡½æ•°ç­¾å](#æµ‹è¯•å‡½æ•°ç­¾å)
  - [é”™è¯¯æŠ¥å‘Šæ–¹æ³•](#é”™è¯¯æŠ¥å‘Šæ–¹æ³•)
  - [å­æµ‹è¯•](#å­æµ‹è¯•)
  - [å¹¶è¡Œæµ‹è¯•](#å¹¶è¡Œæµ‹è¯•)
- [3. æµ‹è¯•è¾…åŠ©å‡½æ•°](#3-æµ‹è¯•è¾…åŠ©å‡½æ•°)
  - [Setupå’ŒTeardown](#setupå’Œteardown)
  - [Helperå‡½æ•°](#helperå‡½æ•°)
  - [ä¸´æ—¶ç›®å½•](#ä¸´æ—¶ç›®å½•)
- [4. æµ‹è¯•è¦†ç›–ç‡](#4-æµ‹è¯•è¦†ç›–ç‡)
  - [ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š](#ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š)
  - [è¦†ç›–ç‡ç¤ºä¾‹](#è¦†ç›–ç‡ç¤ºä¾‹)
- [5. æµ‹è¯•æŠ€å·§](#5-æµ‹è¯•æŠ€å·§)
  - [è¡¨æ ¼é©±åŠ¨æµ‹è¯•](#è¡¨æ ¼é©±åŠ¨æµ‹è¯•)
  - [æµ‹è¯•ç§æœ‰å‡½æ•°](#æµ‹è¯•ç§æœ‰å‡½æ•°)
  - [Mockå’ŒStub](#mockå’Œstub)
- [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
  - [1. å‘½åè§„èŒƒ](#1-å‘½åè§„èŒƒ)
  - [2. ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªåŠŸèƒ½](#2-ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªåŠŸèƒ½)
  - [3. ä½¿ç”¨è¡¨æ ¼é©±åŠ¨æµ‹è¯•](#3-ä½¿ç”¨è¡¨æ ¼é©±åŠ¨æµ‹è¯•)
  - [4. æ¸…ç†èµ„æº](#4-æ¸…ç†èµ„æº)
  - [5. å¿«é€Ÿå¤±è´¥](#5-å¿«é€Ÿå¤±è´¥)
- [ğŸ”— ç›¸å…³èµ„æº](#-ç›¸å…³èµ„æº)

## 1. å•å…ƒæµ‹è¯•åŸºç¡€

### æµ‹è¯•æ–‡ä»¶å‘½å

```go
// æºæ–‡ä»¶
math.go

// æµ‹è¯•æ–‡ä»¶ï¼ˆåœ¨åŒä¸€ç›®å½•ï¼‰
math_test.go
```

---

### åŸºæœ¬æµ‹è¯•å‡½æ•°

```go
// math.go
package math

func Add(a, b int) int {
    return a + b
}

// math_test.go
package math

import "testing"

func TestAdd(t *testing.T) {
    result := Add(2, 3)
    expected := 5
    
    if result != expected {
        t.Errorf("Add(2, 3) = %d; want %d", result, expected)
    }
}
```

---

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå½“å‰ç›®å½•çš„æµ‹è¯•
go test

# è¿è¡Œæ‰€æœ‰åŒ…çš„æµ‹è¯•
go test ./...

# è¯¦ç»†è¾“å‡º
go test -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
go test -run TestAdd

# è¿è¡ŒåŒ¹é…æ¨¡å¼çš„æµ‹è¯•
go test -run Test.*Add
```

---

## 2. æµ‹è¯•å‡½æ•°ç¼–å†™

### æµ‹è¯•å‡½æ•°ç­¾å

```go
func TestXxx(t *testing.T) {
    // æµ‹è¯•ä»£ç 
}
```

**è§„åˆ™**:
- å‡½æ•°åå¿…é¡»ä»¥`Test`å¼€å¤´
- æ¥å—`*testing.T`å‚æ•°
- åœ¨`_test.go`æ–‡ä»¶ä¸­

---

### é”™è¯¯æŠ¥å‘Šæ–¹æ³•

```go
func TestMethods(t *testing.T) {
    // Error: è®°å½•é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
    if condition {
        t.Error("error message")
    }
    
    // Errorf: æ ¼å¼åŒ–é”™è¯¯
    if result != expected {
        t.Errorf("got %v, want %v", result, expected)
    }
    
    // Fatal: è®°å½•é”™è¯¯å¹¶ç«‹å³åœæ­¢
    if criticalError {
        t.Fatal("fatal error")
    }
    
    // Fatalf: æ ¼å¼åŒ–çš„Fatal
    if criticalError {
        t.Fatalf("fatal: %v", err)
    }
    
    // Fail: æ ‡è®°æµ‹è¯•å¤±è´¥ï¼Œç»§ç»­æ‰§è¡Œ
    if condition {
        t.Fail()
    }
    
    // FailNow: æ ‡è®°æµ‹è¯•å¤±è´¥ï¼Œç«‹å³åœæ­¢
    if criticalError {
        t.FailNow()
    }
}
```

---

### å­æµ‹è¯•

```go
func TestAdd(t *testing.T) {
    tests := []struct {
        name string
        a, b int
        want int
    }{
        {"positive", 2, 3, 5},
        {"negative", -1, -1, -2},
        {"zero", 0, 0, 0},
        {"mixed", -1, 1, 0},
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got := Add(tt.a, tt.b)
            if got != tt.want {
                t.Errorf("Add(%d, %d) = %d; want %d", 
                    tt.a, tt.b, got, tt.want)
            }
        })
    }
}
```

**è¿è¡Œç‰¹å®šå­æµ‹è¯•**:
```bash
go test -run TestAdd/positive
```

---

### å¹¶è¡Œæµ‹è¯•

```go
func TestParallel(t *testing.T) {
    tests := []struct {
        name string
        // ...
    }{
        // test cases
    }
    
    for _, tt := range tests {
        tt := tt  // æ•è·å˜é‡
        t.Run(tt.name, func(t *testing.T) {
            t.Parallel()  // æ ‡è®°ä¸ºå¹¶è¡Œ
            
            // æµ‹è¯•ä»£ç 
        })
    }
}
```

---

## 3. æµ‹è¯•è¾…åŠ©å‡½æ•°

### Setupå’ŒTeardown

```go
func TestMain(m *testing.M) {
    // Setup
    setup()
    
    // è¿è¡Œæµ‹è¯•
    code := m.Run()
    
    // Teardown
    teardown()
    
    os.Exit(code)
}

func setup() {
    // åˆå§‹åŒ–æ•°æ®åº“ã€é…ç½®ç­‰
}

func teardown() {
    // æ¸…ç†èµ„æº
}
```

---

### Helperå‡½æ•°

```go
func assertEqual(t *testing.T, got, want interface{}) {
    t.Helper()  // æ ‡è®°ä¸ºè¾…åŠ©å‡½æ•°
    
    if got != want {
        t.Errorf("got %v, want %v", got, want)
    }
}

func TestWithHelper(t *testing.T) {
    result := Add(2, 3)
    assertEqual(t, result, 5)  // é”™è¯¯ä¼šæŒ‡å‘è¿™ä¸€è¡Œï¼Œè€Œä¸æ˜¯assertEqualå†…éƒ¨
}
```

---

### ä¸´æ—¶ç›®å½•

```go
func TestWithTempDir(t *testing.T) {
    // åˆ›å»ºä¸´æ—¶ç›®å½•
    dir := t.TempDir()  // æµ‹è¯•ç»“æŸåè‡ªåŠ¨æ¸…ç†
    
    // ä½¿ç”¨ä¸´æ—¶ç›®å½•
    file := filepath.Join(dir, "test.txt")
    os.WriteFile(file, []byte("test"), 0644)
    
    // æµ‹è¯•ä»£ç 
}
```

---

## 4. æµ‹è¯•è¦†ç›–ç‡

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æ–‡ä»¶
go test -coverprofile=coverage.out

# æŸ¥çœ‹è¦†ç›–ç‡
go tool cover -func=coverage.out

# ç”ŸæˆHTMLæŠ¥å‘Š
go tool cover -html=coverage.out -o coverage.html
```

---

### è¦†ç›–ç‡ç¤ºä¾‹

```go
// math.go
func Divide(a, b int) (int, error) {
    if b == 0 {
        return 0, errors.New("division by zero")
    }
    return a / b, nil
}

// math_test.go
func TestDivide(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸æƒ…å†µ
    result, err := Divide(10, 2)
    if err != nil {
        t.Fatal(err)
    }
    if result != 5 {
        t.Errorf("got %d, want 5", result)
    }
    
    // æµ‹è¯•é™¤é›¶é”™è¯¯
    _, err = Divide(10, 0)
    if err == nil {
        t.Error("expected error for division by zero")
    }
}
```

---

## 5. æµ‹è¯•æŠ€å·§

### è¡¨æ ¼é©±åŠ¨æµ‹è¯•

```go
func TestCalculate(t *testing.T) {
    tests := []struct {
        name     string
        op       string
        a, b     int
        want     int
        wantErr  bool
    }{
        {"add", "+", 2, 3, 5, false},
        {"subtract", "-", 5, 3, 2, false},
        {"multiply", "*", 2, 3, 6, false},
        {"divide", "/", 6, 2, 3, false},
        {"divide by zero", "/", 6, 0, 0, true},
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got, err := Calculate(tt.op, tt.a, tt.b)
            
            if tt.wantErr {
                if err == nil {
                    t.Error("expected error but got none")
                }
                return
            }
            
            if err != nil {
                t.Fatalf("unexpected error: %v", err)
            }
            
            if got != tt.want {
                t.Errorf("got %d, want %d", got, tt.want)
            }
        })
    }
}
```

---

### æµ‹è¯•ç§æœ‰å‡½æ•°

```go
// é€šè¿‡å¯¼å‡ºå‡½æ•°æµ‹è¯•
func TestPrivateFunction(t *testing.T) {
    // é€šè¿‡å…¬å…±APIé—´æ¥æµ‹è¯•ç§æœ‰å‡½æ•°
    result := PublicFunction()
    // éªŒè¯ç»“æœ
}

// æˆ–åœ¨æµ‹è¯•æ–‡ä»¶ä¸­é‡æ–°å£°æ˜
func privateFunction(x int) int {
    // æµ‹è¯•éœ€è¦æ—¶å¯ä»¥åœ¨æµ‹è¯•æ–‡ä»¶ä¸­è®¿é—®
}
```

---

### Mockå’ŒStub

```go
// æ¥å£å®šä¹‰
type Database interface {
    GetUser(id int) (*User, error)
}

// Mockå®ç°
type MockDatabase struct {
    GetUserFunc func(id int) (*User, error)
}

func (m *MockDatabase) GetUser(id int) (*User, error) {
    if m.GetUserFunc != nil {
        return m.GetUserFunc(id)
    }
    return nil, errors.New("not implemented")
}

// æµ‹è¯•
func TestUserService(t *testing.T) {
    mockDB := &MockDatabase{
        GetUserFunc: func(id int) (*User, error) {
            return &User{ID: id, Name: "Test"}, nil
        },
    }
    
    service := NewUserService(mockDB)
    user, err := service.GetUser(1)
    
    if err != nil {
        t.Fatal(err)
    }
    
    if user.Name != "Test" {
        t.Errorf("got %s, want Test", user.Name)
    }
}
```

---

## 6. æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

```go
// âœ… æ¨è
func TestAdd(t *testing.T) {}
func TestAdd_Positive(t *testing.T) {}
func TestAdd_WithZero(t *testing.T) {}

// âŒ ä¸æ¨è
func Test_add(t *testing.T) {}
func testAdd(t *testing.T) {}
```

---

### 2. ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªåŠŸèƒ½

```go
// âœ… æ¨èï¼šæ¯ä¸ªæµ‹è¯•ä¸“æ³¨ä¸€ä¸ªåŠŸèƒ½
func TestAdd(t *testing.T) {
    result := Add(2, 3)
    if result != 5 {
        t.Errorf("got %d, want 5", result)
    }
}

func TestAddNegative(t *testing.T) {
    result := Add(-1, -1)
    if result != -2 {
        t.Errorf("got %d, want -2", result)
    }
}

// âŒ ä¸æ¨èï¼šä¸€ä¸ªæµ‹è¯•æµ‹å¤šä¸ªåŠŸèƒ½
func TestAddAll(t *testing.T) {
    if Add(2, 3) != 5 {
        t.Error("positive failed")
    }
    if Add(-1, -1) != -2 {
        t.Error("negative failed")
    }
    // ...
}
```

---

### 3. ä½¿ç”¨è¡¨æ ¼é©±åŠ¨æµ‹è¯•

```go
// âœ… æ¨è
func TestAdd(t *testing.T) {
    tests := []struct {
        name string
        a, b int
        want int
    }{
        {"positive", 2, 3, 5},
        {"negative", -1, -1, -2},
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got := Add(tt.a, tt.b)
            if got != tt.want {
                t.Errorf("got %d, want %d", got, tt.want)
            }
        })
    }
}
```

---

### 4. æ¸…ç†èµ„æº

```go
// âœ… æ¨èï¼šä½¿ç”¨deferæ¸…ç†
func TestWithResource(t *testing.T) {
    resource := setup()
    defer cleanup(resource)
    
    // æµ‹è¯•ä»£ç 
}

// âœ… æ¨èï¼šä½¿ç”¨t.Cleanup
func TestWithCleanup(t *testing.T) {
    resource := setup()
    t.Cleanup(func() {
        cleanup(resource)
    })
    
    // æµ‹è¯•ä»£ç 
}
```

---

### 5. å¿«é€Ÿå¤±è´¥

```go
// âœ… æ¨èï¼šä½¿ç”¨Fatalå¿«é€Ÿå¤±è´¥
func TestCritical(t *testing.T) {
    resource, err := setup()
    if err != nil {
        t.Fatalf("setup failed: %v", err)  // ç«‹å³åœæ­¢
    }
    
    // ç»§ç»­æµ‹è¯•
}

// âŒ ä¸æ¨èï¼šä½¿ç”¨Errorç»§ç»­æ‰§è¡Œ
func TestCritical(t *testing.T) {
    resource, err := setup()
    if err != nil {
        t.Errorf("setup failed: %v", err)  // ç»§ç»­æ‰§è¡Œ
    }
    
    // resourceå¯èƒ½ä¸ºnilï¼Œä¼španic
    resource.DoSomething()
}
```

---

## ğŸ”— ç›¸å…³èµ„æº

- [è¡¨æ ¼é©±åŠ¨æµ‹è¯•](./02-è¡¨æ ¼é©±åŠ¨æµ‹è¯•.md)
- [é›†æˆæµ‹è¯•](./03-é›†æˆæµ‹è¯•.md)
- [Mockä¸Stub](./06-Mockä¸Stub.md)

---

**æœ€åæ›´æ–°**: 2025-10-28  
**Goç‰ˆæœ¬**: 1.25.3
