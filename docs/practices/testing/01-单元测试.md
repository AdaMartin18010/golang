# å•å…ƒæµ‹è¯•

**éš¾åº¦**: ä¸­çº§ | **é¢„è®¡é˜…è¯»**: 20åˆ†é’Ÿ | **å‰ç½®çŸ¥è¯†**: GoåŸºç¡€è¯­æ³•ã€testingåŒ…

---

## ğŸ“‹ ç›®å½•

- [1. ğŸ“– æ¦‚å¿µä»‹ç»](#1--æ¦‚å¿µä»‹ç»)
- [2. ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹](#2--æ ¸å¿ƒçŸ¥è¯†ç‚¹)
  - [2.1 åŸºç¡€æµ‹è¯•ç¼–å†™](#21-åŸºç¡€æµ‹è¯•ç¼–å†™)
  - [2.2 è¡¨æ ¼é©±åŠ¨æµ‹è¯•](#22-è¡¨æ ¼é©±åŠ¨æµ‹è¯•)
  - [2.3 æµ‹è¯•è¾…åŠ©å‡½æ•°](#23-æµ‹è¯•è¾…åŠ©å‡½æ•°)
  - [2.4 Setupå’ŒTeardown](#24-setupå’Œteardown)
  - [2.5 é”™è¯¯åœºæ™¯æµ‹è¯•](#25-é”™è¯¯åœºæ™¯æµ‹è¯•)
- [3. ğŸ—ï¸ å®æˆ˜æ¡ˆä¾‹](#3-ï¸-å®æˆ˜æ¡ˆä¾‹)
- [4. âš ï¸ å¸¸è§é—®é¢˜](#4-ï¸-å¸¸è§é—®é¢˜)
- [5. ğŸ’¡ æœ€ä½³å®è·µ](#5--æœ€ä½³å®è·µ)
- [6. ğŸ“š ç›¸å…³èµ„æº](#6--ç›¸å…³èµ„æº)

---

## 1. ğŸ“– æ¦‚å¿µä»‹ç»

å•å…ƒæµ‹è¯•æ˜¯Goæµ‹è¯•ä½“ç³»çš„åŸºç¡€ï¼Œç”¨äºéªŒè¯å•ä¸ªå‡½æ•°æˆ–æ–¹æ³•çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚Goå†…ç½®çš„testingåŒ…æä¾›äº†ç®€æ´è€Œå¼ºå¤§çš„æµ‹è¯•æ”¯æŒï¼Œæ— éœ€ç¬¬ä¸‰æ–¹æ¡†æ¶å³å¯ç¼–å†™é«˜è´¨é‡çš„å•å…ƒæµ‹è¯•ã€‚

---

## 2. ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹

### 2.1 åŸºç¡€æµ‹è¯•ç¼–å†™

```go
// math.go
package math

func Add(a, b int) int {
    return a + b
}

func Multiply(a, b int) int {
    return a * b
}
```

```go
// math_test.go
package math

import "testing"

// æµ‹è¯•å‡½æ•°å¿…é¡»ä»¥Testå¼€å¤´ï¼Œå‚æ•°ä¸º*testing.T
func TestAdd(t *testing.T) {
    result := Add(2, 3)
    expected := 5
    
    if result != expected {
        t.Errorf("Add(2, 3) = %d; want %d", result, expected)
    }
}

func TestMultiply(t *testing.T) {
    result := Multiply(3, 4)
    expected := 12
    
    if result != expected {
        t.Errorf("Multiply(3, 4) = %d; want %d", result, expected)
    }
}
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
go test
go test -v  # è¯¦ç»†è¾“å‡º
go test -run TestAdd  # è¿è¡Œç‰¹å®šæµ‹è¯•
```

---

### 2.2 è¡¨æ ¼é©±åŠ¨æµ‹è¯•

```go
func TestAddTableDriven(t *testing.T) {
    tests := []struct {
        name     string
        a, b     int
        expected int
    }{
        {"æ­£æ•°ç›¸åŠ ", 2, 3, 5},
        {"è´Ÿæ•°ç›¸åŠ ", -1, -2, -3},
        {"é›¶å€¼", 0, 5, 5},
        {"å¤§æ•°", 1000000, 2000000, 3000000},
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            result := Add(tt.a, tt.b)
            if result != tt.expected {
                t.Errorf("Add(%d, %d) = %d; want %d", 
                    tt.a, tt.b, result, tt.expected)
            }
        })
    }
}
```

---

### 2.3 æµ‹è¯•è¾…åŠ©å‡½æ•°

```go
// helper.go
package math

func assertEqual(t *testing.T, got, want int) {
    t.Helper() // æ ‡è®°ä¸ºè¾…åŠ©å‡½æ•°
    if got != want {
        t.Errorf("got %d, want %d", got, want)
    }
}

func TestWithHelper(t *testing.T) {
    result := Add(2, 3)
    assertEqual(t, result, 5)
}
```

---

### 2.4 Setupå’ŒTeardown

```go
func TestMain(m *testing.M) {
    // Setup
    fmt.Println("Before tests")
    
    // è¿è¡Œæµ‹è¯•
    code := m.Run()
    
    // Teardown
    fmt.Println("After tests")
    
    os.Exit(code)
}

func TestWithSetup(t *testing.T) {
    // æ¯ä¸ªæµ‹è¯•çš„setup
    t.Cleanup(func() {
        fmt.Println("Cleanup for this test")
    })
    
    // æµ‹è¯•é€»è¾‘
    result := Add(1, 1)
    if result != 2 {
        t.Error("expected 2")
    }
}
```

---

### 2.5 é”™è¯¯åœºæ™¯æµ‹è¯•

```go
// å¸¦é”™è¯¯è¿”å›çš„å‡½æ•°
func Divide(a, b float64) (float64, error) {
    if b == 0 {
        return 0, errors.New("division by zero")
    }
    return a / b, nil
}

func TestDivide(t *testing.T) {
    tests := []struct {
        name      string
        a, b      float64
        want      float64
        wantError bool
    }{
        {"æ­£å¸¸é™¤æ³•", 10, 2, 5, false},
        {"é™¤ä»¥é›¶", 10, 0, 0, true},
        {"è´Ÿæ•°", -10, 2, -5, false},
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got, err := Divide(tt.a, tt.b)
            
            if tt.wantError {
                if err == nil {
                    t.Error("expected error, got nil")
                }
                return
            }
            
            if err != nil {
                t.Errorf("unexpected error: %v", err)
            }
            
            if got != tt.want {
                t.Errorf("got %.2f, want %.2f", got, tt.want)
            }
        })
    }
}
```

---

## 3. ğŸ—ï¸ å®æˆ˜æ¡ˆä¾‹

### 3.1 æ¡ˆä¾‹ï¼šæµ‹è¯•ç”¨æˆ·æœåŠ¡

```go
// user.go
package user

import "errors"

type User struct {
    ID    int
    Name  string
    Email string
}

type UserService struct {
    users map[int]*User
}

func NewUserService() *UserService {
    return &UserService{
        users: make(map[int]*User),
    }
}

func (s *UserService) Create(user *User) error {
    if user.Name == "" {
        return errors.New("name is required")
    }
    if user.Email == "" {
        return errors.New("email is required")
    }
    s.users[user.ID] = user
    return nil
}

func (s *UserService) Get(id int) (*User, error) {
    user, ok := s.users[id]
    if !ok {
        return nil, errors.New("user not found")
    }
    return user, nil
}
```

```go
// user_test.go
package user

import (
    "testing"
)

func TestUserService_Create(t *testing.T) {
    tests := []struct {
        name      string
        user      *User
        wantError bool
        errorMsg  string
    }{
        {
            name: "æœ‰æ•ˆç”¨æˆ·",
            user: &User{ID: 1, Name: "Alice", Email: "alice@example.com"},
            wantError: false,
        },
        {
            name: "ç¼ºå°‘åå­—",
            user: &User{ID: 2, Email: "bob@example.com"},
            wantError: true,
            errorMsg: "name is required",
        },
        {
            name: "ç¼ºå°‘é‚®ç®±",
            user: &User{ID: 3, Name: "Charlie"},
            wantError: true,
            errorMsg: "email is required",
        },
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            service := NewUserService()
            err := service.Create(tt.user)
            
            if tt.wantError {
                if err == nil {
                    t.Error("expected error, got nil")
                } else if err.Error() != tt.errorMsg {
                    t.Errorf("got error %q, want %q", err.Error(), tt.errorMsg)
                }
            } else {
                if err != nil {
                    t.Errorf("unexpected error: %v", err)
                }
                
                // éªŒè¯ç”¨æˆ·å·²åˆ›å»º
                got, err := service.Get(tt.user.ID)
                if err != nil {
                    t.Errorf("failed to get user: %v", err)
                }
                if got.Name != tt.user.Name {
                    t.Errorf("got name %s, want %s", got.Name, tt.user.Name)
                }
            }
        })
    }
}
```

---

## 4. âš ï¸ å¸¸è§é—®é¢˜

### Q1: æµ‹è¯•æ–‡ä»¶åº”è¯¥æ”¾åœ¨å“ªé‡Œï¼Ÿ
- ä¸è¢«æµ‹è¯•çš„ä»£ç æ”¾åœ¨åŒä¸€ä¸ªåŒ…
- æ–‡ä»¶åï¼š`xxx_test.go`
- ä¾‹å¦‚ï¼š`math.go` â†’ `math_test.go`

### Q2: ä»€ä¹ˆæ—¶å€™ä½¿ç”¨t.Error vs t.Fatalï¼Ÿ
- `t.Error` / `t.Errorf`: è®°å½•é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
- `t.Fatal` / `t.Fatalf`: è®°å½•é”™è¯¯ï¼Œç«‹å³åœæ­¢å½“å‰æµ‹è¯•

### Q3: å¦‚ä½•æµ‹è¯•ç§æœ‰å‡½æ•°ï¼Ÿ
- æ–¹æ³•1ï¼šé€šè¿‡æµ‹è¯•å…¬æœ‰å‡½æ•°é—´æ¥æµ‹è¯•
- æ–¹æ³•2ï¼šåœ¨testæ–‡ä»¶ä¸­å®šä¹‰ï¼ˆåŒåŒ…æµ‹è¯•å¯è®¿é—®ç§æœ‰æˆå‘˜ï¼‰

### Q4: æµ‹è¯•è¦†ç›–ç‡å¤šå°‘åˆé€‚ï¼Ÿ
- æ ¸å¿ƒé€»è¾‘ï¼š80-90%
- å·¥å…·ä»£ç ï¼š70-80%
- ä¸è¦ç›²ç›®è¿½æ±‚100%

---

## 5. ğŸ’¡ æœ€ä½³å®è·µ

1. **æµ‹è¯•å‘½åæ¸…æ™°**
   ```go
   // âœ… å¥½
   func TestAdd_PositiveNumbers_ReturnsSum(t *testing.T)
   
   // âŒ å·®
   func TestAdd1(t *testing.T)
   ```

2. **ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªå…³æ³¨ç‚¹**
   ```go
   // âœ… å¥½ï¼šä¸“æ³¨æµ‹è¯•ä¸€ä¸ªåŠŸèƒ½
   func TestUserCreate(t *testing.T)
   func TestUserUpdate(t *testing.T)
   
   // âŒ å·®ï¼šä¸€ä¸ªæµ‹è¯•æµ‹å¤šä¸ªåŠŸèƒ½
   func TestUserOperations(t *testing.T)
   ```

3. **ä½¿ç”¨t.Helper()æ ‡è®°è¾…åŠ©å‡½æ•°**

4. **æµ‹è¯•è¦å¿«é€Ÿ**
   - é¿å…sleep
   - ä½¿ç”¨mockè€ŒéçœŸå®ä¾èµ–
   - å¹¶è¡Œè¿è¡Œï¼š`t.Parallel()`

5. **æµ‹è¯•è¦ç‹¬ç«‹**
   - æ¯ä¸ªæµ‹è¯•äº’ä¸ä¾èµ–
   - ä¸ä¾èµ–æ‰§è¡Œé¡ºåº
   - æ¸…ç†æµ‹è¯•æ•°æ®

---

## 6. ğŸ“š ç›¸å…³èµ„æº

- [testing Package](https://pkg.go.dev/testing)
- [Go Testing Style Guide](https://github.com/golang/go/wiki/TestComments)
- [Table Driven Tests](https://go.dev/wiki/TableDrivenTests)

---

**æœ€åæ›´æ–°**: 2025-10-27  
**ä½œè€…**: Documentation Team

