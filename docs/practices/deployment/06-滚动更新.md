# æ»šåŠ¨æ›´æ–°

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-29
**é€‚ç”¨äº**: Go 1.25.3

---

## ğŸ“‹ ç›®å½•

- [æ»šåŠ¨æ›´æ–°](#æ»šåŠ¨æ›´æ–°)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. ğŸ“– æ¦‚å¿µä»‹ç»](#1--æ¦‚å¿µä»‹ç»)
  - [2. ğŸ¯ æ›´æ–°ç­–ç•¥](#2--æ›´æ–°ç­–ç•¥)
    - [2.1 K8sæ»šåŠ¨æ›´æ–°](#21-k8sæ»šåŠ¨æ›´æ–°)
    - [2.2 è“ç»¿éƒ¨ç½²](#22-è“ç»¿éƒ¨ç½²)
    - [2.3 é‡‘ä¸é›€å‘å¸ƒ](#23-é‡‘ä¸é›€å‘å¸ƒ)
  - [3. ğŸ”„ æ›´æ–°æ“ä½œ](#3--æ›´æ–°æ“ä½œ)
    - [3.1 æ›´æ–°é•œåƒ](#31-æ›´æ–°é•œåƒ)
    - [3.2 æš‚åœå’Œæ¢å¤](#32-æš‚åœå’Œæ¢å¤)
    - [3.3 å›æ»š](#33-å›æ»š)
  - [4. ğŸ’¡ æœ€ä½³å®è·µ](#4--æœ€ä½³å®è·µ)
    - [4.1 å¥åº·æ£€æŸ¥](#41-å¥åº·æ£€æŸ¥)
    - [4.2 ä¼˜é›…å…³é—­](#42-ä¼˜é›…å…³é—­)
    - [4.3 æ›´æ–°ç­–ç•¥](#43-æ›´æ–°ç­–ç•¥)
  - [5. ğŸ“Š ç›‘æ§æ›´æ–°](#5--ç›‘æ§æ›´æ–°)
  - [6. âš ï¸ å¸¸è§é—®é¢˜](#6-ï¸-å¸¸è§é—®é¢˜)

## 1. ğŸ“– æ¦‚å¿µä»‹ç»

æ»šåŠ¨æ›´æ–°æ˜¯é›¶åœæœºéƒ¨ç½²çš„å…³é”®æŠ€æœ¯ï¼Œé€šè¿‡é€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬å®ä¾‹æ¥æ›´æ–°åº”ç”¨ï¼Œç¡®ä¿æœåŠ¡æŒç»­å¯ç”¨ã€‚

---

## 2. ğŸ¯ æ›´æ–°ç­–ç•¥

### 2.1 K8sæ»šåŠ¨æ›´æ–°

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 4
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1        # æœ€å¤šé¢å¤–1ä¸ªPod
      maxUnavailable: 1  # æœ€å¤š1ä¸ªä¸å¯ç”¨
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:v2
```

```text
åˆå§‹: [v1] [v1] [v1] [v1]
æ­¥éª¤1: [v2] [v1] [v1] [v1]  # åˆ›å»ºv2
æ­¥éª¤2: [v2] [v2] [v1] [v1]  # v1å˜readyååˆ›å»ºv2
æ­¥éª¤3: [v2] [v2] [v2] [v1]
å®Œæˆ:  [v2] [v2] [v2] [v2]
```

---

### 2.2 è“ç»¿éƒ¨ç½²

```yaml
# è“è‰²ç¯å¢ƒï¼ˆå½“å‰ï¼‰
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-blue
spec:
  replicas: 3
  template:
    metadata:
      labels:
        app: myapp
        version: blue
---
# ç»¿è‰²ç¯å¢ƒï¼ˆæ–°ç‰ˆæœ¬ï¼‰
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-green
spec:
  replicas: 3
  template:
    metadata:
      labels:
        app: myapp
        version: green
---
# Serviceåˆ‡æ¢
apiVersion: v1
kind: Service
metadata:
  name: myapp
spec:
  selector:
    app: myapp
    version: blue  # åˆ‡æ¢åˆ°greenå³å®Œæˆéƒ¨ç½²
```

---

### 2.3 é‡‘ä¸é›€å‘å¸ƒ

```yaml
# ä¸»ç‰ˆæœ¬ - 90%æµé‡
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-stable
spec:
  replicas: 9  # 90%
---
# é‡‘ä¸é›€ç‰ˆæœ¬ - 10%æµé‡
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-canary
spec:
  replicas: 1  # 10%
```

---

## 3. ğŸ”„ æ›´æ–°æ“ä½œ

### 3.1 æ›´æ–°é•œåƒ

```bash
# æ–¹å¼1ï¼škubectl set image
kubectl set image deployment/myapp myapp=myapp:v2

# æ–¹å¼2ï¼škubectl apply
kubectl apply -f deployment.yaml

# æŸ¥çœ‹æ›´æ–°çŠ¶æ€
kubectl rollout status deployment/myapp

# æŸ¥çœ‹æ›´æ–°å†å²
kubectl rollout history deployment/myapp
```

---

### 3.2 æš‚åœå’Œæ¢å¤

```bash
# æš‚åœæ›´æ–°ï¼ˆç”¨äºé‡‘ä¸é›€ï¼‰
kubectl rollout pause deployment/myapp

# è§‚å¯ŸæŒ‡æ ‡
# ...

# æ¢å¤æ›´æ–°
kubectl rollout resume deployment/myapp
```

---

### 3.3 å›æ»š

```bash
# å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
kubectl rollout undo deployment/myapp

# å›æ»šåˆ°ç‰¹å®šç‰ˆæœ¬
kubectl rollout undo deployment/myapp --to-revision=2

# æŸ¥çœ‹å›æ»šçŠ¶æ€
kubectl rollout status deployment/myapp
```

---

## 4. ğŸ’¡ æœ€ä½³å®è·µ

### 4.1 å¥åº·æ£€æŸ¥

```yaml
readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 5

livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 15
  periodSeconds: 20
```

### 4.2 ä¼˜é›…å…³é—­

```go
func main() {
    srv := &http.Server{Addr: ":8080"}

    go func() {
        srv.ListenAndServe()
    }()

    // ç­‰å¾…ä¸­æ–­ä¿¡å·
    quit := make(chan os.Signal, 1)
    signal.Notify(quit, syscall.SIGTERM, syscall.SIGINT)
    <-quit

    // 30ç§’ä¼˜é›…å…³é—­
    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()

    if err := srv.Shutdown(ctx); err != nil {
        log.Fatal(err)
    }
}
```

### 4.3 æ›´æ–°ç­–ç•¥

```yaml
spec:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 25%      # å…è®¸è¶…å‡ºæœŸæœ›å‰¯æœ¬æ•°25%
      maxUnavailable: 0  # é›¶åœæœº
  minReadySeconds: 10    # æ–°Podå°±ç»ªåç­‰å¾…10ç§’
```

---

## 5. ğŸ“Š ç›‘æ§æ›´æ–°

```bash
# å®æ—¶ç›‘æ§
watch kubectl get pods

# æŸ¥çœ‹äº‹ä»¶
kubectl get events --sort-by='.lastTimestamp'

# æŸ¥çœ‹æ—¥å¿—
kubectl logs -f deployment/myapp
```

---

## 6. âš ï¸ å¸¸è§é—®é¢˜

**æœ€åæ›´æ–°**: 2025-10-29
