# ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

**éš¾åº¦**: é«˜çº§ | **é¢„è®¡é˜…è¯»**: 20åˆ†é’Ÿ | **å‰ç½®çŸ¥è¯†**: éƒ¨ç½²åŸºç¡€

---

## ğŸ“‹ ç›®å½•

- [1. ğŸ“– æ¦‚å¿µä»‹ç»](#1--æ¦‚å¿µä»‹ç»)
- [2. ğŸ” å®‰å…¨åŠ å›º](#2--å®‰å…¨åŠ å›º)
- [3. âš¡ æ€§èƒ½ä¼˜åŒ–](#3--æ€§èƒ½ä¼˜åŒ–)
- [4. ğŸ“Š ç›‘æ§å‘Šè­¦](#4--ç›‘æ§å‘Šè­¦)
- [5. ğŸ”„ æ•…éšœæ¢å¤](#5--æ•…éšœæ¢å¤)
- [6. ğŸ“ æ—¥å¿—ç®¡ç†](#6--æ—¥å¿—ç®¡ç†)
- [7. ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•](#7--éƒ¨ç½²æ£€æŸ¥æ¸…å•)
- [8. âš ï¸ å¸¸è§é™·é˜±](#8-ï¸-å¸¸è§é™·é˜±)
- [9. ğŸ“š ç›¸å…³èµ„æº](#9--ç›¸å…³èµ„æº)

---

## 1. ğŸ“– æ¦‚å¿µä»‹ç»

ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éœ€è¦è€ƒè™‘å®‰å…¨æ€§ã€å¯é æ€§ã€å¯ç»´æŠ¤æ€§ç­‰å¤šä¸ªæ–¹é¢ã€‚æœ¬æ–‡æ€»ç»“Goåº”ç”¨ç”Ÿäº§éƒ¨ç½²çš„æœ€ä½³å®è·µã€‚

---

## 2. ğŸ” å®‰å…¨åŠ å›º

### 2.1 æœ€å°æƒé™åŸåˆ™

```dockerfile
# ä½¿ç”¨érootç”¨æˆ·
FROM alpine:latest

RUN addgroup -S appgroup && adduser -S appuser -G appgroup

USER appuser

COPY --chown=appuser:appgroup myapp /myapp

CMD ["/myapp"]
```

### 2.2 Secretç®¡ç†

```go
// ä¸è¦ç¡¬ç¼–ç Secret
// âŒ é”™è¯¯
const dbPassword = "mypassword123"

// âœ… æ­£ç¡®ï¼šä»ç¯å¢ƒå˜é‡è¯»å–
dbPassword := os.Getenv("DB_PASSWORD")
if dbPassword == "" {
    log.Fatal("DB_PASSWORD not set")
}
```

### 2.3 TLSé…ç½®

```go
tlsConfig := &tls.Config{
    MinVersion:               tls.VersionTLS12,
    PreferServerCipherSuites: true,
    CipherSuites: []uint16{
        tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
        tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
    },
}

server := &http.Server{
    TLSConfig: tlsConfig,
    // ...
}
```

---

## 3. âš¡ æ€§èƒ½ä¼˜åŒ–

### 3.1 èµ„æºé™åˆ¶

```yaml
resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "256Mi"
    cpu: "200m"
```

### 3.2 è¿æ¥æ± 

```go
// æ•°æ®åº“è¿æ¥æ± 
db.SetMaxOpenConns(25)
db.SetMaxIdleConns(5)
db.SetConnMaxLifetime(5 * time.Minute)

// HTTPå®¢æˆ·ç«¯å¤ç”¨
var httpClient = &http.Client{
    Timeout: 10 * time.Second,
    Transport: &http.Transport{
        MaxIdleConns:        100,
        MaxIdleConnsPerHost: 10,
        IdleConnTimeout:     90 * time.Second,
    },
}
```

### 3.3 ä¼˜é›…å…³é—­

```go
func gracefulShutdown(srv *http.Server) {
    quit := make(chan os.Signal, 1)
    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
    <-quit
    
    log.Println("Shutting down server...")
    
    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()
    
    if err := srv.Shutdown(ctx); err != nil {
        log.Fatal("Server forced to shutdown:", err)
    }
}
```

---

## 4. ğŸ“Š ç›‘æ§å‘Šè­¦

### 4.1 å…³é”®æŒ‡æ ‡

```go
var (
    // è¯·æ±‚æŒ‡æ ‡
    httpRequestsTotal = promauto.NewCounterVec(...)
    httpRequestDuration = promauto.NewHistogramVec(...)
    
    // ä¸šåŠ¡æŒ‡æ ‡
    ordersTotal = promauto.NewCounter(...)
    activeUsers = promauto.NewGauge(...)
)
```

### 4.2 å‘Šè­¦è§„åˆ™

```yaml
# prometheus-alerts.yml
groups:
- name: app
  rules:
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
    for: 5m
    annotations:
      summary: "High error rate detected"
  
  - alert: HighLatency
    expr: histogram_quantile(0.99, http_request_duration_seconds) > 1
    for: 5m
```

---

## 5. ğŸ”„ æ•…éšœæ¢å¤

### 5.1 å¥åº·æ£€æŸ¥

```go
func healthHandler(w http.ResponseWriter, r *http.Request) {
    // æ£€æŸ¥æ•°æ®åº“
    if err := db.Ping(); err != nil {
        w.WriteHeader(http.StatusServiceUnavailable)
        json.NewEncoder(w).Encode(map[string]string{
            "status": "unhealthy",
            "error":  err.Error(),
        })
        return
    }
    
    w.WriteHeader(http.StatusOK)
    json.NewEncoder(w).Encode(map[string]string{
        "status": "healthy",
    })
}
```

### 5.2 è‡ªåŠ¨é‡å¯

```yaml
# Kubernetes
spec:
  containers:
  - name: myapp
    livenessProbe:
      httpGet:
        path: /health
        port: 8080
      failureThreshold: 3
      periodSeconds: 10
```

### 5.3 å¤‡ä»½ç­–ç•¥

```bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
pg_dump myapp > /backups/myapp_$DATE.sql
aws s3 cp /backups/myapp_$DATE.sql s3://backups/
```

---

## 6. ğŸ“ æ—¥å¿—ç®¡ç†

### 6.1 ç»“æ„åŒ–æ—¥å¿—

```go
logger.Info("User logged in",
    zap.String("user_id", userID),
    zap.String("ip", clientIP),
    zap.String("user_agent", userAgent),
)
```

### 6.2 æ—¥å¿—çº§åˆ«

```
ç”Ÿäº§ç¯å¢ƒ: INFOåŠä»¥ä¸Š
æµ‹è¯•ç¯å¢ƒ: DEBUGåŠä»¥ä¸Š
å¼€å‘ç¯å¢ƒ: ALL
```

### 6.3 æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

```go
// âŒ ä¸è¦è®°å½•å¯†ç 
logger.Info("Login attempt", zap.String("password", password))

// âœ… åªè®°å½•å¿…è¦ä¿¡æ¯
logger.Info("Login attempt", zap.String("username", username))
```

---

## 7. ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰
- [ ] ä»£ç Reviewé€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
- [ ] å®‰å…¨æ‰«æé€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°

### éƒ¨ç½²ä¸­
- [ ] å¤‡ä»½å½“å‰ç‰ˆæœ¬
- [ ] é€šçŸ¥ç›¸å…³äººå‘˜
- [ ] ç›‘æ§å…³é”®æŒ‡æ ‡
- [ ] å‡†å¤‡å›æ»šæ–¹æ¡ˆ

### éƒ¨ç½²å
- [ ] éªŒè¯åŠŸèƒ½æ­£å¸¸
- [ ] æ£€æŸ¥é”™è¯¯æ—¥å¿—
- [ ] ç›‘æ§æ€§èƒ½æŒ‡æ ‡
- [ ] æ›´æ–°è¿ç»´æ–‡æ¡£

---

## 8. âš ï¸ å¸¸è§é™·é˜±

1. **æœªé…ç½®èµ„æºé™åˆ¶** â†’ Podè¢«OOM Kill
2. **ç¼ºå°‘å¥åº·æ£€æŸ¥** â†’ å¤±è´¥çš„Podä»æ¥æ”¶æµé‡
3. **æœªå®ç°ä¼˜é›…å…³é—­** â†’ è¯·æ±‚ä¸­æ–­
4. **æ—¥å¿—è¿‡å¤š** â†’ ç£ç›˜æ»¡
5. **æœªç›‘æ§å…³é”®æŒ‡æ ‡** â†’ é—®é¢˜å‘ç°å¤ªæ™š

---

## 9. ğŸ“š ç›¸å…³èµ„æº

- [12-Factor App](https://12factor.net/)
- [Production Best Practices](https://kubernetes.io/docs/concepts/configuration/overview/)

---

**æœ€åæ›´æ–°**: 2025-10-28
