# Goä»£ç è´¨é‡æ§åˆ¶å®Œå…¨æŒ‡å—

> **ç®€ä»‹**: å…¨é¢çš„Goä»£ç è´¨é‡æ§åˆ¶æ–¹æ³•ï¼ŒåŒ…æ‹¬é™æ€åˆ†æã€ä»£ç å®¡æŸ¥ã€è´¨é‡æŒ‡æ ‡å’Œæœ€ä½³å®è·µ

---

## ğŸ“‹ ç›®å½•


- [1. ğŸ“‹ ä»£ç è´¨é‡æ¦‚è¿°](#1--ä»£ç è´¨é‡æ¦‚è¿°)
  - [è´¨é‡ç»´åº¦](#è´¨é‡ç»´åº¦)
  - [è´¨é‡æŒ‡æ ‡](#è´¨é‡æŒ‡æ ‡)
- [2. ğŸ” é™æ€ä»£ç åˆ†æ](#2--é™æ€ä»£ç åˆ†æ)
  - [golangci-linté…ç½®](#golangci-linté…ç½®)
  - [æ ¸å¿ƒLintersè¯¦è§£](#æ ¸å¿ƒlintersè¯¦è§£)
    - [errcheck - é”™è¯¯å¤„ç†æ£€æŸ¥](#errcheck---é”™è¯¯å¤„ç†æ£€æŸ¥)
    - [gosimple - ç®€åŒ–ä»£ç ](#gosimple---ç®€åŒ–ä»£ç )
    - [gocyclo - åœˆå¤æ‚åº¦æ£€æŸ¥](#gocyclo---åœˆå¤æ‚åº¦æ£€æŸ¥)
- [3. ğŸ“ ä»£ç è§„èŒƒ](#3--ä»£ç è§„èŒƒ)
  - [å‘½åè§„èŒƒ](#å‘½åè§„èŒƒ)
  - [ä»£ç ç»“æ„](#ä»£ç ç»“æ„)
  - [æ³¨é‡Šè§„èŒƒ](#æ³¨é‡Šè§„èŒƒ)
- [4. ğŸ¯ ä»£ç å¤æ‚åº¦æ§åˆ¶](#4--ä»£ç å¤æ‚åº¦æ§åˆ¶)
  - [åœˆå¤æ‚åº¦ï¼ˆCyclomatic Complexity)](#åœˆå¤æ‚åº¦cyclomatic-complexity)
  - [è®¤çŸ¥å¤æ‚åº¦ï¼ˆCognitive Complexity)](#è®¤çŸ¥å¤æ‚åº¦cognitive-complexity)
- [5. ğŸ§¹ ä»£ç é‡æ„æŠ€å·§](#5--ä»£ç é‡æ„æŠ€å·§)
  - [æå–æ–¹æ³•](#æå–æ–¹æ³•)
  - [ç®€åŒ–æ¡ä»¶è¡¨è¾¾å¼](#ç®€åŒ–æ¡ä»¶è¡¨è¾¾å¼)
  - [æ¶ˆé™¤é‡å¤ä»£ç ](#æ¶ˆé™¤é‡å¤ä»£ç )
- [6. ğŸ” å®‰å…¨æ£€æŸ¥](#6--å®‰å…¨æ£€æŸ¥)
  - [å¸¸è§å®‰å…¨é—®é¢˜](#å¸¸è§å®‰å…¨é—®é¢˜)
    - [SQLæ³¨å…¥](#sqlæ³¨å…¥)
    - [å‘½ä»¤æ³¨å…¥](#å‘½ä»¤æ³¨å…¥)
    - [æ•æ„Ÿä¿¡æ¯æ³„éœ²](#æ•æ„Ÿä¿¡æ¯æ³„éœ²)
  - [gosecå®‰å…¨æ‰«æ](#gosecå®‰å…¨æ‰«æ)
- [7. ğŸ“Š ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ](#7--ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ)
  - [å®¡æŸ¥æ¸…å•](#å®¡æŸ¥æ¸…å•)
  - [å®¡æŸ¥æµç¨‹](#å®¡æŸ¥æµç¨‹)
- [8. ğŸ¯ è´¨é‡é—¨ç¦](#8--è´¨é‡é—¨ç¦)
  - [è´¨é‡é—¨ç¦é…ç½®](#è´¨é‡é—¨ç¦é…ç½®)
  - [CIé›†æˆ](#cié›†æˆ)
- [9. ğŸ’¡ æœ€ä½³å®è·µ](#9--æœ€ä½³å®è·µ)
  - [DO's âœ…](#dos-)
  - [DON'Ts âŒ](#donts-)
- [10. ğŸ”§ å·¥å…·æ¨è](#10--å·¥å…·æ¨è)
  - [é™æ€åˆ†æå·¥å…·](#é™æ€åˆ†æå·¥å…·)
  - [IDEæ’ä»¶](#ideæ’ä»¶)
- [ğŸ“š æ‰©å±•é˜…è¯»](#-æ‰©å±•é˜…è¯»)

## 1. ğŸ“‹ ä»£ç è´¨é‡æ¦‚è¿°

### è´¨é‡ç»´åº¦

ä»£ç è´¨é‡åŒ…å«å¤šä¸ªç»´åº¦ï¼š

| ç»´åº¦ | è¯´æ˜ | è¡¡é‡æ ‡å‡† |
|------|------|---------|
| **æ­£ç¡®æ€§** | ä»£ç åŠŸèƒ½æ˜¯å¦æ­£ç¡® | æµ‹è¯•è¦†ç›–ç‡ã€Bugæ•°é‡ |
| **å¯è¯»æ€§** | ä»£ç æ˜¯å¦æ˜“äºç†è§£ | å‘½åè§„èŒƒã€æ³¨é‡Šè´¨é‡ |
| **å¯ç»´æŠ¤æ€§** | ä»£ç æ˜¯å¦æ˜“äºä¿®æ”¹ | å¤æ‚åº¦ã€è€¦åˆåº¦ |
| **æ€§èƒ½** | ä»£ç æ‰§è¡Œæ•ˆç‡ | Benchmarkç»“æœ |
| **å®‰å…¨æ€§** | ä»£ç æ˜¯å¦å®‰å…¨ | å®‰å…¨æ‰«æç»“æœ |
| **å¯æµ‹è¯•æ€§** | ä»£ç æ˜¯å¦æ˜“äºæµ‹è¯• | å•å…ƒæµ‹è¯•è¦†ç›–ç‡ |

### è´¨é‡æŒ‡æ ‡

```go
// è´¨é‡æŒ‡æ ‡ç¤ºä¾‹
type CodeQualityMetrics struct {
    TestCoverage      float64 // æµ‹è¯•è¦†ç›–ç‡ (>80%)
    LinesOfCode       int     // ä»£ç è¡Œæ•°
    CyclomaticComplexity int  // åœˆå¤æ‚åº¦ (<15)
    DuplicationRate   float64 // é‡å¤ç‡ (<5%)
    TechnicalDebt     int     // æŠ€æœ¯å€ºåŠ¡ï¼ˆå°æ—¶ï¼‰
    SecurityIssues    int     // å®‰å…¨é—®é¢˜æ•°é‡
    CodeSmells        int     // ä»£ç åå‘³é“æ•°é‡
}

// è´¨é‡è¯„åˆ†è®¡ç®—
func CalculateQualityScore(metrics CodeQualityMetrics) int {
    score := 100
    
    // æµ‹è¯•è¦†ç›–ç‡æ‰£åˆ†
    if metrics.TestCoverage < 80 {
        score -= int((80 - metrics.TestCoverage) / 2)
    }
    
    // åœˆå¤æ‚åº¦æ‰£åˆ†
    if metrics.CyclomaticComplexity > 15 {
        score -= (metrics.CyclomaticComplexity - 15) * 2
    }
    
    // ä»£ç é‡å¤æ‰£åˆ†
    if metrics.DuplicationRate > 5 {
        score -= int((metrics.DuplicationRate - 5) * 3)
    }
    
    // å®‰å…¨é—®é¢˜æ‰£åˆ†
    score -= metrics.SecurityIssues * 5
    
    // ä»£ç åå‘³é“æ‰£åˆ†
    score -= metrics.CodeSmells
    
    if score < 0 {
        score = 0
    }
    
    return score
}
```

---

## 2. ğŸ” é™æ€ä»£ç åˆ†æ

### golangci-linté…ç½®

å®Œæ•´çš„`.golangci.yml`é…ç½®ï¼š

```yaml
# .golangci.yml
run:
  timeout: 5m
  tests: true
  skip-dirs:
    - vendor
    - third_party
  skip-files:
    - ".*\\.pb\\.go$"

linters-settings:
  govet:
    check-shadowing: true
    enable-all: true
  
  gocyclo:
    min-complexity: 15
  
  dupl:
    threshold: 100
  
  goconst:
    min-len: 3
    min-occurrences: 3
  
  misspell:
    locale: US
  
  lll:
    line-length: 120
  
  goimports:
    local-prefixes: github.com/yourorg/yourproject
  
  gocritic:
    enabled-tags:
      - diagnostic
      - experimental
      - opinionated
      - performance
      - style
  
  funlen:
    lines: 100
    statements: 50
  
  gocognit:
    min-complexity: 20
  
  nestif:
    min-complexity: 4
  
  cyclop:
    max-complexity: 15
  
  errorlint:
    errorf: true
    asserts: true
    comparison: true

linters:
  enable:
    - bodyclose      # æ£€æŸ¥HTTPå“åº”ä½“æ˜¯å¦å…³é—­
    - deadcode       # æ£€æŸ¥æœªä½¿ç”¨çš„ä»£ç 
    - depguard       # æ£€æŸ¥åŒ…ä¾èµ–
    - dogsled        # æ£€æŸ¥ç©ºç™½æ ‡è¯†ç¬¦èµ‹å€¼
    - dupl           # æ£€æŸ¥ä»£ç é‡å¤
    - errcheck       # æ£€æŸ¥æœªå¤„ç†çš„é”™è¯¯
    - exportloopref  # æ£€æŸ¥å¾ªç¯ä¸­çš„æŒ‡é’ˆå¼•ç”¨
    - funlen         # æ£€æŸ¥å‡½æ•°é•¿åº¦
    - gochecknoinits # æ£€æŸ¥initå‡½æ•°
    - goconst        # æ£€æŸ¥å¯ä»¥æå–ä¸ºå¸¸é‡çš„å­—ç¬¦ä¸²
    - gocritic       # Goä»£ç è¯„å®¡
    - gocyclo        # æ£€æŸ¥åœˆå¤æ‚åº¦
    - gofmt          # æ£€æŸ¥ä»£ç æ ¼å¼
    - goimports      # æ£€æŸ¥importé¡ºåº
    - gomnd          # æ£€æŸ¥é­”æ³•æ•°å­—
    - goprintffuncname # æ£€æŸ¥printfé£æ ¼å‡½æ•°å
    - gosec          # å®‰å…¨æ£€æŸ¥
    - gosimple       # ç®€åŒ–ä»£ç å»ºè®®
    - govet          # Goå®˜æ–¹æ£€æŸ¥å·¥å…·
    - ineffassign    # æ£€æŸ¥æ— æ•ˆèµ‹å€¼
    - lll            # æ£€æŸ¥è¡Œé•¿åº¦
    - misspell       # æ£€æŸ¥æ‹¼å†™é”™è¯¯
    - nakedret       # æ£€æŸ¥è£¸è¿”å›
    - nestif         # æ£€æŸ¥åµŒå¥—æ·±åº¦
    - noctx          # æ£€æŸ¥HTTPè¯·æ±‚æ˜¯å¦ä¼ é€’context
    - nolintlint     # æ£€æŸ¥nolintæŒ‡ä»¤
    - rowserrcheck   # æ£€æŸ¥SQL Rowsé”™è¯¯
    - staticcheck    # é™æ€æ£€æŸ¥
    - stylecheck     # é£æ ¼æ£€æŸ¥
    - typecheck      # ç±»å‹æ£€æŸ¥
    - unconvert      # æ£€æŸ¥ä¸å¿…è¦çš„ç±»å‹è½¬æ¢
    - unparam        # æ£€æŸ¥æœªä½¿ç”¨çš„å‚æ•°
    - unused         # æ£€æŸ¥æœªä½¿ç”¨çš„å¸¸é‡ã€å˜é‡ã€å‡½æ•°ç­‰
    - whitespace     # æ£€æŸ¥å¤šä½™çš„ç©ºç™½
    - errorlint      # é”™è¯¯å¤„ç†æ£€æŸ¥
    - gocognit       # è®¤çŸ¥å¤æ‚åº¦
    - cyclop         # åŒ…å’Œå‡½æ•°çš„åœˆå¤æ‚åº¦

issues:
  exclude-rules:
    # æ’é™¤æµ‹è¯•æ–‡ä»¶çš„æŸäº›æ£€æŸ¥
    - path: _test\.go
      linters:
        - gomnd
        - funlen
        - dupl
    
    # æ’é™¤mainå‡½æ•°çš„æŸäº›æ£€æŸ¥
    - path: cmd/
      linters:
        - gochecknoinits

  max-issues-per-linter: 0
  max-same-issues: 0

output:
  format: colored-line-number
  print-issued-lines: true
  print-linter-name: true
```

### æ ¸å¿ƒLintersè¯¦è§£

#### errcheck - é”™è¯¯å¤„ç†æ£€æŸ¥

```go
// âŒ ä¸æ¨è - å¿½ç•¥é”™è¯¯
file, _ := os.Open("file.txt")
defer file.Close()

// âœ… æ¨è - å¤„ç†é”™è¯¯
file, err := os.Open("file.txt")
if err != nil {
    return fmt.Errorf("failed to open file: %w", err)
}
defer file.Close()
```

#### gosimple - ç®€åŒ–ä»£ç 

```go
// âŒ ä¸æ¨è - å¤æ‚å†™æ³•
var s string
if condition {
    s = "yes"
} else {
    s = "no"
}

// âœ… æ¨è - ç®€åŒ–å†™æ³•
s := "no"
if condition {
    s = "yes"
}

// æ›´ç®€æ´
s := map[bool]string{true: "yes", false: "no"}[condition]
```

#### gocyclo - åœˆå¤æ‚åº¦æ£€æŸ¥

```go
// âŒ ä¸æ¨è - åœˆå¤æ‚åº¦è¿‡é«˜ (>15)
func ProcessOrder(order Order) error {
    if order.Status == "pending" {
        if order.Amount > 1000 {
            if order.Customer.VIP {
                if order.Customer.CreditLimit > order.Amount {
                    // ... åµŒå¥—è¿‡æ·±
                }
            }
        }
    }
    // ...
}

// âœ… æ¨è - é™ä½å¤æ‚åº¦
func ProcessOrder(order Order) error {
    if !isValidOrder(order) {
        return ErrInvalidOrder
    }
    
    if err := checkCredit(order); err != nil {
        return err
    }
    
    return processPayment(order)
}

func isValidOrder(order Order) bool {
    return order.Status == "pending" && order.Amount > 0
}

func checkCredit(order Order) error {
    if order.Amount <= 1000 {
        return nil
    }
    
    if !order.Customer.VIP {
        return ErrRequiresVIP
    }
    
    if order.Customer.CreditLimit < order.Amount {
        return ErrInsufficientCredit
    }
    
    return nil
}
```

---

## 3. ğŸ“ ä»£ç è§„èŒƒ

### å‘½åè§„èŒƒ

```go
// âœ… æ¨èçš„å‘½å
type UserService struct {}      // å¤§é©¼å³°ï¼ˆå¯¼å‡ºï¼‰
type userRepository struct {}   // å°é©¼å³°ï¼ˆæœªå¯¼å‡ºï¼‰

func (s *UserService) GetUser(id int) (*User, error) {}  // æ–¹æ³•åå¤§é©¼å³°
func (s *UserService) validateEmail(email string) bool {} // ç§æœ‰æ–¹æ³•å°é©¼å³°

const MaxRetries = 3           // å¸¸é‡å¤§é©¼å³°
const defaultTimeout = 30      // ç§æœ‰å¸¸é‡å°é©¼å³°

var ErrUserNotFound = errors.New("user not found")  // é”™è¯¯å˜é‡ä»¥Errå¼€å¤´

// âŒ ä¸æ¨èçš„å‘½å
type user_service struct {}     // ä¸ä½¿ç”¨ä¸‹åˆ’çº¿
func GetUSER() {}               // ä¸å…¨å¤§å†™
const max_retries = 3           // ä¸ä½¿ç”¨ä¸‹åˆ’çº¿
var errUserNotFound = errors.New("...") // å¯¼å‡ºçš„é”™è¯¯åº”è¯¥å¤§å†™
```

### ä»£ç ç»“æ„

```go
// âœ… æ¨èçš„æ–‡ä»¶ç»“æ„
package service

import (
    // æ ‡å‡†åº“
    "context"
    "fmt"
    "time"
    
    // ç¬¬ä¸‰æ–¹åº“
    "github.com/pkg/errors"
    
    // é¡¹ç›®å†…éƒ¨åŒ…
    "myproject/internal/model"
    "myproject/internal/repository"
)

// å¸¸é‡å®šä¹‰
const (
    defaultTimeout = 30 * time.Second
    maxRetries     = 3
)

// ç±»å‹å®šä¹‰
type UserService struct {
    repo repository.UserRepository
    cache Cache
}

// æ„é€ å‡½æ•°
func NewUserService(repo repository.UserRepository) *UserService {
    return &UserService{
        repo: repo,
    }
}

// å…¬å…±æ–¹æ³•
func (s *UserService) GetUser(ctx context.Context, id int) (*model.User, error) {
    // ...
}

// ç§æœ‰æ–¹æ³•
func (s *UserService) validateUser(user *model.User) error {
    // ...
}
```

### æ³¨é‡Šè§„èŒƒ

```go
// Package service æä¾›ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘å¤„ç†
// åŒ…æ³¨é‡Šåº”è¯¥åœ¨packageè¯­å¥ä¹‹å‰
package service

// UserService ç”¨æˆ·æœåŠ¡ï¼Œè´Ÿè´£ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘
// ç±»å‹æ³¨é‡Šåº”è¯¥ä»¥ç±»å‹åå¼€å¤´
type UserService struct {
    repo repository.UserRepository // ç”¨æˆ·æ•°æ®ä»“åº“
    cache Cache                     // ç¼“å­˜å®ä¾‹
}

// GetUser æ ¹æ®IDè·å–ç”¨æˆ·ä¿¡æ¯
// 
// å‚æ•°:
//   - ctx: è¯·æ±‚ä¸Šä¸‹æ–‡
//   - id: ç”¨æˆ·ID
//
// è¿”å›:
//   - *User: ç”¨æˆ·å¯¹è±¡
//   - error: é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨è¿”å›ErrUserNotFound
//
// å‡½æ•°æ³¨é‡Šåº”è¯¥è¯´æ˜åŠŸèƒ½ã€å‚æ•°å’Œè¿”å›å€¼
func (s *UserService) GetUser(ctx context.Context, id int) (*User, error) {
    // å…ˆä»ç¼“å­˜è·å–
    if user, ok := s.cache.Get(id); ok {
        return user, nil
    }
    
    // ä»æ•°æ®åº“æŸ¥è¯¢
    user, err := s.repo.FindByID(ctx, id)
    if err != nil {
        return nil, fmt.Errorf("failed to get user: %w", err)
    }
    
    // å†™å…¥ç¼“å­˜
    s.cache.Set(id, user)
    
    return user, nil
}
```

---

## 4. ğŸ¯ ä»£ç å¤æ‚åº¦æ§åˆ¶

### åœˆå¤æ‚åº¦ï¼ˆCyclomatic Complexity)

åœˆå¤æ‚åº¦è¡¡é‡ç¨‹åºçš„å¤æ‚ç¨‹åº¦ï¼Œé€šè¿‡è®¡ç®—ä»£ç ä¸­ç‹¬ç«‹è·¯å¾„çš„æ•°é‡ã€‚

**è®¡ç®—è§„åˆ™**:

- åŸºç¡€å€¼ä¸º1
- æ¯ä¸ªifã€forã€caseã€&&ã€||å¢åŠ 1

```go
// åœˆå¤æ‚åº¦ = 1 (åŸºç¡€) + 2 (if) + 1 (&&) = 4
func Example1(a, b int) bool {
    if a > 0 {
        if b > 0 && a > b {
            return true
        }
    }
    return false
}

// âœ… é™ä½å¤æ‚åº¦ - æå–å‡½æ•°
func Example2(a, b int) bool {
    if !isPositive(a) {
        return false
    }
    return isPositive(b) && a > b
}

func isPositive(n int) bool {
    return n > 0
}
```

**å»ºè®®é˜ˆå€¼**:

- < 10: ç®€å•å‡½æ•°
- 10-15: ä¸­ç­‰å¤æ‚åº¦
- 15-20: éœ€è¦é‡æ„
- \> 20: å¿…é¡»é‡æ„

### è®¤çŸ¥å¤æ‚åº¦ï¼ˆCognitive Complexity)

è®¤çŸ¥å¤æ‚åº¦æ›´æ³¨é‡ä»£ç çš„å¯ç†è§£æ€§ã€‚

```go
// é«˜è®¤çŸ¥å¤æ‚åº¦
func ProcessData(data []int) int {
    result := 0
    for i := 0; i < len(data); i++ {
        if data[i] > 0 {
            if data[i] % 2 == 0 {
                for j := 0; j < data[i]; j++ {
                    if j % 3 == 0 {
                        result += j
                    }
                }
            }
        }
    }
    return result
}

// âœ… é™ä½è®¤çŸ¥å¤æ‚åº¦
func ProcessData(data []int) int {
    result := 0
    for _, num := range data {
        result += processNumber(num)
    }
    return result
}

func processNumber(num int) int {
    if num <= 0 || num % 2 != 0 {
        return 0
    }
    
    sum := 0
    for i := 0; i < num; i += 3 {
        sum += i
    }
    return sum
}
```

---

## 5. ğŸ§¹ ä»£ç é‡æ„æŠ€å·§

### æå–æ–¹æ³•

```go
// âŒ é•¿æ–¹æ³•
func CreateOrder(req CreateOrderRequest) (*Order, error) {
    // éªŒè¯ç”¨æˆ·
    user, err := db.Query("SELECT * FROM users WHERE id = ?", req.UserID)
    if err != nil {
        return nil, err
    }
    if user == nil {
        return nil, errors.New("user not found")
    }
    
    // éªŒè¯å•†å“
    product, err := db.Query("SELECT * FROM products WHERE id = ?", req.ProductID)
    if err != nil {
        return nil, err
    }
    if product == nil {
        return nil, errors.New("product not found")
    }
    if product.Stock < req.Quantity {
        return nil, errors.New("insufficient stock")
    }
    
    // è®¡ç®—ä»·æ ¼
    totalPrice := product.Price * float64(req.Quantity)
    if user.VIP {
        totalPrice *= 0.9 // VIP 9æŠ˜
    }
    
    // åˆ›å»ºè®¢å•
    order := &Order{
        UserID:    req.UserID,
        ProductID: req.ProductID,
        Quantity:  req.Quantity,
        Price:     totalPrice,
    }
    
    return order, nil
}

// âœ… æå–æ–¹æ³•å
func CreateOrder(req CreateOrderRequest) (*Order, error) {
    user, err := validateUser(req.UserID)
    if err != nil {
        return nil, err
    }
    
    product, err := validateProduct(req.ProductID, req.Quantity)
    if err != nil {
        return nil, err
    }
    
    price := calculatePrice(product, req.Quantity, user.VIP)
    
    return buildOrder(req, price), nil
}

func validateUser(userID int) (*User, error) {
    user, err := db.Query("SELECT * FROM users WHERE id = ?", userID)
    if err != nil {
        return nil, fmt.Errorf("query user failed: %w", err)
    }
    if user == nil {
        return nil, ErrUserNotFound
    }
    return user, nil
}

func validateProduct(productID, quantity int) (*Product, error) {
    product, err := db.Query("SELECT * FROM products WHERE id = ?", productID)
    if err != nil {
        return nil, fmt.Errorf("query product failed: %w", err)
    }
    if product == nil {
        return nil, ErrProductNotFound
    }
    if product.Stock < quantity {
        return nil, ErrInsufficientStock
    }
    return product, nil
}

func calculatePrice(product *Product, quantity int, isVIP bool) float64 {
    price := product.Price * float64(quantity)
    if isVIP {
        price *= 0.9
    }
    return price
}

func buildOrder(req CreateOrderRequest, price float64) *Order {
    return &Order{
        UserID:    req.UserID,
        ProductID: req.ProductID,
        Quantity:  req.Quantity,
        Price:     price,
    }
}
```

### ç®€åŒ–æ¡ä»¶è¡¨è¾¾å¼

```go
// âŒ å¤æ‚æ¡ä»¶
func CanPurchase(user *User, product *Product, quantity int) bool {
    if user != nil && user.Status == "active" && product != nil && 
       product.Stock >= quantity && (user.Balance >= product.Price * float64(quantity) || 
       user.CreditLimit >= product.Price * float64(quantity)) {
        return true
    }
    return false
}

// âœ… ç®€åŒ–æ¡ä»¶
func CanPurchase(user *User, product *Product, quantity int) bool {
    if !isValidUser(user) || !isValidProduct(product, quantity) {
        return false
    }
    return hasEnoughFunds(user, product, quantity)
}

func isValidUser(user *User) bool {
    return user != nil && user.Status == "active"
}

func isValidProduct(product *Product, quantity int) bool {
    return product != nil && product.Stock >= quantity
}

func hasEnoughFunds(user *User, product *Product, quantity int) bool {
    totalCost := product.Price * float64(quantity)
    return user.Balance >= totalCost || user.CreditLimit >= totalCost
}
```

### æ¶ˆé™¤é‡å¤ä»£ç 

```go
// âŒ é‡å¤ä»£ç 
func GetUserByID(id int) (*User, error) {
    var user User
    err := db.QueryRow("SELECT id, name, email FROM users WHERE id = ?", id).Scan(&user.ID, &user.Name, &user.Email)
    if err != nil {
        if err == sql.ErrNoRows {
            return nil, ErrUserNotFound
        }
        return nil, fmt.Errorf("query failed: %w", err)
    }
    return &user, nil
}

func GetUserByEmail(email string) (*User, error) {
    var user User
    err := db.QueryRow("SELECT id, name, email FROM users WHERE email = ?", email).Scan(&user.ID, &user.Name, &user.Email)
    if err != nil {
        if err == sql.ErrNoRows {
            return nil, ErrUserNotFound
        }
        return nil, fmt.Errorf("query failed: %w", err)
    }
    return &user, nil
}

// âœ… æ¶ˆé™¤é‡å¤
func GetUserByID(id int) (*User, error) {
    return queryUser("SELECT id, name, email FROM users WHERE id = ?", id)
}

func GetUserByEmail(email string) (*User, error) {
    return queryUser("SELECT id, name, email FROM users WHERE email = ?", email)
}

func queryUser(query string, arg interface{}) (*User, error) {
    var user User
    err := db.QueryRow(query, arg).Scan(&user.ID, &user.Name, &user.Email)
    if err != nil {
        if err == sql.ErrNoRows {
            return nil, ErrUserNotFound
        }
        return nil, fmt.Errorf("query failed: %w", err)
    }
    return &user, nil
}
```

---

## 6. ğŸ” å®‰å…¨æ£€æŸ¥

### å¸¸è§å®‰å…¨é—®é¢˜

#### SQLæ³¨å…¥

```go
// âŒ ä¸å®‰å…¨ - SQLæ³¨å…¥é£é™©
func GetUser(username string) (*User, error) {
    query := "SELECT * FROM users WHERE username = '" + username + "'"
    // å¦‚æœusernameæ˜¯ "admin' OR '1'='1"ï¼Œå°†è¿”å›æ‰€æœ‰ç”¨æˆ·
    rows, err := db.Query(query)
    // ...
}

// âœ… å®‰å…¨ - ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
func GetUser(username string) (*User, error) {
    query := "SELECT * FROM users WHERE username = ?"
    rows, err := db.Query(query, username)
    // ...
}
```

#### å‘½ä»¤æ³¨å…¥

```go
// âŒ ä¸å®‰å…¨ - å‘½ä»¤æ³¨å…¥é£é™©
func BackupDatabase(filename string) error {
    cmd := exec.Command("sh", "-c", "mysqldump -u root db > " + filename)
    // å¦‚æœfilenameæ˜¯ "backup.sql; rm -rf /"ï¼Œå°†æ‰§è¡Œåˆ é™¤å‘½ä»¤
    return cmd.Run()
}

// âœ… å®‰å…¨ - éªŒè¯è¾“å…¥å¹¶ä½¿ç”¨ç™½åå•
func BackupDatabase(filename string) error {
    // éªŒè¯æ–‡ä»¶å
    if !regexp.MustCompile(`^[a-zA-Z0-9_-]+\.sql$`).MatchString(filename) {
        return errors.New("invalid filename")
    }
    
    // ä½¿ç”¨å‚æ•°æ•°ç»„è€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥
    cmd := exec.Command("mysqldump", "-u", "root", "db")
    file, err := os.Create(filename)
    if err != nil {
        return err
    }
    defer file.Close()
    
    cmd.Stdout = file
    return cmd.Run()
}
```

#### æ•æ„Ÿä¿¡æ¯æ³„éœ²

```go
// âŒ ä¸å®‰å…¨ - æ‰“å°æ•æ„Ÿä¿¡æ¯
func Login(username, password string) error {
    log.Printf("Login attempt: username=%s, password=%s", username, password)
    // ...
}

// âœ… å®‰å…¨ - ä¸æ‰“å°æ•æ„Ÿä¿¡æ¯
func Login(username, password string) error {
    log.Printf("Login attempt: username=%s", username)
    // å¯†ç ä¸åº”è¯¥è¢«è®°å½•
    // ...
}
```

### gosecå®‰å…¨æ‰«æ

```bash
# å®‰è£…gosec
go install github.com/securego/gosec/v2/cmd/gosec@latest

# è¿è¡Œå®‰å…¨æ‰«æ
gosec ./...

# ç”ŸæˆæŠ¥å‘Š
gosec -fmt=json -out=results.json ./...
```

---

## 7. ğŸ“Š ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ

### å®¡æŸ¥æ¸…å•

**åŠŸèƒ½æ€§**:

- [ ] ä»£ç æ˜¯å¦å®ç°äº†éœ€æ±‚
- [ ] è¾¹ç•Œæ¡ä»¶æ˜¯å¦å¤„ç†
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦å®Œæ•´
- [ ] æµ‹è¯•ç”¨ä¾‹æ˜¯å¦å……åˆ†

**ä»£ç è´¨é‡**:

- [ ] å‘½åæ˜¯å¦æ¸…æ™°
- [ ] æ³¨é‡Šæ˜¯å¦å……åˆ†
- [ ] ä»£ç æ˜¯å¦ç®€æ´
- [ ] æ˜¯å¦æœ‰é‡å¤ä»£ç 

**æ€§èƒ½**:

- [ ] æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜
- [ ] æ•°æ®åº“æŸ¥è¯¢æ˜¯å¦ä¼˜åŒ–
- [ ] æ˜¯å¦æœ‰ä¸å¿…è¦çš„è®¡ç®—

**å®‰å…¨æ€§**:

- [ ] æ˜¯å¦æœ‰å®‰å…¨æ¼æ´
- [ ] è¾“å…¥æ˜¯å¦éªŒè¯
- [ ] æ•æ„Ÿä¿¡æ¯æ˜¯å¦ä¿æŠ¤

### å®¡æŸ¥æµç¨‹

```mermaid
graph LR
    A[æäº¤PR] --> B[è‡ªåŠ¨æ£€æŸ¥]
    B --> C{é€šè¿‡?}
    C -->|å¦| A
    C -->|æ˜¯| D[ä»£ç å®¡æŸ¥]
    D --> E{é€šè¿‡?}
    E -->|å¦| F[ä¿®æ”¹ä»£ç ]
    F --> D
    E -->|æ˜¯| G[åˆå¹¶ä»£ç ]
```

---

## 8. ğŸ¯ è´¨é‡é—¨ç¦

### è´¨é‡é—¨ç¦é…ç½®

```yaml
# .è´¨é‡é—¨ç¦.yml
quality-gate:
  # æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
  coverage:
    minimum: 80%
    
  # ä»£ç å¤æ‚åº¦è¦æ±‚
  complexity:
    max-cyclomatic: 15
    max-cognitive: 20
    
  # ä»£ç é‡å¤ç‡è¦æ±‚
  duplication:
    max-rate: 5%
    
  # å®‰å…¨é—®é¢˜è¦æ±‚
  security:
    max-high: 0
    max-medium: 5
    
  # ä»£ç è§„èŒƒè¦æ±‚
  linting:
    max-errors: 0
    max-warnings: 10
```

### CIé›†æˆ

```yaml
# .github/workflows/quality-gate.yml
name: Quality Gate

on: [push, pull_request]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Go
      uses: actions/setup-go@v3
      with:
        go-version: 1.21
    
    # æµ‹è¯•å’Œè¦†ç›–ç‡
    - name: Run tests with coverage
      run: |
        go test -v -race -coverprofile=coverage.out ./...
        go tool cover -func=coverage.out
    
    # æ£€æŸ¥è¦†ç›–ç‡
    - name: Check coverage
      run: |
        COVERAGE=$(go tool cover -func=coverage.out | grep total | awk '{print $3}' | sed 's/%//')
        if (( $(echo "$COVERAGE < 80" | bc -l) )); then
          echo "Coverage $COVERAGE% is below 80%"
          exit 1
        fi
    
    # ä»£ç è´¨é‡æ£€æŸ¥
    - name: golangci-lint
      uses: golangci/golangci-lint-action@v3
      with:
        version: latest
        args: --timeout=5m
    
    # å®‰å…¨æ‰«æ
    - name: Run Gosec Security Scanner
      uses: securego/gosec@master
      with:
        args: '-no-fail -fmt json -out results.json ./...'
    
    # å¤æ‚åº¦æ£€æŸ¥
    - name: Check complexity
      run: |
        go install github.com/fzipp/gocyclo/cmd/gocyclo@latest
        gocyclo -over 15 .
    
    # ä»£ç é‡å¤æ£€æŸ¥
    - name: Check duplication
      run: |
        go install github.com/mibk/dupl@latest
        dupl -threshold 100 .
```

---

## 9. ğŸ’¡ æœ€ä½³å®è·µ

### DO's âœ…

1. **ç¼–å†™è‡ªæ–‡æ¡£åŒ–çš„ä»£ç **
   - ä½¿ç”¨æ¸…æ™°çš„å‘½å
   - æ·»åŠ å¿…è¦çš„æ³¨é‡Š
   - ä¿æŒä»£ç ç®€æ´

2. **éµå¾ªGoæƒ¯ä¾‹**
   - ä½¿ç”¨gofmtæ ¼å¼åŒ–ä»£ç 
   - éµå¾ªGoå‘½åè§„èŒƒ
   - ä½¿ç”¨Goæƒ¯ç”¨æ³•

3. **åŠæ—©è¿”å›**
   - ä½¿ç”¨guardå­å¥
   - å‡å°‘åµŒå¥—å±‚æ¬¡
   - æé«˜ä»£ç å¯è¯»æ€§

4. **å°å‡½æ•°åŸåˆ™**
   - å‡½æ•°ä¸è¶…è¿‡50è¡Œ
   - å•ä¸€èŒè´£
   - æ˜“äºæµ‹è¯•

5. **å®šæœŸé‡æ„**
   - æ¶ˆé™¤ä»£ç åå‘³é“
   - é™ä½æŠ€æœ¯å€ºåŠ¡
   - ä¿æŒä»£ç è´¨é‡

### DON'Ts âŒ

1. **ä¸è¦å¿½ç•¥é”™è¯¯**
2. **ä¸è¦å†™è¿‡é•¿çš„å‡½æ•°**
3. **ä¸è¦è¿‡åº¦åµŒå¥—**
4. **ä¸è¦é‡å¤ä»£ç **
5. **ä¸è¦å¿½ç•¥ä»£ç å®¡æŸ¥åé¦ˆ**

---

## 10. ğŸ”§ å·¥å…·æ¨è

### é™æ€åˆ†æå·¥å…·

| å·¥å…· | ç”¨é€” | æ¨èæŒ‡æ•° |
|------|------|---------|
| **golangci-lint** | ç»¼åˆä»£ç æ£€æŸ¥ | â­â­â­â­â­ |
| **gosec** | å®‰å…¨æ‰«æ | â­â­â­â­â­ |
| **gocyclo** | åœˆå¤æ‚åº¦æ£€æŸ¥ | â­â­â­â­ |
| **dupl** | ä»£ç é‡å¤æ£€æŸ¥ | â­â­â­â­ |
| **staticcheck** | é«˜çº§é™æ€åˆ†æ | â­â­â­â­â­ |

### IDEæ’ä»¶

**VS Code**:

- Go extension (å®˜æ–¹)
- Error Lens
- SonarLint
- Better Comments

**GoLand**:

- å†…ç½®ä»£ç æ£€æŸ¥
- Code With Me
- .ignore

---

## ğŸ“š æ‰©å±•é˜…è¯»

- [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments)
- [Effective Go](https://golang.org/doc/effective_go.html)
- [golangci-lintæ–‡æ¡£](https://golangci-lint.run/)
- [Clean Code (Go)](https://github.com/Pungyeon/clean-go-article)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Go Documentation Team  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ24æ—¥  
**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæˆ  
**é€‚ç”¨ç‰ˆæœ¬**: Go 1.21+
