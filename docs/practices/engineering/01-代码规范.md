# Goä»£ç è§„èŒƒ

> **ç®€ä»‹**: Goä»£ç è§„èŒƒå®Œæ•´æŒ‡å—ï¼ŒåŒ…æ‹¬å‘½åè§„èŒƒã€ä»£ç é£æ ¼ã€æ³¨é‡Šè§„èŒƒå’Œæœ€ä½³å®è·µ

> **ç‰ˆæœ¬**: Go 1.25.3  
> **éš¾åº¦**: â­â­â­  
> **æ ‡ç­¾**: #ä»£ç è§„èŒƒ #é£æ ¼æŒ‡å— #æœ€ä½³å®è·µ

---

## ğŸ“š ç›®å½•

1. [å‘½åè§„èŒƒ](#å‘½åè§„èŒƒ)
2. [ä»£ç é£æ ¼](#ä»£ç é£æ ¼)
3. [æ³¨é‡Šè§„èŒƒ](#æ³¨é‡Šè§„èŒƒ)
4. [åŒ…ç»„ç»‡](#åŒ…ç»„ç»‡)
5. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
6. [å¹¶å‘ç¼–ç¨‹](#å¹¶å‘ç¼–ç¨‹)

---

## 1. å‘½åè§„èŒƒ

### åŒ…å

```go
// âœ… æ¨èï¼šå°å†™ã€ç®€çŸ­ã€æœ‰æ„ä¹‰
package http
package json
package user
package order

// âŒ ä¸æ¨èï¼šé©¼å³°ã€ä¸‹åˆ’çº¿ã€è¿‡é•¿
package httpServer
package json_parser
package userManagementService
```

---

### å˜é‡å

```go
// âœ… æ¨èï¼šé©¼å³°å‘½åã€æœ‰æ„ä¹‰
var userName string
var userCount int
var isActive bool

// ç¼©å†™è¦ä¹ˆå…¨å¤§å†™è¦ä¹ˆå…¨å°å†™
var userID string    // âœ…
var userHTTPClient   // âœ…
var userId string    // âŒ
var userHttpClient   // âŒ

// å±€éƒ¨å˜é‡å¯ä»¥ç®€çŸ­
for i := 0; i < 10; i++ {    // âœ…
    // ...
}

// ä½†è¦é¿å…è¿‡äºç®€çŸ­å¯¼è‡´éš¾ä»¥ç†è§£
var u string  // âŒ ä¸æ¸…æ¥šuæ˜¯ä»€ä¹ˆ
var user string  // âœ… æ¸…æ™°æ˜äº†
```

---

### å¸¸é‡å

```go
// âœ… æ¨èï¼šé©¼å³°å‘½å
const MaxConnections = 100
const defaultTimeout = 30 * time.Second

// åŒ…çº§å¸¸é‡ä½¿ç”¨å¤§å†™å¼€å¤´ï¼ˆå¯¼å‡ºï¼‰
const (
    StatusPending  = "pending"
    StatusActive   = "active"
    StatusInactive = "inactive"
)

// ç§æœ‰å¸¸é‡ä½¿ç”¨å°å†™å¼€å¤´
const (
    minPoolSize = 1
    maxPoolSize = 100
)

// âŒ ä¸æ¨èï¼šå…¨å¤§å†™è›‡å½¢å‘½åï¼ˆCé£æ ¼ï¼‰
const MAX_CONNECTIONS = 100
const DEFAULT_TIMEOUT = 30
```

---

### å‡½æ•°å

```go
// âœ… æ¨èï¼šé©¼å³°å‘½åã€åŠ¨è¯å¼€å¤´
func GetUser(id string) (*User, error)
func CreateOrder(req *CreateOrderRequest) (*Order, error)
func UpdateUserEmail(userID, email string) error
func DeletePost(id string) error

// å¸ƒå°”å‡½æ•°ä½¿ç”¨is/has/canå‰ç¼€
func IsValid() bool
func HasPermission() bool
func CanAccess() bool

// âŒ ä¸æ¨è
func get_user(id string) (*User, error)  // ä¸‹åˆ’çº¿
func userGet(id string) (*User, error)   // åè¯å¼€å¤´
```

---

### æ¥å£å

```go
// âœ… æ¨èï¼šå•æ–¹æ³•æ¥å£ä½¿ç”¨-eråç¼€
type Reader interface {
    Read(p []byte) (n int, err error)
}

type Writer interface {
    Write(p []byte) (n int, err error)
}

type Closer interface {
    Close() error
}

// å¤šæ–¹æ³•æ¥å£ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
type UserRepository interface {
    Create(user *User) error
    FindByID(id string) (*User, error)
    Update(user *User) error
    Delete(id string) error
}

// âŒ ä¸æ¨èï¼šIUser (C#é£æ ¼), UserInterface
```

---

### ç»“æ„ä½“å

```go
// âœ… æ¨èï¼šé©¼å³°å‘½åã€åè¯
type User struct {
    ID       string
    Username string
    Email    string
}

type OrderItem struct {
    ProductID string
    Quantity  int
    Price     float64
}

// âŒ ä¸æ¨è
type user struct {  // å°å†™å¼€å¤´ï¼ˆé™¤éæ˜¯ç§æœ‰çš„ï¼‰
    // ...
}

type UserStruct struct {  // å¤šä½™çš„Structåç¼€
    // ...
}
```

---

## 2. ä»£ç é£æ ¼

### ä»£ç æ ¼å¼åŒ–

```bash
# ä½¿ç”¨gofmtæ ¼å¼åŒ–ä»£ç 
gofmt -w .

# ä½¿ç”¨goimportsï¼ˆè‡ªåŠ¨ç®¡ç†importï¼‰
goimports -w .
```

---

### importåˆ†ç»„

```go
// âœ… æ¨èï¼šåˆ†ç»„å¹¶æŒ‰å­—æ¯æ’åº
import (
    // æ ‡å‡†åº“
    "context"
    "encoding/json"
    "fmt"
    "net/http"
    "time"
    
    // ç¬¬ä¸‰æ–¹åº“
    "github.com/gin-gonic/gin"
    "github.com/go-redis/redis/v8"
    "gorm.io/gorm"
    
    // é¡¹ç›®å†…éƒ¨åŒ…
    "myapp/internal/model"
    "myapp/internal/service"
    "myapp/pkg/logger"
)

// âŒ ä¸æ¨èï¼šæ··ä¹±çš„import
import (
    "myapp/internal/model"
    "fmt"
    "github.com/gin-gonic/gin"
    "time"
    "myapp/pkg/logger"
)
```

---

### è¡Œå®½

```go
// âœ… æ¨èï¼šæ¯è¡Œä¸è¶…è¿‡120å­—ç¬¦
func CreateUser(username, email, password string, age int, address string) (*User, error) {
    // ...
}

// é•¿å‡½æ•°è°ƒç”¨æ¢è¡Œ
result, err := service.ProcessOrder(
    orderID,
    userID,
    paymentMethod,
    shippingAddress,
    billingAddress,
)

// âŒ ä¸æ¨èï¼šè¿‡é•¿çš„è¡Œ
result, err := service.ProcessOrder(orderID, userID, paymentMethod, shippingAddress, billingAddress, discountCode, couponCode)
```

---

### å‡½æ•°é•¿åº¦

```go
// âœ… æ¨èï¼šå‡½æ•°ä¿æŒç®€çŸ­ï¼ˆ<50è¡Œï¼‰
func ProcessOrder(order *Order) error {
    if err := validateOrder(order); err != nil {
        return err
    }
    
    if err := calculateTotal(order); err != nil {
        return err
    }
    
    if err := saveOrder(order); err != nil {
        return err
    }
    
    return nil
}

// âŒ ä¸æ¨èï¼šè¶…é•¿å‡½æ•°ï¼ˆ>100è¡Œï¼‰
func ProcessOrder(order *Order) error {
    // 100+ lines of code...
}
```

---

### ç©ºè¡Œä½¿ç”¨

```go
// âœ… æ¨èï¼šåˆç†ä½¿ç”¨ç©ºè¡Œåˆ†éš”é€»è¾‘å—
func ProcessOrder(order *Order) error {
    // éªŒè¯
    if err := validateOrder(order); err != nil {
        return err
    }
    
    // è®¡ç®—
    total := calculateTotal(order)
    discount := calculateDiscount(order)
    finalAmount := total - discount
    
    // ä¿å­˜
    if err := saveOrder(order); err != nil {
        return err
    }
    
    return nil
}
```

---

## 3. æ³¨é‡Šè§„èŒƒ

### åŒ…æ³¨é‡Š

```go
// âœ… æ¨èï¼šåŒ…æ³¨é‡Šåœ¨packageè¯­å¥ä¹‹å‰
// Package user provides user management functionality.
// It includes user creation, authentication, and authorization.
package user

// âŒ ä¸æ¨èï¼šç¼ºå°‘åŒ…æ³¨é‡Š
package user
```

---

### å‡½æ•°æ³¨é‡Š

```go
// âœ… æ¨èï¼šä»¥å‡½æ•°åå¼€å¤´ï¼Œè¯´æ˜åŠŸèƒ½
// GetUser retrieves a user by their unique ID.
// It returns an error if the user is not found.
func GetUser(id string) (*User, error) {
    // ...
}

// CreateOrder creates a new order for the specified user.
// It validates the order items and calculates the total amount.
// Returns the created order or an error if validation fails.
func CreateOrder(userID string, items []OrderItem) (*Order, error) {
    // ...
}

// âŒ ä¸æ¨èï¼šæ— æ³¨é‡Šæˆ–æ³¨é‡Šä¸æ¸…æ™°
func GetUser(id string) (*User, error) {
    // get user
}
```

---

### ç»“æ„ä½“æ³¨é‡Š

```go
// âœ… æ¨èï¼šæ³¨é‡Šç»“æ„ä½“å’Œå…³é”®å­—æ®µ
// User represents a user in the system.
type User struct {
    // ID is the unique identifier for the user.
    ID string
    
    // Username is the user's login name.
    Username string
    
    // Email is the user's email address.
    Email string
    
    // CreatedAt is the timestamp when the user was created.
    CreatedAt time.Time
}
```

---

### ä»£ç å†…æ³¨é‡Š

```go
// âœ… æ¨èï¼šè§£é‡Šä¸ºä»€ä¹ˆï¼Œè€Œä¸æ˜¯åšä»€ä¹ˆ
func CalculatePrice(basePrice float64, quantity int) float64 {
    // Apply bulk discount for orders over 100 items
    // to encourage large purchases
    if quantity > 100 {
        return basePrice * float64(quantity) * 0.9
    }
    
    return basePrice * float64(quantity)
}

// âŒ ä¸æ¨èï¼šæ³¨é‡Šæè¿°ä»£ç åœ¨åšä»€ä¹ˆ
func CalculatePrice(basePrice float64, quantity int) float64 {
    // Check if quantity is greater than 100
    if quantity > 100 {
        // Multiply base price by quantity and 0.9
        return basePrice * float64(quantity) * 0.9
    }
    
    // Multiply base price by quantity
    return basePrice * float64(quantity)
}
```

---

## 4. åŒ…ç»„ç»‡

### é¡¹ç›®ç»“æ„

```
myapp/
â”œâ”€â”€ cmd/                    # ä¸»ç¨‹åºå…¥å£
â”‚   â””â”€â”€ myapp/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/               # ç§æœ‰ä»£ç 
â”‚   â”œâ”€â”€ handler/           # HTTP handlers
â”‚   â”œâ”€â”€ service/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ repository/        # æ•°æ®è®¿é—®
â”‚   â””â”€â”€ model/             # æ•°æ®æ¨¡å‹
â”œâ”€â”€ pkg/                   # å…¬å…±åº“
â”‚   â”œâ”€â”€ logger/
â”‚   â””â”€â”€ validator/
â”œâ”€â”€ api/                   # APIå®šä¹‰
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶
â””â”€â”€ go.mod
```

---

### åŒ…å¯¼å…¥

```go
// âœ… æ¨èï¼šé¿å…å¾ªç¯ä¾èµ–
package handler

import "myapp/internal/service"  // handler â†’ service

package service

import "myapp/internal/repository"  // service â†’ repository

// âŒ ä¸æ¨èï¼šå¾ªç¯ä¾èµ–
package handler

import "myapp/internal/service"

package service

import "myapp/internal/handler"  // å¾ªç¯ä¾èµ–ï¼
```

---

## 5. é”™è¯¯å¤„ç†

### é”™è¯¯è¿”å›

```go
// âœ… æ¨èï¼šé”™è¯¯ä½œä¸ºæœ€åä¸€ä¸ªè¿”å›å€¼
func GetUser(id string) (*User, error) {
    // ...
}

func ProcessOrder(order *Order) error {
    // ...
}

// âœ… æ¨èï¼šç«‹å³æ£€æŸ¥é”™è¯¯
user, err := GetUser(id)
if err != nil {
    return nil, fmt.Errorf("failed to get user: %w", err)
}

// âŒ ä¸æ¨èï¼šå¿½ç•¥é”™è¯¯
user, _ := GetUser(id)
```

---

### é”™è¯¯åŒ…è£…

```go
// âœ… æ¨èï¼šä½¿ç”¨%wåŒ…è£…é”™è¯¯
func ProcessOrder(orderID string) error {
    order, err := getOrder(orderID)
    if err != nil {
        return fmt.Errorf("failed to get order %s: %w", orderID, err)
    }
    
    // ...
    return nil
}

// âŒ ä¸æ¨èï¼šä¸¢å¤±åŸå§‹é”™è¯¯
func ProcessOrder(orderID string) error {
    order, err := getOrder(orderID)
    if err != nil {
        return fmt.Errorf("failed to get order")  // ä¸¢å¤±äº†åŸå§‹é”™è¯¯
    }
    
    // ...
    return nil
}
```

---

### é”™è¯¯æ£€æŸ¥

```go
// âœ… æ¨èï¼šä½¿ç”¨errors.Iså’Œerrors.As
if errors.Is(err, ErrNotFound) {
    // å¤„ç†æœªæ‰¾åˆ°é”™è¯¯
}

var validationErr *ValidationError
if errors.As(err, &validationErr) {
    // å¤„ç†éªŒè¯é”™è¯¯
}

// âŒ ä¸æ¨èï¼šç›´æ¥æ¯”è¾ƒé”™è¯¯
if err == ErrNotFound {  // æ— æ³•å¤„ç†åŒ…è£…çš„é”™è¯¯
    // ...
}
```

---

## 6. å¹¶å‘ç¼–ç¨‹

### Goroutineå¯åŠ¨

```go
// âœ… æ¨èï¼šç¡®ä¿goroutineèƒ½å¤Ÿé€€å‡º
func ProcessItems(ctx context.Context, items []Item) {
    for _, item := range items {
        item := item  // æ•è·å¾ªç¯å˜é‡
        
        go func() {
            select {
            case <-ctx.Done():
                return
            default:
                process(item)
            }
        }()
    }
}

// âŒ ä¸æ¨èï¼šgoroutineå¯èƒ½æ³„æ¼
func ProcessItems(items []Item) {
    for _, item := range items {
        go func() {
            process(item)  // å¯èƒ½ä¸€ç›´è¿è¡Œ
        }()
    }
}
```

---

### Channelä½¿ç”¨

```go
// âœ… æ¨èï¼šå…³é—­channel
func Producer(ch chan<- int) {
    defer close(ch)  // ç¡®ä¿å…³é—­
    
    for i := 0; i < 10; i++ {
        ch <- i
    }
}

// âœ… æ¨èï¼šä½¿ç”¨å¸¦ç¼“å†²çš„channelé¿å…é˜»å¡
ch := make(chan int, 10)

// âŒ ä¸æ¨èï¼šä¸å…³é—­channel
func Producer(ch chan<- int) {
    for i := 0; i < 10; i++ {
        ch <- i
    }
    // å¿˜è®°å…³é—­ï¼Œæ¶ˆè´¹è€…ä¼šä¸€ç›´ç­‰å¾…
}
```

---

### Contextä½¿ç”¨

```go
// âœ… æ¨èï¼šä¼ é€’context
func ProcessRequest(ctx context.Context, req *Request) error {
    // ä¼ é€’contextåˆ°ä¸‹å±‚
    user, err := userService.GetUser(ctx, req.UserID)
    if err != nil {
        return err
    }
    
    // ä½¿ç”¨contextçš„è¶…æ—¶
    ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
    defer cancel()
    
    return externalService.Call(ctx, user)
}

// âŒ ä¸æ¨èï¼šä¸ä½¿ç”¨context
func ProcessRequest(req *Request) error {
    user, err := userService.GetUser(req.UserID)
    if err != nil {
        return err
    }
    
    return externalService.Call(user)
}
```

---

## ğŸ¯ ä»£ç å®¡æŸ¥æ¸…å•

### å‘½å
- [ ] åŒ…åå°å†™ã€ç®€çŸ­
- [ ] å˜é‡åé©¼å³°ã€æœ‰æ„ä¹‰
- [ ] æ¥å£åä½¿ç”¨-eråç¼€
- [ ] å¸¸é‡ä½¿ç”¨é©¼å³°å‘½å

### æ ¼å¼
- [ ] ä»£ç å·²æ ¼å¼åŒ–ï¼ˆgofmtï¼‰
- [ ] importå·²åˆ†ç»„æ’åº
- [ ] è¡Œå®½<120å­—ç¬¦
- [ ] å‡½æ•°é•¿åº¦<50è¡Œ

### æ³¨é‡Š
- [ ] åŒ…æœ‰æ³¨é‡Š
- [ ] å¯¼å‡ºå‡½æ•°æœ‰æ³¨é‡Š
- [ ] å¤æ‚é€»è¾‘æœ‰è§£é‡Š

### é”™è¯¯å¤„ç†
- [ ] é”™è¯¯ä¸è¢«å¿½ç•¥
- [ ] é”™è¯¯è¢«æ­£ç¡®åŒ…è£…
- [ ] ä½¿ç”¨errors.Is/As

### å¹¶å‘
- [ ] Goroutineèƒ½å¤Ÿé€€å‡º
- [ ] Channelè¢«æ­£ç¡®å…³é—­
- [ ] Contextè¢«æ­£ç¡®ä¼ é€’

---

## ğŸ”— ç›¸å…³èµ„æº

- [æµ‹è¯•è§„èŒƒ](../testing/README.md)
- [æ–‡æ¡£è§„èŒƒ](./02-æ–‡æ¡£è§„èŒƒ.md)
- [Goå®˜æ–¹ä»£ç è§„èŒƒ](https://go.dev/doc/effective_go)

---

**æœ€åæ›´æ–°**: 2025-10-28  
**Goç‰ˆæœ¬**: 1.25.3

