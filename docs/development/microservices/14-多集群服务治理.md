# 14. ğŸŒ å¤šé›†ç¾¤æœåŠ¡æ²»ç†

> ğŸ“š **ç®€ä»‹**ï¼šæœ¬æ–‡æ¡£æ·±å…¥æ¢è®¨å¤šé›†ç¾¤å¾®æœåŠ¡æ¶æ„çš„è®¾è®¡ä¸æ²»ç†ï¼Œæ¶µç›–è·¨é›†ç¾¤é€šä¿¡ã€æœåŠ¡å‘ç°ã€æµé‡ç®¡ç†ã€å®¹ç¾å¤‡ä»½å’Œæˆæœ¬ä¼˜åŒ–ç­‰æ ¸å¿ƒä¸»é¢˜ã€‚é€šè¿‡æœ¬æ–‡ï¼Œè¯»è€…å°†æŒæ¡æ„å»ºå’Œç®¡ç†å¤§è§„æ¨¡ã€å¤šåŒºåŸŸå¾®æœåŠ¡ç³»ç»Ÿçš„å®è·µæŠ€èƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [14. ğŸŒ å¤šé›†ç¾¤æœåŠ¡æ²»ç†](#14--å¤šé›†ç¾¤æœåŠ¡æ²»ç†)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [14.1 ğŸ“š å¤šé›†ç¾¤æ¶æ„æ¦‚è¿°](#141--å¤šé›†ç¾¤æ¶æ„æ¦‚è¿°)
  - [14.2 ğŸŒ è·¨é›†ç¾¤é€šä¿¡](#142--è·¨é›†ç¾¤é€šä¿¡)
    - [Istioå¤šé›†ç¾¤ç½‘æ ¼](#istioå¤šé›†ç¾¤ç½‘æ ¼)
    - [Submarinerè·¨é›†ç¾¤ç½‘ç»œ](#submarinerè·¨é›†ç¾¤ç½‘ç»œ)
    - [äº‘å‚å•†æ–¹æ¡ˆ](#äº‘å‚å•†æ–¹æ¡ˆ)
  - [14.3 ğŸ” æœåŠ¡å‘ç°ä¸æ³¨å†Œ](#143--æœåŠ¡å‘ç°ä¸æ³¨å†Œ)
    - [Consulå¤šæ•°æ®ä¸­å¿ƒ](#consulå¤šæ•°æ®ä¸­å¿ƒ)
    - [Istioå¤šé›†ç¾¤æœåŠ¡å‘ç°](#istioå¤šé›†ç¾¤æœåŠ¡å‘ç°)
  - [14.4 ğŸš¦ æµé‡ç®¡ç†](#144--æµé‡ç®¡ç†)
    - [åœ°åŸŸæ„ŸçŸ¥è·¯ç”±](#åœ°åŸŸæ„ŸçŸ¥è·¯ç”±)
    - [å…¨å±€è´Ÿè½½å‡è¡¡](#å…¨å±€è´Ÿè½½å‡è¡¡)
    - [è·¨é›†ç¾¤æ•…éšœè½¬ç§»](#è·¨é›†ç¾¤æ•…éšœè½¬ç§»)
  - [14.5 ğŸ’¾ æ•°æ®åŒæ­¥ä¸ä¸€è‡´æ€§](#145--æ•°æ®åŒæ­¥ä¸ä¸€è‡´æ€§)
    - [MySQLè·¨åŒºåŸŸå¤åˆ¶](#mysqlè·¨åŒºåŸŸå¤åˆ¶)
    - [Redisè·¨æ•°æ®ä¸­å¿ƒåŒæ­¥](#redisè·¨æ•°æ®ä¸­å¿ƒåŒæ­¥)
    - [äº‹ä»¶æº¯æº](#äº‹ä»¶æº¯æº)
  - [14.6 ğŸ›¡ï¸ é«˜å¯ç”¨ä¸å®¹ç¾](#146-ï¸-é«˜å¯ç”¨ä¸å®¹ç¾)
    - [åŒºåŸŸæ•…éšœè‡ªåŠ¨åˆ‡æ¢](#åŒºåŸŸæ•…éšœè‡ªåŠ¨åˆ‡æ¢)
    - [å¤‡ä»½ä¸æ¢å¤](#å¤‡ä»½ä¸æ¢å¤)
    - [ç¾å¤‡æ¼”ç»ƒ](#ç¾å¤‡æ¼”ç»ƒ)
  - [14.7 ğŸ“Š ç›‘æ§ä¸å¯è§‚æµ‹æ€§](#147--ç›‘æ§ä¸å¯è§‚æµ‹æ€§)
    - [Prometheusè”é‚¦](#prometheusè”é‚¦)
    - [Thanoså…¨å±€æŸ¥è¯¢](#thanoså…¨å±€æŸ¥è¯¢)
    - [åˆ†å¸ƒå¼è¿½è¸ª](#åˆ†å¸ƒå¼è¿½è¸ª)
  - [14.8 ğŸ’° æˆæœ¬ä¼˜åŒ–](#148--æˆæœ¬ä¼˜åŒ–)
    - [è·¨åŒºåŸŸæˆæœ¬åˆ†æ](#è·¨åŒºåŸŸæˆæœ¬åˆ†æ)
    - [èµ„æºè°ƒåº¦ä¼˜åŒ–](#èµ„æºè°ƒåº¦ä¼˜åŒ–)
  - [14.9 ğŸ¯ æœ€ä½³å®è·µ](#149--æœ€ä½³å®è·µ)
  - [14.10 âš ï¸ å¸¸è§é—®é¢˜](#1410-ï¸-å¸¸è§é—®é¢˜)
    - [Q1: è·¨é›†ç¾¤ç½‘ç»œå»¶è¿Ÿé«˜ï¼Ÿ](#q1-è·¨é›†ç¾¤ç½‘ç»œå»¶è¿Ÿé«˜)
    - [Q2: å¦‚ä½•å¤„ç†è·¨é›†ç¾¤æ•°æ®ä¸€è‡´æ€§ï¼Ÿ](#q2-å¦‚ä½•å¤„ç†è·¨é›†ç¾¤æ•°æ®ä¸€è‡´æ€§)
    - [Q3: å¤šé›†ç¾¤ç®¡ç†å¤æ‚åº¦é«˜ï¼Ÿ](#q3-å¤šé›†ç¾¤ç®¡ç†å¤æ‚åº¦é«˜)
    - [Q4: æˆæœ¬è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ](#q4-æˆæœ¬è¿‡é«˜æ€ä¹ˆåŠ)
  - [14.11 ğŸ“š æ‰©å±•é˜…è¯»](#1411--æ‰©å±•é˜…è¯»)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

## 14.1 ğŸ“š å¤šé›†ç¾¤æ¶æ„æ¦‚è¿°

**å¤šé›†ç¾¤æ¶æ„**: å°†åº”ç”¨éƒ¨ç½²åˆ°å¤šä¸ªKubernetesé›†ç¾¤ï¼Œé€šå¸¸è·¨è¶Šä¸åŒçš„åœ°ç†åŒºåŸŸæˆ–äº‘æœåŠ¡å•†ã€‚

**ä½¿ç”¨åœºæ™¯**:

- âœ… **é«˜å¯ç”¨**: å•é›†ç¾¤æ•…éšœä¸å½±å“å…¨å±€
- âœ… **ç¾å¤‡**: è·¨åŒºåŸŸå®¹ç¾
- âœ… **å°±è¿‘è®¿é—®**: å‡å°‘ç½‘ç»œå»¶è¿Ÿ
- âœ… **åˆè§„è¦æ±‚**: æ•°æ®ä¸»æƒå’Œæœ¬åœ°åŒ–
- âœ… **æˆæœ¬ä¼˜åŒ–**: åˆ©ç”¨ä¸åŒåŒºåŸŸä»·æ ¼å·®å¼‚
- âœ… **ç¯å¢ƒéš”ç¦»**: å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒéš”ç¦»

**æ¶æ„æ¨¡å¼**:

| æ¨¡å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| ä¸»ä»æ¨¡å¼ | ä¸»é›†ç¾¤å¤„ç†å†™ï¼Œä»é›†ç¾¤åªè¯» | è¯»å¤šå†™å°‘ |
| å¤šæ´»æ¨¡å¼ | æ‰€æœ‰é›†ç¾¤å‡å¯è¯»å†™ | é«˜å¯ç”¨è¦æ±‚ |
| è”é‚¦æ¨¡å¼ | ç»Ÿä¸€æ§åˆ¶å¹³é¢ç®¡ç†å¤šé›†ç¾¤ | å¤§è§„æ¨¡é›†ç¾¤ |

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Global Control Plane            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Service Mesh Control Plane      â”‚   â”‚
â”‚  â”‚  (Istio Multi-Primary)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“         â†“         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ é›†ç¾¤US  â”‚   â”‚ é›†ç¾¤EU  â”‚   â”‚ é›†ç¾¤AS  â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚Svc Aâ”‚ â”‚â—„â”€â–ºâ”‚ â”‚Svc Aâ”‚ â”‚â—„â”€â–ºâ”‚ â”‚Svc Aâ”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚Svc Bâ”‚ â”‚   â”‚ â”‚Svc Bâ”‚ â”‚   â”‚ â”‚Svc Bâ”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 14.2 ğŸŒ è·¨é›†ç¾¤é€šä¿¡

### Istioå¤šé›†ç¾¤ç½‘æ ¼

**Multi-Primaryå¤šä¸»æ¨¡å¼**:

```bash
# é›†ç¾¤1é…ç½®
istioctl install --set profile=default \
  --set values.global.meshID=mesh1 \
  --set values.global.multiCluster.clusterName=cluster1 \
  --set values.global.network=network1

# é›†ç¾¤2é…ç½®
istioctl install --set profile=default \
  --set values.global.meshID=mesh1 \
  --set values.global.multiCluster.clusterName=cluster2 \
  --set values.global.network=network2

# é…ç½®è·¨é›†ç¾¤Secret
istioctl create-remote-secret \
  --context=cluster1 \
  --name=cluster1 | \
  kubectl apply -f - --context=cluster2

istioctl create-remote-secret \
  --context=cluster2 \
  --name=cluster2 | \
  kubectl apply -f - --context=cluster1
```

**ServiceEntryé…ç½®**:

```yaml
apiVersion: networking.istio.io/v1beta1
kind: ServiceEntry
metadata:
  name: user-service-cluster2
spec:
  hosts:
  - user-service.production.global
  location: MESH_INTERNAL
  ports:
  - number: 80
    name: http
    protocol: HTTP
  resolution: DNS
  addresses:
  - 10.20.30.40  # è¿œç¨‹é›†ç¾¤Service IP
  endpoints:
  - address: user-service.production.svc.cluster2.local
    ports:
      http: 80
```

### Submarinerè·¨é›†ç¾¤ç½‘ç»œ

```bash
# å®‰è£…Submariner Broker
subctl deploy-broker --kubeconfig broker-cluster.yaml

# åŠ å…¥é›†ç¾¤1
subctl join --kubeconfig cluster1.yaml broker-info.subm

# åŠ å…¥é›†ç¾¤2
subctl join --kubeconfig cluster2.yaml broker-info.subm

# å¯¼å‡ºæœåŠ¡
subctl export service user-service -n production --kubeconfig cluster1.yaml
```

### äº‘å‚å•†æ–¹æ¡ˆ

**AWS VPC Peering**:

```bash
# åˆ›å»ºVPC Peeringè¿æ¥
aws ec2 create-vpc-peering-connection \
  --vpc-id vpc-1a2b3c4d \
  --peer-vpc-id vpc-5e6f7g8h \
  --peer-region us-west-2
```

**GCP VPC Network Peering**:

```bash
gcloud compute networks peerings create peer-to-cluster2 \
  --network=cluster1-network \
  --peer-project=project-cluster2 \
  --peer-network=cluster2-network
```

## 14.3 ğŸ” æœåŠ¡å‘ç°ä¸æ³¨å†Œ

### Consulå¤šæ•°æ®ä¸­å¿ƒ

```hcl
# Consulé…ç½®
datacenter = "us-east-1"
primary_datacenter = "us-east-1"

connect {
  enabled = true
}

wan_join = ["consul-server.us-west-2.example.com"]
```

**è·¨DCæœåŠ¡å‘ç°**:

```go
package main

import (
    "github.com/hashicorp/consul/api"
)

func DiscoverService(service, datacenter string) ([]*api.ServiceEntry, error) {
    client, _ := api.NewClient(api.DefaultConfig())

    services, _, err := client.Health().Service(
        service,
        "",
        true,
        &api.QueryOptions{
            Datacenter: datacenter,
        },
    )

    return services, err
}

// ä½¿ç”¨
func main() {
    // æœ¬åœ°DC
    localServices, _ := DiscoverService("user-service", "us-east-1")

    // è¿œç¨‹DC
    remoteServices, _ := DiscoverService("user-service", "eu-west-1")
}
```

### Istioå¤šé›†ç¾¤æœåŠ¡å‘ç°

```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: user-service-multi-cluster
spec:
  host: user-service.production.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      localityLbSetting:
        enabled: true
        distribute:
        - from: us-east/*
          to:
            "us-east/*": 80
            "eu-west/*": 20
        - from: eu-west/*
          to:
            "eu-west/*": 80
            "us-east/*": 20
```

## 14.4 ğŸš¦ æµé‡ç®¡ç†

### åœ°åŸŸæ„ŸçŸ¥è·¯ç”±

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: user-service-geo-routing
spec:
  hosts:
  - user-service
  http:
  - match:
    - headers:
        x-region:
          exact: us
    route:
    - destination:
        host: user-service
      weight: 100
      subset: us-cluster
  - match:
    - headers:
        x-region:
          exact: eu
    route:
    - destination:
        host: user-service
      weight: 100
      subset: eu-cluster
  - route:
    - destination:
        host: user-service
      weight: 50
      subset: us-cluster
    - destination:
        host: user-service
      weight: 50
      subset: eu-cluster
```

### å…¨å±€è´Ÿè½½å‡è¡¡

**Global Server Load Balancing (GSLB)**:

```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: user-service-gslb
spec:
  host: user-service.production.global
  trafficPolicy:
    loadBalancer:
      simple: ROUND_ROBIN
      localityLbSetting:
        enabled: true
        failover:
        - from: us-east-1
          to: us-west-2
        - from: eu-west-1
          to: us-east-1
```

### è·¨é›†ç¾¤æ•…éšœè½¬ç§»

```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: user-service-failover
spec:
  host: user-service
  trafficPolicy:
    connectionPool:
      http:
        maxRequestsPerConnection: 1
    outlierDetection:
      consecutive5xxErrors: 5
      interval: 30s
      baseEjectionTime: 60s
    loadBalancer:
      localityLbSetting:
        enabled: true
        failover:
        - from: cluster1
          to: cluster2
```

## 14.5 ğŸ’¾ æ•°æ®åŒæ­¥ä¸ä¸€è‡´æ€§

### MySQLè·¨åŒºåŸŸå¤åˆ¶

```sql
-- ä¸»åº“é…ç½®ï¼ˆUSé›†ç¾¤ï¼‰
[mysqld]
server-id=1
log-bin=mysql-bin
binlog-do-db=userdb

-- ä»åº“é…ç½®ï¼ˆEUé›†ç¾¤ï¼‰
[mysqld]
server-id=2
relay-log=mysql-relay-bin

-- å»ºç«‹å¤åˆ¶
CHANGE MASTER TO
  MASTER_HOST='us-mysql.example.com',
  MASTER_USER='replicator',
  MASTER_PASSWORD='password',
  MASTER_LOG_FILE='mysql-bin.000001',
  MASTER_LOG_POS=107;

START SLAVE;
```

**Goåº”ç”¨è¯»å†™åˆ†ç¦»**:

```go
type DBCluster struct {
    master *sql.DB  // USé›†ç¾¤
    slaves []*sql.DB // EUã€ASé›†ç¾¤
}

func (dbc *DBCluster) Query(ctx context.Context, query string) (*sql.Rows, error) {
    // æ ¹æ®ç”¨æˆ·åœ°åŸŸé€‰æ‹©ä»åº“
    region := ctx.Value("region").(string)
    slave := dbc.selectSlave(region)
    return slave.QueryContext(ctx, query)
}

func (dbc *DBCluster) Exec(ctx context.Context, query string) (sql.Result, error) {
    // å†™æ“ä½œå§‹ç»ˆèµ°ä¸»åº“
    return dbc.master.ExecContext(ctx, query)
}
```

### Redisè·¨æ•°æ®ä¸­å¿ƒåŒæ­¥

**Redis Enterprise Active-Active**:

```bash
# åˆ›å»ºActive-Activeæ•°æ®åº“
rladmin create db db-name memory-size 1GB \
  replication false \
  crdt true \
  crdt-replication true \
  crdt-replica-id 1
```

### äº‹ä»¶æº¯æº

```go
type EventStore struct {
    stores map[string]*EventDB // æ¯ä¸ªé›†ç¾¤ä¸€ä¸ªEventDB
}

func (es *EventStore) Publish(event Event) error {
    // å‘å¸ƒåˆ°æ‰€æœ‰é›†ç¾¤
    var wg sync.WaitGroup
    for _, store := range es.stores {
        wg.Add(1)
        go func(s *EventDB) {
            defer wg.Done()
            s.Append(event)
        }(store)
    }
    wg.Wait()
    return nil
}
```

## 14.6 ğŸ›¡ï¸ é«˜å¯ç”¨ä¸å®¹ç¾

### åŒºåŸŸæ•…éšœè‡ªåŠ¨åˆ‡æ¢

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 3
  template:
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values:
                  - user-service
              topologyKey: topology.kubernetes.io/zone
```

### å¤‡ä»½ä¸æ¢å¤

**Veleroå¤šé›†ç¾¤å¤‡ä»½**:

```bash
# å®‰è£…Velero
velero install \
  --provider aws \
  --plugins velero/velero-plugin-for-aws:v1.8.0 \
  --bucket velero-backups \
  --backup-location-config region=us-east-1 \
  --snapshot-location-config region=us-east-1

# åˆ›å»ºå®šæœŸå¤‡ä»½
velero schedule create daily-backup \
  --schedule="0 2 * * *" \
  --include-namespaces production

# è·¨é›†ç¾¤æ¢å¤
velero restore create --from-backup daily-backup-20231020 \
  --namespace-mappings production:production-restored \
  --kubeconfig cluster2.yaml
```

### ç¾å¤‡æ¼”ç»ƒ

```bash
# æ¨¡æ‹Ÿé›†ç¾¤æ•…éšœ
kubectl --context=cluster1 scale deployment user-service --replicas=0

# éªŒè¯æµé‡è‡ªåŠ¨åˆ‡æ¢åˆ°cluster2
kubectl --context=cluster2 get pods -l app=user-service

# ç›‘æ§æµé‡åˆ†å¸ƒ
istioctl --context=cluster2 dashboard kiali
```

## 14.7 ğŸ“Š ç›‘æ§ä¸å¯è§‚æµ‹æ€§

### Prometheusè”é‚¦

```yaml
# å…¨å±€Prometheusé…ç½®
scrape_configs:
- job_name: 'federate-us'
  scrape_interval: 15s
  honor_labels: true
  metrics_path: '/federate'
  params:
    'match[]':
      - '{job="kubernetes-pods"}'
      - '{__name__=~"job:.*"}'
  static_configs:
  - targets:
    - 'prometheus-us.example.com:9090'
    labels:
      cluster: 'us-east-1'

- job_name: 'federate-eu'
  scrape_interval: 15s
  honor_labels: true
  metrics_path: '/federate'
  params:
    'match[]':
      - '{job="kubernetes-pods"}'
  static_configs:
  - targets:
    - 'prometheus-eu.example.com:9090'
    labels:
      cluster: 'eu-west-1'
```

### Thanoså…¨å±€æŸ¥è¯¢

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: thanos-query
spec:
  template:
    spec:
      containers:
      - name: thanos-query
        image: thanosio/thanos:v0.32.0
        args:
        - query
        - --http-address=0.0.0.0:9090
        - --store=thanos-sidecar-us.monitoring:10901
        - --store=thanos-sidecar-eu.monitoring:10901
        - --store=thanos-sidecar-as.monitoring:10901
```

### åˆ†å¸ƒå¼è¿½è¸ª

**Jaegerå¤šé›†ç¾¤é…ç½®**:

```yaml
apiVersion: jaegertracing.io/v1
kind: Jaeger
metadata:
  name: jaeger-global
spec:
  strategy: production
  storage:
    type: elasticsearch
    options:
      es:
        server-urls: https://elasticsearch-global.example.com:9200
  collector:
    replicas: 3
  query:
    replicas: 2
```

## 14.8 ğŸ’° æˆæœ¬ä¼˜åŒ–

### è·¨åŒºåŸŸæˆæœ¬åˆ†æ

**å‡ºå£æµé‡æˆæœ¬**:

| äº‘å‚å•† | åŒåŒºåŸŸ | è·¨åŒºåŸŸ | è·¨å¤§é™† |
|--------|--------|--------|--------|
| AWS | å…è´¹ | $0.01/GB | $0.02-0.09/GB |
| GCP | å…è´¹ | $0.01/GB | $0.08-0.23/GB |
| Azure | å…è´¹ | $0.02/GB | $0.05-0.16/GB |

**ä¼˜åŒ–ç­–ç•¥**:

```go
// æœ¬åœ°ä¼˜å…ˆè·¯ç”±
type RegionRouter struct {
    localEndpoint  string
    remoteEndpoints map[string]string
}

func (rr *RegionRouter) Route(ctx context.Context, region string) string {
    // ä¼˜å…ˆä½¿ç”¨æœ¬åœ°endpoint
    if region == os.Getenv("CURRENT_REGION") {
        return rr.localEndpoint
    }

    // è·¨åŒºåŸŸè°ƒç”¨
    if remote, ok := rr.remoteEndpoints[region]; ok {
        return remote
    }

    return rr.localEndpoint
}
```

### èµ„æºè°ƒåº¦ä¼˜åŒ–

```yaml
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: high-priority
value: 1000
globalDefault: false
description: "High priority workloads"

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: critical-service
spec:
  template:
    spec:
      priorityClassName: high-priority
      nodeSelector:
        node.kubernetes.io/instance-type: "c5.large"  # é€‰æ‹©æ€§ä»·æ¯”é«˜çš„å®ä¾‹
```

## 14.9 ğŸ¯ æœ€ä½³å®è·µ

1. **åœ°åŸŸäº²å’Œæ€§**: ç”¨æˆ·æµé‡å°±è¿‘è·¯ç”±ï¼Œå‡å°‘å»¶è¿Ÿå’Œæˆæœ¬
2. **æ•°æ®æœ¬åœ°åŒ–**: éµå®ˆæ•°æ®åˆè§„è¦æ±‚
3. **æ¸è¿›å¼éƒ¨ç½²**: å…ˆå•é›†ç¾¤éªŒè¯ï¼Œå†æ¨å¹¿åˆ°å…¶ä»–é›†ç¾¤
4. **è‡ªåŠ¨åŒ–æ•…éšœè½¬ç§»**: é…ç½®å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨åˆ‡æ¢
5. **ç»Ÿä¸€ç›‘æ§**: ä½¿ç”¨Prometheusè”é‚¦æˆ–Thanos
6. **åŠ å¯†ä¼ è¾“**: è·¨é›†ç¾¤é€šä¿¡å¯ç”¨mTLS
7. **å®šæœŸå¤‡ä»½**: ä½¿ç”¨Veleroç­‰å·¥å…·å®šæœŸå¤‡ä»½
8. **æˆæœ¬ç›‘æ§**: è·Ÿè¸ªè·¨åŒºåŸŸæµé‡æˆæœ¬
9. **æ–‡æ¡£åŒ–**: ç»´æŠ¤é›†ç¾¤æ‹“æ‰‘å’Œä¾èµ–å…³ç³»æ–‡æ¡£
10. **å®šæœŸæ¼”ç»ƒ**: å®šæœŸè¿›è¡Œå®¹ç¾æ¼”ç»ƒ

## 14.10 âš ï¸ å¸¸è§é—®é¢˜

### Q1: è·¨é›†ç¾¤ç½‘ç»œå»¶è¿Ÿé«˜ï¼Ÿ

**A**:

- å¯ç”¨åœ°åŸŸæ„ŸçŸ¥è·¯ç”±
- ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº
- ä¼˜åŒ–æ•°æ®ä¼ è¾“ï¼ˆå‹ç¼©ã€æ‰¹é‡ï¼‰
- è€ƒè™‘è¾¹ç¼˜è®¡ç®—

### Q2: å¦‚ä½•å¤„ç†è·¨é›†ç¾¤æ•°æ®ä¸€è‡´æ€§ï¼Ÿ

**A**:

- äº‹ä»¶æº¯æºæ¨¡å¼
- CQRSè¯»å†™åˆ†ç¦»
- æœ€ç»ˆä¸€è‡´æ€§è®¾è®¡
- åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSAGAï¼‰

### Q3: å¤šé›†ç¾¤ç®¡ç†å¤æ‚åº¦é«˜ï¼Ÿ

**A**:

- ä½¿ç”¨GitOpsç»Ÿä¸€ç®¡ç†
- ArgoCD ApplicationSetå¤šé›†ç¾¤éƒ¨ç½²
- Rancher/Lensç­‰ç®¡ç†å¹³å°
- è‡ªåŠ¨åŒ–è„šæœ¬å’Œå·¥å…·

### Q4: æˆæœ¬è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ

**A**:

- ä¼˜åŒ–è·¨åŒºåŸŸæµé‡
- ä½¿ç”¨Reserved Instances
- åˆç†è§„åˆ’é›†ç¾¤è§„æ¨¡
- ç›‘æ§å’Œä¼˜åŒ–èµ„æºä½¿ç”¨

## 14.11 ğŸ“š æ‰©å±•é˜…è¯»

### å®˜æ–¹æ–‡æ¡£

- [Istioå¤šé›†ç¾¤éƒ¨ç½²](https://istio.io/latest/docs/setup/install/multicluster/)
- [Submarineræ–‡æ¡£](https://submariner.io/getting-started/)
- [Veleroæ–‡æ¡£](https://velero.io/docs/)
- [Thanosæ–‡æ¡£](https://thanos.io/tip/thanos/getting-started.md/)

### ç›¸å…³æ–‡æ¡£

- [10-é«˜æ€§èƒ½å¾®æœåŠ¡æ¶æ„.md](./10-é«˜æ€§èƒ½å¾®æœåŠ¡æ¶æ„.md)
- [11-Kuberneteså¾®æœåŠ¡éƒ¨ç½².md](./11-Kuberneteså¾®æœåŠ¡éƒ¨ç½².md)
- [12-Service Meshé›†æˆ.md](./12-Service-Meshé›†æˆ.md)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Go Documentation Team
**æœ€åæ›´æ–°**: 2025-10-29
**æ–‡æ¡£çŠ¶æ€**: å®Œæˆ
**é€‚ç”¨ç‰ˆæœ¬**: Kubernetes 1.27+, Istio 1.20+, Go 1.21+
