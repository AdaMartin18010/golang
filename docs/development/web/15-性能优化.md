# WebæœåŠ¡æ€§èƒ½ä¼˜åŒ–

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-29
**é€‚ç”¨äº**: Go 1.23+

---

## ğŸ“‹ ç›®å½•

- [1. å¸¸è§æ€§èƒ½ç“¶é¢ˆ](#1-å¸¸è§æ€§èƒ½ç“¶é¢ˆ)
  - [WebæœåŠ¡å…¸å‹æ€§èƒ½é—®é¢˜](#webæœåŠ¡å…¸å‹æ€§èƒ½é—®é¢˜)
- [2. pprofä¸traceå®æˆ˜](#2-pprofä¸traceå®æˆ˜)
  - [å¯ç”¨pprof](#å¯ç”¨pprof)
  - [CPUæ€§èƒ½åˆ†æ](#cpuæ€§èƒ½åˆ†æ)
  - [å†…å­˜åˆ†æ](#å†…å­˜åˆ†æ)
  - [Goroutineåˆ†æ](#goroutineåˆ†æ)
  - [Mutex/Blockåˆ†æ](#mutexblockåˆ†æ)
  - [Traceåˆ†æ](#traceåˆ†æ)
- [3. ä¼˜åŒ–ç­–ç•¥ä¸å·¥ç¨‹æµç¨‹](#3-ä¼˜åŒ–ç­–ç•¥ä¸å·¥ç¨‹æµç¨‹)
  - [æ€§èƒ½ä¼˜åŒ–å·¥ç¨‹æµç¨‹](#æ€§èƒ½ä¼˜åŒ–å·¥ç¨‹æµç¨‹)
  - [å‹æµ‹å®šä½ç“¶é¢ˆ](#å‹æµ‹å®šä½ç“¶é¢ˆ)
  - [å…¸å‹ä¼˜åŒ–æ‰‹æ®µ](#å…¸å‹ä¼˜åŒ–æ‰‹æ®µ)
- [4. æœ€ä½³å®è·µ](#4-æœ€ä½³å®è·µ)
  - [è·¯ç”±ä¼˜åŒ–](#è·¯ç”±ä¼˜åŒ–)
  - [JSONä¼˜åŒ–](#jsonä¼˜åŒ–)
  - [Contextæ± åŒ–](#contextæ± åŒ–)
  - [æ•°æ®åº“ä¼˜åŒ–](#æ•°æ®åº“ä¼˜åŒ–)
  - [GCè°ƒä¼˜](#gcè°ƒä¼˜)
- [5. å¼€æºé¡¹ç›®æ¡ˆä¾‹](#5-å¼€æºé¡¹ç›®æ¡ˆä¾‹)
  - [Ginæ¡†æ¶ä¼˜åŒ–](#ginæ¡†æ¶ä¼˜åŒ–)
  - [etcdä¼˜åŒ–](#etcdä¼˜åŒ–)
  - [Go kitå¾®æœåŠ¡](#go-kitå¾®æœåŠ¡)
  - [gRPC-Go](#grpc-go)
- [6. å‚è€ƒèµ„æ–™](#6-å‚è€ƒèµ„æ–™)

## 1. å¸¸è§æ€§èƒ½ç“¶é¢ˆ

### WebæœåŠ¡å…¸å‹æ€§èƒ½é—®é¢˜

**1. è·¯ç”±åŒ¹é…å¼€é”€**
- çº¿æ€§åŒ¹é…å¯¼è‡´O(n)å¤æ‚åº¦
- æ­£åˆ™è¡¨è¾¾å¼è¿‡åº¦ä½¿ç”¨
- è·¯ç”±è§„åˆ™è¿‡å¤š

**2. JSONåºåˆ—åŒ–/ååºåˆ—åŒ–**
- æ ‡å‡†åº“encoding/jsonæ€§èƒ½ä¸€èˆ¬
- å¤§å¯¹è±¡åºåˆ—åŒ–è€—æ—¶
- åå°„å¼€é”€

**3. æ•°æ®åº“æŸ¥è¯¢**
- N+1æŸ¥è¯¢é—®é¢˜
- ç¼ºå°‘ç´¢å¼•
- æ…¢æŸ¥è¯¢æœªä¼˜åŒ–
- è¿æ¥æ± é…ç½®ä¸å½“

**4. I/Oé˜»å¡**
- åŒæ­¥I/Oæ“ä½œ
- æœªä½¿ç”¨è¿æ¥æ± 
- ç¼“å†²åŒºé…ç½®ä¸å½“

**5. Goroutineç®¡ç†**
- è¿‡åº¦åˆ›å»ºGoroutine
- Goroutineæ³„æ¼
- é”ç«äº‰

**6. GCæš‚åœ**
- å†…å­˜åˆ†é…è¿‡å¤š
- å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¿‡é•¿
- GCå‚æ•°æœªè°ƒä¼˜

## 2. pprofä¸traceå®æˆ˜

### å¯ç”¨pprof

**æ–¹æ³•1ï¼šå¯¼å…¥net/http/pprof**

```go
package main

import (
    "log"
    "net/http"
    _ "net/http/pprof"  // è‡ªåŠ¨æ³¨å†Œ/debug/pprof/*è·¯ç”±
)

func main() {
    // å¯åŠ¨pprof HTTPæœåŠ¡
    go func() {
        log.Println("pprof server: http://localhost:6060/debug/pprof/")
        if err := http.ListenAndServe(":6060", nil); err != nil {
            log.Fatal(err)
        }
    }()

    // å¯åŠ¨ä¸šåŠ¡æœåŠ¡
    startAppServer()
}
```

**æ–¹æ³•2ï¼šç‹¬ç«‹è·¯ç”±**

```go
import (
    "net/http"
    "net/http/pprof"
)

func registerPprof(mux *http.ServeMux) {
    mux.HandleFunc("/debug/pprof/", pprof.Index)
    mux.HandleFunc("/debug/pprof/cmdline", pprof.Cmdline)
    mux.HandleFunc("/debug/pprof/profile", pprof.Profile)
    mux.HandleFunc("/debug/pprof/symbol", pprof.Symbol)
    mux.HandleFunc("/debug/pprof/trace", pprof.Trace)
}
```

### CPUæ€§èƒ½åˆ†æ

**é‡‡é›†CPU Profileï¼š**

```bash
# é‡‡é›†30ç§’CPU profile
go tool pprof http://localhost:6060/debug/pprof/profile?seconds=30

# æˆ–è€…ä¿å­˜åˆ°æ–‡ä»¶
curl http://localhost:6060/debug/pprof/profile?seconds=30 > cpu.prof
go tool pprof cpu.prof
```

**äº¤äº’å¼åˆ†æï¼š**

```bash
(pprof) top           # æ˜¾ç¤ºTopå‡½æ•°CPUå ç”¨
(pprof) list funcName # æ˜¾ç¤ºå‡½æ•°æºç å’ŒCPUå ç”¨
(pprof) web           # ç”Ÿæˆè°ƒç”¨å›¾ï¼ˆéœ€è¦graphvizï¼‰
(pprof) pdf           # ç”ŸæˆPDFæŠ¥å‘Š
```

**Web UIåˆ†æï¼š**

```bash
go tool pprof -http=:8080 cpu.prof
# è®¿é—® http://localhost:8080
```

### å†…å­˜åˆ†æ

```bash
# å †å†…å­˜åˆ†é…
go tool pprof http://localhost:6060/debug/pprof/heap

# æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨ï¼ˆinuse_spaceï¼‰
go tool pprof -sample_index=inuse_space \
    http://localhost:6060/debug/pprof/heap

# æŸ¥çœ‹ç´¯è®¡åˆ†é…ï¼ˆalloc_spaceï¼‰
go tool pprof -sample_index=alloc_space \
    http://localhost:6060/debug/pprof/heap

# å¸¸ç”¨å‘½ä»¤
(pprof) top           # Topå†…å­˜åˆ†é…
(pprof) list funcName # æŸ¥çœ‹å‡½æ•°åˆ†é…è¯¦æƒ…
(pprof) traces        # æŸ¥çœ‹åˆ†é…è°ƒç”¨é“¾
```

### Goroutineåˆ†æ

```bash
# æŸ¥çœ‹å½“å‰æ‰€æœ‰Goroutine
curl http://localhost:6060/debug/pprof/goroutine?debug=2 > goroutine.txt

# ä½¿ç”¨pprofåˆ†æ
go tool pprof http://localhost:6060/debug/pprof/goroutine

# æ£€æµ‹æ³„æ¼
(pprof) top           # æŸ¥çœ‹Goroutineæ•°é‡åˆ†å¸ƒ
(pprof) traces        # æŸ¥çœ‹Goroutineè°ƒç”¨æ ˆ
```

### Mutex/Blockåˆ†æ

```bash
# é”ç«äº‰åˆ†æ
go tool pprof http://localhost:6060/debug/pprof/mutex

# é˜»å¡åˆ†æ
go tool pprof http://localhost:6060/debug/pprof/block

# éœ€è¦å…ˆå¯ç”¨
import "runtime"

func init() {
    runtime.SetMutexProfileFraction(1)  // å¯ç”¨mutex profiling
    runtime.SetBlockProfileRate(1)      // å¯ç”¨block profiling
}
```

### Traceåˆ†æ

```bash
# é‡‡é›†traceï¼ˆå»ºè®®5-10ç§’ï¼‰
curl http://localhost:6060/debug/pprof/trace?seconds=5 > trace.out

# åˆ†ætrace
go tool trace trace.out
```

**Traceå¯ä»¥æŸ¥çœ‹ï¼š**
- Goroutineè°ƒåº¦æƒ…å†µ
- ç³»ç»Ÿè°ƒç”¨é˜»å¡
- ç½‘ç»œI/Oäº‹ä»¶
- GCäº‹ä»¶
- å¤„ç†å™¨åˆ©ç”¨ç‡

## 3. ä¼˜åŒ–ç­–ç•¥ä¸å·¥ç¨‹æµç¨‹

### æ€§èƒ½ä¼˜åŒ–å·¥ç¨‹æµç¨‹

```
1. å»ºç«‹åŸºçº¿
   â†“
2. å‹æµ‹å®šä½ç“¶é¢ˆ
   â†“
3. pprof/traceåˆ†æ
   â†“
4. é’ˆå¯¹æ€§ä¼˜åŒ–
   â†“
5. å›å½’æµ‹è¯•
   â†“
6. ç›‘æ§å‘Šè­¦
```

### å‹æµ‹å®šä½ç“¶é¢ˆ

**ä½¿ç”¨wrk/ab/vegetaï¼š**

```bash
# wrkå‹æµ‹
wrk -t12 -c400 -d30s --latency http://localhost:8080/api/users

# è¾“å‡ºï¼š
Requests/sec:  10254.43
Latency:
  50%  15.23ms
  99%  124.56ms

# abå‹æµ‹
ab -n 10000 -c 100 http://localhost:8080/api/users

# vegetaå‹æµ‹
echo "GET http://localhost:8080/api/users" | \
  vegeta attack -duration=30s -rate=1000 | \
  vegeta report
```

### å…¸å‹ä¼˜åŒ–æ‰‹æ®µ

**1. å¯¹è±¡æ± ï¼ˆsync.Poolï¼‰**

```go
var bufferPool = sync.Pool{
    New: func() interface{} {
        return new(bytes.Buffer)
    },
}

func handler(w http.ResponseWriter, r *http.Request) {
    buf := bufferPool.Get().(*bytes.Buffer)
    defer func() {
        buf.Reset()
        bufferPool.Put(buf)
    }()

    // ä½¿ç”¨buf
    buf.WriteString("response")
    w.Write(buf.Bytes())
}
```

**2. æ‰¹é‡å¤„ç†**

```go
// âŒ é€æ¡å¤„ç†
for _, item := range items {
    db.Insert(item)  // Næ¬¡æ•°æ®åº“æ“ä½œ
}

// âœ… æ‰¹é‡å¤„ç†
db.BatchInsert(items)  // 1æ¬¡æ•°æ®åº“æ“ä½œ
```

**3. è¿æ¥æ± é…ç½®**

```go
// HTTP Client
var client = &http.Client{
    Transport: &http.Transport{
        MaxIdleConns:        100,
        MaxIdleConnsPerHost: 10,
        IdleConnTimeout:     90 * time.Second,
    },
}

// æ•°æ®åº“
db.SetMaxOpenConns(25)
db.SetMaxIdleConns(10)
db.SetConnMaxLifetime(5 * time.Minute)
```

**4. å¼‚æ­¥I/O**

```go
// âŒ åŒæ­¥æ—¥å¿—å†™å…¥é˜»å¡è¯·æ±‚
func handler(w http.ResponseWriter, r *http.Request) {
    processRequest()
    writeLog(r)  // é˜»å¡
    w.Write([]byte("OK"))
}

// âœ… å¼‚æ­¥æ—¥å¿—å†™å…¥
var logChan = make(chan LogEntry, 1000)

func handler(w http.ResponseWriter, r *http.Request) {
    processRequest()
    logChan <- LogEntry{r}  // éé˜»å¡
    w.Write([]byte("OK"))
}

func logWorker() {
    for entry := range logChan {
        writeLog(entry)
    }
}
```

**5. ç¼“å­˜ç­–ç•¥**

```go
import "github.com/patrickmn/go-cache"

var appCache = cache.New(5*time.Minute, 10*time.Minute)

func handler(w http.ResponseWriter, r *http.Request) {
    key := r.URL.Path

    // å°è¯•ä»ç¼“å­˜è·å–
    if data, found := appCache.Get(key); found {
        w.Write(data.([]byte))
        return
    }

    // è®¡ç®—ç»“æœ
    result := expensiveComputation()
    appCache.Set(key, result, cache.DefaultExpiration)
    w.Write(result)
}
```

**6. é™æµä¸é™çº§**

```go
import "golang.org/x/time/rate"

var limiter = rate.NewLimiter(1000, 100)  // 1000 req/s, burst 100

func rateLimitMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        if !limiter.Allow() {
            http.Error(w, "Too Many Requests", http.StatusTooManyRequests)
            return
        }
        next.ServeHTTP(w, r)
    })
}
```

## 4. æœ€ä½³å®è·µ

### è·¯ç”±ä¼˜åŒ–

**ä½¿ç”¨é«˜æ€§èƒ½è·¯ç”±å™¨ï¼š**

```go
import "github.com/julienschmidt/httprouter"

router := httprouter.New()
router.GET("/users/:id", getUserHandler)
router.POST("/users", createUserHandler)

// Benchmarkå¯¹æ¯”ï¼š
// httprouter: 100000 req/s
// net/http:    50000 req/s
```

### JSONä¼˜åŒ–

**ä½¿ç”¨é«˜æ€§èƒ½JSONåº“ï¼š**

```go
import "github.com/bytedance/sonic"

// åºåˆ—åŒ–
data, err := sonic.Marshal(obj)

// ååºåˆ—åŒ–
var obj MyStruct
err := sonic.Unmarshal(data, &obj)

// Benchmarkå¯¹æ¯”ï¼š
// sonic:       3-4x faster than encoding/json
// easyjson:    2x faster
// jsoniter:    2x faster
```

### Contextæ± åŒ–

**Ginæ¡†æ¶ç¤ºä¾‹ï¼š**

```go
// Ginå†…éƒ¨ä½¿ç”¨Contextæ± 
func (engine *Engine) ServeHTTP(w http.ResponseWriter, req *http.Request) {
    c := engine.pool.Get().(*Context)
    c.writermem.reset(w)
    c.Request = req
    c.reset()

    engine.handleHTTPRequest(c)

    engine.pool.Put(c)  // å›æ”¶Context
}
```

### æ•°æ®åº“ä¼˜åŒ–

**é¢„ç¼–è¯‘è¯­å¥ + æ‰¹é‡æ“ä½œï¼š**

```go
// é¢„ç¼–è¯‘è¯­å¥
stmt, err := db.Prepare("INSERT INTO users(name, email) VALUES(?, ?)")
defer stmt.Close()

for _, user := range users {
    stmt.Exec(user.Name, user.Email)
}

// æˆ–ä½¿ç”¨æ‰¹é‡æ’å…¥
db.Exec("INSERT INTO users(name, email) VALUES (?, ?), (?, ?), ...",
    user1.Name, user1.Email, user2.Name, user2.Email, ...)
```

### GCè°ƒä¼˜

```bash
# è®¾ç½®GOGCï¼ˆé»˜è®¤100ï¼‰
export GOGC=200  # å‡å°‘GCé¢‘ç‡ï¼Œå¢åŠ å†…å­˜ä½¿ç”¨

# è®¾ç½®å†…å­˜é™åˆ¶ï¼ˆGo 1.19+ï¼‰
export GOMEMLIMIT=8GiB  # è½¯é™åˆ¶

# è®¾ç½®GOMAXPROCS
export GOMAXPROCS=8  # æˆ–runtime.GOMAXPROCS(8)
```

## 5. å¼€æºé¡¹ç›®æ¡ˆä¾‹

### Ginæ¡†æ¶ä¼˜åŒ–

**æ ¸å¿ƒä¼˜åŒ–ç‚¹ï¼š**
- Contextæ± åŒ–å‡å°‘åˆ†é…
- httprouteré«˜æ€§èƒ½è·¯ç”±
- é›¶æ‹·è´Bodyè¯»å–
- æ‰¹é‡å“åº”å†™å…¥

**æ€§èƒ½æ•°æ®ï¼š**
```
Gin:          50000 req/s
Echo:         48000 req/s
net/http:     30000 req/s
```

### etcdä¼˜åŒ–

**æ ¸å¿ƒä¼˜åŒ–ç‚¹ï¼š**
- æ‰¹é‡å†™å…¥WALæ—¥å¿—
- å†…å­˜æ± ç®¡ç†å¤§å¯¹è±¡
- GOMAXPROCSåŠ¨æ€è°ƒæ•´
- GCå‚æ•°ç²¾ç»†è°ƒä¼˜

### Go kitå¾®æœåŠ¡

**æ ¸å¿ƒä¼˜åŒ–ç‚¹ï¼š**
- ä¸­é—´ä»¶é“¾è·¯ä¼˜åŒ–
- Metricså¼‚æ­¥é‡‡é›†
- ç†”æ–­å™¨é¿å…é›ªå´©
- è¿æ¥æ± å¤ç”¨

### gRPC-Go

**æ ¸å¿ƒä¼˜åŒ–ç‚¹ï¼š**
- HTTP/2è¿æ¥æ± 
- æµæ§ä¸çª—å£è°ƒæ•´
- Protobufé«˜æ•ˆåºåˆ—åŒ–
- æ‰¹é‡æ¶ˆæ¯ä¼ è¾“

## 6. å‚è€ƒèµ„æ–™

- Goå®˜æ–¹pprofæ–‡æ¡£ï¼š<https://github.com/google/pprof>
- Ginæ¡†æ¶æºç ï¼š<https://github.com/gin-gonic/gin>
- etcdæ€§èƒ½ä¼˜åŒ–ï¼š<https://etcd.io/docs/latest/tuning/>
- Goé«˜æ€§èƒ½ç¼–ç¨‹ï¼š<https://geektutu.com/post/high-performance-go.html>
- Goå¤œè¯»æ€§èƒ½ä¼˜åŒ–ä¸“æ ï¼š<https://github.com/developer-learning/night-reading-go>

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Go Documentation Team
**æœ€åæ›´æ–°**: 2025-10-29
**æ–‡æ¡£çŠ¶æ€**: å·²ä¼˜åŒ–
**é€‚ç”¨ç‰ˆæœ¬**: Go 1.25.3+
