# Git Hooks ä¸ä»£ç è´¨é‡

> **ç‰ˆæœ¬**: v1.0
> **æ—¥æœŸ**: 2025-01-XX

---

## ğŸ“‹ æ¦‚è¿°

æ¡†æ¶æä¾›äº† Git pre-commit hooksï¼Œåœ¨æ¯æ¬¡æäº¤å‰è‡ªåŠ¨è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥ï¼Œç¡®ä¿ä»£ç ç¬¦åˆè§„èŒƒã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£… Git Hooks

```bash
# æ–¹å¼ 1: ä½¿ç”¨ Makefile
make install-hooks

# æ–¹å¼ 2: ä½¿ç”¨è„šæœ¬
bash scripts/dev/install-hooks.sh
```

### æ‰‹åŠ¨å®‰è£…

```bash
# å¤åˆ¶ pre-commit hook
cp .githooks/pre-commit .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

---

## ğŸ” Pre-commit Hook åŠŸèƒ½

Pre-commit hook ä¼šåœ¨æ¯æ¬¡ `git commit` æ—¶è‡ªåŠ¨è¿è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

### 1. ä»£ç æ ¼å¼æ£€æŸ¥ (gofmt)

æ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆ Go ä»£ç æ ¼å¼è§„èŒƒã€‚

**å¤±è´¥æ—¶**:

- æ˜¾ç¤ºæœªæ ¼å¼åŒ–çš„æ–‡ä»¶åˆ—è¡¨
- æç¤ºè¿è¡Œ `make fmt` æˆ– `gofmt -w .` ä¿®å¤

### 2. go vet æ£€æŸ¥

è¿è¡Œ Go å®˜æ–¹é™æ€åˆ†æå·¥å…·ã€‚

**æ£€æŸ¥é¡¹**:

- æœªä½¿ç”¨çš„å˜é‡
- é”™è¯¯çš„å‡½æ•°è°ƒç”¨
- é”™è¯¯çš„ç±»å‹è½¬æ¢
- å…¶ä»–å¸¸è§é”™è¯¯

### 3. golangci-lint æ£€æŸ¥

è¿è¡Œ golangci-lintï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ã€‚

**æ£€æŸ¥é¡¹**:

- ä»£ç è´¨é‡
- ä»£ç é£æ ¼
- æ€§èƒ½é—®é¢˜
- å®‰å…¨é—®é¢˜
- å¤æ‚åº¦

**æ³¨æ„**: å¦‚æœæœªå®‰è£… golangci-lintï¼Œä¼šè·³è¿‡æ­¤æ£€æŸ¥å¹¶æç¤ºå®‰è£…ã€‚

### 4. ç›¸å…³æµ‹è¯•

è¿è¡Œä¿®æ”¹æ–‡ä»¶ç›¸å…³çš„æµ‹è¯•ï¼ˆä»…è¿è¡Œ `-short` æ¨¡å¼çš„æµ‹è¯•ï¼Œå¿«é€Ÿåé¦ˆï¼‰ã€‚

**æ£€æŸ¥é¡¹**:

- åªè¿è¡Œæœ‰æµ‹è¯•æ–‡ä»¶çš„åŒ…çš„æµ‹è¯•
- ä½¿ç”¨ `go test -short` å¿«é€Ÿæ‰§è¡Œ

---

## ğŸ“ Hook é…ç½®

### Pre-commit Hook ä½ç½®

```text
.githooks/pre-commit  # æºæ–‡ä»¶
.git/hooks/pre-commit # å®‰è£…åçš„ä½ç½®
```

### è‡ªå®šä¹‰ Hook

å¯ä»¥ä¿®æ”¹ `.githooks/pre-commit` æ¥è‡ªå®šä¹‰æ£€æŸ¥è¡Œä¸ºï¼š

```bash
# ç¼–è¾‘ hook
vim .githooks/pre-commit

# é‡æ–°å®‰è£…
make install-hooks
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ­£å¸¸æäº¤

```bash
# 1. ä¿®æ”¹ä»£ç 
vim internal/domain/user/entity.go

# 2. æš‚å­˜æ–‡ä»¶
git add internal/domain/user/entity.go

# 3. æäº¤ï¼ˆè‡ªåŠ¨è¿è¡Œæ£€æŸ¥ï¼‰
git commit -m "feat: add user entity"

# å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œæäº¤æˆåŠŸ
# å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œæäº¤è¢«é˜»æ­¢ï¼Œéœ€è¦ä¿®å¤åé‡æ–°æäº¤
```

### åœºæ™¯ 2: æ£€æŸ¥å¤±è´¥

```bash
$ git commit -m "feat: add feature"
========================================
  è¿è¡Œ pre-commit æ£€æŸ¥
========================================

[1/4] æ£€æŸ¥ä»£ç æ ¼å¼...
âŒ ä»£ç æ ¼å¼ä¸ç¬¦åˆè§„èŒƒ:
  internal/domain/user/entity.go
è¿è¡Œ 'make fmt' æˆ– 'gofmt -w .' ä¿®å¤

# ä¿®å¤ä»£ç æ ¼å¼
make fmt

# é‡æ–°æäº¤
git add internal/domain/user/entity.go
git commit -m "feat: add feature"
```

### åœºæ™¯ 3: è·³è¿‡æ£€æŸ¥ï¼ˆä¸æ¨èï¼‰

```bash
# ä½¿ç”¨ --no-verify è·³è¿‡æ£€æŸ¥ï¼ˆä¸æ¨èï¼‰
git commit --no-verify -m "feat: add feature"
```

**æ³¨æ„**: è·³è¿‡æ£€æŸ¥å¯èƒ½å¯¼è‡´ä»£ç è´¨é‡é—®é¢˜ï¼Œä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: Hook æœªæ‰§è¡Œ

**åŸå› **: Hook æ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™

**è§£å†³**:

```bash
chmod +x .git/hooks/pre-commit
```

### é—®é¢˜ 2: golangci-lint æœªå®‰è£…

**ç°è±¡**: Hook æç¤º golangci-lint æœªå®‰è£…

**è§£å†³**:

```bash
# å®‰è£… golangci-lint
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

# æˆ–ä½¿ç”¨ Makefile
make install-tools
```

### é—®é¢˜ 3: æµ‹è¯•è¿è¡Œæ—¶é—´è¿‡é•¿

**åŸå› **: æµ‹è¯•åŒ…å«é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯•

**è§£å†³**: Pre-commit hook ä½¿ç”¨ `go test -short`ï¼Œåªè¿è¡Œå¿«é€Ÿæµ‹è¯•ã€‚é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯•åº”åœ¨ CI/CD ä¸­è¿è¡Œã€‚

---

## ğŸ“š ç›¸å…³å‘½ä»¤

### Makefile å‘½ä»¤

```bash
# å®‰è£… hooks
make install-hooks

# æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥ï¼ˆä¸æäº¤ï¼‰
make check

# æäº¤å‰æ£€æŸ¥ï¼ˆæ ¼å¼ã€æ£€æŸ¥ã€æµ‹è¯•ï¼‰
make pre-commit

# æ ¼å¼åŒ–ä»£ç 
make fmt

# è¿è¡Œä»£ç æ£€æŸ¥
make lint
```

### Git å‘½ä»¤

```bash
# æŸ¥çœ‹ hook å†…å®¹
cat .git/hooks/pre-commit

# æµ‹è¯• hookï¼ˆæ‰‹åŠ¨è¿è¡Œï¼‰
.git/hooks/pre-commit

# å¸è½½ hookï¼ˆåˆ é™¤æ–‡ä»¶ï¼‰
rm .git/hooks/pre-commit
```

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **å§‹ç»ˆå®‰è£… hooks**: åœ¨é¡¹ç›®å¼€å§‹æ—¶è¿è¡Œ `make install-hooks`
2. **ä¸è¦è·³è¿‡æ£€æŸ¥**: é™¤éæœ‰ç‰¹æ®ŠåŸå› ï¼Œä¸è¦ä½¿ç”¨ `--no-verify`
3. **å¿«é€Ÿä¿®å¤**: å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œç«‹å³ä¿®å¤å¹¶é‡æ–°æäº¤
4. **ä¿æŒå·¥å…·æ›´æ–°**: å®šæœŸæ›´æ–° golangci-lint ç­‰å·¥å…·
5. **å›¢é˜Ÿåä½œ**: ç¡®ä¿å›¢é˜Ÿæˆå‘˜éƒ½å®‰è£…äº† hooks

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [ä»£ç è´¨é‡æ§åˆ¶](../practices/engineering/02-ä»£ç è´¨é‡æ§åˆ¶.md)
- [è´¡çŒ®æŒ‡å—](../guides/contributing.md)
- [æ¡†æ¶åŸºç¡€è®¾æ–½è¯´æ˜](00-æ¡†æ¶åŸºç¡€è®¾æ–½è¯´æ˜.md)

---

**æœ€åæ›´æ–°**: 2025-01-XX
