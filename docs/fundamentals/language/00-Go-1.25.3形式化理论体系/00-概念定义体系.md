# 概念定义体系

**版本**: v1.0  
**更新日期**: 2025-10-29  
**适用于**: Go 1.25.3

---

## 核心概念

### 1. 类型系统形式化

**类型判断**:

```text
Γ ⊢ e : T

定义:
- Γ: 类型环境，映射变量到类型
- e: 表达式
- T: 类型
- ⊢: 类型判断符号
```

**类型规则示例**:

```text
变量规则:
x : T ∈ Γ
-----------
Γ ⊢ x : T

函数应用规则:
Γ ⊢ f : T₁ → T₂    Γ ⊢ x : T₁
--------------------------------
Γ ⊢ f(x) : T₂
```

---

### 2. 泛型类型系统

**形式化定义**:

```text
泛型函数:
func F[T Constraint](x T) T

类型约束:
type Constraint interface {
    ~int | ~float64 | ...
}

Go 1.25.3简化:
- 移除"core types"概念
- 简化类型集语义
```

---

### 3. CSP并发模型

**进程代数**:

```text
P ::= STOP              空进程
    | c!v → P          发送后继续P
    | c?x → P(x)       接收后继续P
    | P || Q           并行组合
    | P ⊔ Q            选择

Go实现:
goroutine → Process
channel   → Communication
select    → Choice operator
```

**通信语义**:

```text
Send(c, v):
  wait until Receive(c, _) ready
  transfer v
  
Receive(c):
  wait until Send(c, v) ready
  get v
  return v
```

---

### 4. GMP调度模型

**形式化定义**:

```go
type G struct {  // Goroutine
    Stack     []byte
    State     GState
    M         *M
}

type M struct {  // Machine/OS Thread
    G         *G
    P         *P
    Spinning  bool
}

type P struct {  // Processor
    RunQueue  []*G
    M         *M
    Status    PStatus
}

// Go 1.25.3新特性
func SetGOMAXPROCS() int {
    if runtime.GOOS == "linux" {
        cgroupLimit := readCgroupCPULimit()
        hostCPUs := runtime.NumCPU()
        return min(cgroupLimit, hostCPUs)
    }
    return runtime.NumCPU()
}
```

---

### 5. Happens-Before关系

**形式化定义**:

```text
A →hb B  (A happens-before B)

公理:
1. Program Order:
   同一goroutine内，A先于B执行 → A →hb B

2. Channel Synchronization:
   send(c, v) →hb receive(c, v)
   
3. Transitivity:
   A →hb B ∧ B →hb C → A →hb C

数据竞争:
DataRace(r, w) ⇔ ¬(r →hb w) ∧ ¬(w →hb r) ∧ same_location(r, w)
```

---

### 6. 三色标记GC

**算法定义**:

```text
Colors = {White, Gray, Black}

初始:
  Roots: Gray
  Others: White

标记:
  while ∃ gray object o:
    mark o as Black
    for each ref r in o:
      if color(r) = White:
        mark r as Gray

清除:
  reclaim all White objects

Go 1.25.3 greenteagc优化:
- 小对象标记: O(n) → O(log n)
- GC开销: -10% ~ -40%
```

---

### 7. 内存模型保证

**同步原语语义**:

```go
// Mutex
type Mutex struct {
    state int32
    sema  uint32
}

// Happens-Before保证:
// Unlock(m) →hb Lock(m)

// Channel
// send(c, v) →hb receive(c, v)

// WaitGroup
// Add(n) →hb Wait() returns
```

---

### 8. Go 1.25.3新概念

**容器感知调度**:

```text
定义: 运行时自动检测容器资源限制

CgroupAware := {
    CPU_Limit:    cgroup.cpu.cfs_quota_us / cgroup.cpu.cfs_period_us,
    Memory_Limit: cgroup.memory.limit_in_bytes,
    Dynamic:      监控cgroup变化并自动调整
}

应用: GOMAXPROCS = min(CPU_Limit, HostCPUs)
```

**Nil Pointer检查改进**:

```text
保证: ∀ p : *T, p = nil →
      Access(p) ⇒ Panic("nil pointer")

Go 1.25.3:
- 检查位置: 访问点（非延迟）
- 检查准确性: 100%
- 错误信息: 精确
```

---

## 🔗 相关文档

- [知识图谱](./00-知识图谱.md)
- [对比矩阵](./00-对比矩阵.md)

---

**最后更新**: 2025-10-29
