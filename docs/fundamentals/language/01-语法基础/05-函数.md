# Goè¯­è¨€å‡½æ•°

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-29
**é€‚ç”¨äº**: Go 1.25.3+

---

## ğŸ“‹ ç›®å½•

- [Goè¯­è¨€å‡½æ•°](#goè¯­è¨€å‡½æ•°)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ“š ç†è®ºåˆ†æ](#-ç†è®ºåˆ†æ)
    - [å‡½æ•°çš„å½¢å¼åŒ–å®šä¹‰](#å‡½æ•°çš„å½¢å¼åŒ–å®šä¹‰)
    - [å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘](#å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘)
    - [è°ƒç”¨çº¦å®šä¸æ ˆå¸§](#è°ƒç”¨çº¦å®šä¸æ ˆå¸§)
  - [ğŸ’» ä»£ç å®ç°](#-ä»£ç å®ç°)
    - [åŸºæœ¬å‡½æ•°å®šä¹‰](#åŸºæœ¬å‡½æ•°å®šä¹‰)
    - [å¤šè¿”å›å€¼](#å¤šè¿”å›å€¼)
    - [å‘½åè¿”å›å€¼](#å‘½åè¿”å›å€¼)
    - [å¯å˜å‚æ•°](#å¯å˜å‚æ•°)
    - [å‡½æ•°ä½œä¸ºå‚æ•°](#å‡½æ•°ä½œä¸ºå‚æ•°)
    - [åŒ¿åå‡½æ•°ä¸é—­åŒ…](#åŒ¿åå‡½æ•°ä¸é—­åŒ…)
    - [å»¶è¿Ÿæ‰§è¡Œ defer](#å»¶è¿Ÿæ‰§è¡Œ-defer)
  - [ğŸ“Š æ€§èƒ½åˆ†æ](#-æ€§èƒ½åˆ†æ)
    - [å†…è”ä¼˜åŒ–](#å†…è”ä¼˜åŒ–)
    - [é€ƒé€¸åˆ†æ](#é€ƒé€¸åˆ†æ)
  - [ğŸ§ª æµ‹è¯•ä»£ç ](#-æµ‹è¯•ä»£ç )
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)
  - [ğŸ” å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
    - [Q1: å‡½æ•°å‚æ•°æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Ÿ](#q1-å‡½æ•°å‚æ•°æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’)
    - [Q2: ä½•æ—¶ä½¿ç”¨å‘½åè¿”å›å€¼ï¼Ÿ](#q2-ä½•æ—¶ä½¿ç”¨å‘½åè¿”å›å€¼)
    - [Q3: deferçš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ](#q3-deferçš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆ)
    - [Q4: é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„æ¼å—ï¼Ÿ](#q4-é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„æ¼å—)
  - [ğŸ“š æ‰©å±•é˜…è¯»](#-æ‰©å±•é˜…è¯»)
    - [ç›¸å…³æ¦‚å¿µ](#ç›¸å…³æ¦‚å¿µ)
    - [è¿›é˜¶ä¸»é¢˜](#è¿›é˜¶ä¸»é¢˜)

## ğŸ“š ç†è®ºåˆ†æ

### å‡½æ•°çš„å½¢å¼åŒ–å®šä¹‰

Goè¯­è¨€ä¸­å‡½æ•°çš„å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š

```text
FunctionDeclaration ::= "func" FunctionName Signature FunctionBody
Signature ::= Parameters [Result]
Parameters ::= "(" [ParameterList ["," ...]] ")"
Result ::= Type | "(" TypeList ")"
```

å…¶ä¸­ï¼š

- **FunctionName**: å‡½æ•°æ ‡è¯†ç¬¦
- **Parameters**: å‚æ•°åˆ—è¡¨
- **Result**: è¿”å›å€¼ç±»å‹
- **FunctionBody**: å‡½æ•°ä½“ï¼ˆè¯­å¥å—ï¼‰

### å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘

Goè¯­è¨€ä¸­å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼ˆFirst-class Functionï¼‰ï¼Œæ„å‘³ç€ï¼š

1. **å¯èµ‹å€¼ç»™å˜é‡**: `var f func(int) int`
2. **å¯ä½œä¸ºå‚æ•°**: `func process(f func(int) int, x int)`
3. **å¯ä½œä¸ºè¿”å›å€¼**: `func getFunc() func(int) int`
4. **å¯å­˜å‚¨åœ¨æ•°æ®ç»“æ„**: `map[string]func() error`

### è°ƒç”¨çº¦å®šä¸æ ˆå¸§

Goå‡½æ•°è°ƒç”¨éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

- **å‚æ•°ä¼ é€’**: å€¼ä¼ é€’ï¼ˆå¤åˆ¶ï¼‰
- **æ ˆå¢é•¿**: åŠ¨æ€æ ˆï¼ŒæŒ‰éœ€å¢é•¿
- **è°ƒç”¨çº¦å®š**: å‚æ•°å’Œè¿”å›å€¼é€šè¿‡æ ˆä¼ é€’
- **å¯„å­˜å™¨**: Go 1.17+ä½¿ç”¨å¯„å­˜å™¨ä¼ é€’éƒ¨åˆ†å‚æ•°

## ğŸ’» ä»£ç å®ç°

### åŸºæœ¬å‡½æ•°å®šä¹‰

```go
package main

import "fmt"

// æ— å‚æ•°æ— è¿”å›å€¼
func hello() {
    fmt.Println("Hello, Go!")
}

// æœ‰å‚æ•°æ— è¿”å›å€¼
func greet(name string) {
    fmt.Printf("Hello, %s!\n", name)
}

// æœ‰å‚æ•°æœ‰è¿”å›å€¼
func add(a, b int) int {
    return a + b
}

// ç›¸åŒç±»å‹å‚æ•°ç®€å†™
func multiply(x, y, z int) int {
    return x * y * z
}

func main() {
    hello()
    greet("Alice")
    sum := add(10, 20)
    fmt.Printf("Sum: %d\n", sum)
    product := multiply(2, 3, 4)
    fmt.Printf("Product: %d\n", product)
}
```

### å¤šè¿”å›å€¼

```go
package main

import (
    "errors"
    "fmt"
    "math"
)

// è¿”å›ä¸¤ä¸ªå€¼
func divide(a, b float64) (float64, error) {
    if b == 0 {
        return 0, errors.New("division by zero")
    }
    return a / b, nil
}

// è¿”å›å¤šä¸ªå€¼
func rectangleInfo(width, height float64) (float64, float64) {
    area := width * height
    perimeter := 2 * (width + height)
    return area, perimeter
}

// è¿”å›å€¼å’Œå¸ƒå°”æ ‡å¿—
func sqrt(x float64) (float64, bool) {
    if x < 0 {
        return 0, false
    }
    return math.Sqrt(x), true
}

func main() {
    // ä½¿ç”¨å¤šè¿”å›å€¼
    result, err := divide(10, 2)
    if err != nil {
        fmt.Printf("Error: %v\n", err)
        return
    }
    fmt.Printf("Result: %.2f\n", result)

    // å¿½ç•¥æŸä¸ªè¿”å›å€¼
    _, err = divide(10, 0)
    if err != nil {
        fmt.Printf("Expected error: %v\n", err)
    }

    // æ¥æ”¶å¤šä¸ªè¿”å›å€¼
    area, perimeter := rectangleInfo(5, 3)
    fmt.Printf("Area: %.2f, Perimeter: %.2f\n", area, perimeter)

    // ä½¿ç”¨å¸ƒå°”æ ‡å¿—
    if result, ok := sqrt(16); ok {
        fmt.Printf("Square root: %.2f\n", result)
    }
}
```

### å‘½åè¿”å›å€¼

```go
package main

import "fmt"

// å‘½åè¿”å›å€¼
func calculate(x, y int) (sum int, product int) {
    sum = x + y
    product = x * y
    return // è£¸è¿”å›
}

// å‘½åè¿”å›å€¼ä¾¿äºæ–‡æ¡£åŒ–
func divMod(dividend, divisor int) (quotient, remainder int) {
    quotient = dividend / divisor
    remainder = dividend % divisor
    return
}

// å‘½åè¿”å›å€¼åœ¨deferä¸­å¯ä»¥ä¿®æ”¹
func processWithDefer() (result string) {
    result = "initial"
    defer func() {
        result = "modified by defer"
    }()
    return result
}

func main() {
    sum, product := calculate(5, 3)
    fmt.Printf("Sum: %d, Product: %d\n", sum, product)

    q, r := divMod(17, 5)
    fmt.Printf("Quotient: %d, Remainder: %d\n", q, r)

    result := processWithDefer()
    fmt.Printf("Result: %s\n", result) // è¾“å‡º: modified by defer
}
```

### å¯å˜å‚æ•°

```go
package main

import "fmt"

// å¯å˜å‚æ•°å‡½æ•°
func sum(numbers ...int) int {
    total := 0
    for _, num := range numbers {
        total += num
    }
    return total
}

// æ··åˆå›ºå®šå‚æ•°å’Œå¯å˜å‚æ•°
func printf(format string, args ...interface{}) {
    fmt.Printf(format, args...)
}

// å¯å˜å‚æ•°çš„ç±»å‹æ–­è¨€
func concat(separator string, elements ...interface{}) string {
    result := ""
    for i, elem := range elements {
        if i > 0 {
            result += separator
        }
        result += fmt.Sprintf("%v", elem)
    }
    return result
}

func main() {
    // è°ƒç”¨å¯å˜å‚æ•°å‡½æ•°
    fmt.Printf("Sum: %d\n", sum(1, 2, 3, 4, 5))

    // å±•å¼€åˆ‡ç‰‡
    numbers := []int{10, 20, 30}
    fmt.Printf("Sum of slice: %d\n", sum(numbers...))

    // ä½¿ç”¨æ··åˆå‚æ•°
    printf("Name: %s, Age: %d\n", "Alice", 25)

    // æ‹¼æ¥ä¸åŒç±»å‹
    result := concat(", ", "Alice", 25, true, 3.14)
    fmt.Printf("Concatenated: %s\n", result)
}
```

### å‡½æ•°ä½œä¸ºå‚æ•°

```go
package main

import "fmt"

// å‡½æ•°ç±»å‹å®šä¹‰
type Operation func(int, int) int

// æ¥å—å‡½æ•°ä½œä¸ºå‚æ•°
func apply(op Operation, a, b int) int {
    return op(a, b)
}

// é«˜é˜¶å‡½æ•°ï¼šè¿”å›å‡½æ•°
func makeAdder(base int) func(int) int {
    return func(x int) int {
        return base + x
    }
}

// å‡½æ•°ç»„åˆ
func compose(f, g func(int) int) func(int) int {
    return func(x int) int {
        return f(g(x))
    }
}

func main() {
    // å®šä¹‰æ“ä½œå‡½æ•°
    add := func(a, b int) int { return a + b }
    multiply := func(a, b int) int { return a * b }

    // ä½¿ç”¨å‡½æ•°ä½œä¸ºå‚æ•°
    fmt.Printf("Add: %d\n", apply(add, 5, 3))
    fmt.Printf("Multiply: %d\n", apply(multiply, 5, 3))

    // ä½¿ç”¨é«˜é˜¶å‡½æ•°
    addTen := makeAdder(10)
    fmt.Printf("Add 10 to 5: %d\n", addTen(5))

    // å‡½æ•°ç»„åˆ
    double := func(x int) int { return x * 2 }
    addOne := func(x int) int { return x + 1 }
    doubleAndAddOne := compose(addOne, double)
    fmt.Printf("Double 5 and add 1: %d\n", doubleAndAddOne(5)) // (5*2)+1 = 11
}
```

### åŒ¿åå‡½æ•°ä¸é—­åŒ…

```go
package main

import "fmt"

// é—­åŒ…ç¤ºä¾‹ï¼šè®¡æ•°å™¨
func makeCounter() func() int {
    count := 0
    return func() int {
        count++
        return count
    }
}

// é—­åŒ…ç¤ºä¾‹ï¼šç”Ÿæˆå™¨
func fibonacci() func() int {
    a, b := 0, 1
    return func() int {
        result := a
        a, b = b, a+b
        return result
    }
}

// é—­åŒ…æ•è·å¤–éƒ¨å˜é‡
func multiplier(factor int) func(int) int {
    return func(x int) int {
        return x * factor
    }
}

func main() {
    // ç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°
    func() {
        fmt.Println("Anonymous function executed immediately")
    }()

    // é—­åŒ…ï¼šè®¡æ•°å™¨
    counter := makeCounter()
    fmt.Printf("Counter: %d\n", counter()) // 1
    fmt.Printf("Counter: %d\n", counter()) // 2
    fmt.Printf("Counter: %d\n", counter()) // 3

    // é—­åŒ…ï¼šæ–æ³¢é‚£å¥‘ç”Ÿæˆå™¨
    fib := fibonacci()
    for i := 0; i < 10; i++ {
        fmt.Printf("%d ", fib())
    }
    fmt.Println()

    // é—­åŒ…ï¼šä¹˜æ³•å™¨
    double := multiplier(2)
    triple := multiplier(3)
    fmt.Printf("Double 5: %d\n", double(5))
    fmt.Printf("Triple 5: %d\n", triple(5))
}
```

### å»¶è¿Ÿæ‰§è¡Œ defer

```go
package main

import (
    "fmt"
    "os"
)

// deferåŸºæœ¬ç”¨æ³•
func deferExample() {
    fmt.Println("Start")
    defer fmt.Println("Deferred 1")
    defer fmt.Println("Deferred 2")
    defer fmt.Println("Deferred 3")
    fmt.Println("End")
    // è¾“å‡ºé¡ºåº: Start, End, Deferred 3, Deferred 2, Deferred 1
}

// deferç”¨äºèµ„æºæ¸…ç†
func readFile(filename string) error {
    file, err := os.Open(filename)
    if err != nil {
        return err
    }
    defer file.Close() // ç¡®ä¿æ–‡ä»¶è¢«å…³é—­

    // å¤„ç†æ–‡ä»¶...
    return nil
}

// deferåœ¨å‡½æ•°è¿”å›å‰ä¿®æ”¹è¿”å›å€¼
func deferModifyReturn() (result int) {
    defer func() {
        result++
    }()
    return 10 // å®é™…è¿”å›11
}

// deferå¤„ç†panic
func safeExecute(f func()) (err error) {
    defer func() {
        if r := recover(); r != nil {
            err = fmt.Errorf("panic recovered: %v", r)
        }
    }()

    f()
    return nil
}

func main() {
    deferExample()

    result := deferModifyReturn()
    fmt.Printf("Modified result: %d\n", result)

    // å®‰å…¨æ‰§è¡Œå¯èƒ½panicçš„å‡½æ•°
    err := safeExecute(func() {
        panic("something went wrong")
    })
    if err != nil {
        fmt.Printf("Error: %v\n", err)
    }
}
```

## ğŸ“Š æ€§èƒ½åˆ†æ

### å†…è”ä¼˜åŒ–

```go
package main

import "testing"

// å°å‡½æ•°ä¼šè¢«ç¼–è¯‘å™¨å†…è”
func add(a, b int) int {
    return a + b
}

// ä½¿ç”¨go:noinlineæŒ‡ä»¤ç¦æ­¢å†…è”
//go:noinline
func addNoInline(a, b int) int {
    return a + b
}

func BenchmarkInline(b *testing.B) {
    for i := 0; i < b.N; i++ {
        _ = add(1, 2)
    }
}

func BenchmarkNoInline(b *testing.B) {
    for i := 0; i < b.N; i++ {
        _ = addNoInline(1, 2)
    }
}
```

### é€ƒé€¸åˆ†æ

```go
package main

// è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆä¼šå¯¼è‡´é€ƒé€¸åˆ°å †
func escapeToHeap() *int {
    x := 42
    return &x // xé€ƒé€¸åˆ°å †
}

// å±€éƒ¨å˜é‡ä¸é€ƒé€¸
func noEscape() int {
    x := 42
    return x // xåœ¨æ ˆä¸Š
}

// ä½¿ç”¨ go build -gcflags="-m" æŸ¥çœ‹é€ƒé€¸åˆ†æ
```

## ğŸ§ª æµ‹è¯•ä»£ç 

```go
package main

import "testing"

func TestAdd(t *testing.T) {
    tests := []struct {
        name string
        a, b int
        want int
    }{
        {"positive", 1, 2, 3},
        {"negative", -1, -2, -3},
        {"mixed", -1, 2, 1},
        {"zero", 0, 0, 0},
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            if got := add(tt.a, tt.b); got != tt.want {
                t.Errorf("add(%d, %d) = %d, want %d", tt.a, tt.b, got, tt.want)
            }
        })
    }
}

func TestDivide(t *testing.T) {
    // æ­£å¸¸æƒ…å†µ
    result, err := divide(10, 2)
    if err != nil {
        t.Errorf("unexpected error: %v", err)
    }
    if result != 5.0 {
        t.Errorf("divide(10, 2) = %f, want 5.0", result)
    }

    // é™¤ä»¥é›¶
    _, err = divide(10, 0)
    if err == nil {
        t.Error("expected error for division by zero")
    }
}
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **å‡½æ•°å‘½å**
   - ä½¿ç”¨åŠ¨è¯æˆ–åŠ¨è¯çŸ­è¯­
   - å¯¼å‡ºå‡½æ•°é¦–å­—æ¯å¤§å†™
   - ç§æœ‰å‡½æ•°é¦–å­—æ¯å°å†™

2. **å‚æ•°è®¾è®¡**
   - å‚æ•°ä¸è¶…è¿‡3-4ä¸ª
   - ä½¿ç”¨ç»“æ„ä½“å°è£…å¤šä¸ªå‚æ•°
   - æŒ‡é’ˆå‚æ•°ç”¨äºå¤§å¯¹è±¡æˆ–éœ€è¦ä¿®æ”¹

3. **è¿”å›å€¼**
   - ä½¿ç”¨å¤šè¿”å›å€¼å¤„ç†é”™è¯¯
   - errorä½œä¸ºæœ€åä¸€ä¸ªè¿”å›å€¼
   - ä½¿ç”¨å‘½åè¿”å›å€¼å¢å¼ºå¯è¯»æ€§

4. **deferä½¿ç”¨**
   - èµ„æºæ¸…ç†ï¼ˆæ–‡ä»¶ã€é”ã€è¿æ¥ï¼‰
   - ç¡®ä¿é…å¯¹æ“ä½œï¼ˆOpen/Closeï¼‰
   - æ³¨æ„deferçš„æ€§èƒ½å¼€é”€

5. **é—­åŒ…æ³¨æ„äº‹é¡¹**
   - é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºé—­åŒ…æ•è·å¾ªç¯å˜é‡
   - æ³¨æ„é—­åŒ…çš„å†…å­˜å¼€é”€
   - ä½¿ç”¨é—­åŒ…å®ç°å·¥å‚æ¨¡å¼

## ğŸ” å¸¸è§é—®é¢˜

### Q1: å‡½æ•°å‚æ•°æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Ÿ

A: Goè¯­è¨€ä¸­**æ‰€æœ‰å‚æ•°éƒ½æ˜¯å€¼ä¼ é€’**ã€‚å¯¹äºåˆ‡ç‰‡ã€æ˜ å°„ã€é€šé“ç­‰å¼•ç”¨ç±»å‹ï¼Œä¼ é€’çš„æ˜¯æè¿°ç¬¦çš„å‰¯æœ¬ï¼Œä½†å®ƒä»¬æŒ‡å‘ç›¸åŒçš„åº•å±‚æ•°æ®ã€‚

### Q2: ä½•æ—¶ä½¿ç”¨å‘½åè¿”å›å€¼ï¼Ÿ

A: å½“è¿”å›å€¼çš„å«ä¹‰ä¸æ˜æ˜¾ï¼Œæˆ–éœ€è¦åœ¨deferä¸­ä¿®æ”¹è¿”å›å€¼æ—¶ä½¿ç”¨å‘½åè¿”å›å€¼ã€‚

### Q3: deferçš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ

A: deferéµå¾ª**åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰**åŸåˆ™ï¼Œæœ€åå£°æ˜çš„deferæœ€å…ˆæ‰§è¡Œã€‚

### Q4: é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„æ¼å—ï¼Ÿ

A: é—­åŒ…ä¼šæŒæœ‰å¤–éƒ¨å˜é‡çš„å¼•ç”¨ï¼Œå¦‚æœé—­åŒ…ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿ï¼Œå¯èƒ½å¯¼è‡´å¤–éƒ¨å˜é‡æ— æ³•è¢«GCå›æ”¶ã€‚

## ğŸ“š æ‰©å±•é˜…è¯»

### ç›¸å…³æ¦‚å¿µ

- [æ–¹æ³•](./06-æ–¹æ³•.md)
- [æ¥å£](./07-æ¥å£.md)
- [é”™è¯¯å¤„ç†](./11-é”™è¯¯å¤„ç†.md)

### è¿›é˜¶ä¸»é¢˜

- å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼
- æ³›å‹å‡½æ•°ï¼ˆGo 1.18+ï¼‰
- æ€§èƒ½ä¼˜åŒ–ä¸å†…è”
- é€ƒé€¸åˆ†æè¯¦è§£

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Go Documentation Team
**æœ€åæ›´æ–°**: 2025-10-29
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
**é€‚ç”¨ç‰ˆæœ¬**: Go 1.25.3+
