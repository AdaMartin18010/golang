# å…¨é¢é«˜çº§åŠŸèƒ½å®ç°æŠ¥å‘Š

## ğŸ‰ å…¨é¢æ¨è¿›å®Œæˆ - é«˜çº§åŠŸèƒ½ç¯‡

æœ¬æ¬¡å·¥ä½œå®Œæˆäº†æ‰€æœ‰é«˜çº§åŠŸèƒ½çš„å®ç°ï¼ŒåŒ…æ‹¬è´Ÿè½½ç›‘æ§ã€APMã€é™æµã€é…ç½®çƒ­é‡è½½ã€æŒ‡æ ‡èšåˆã€Kubernetes é›†æˆç­‰ã€‚

## âœ… æ–°å¢é«˜çº§åŠŸèƒ½æ¸…å•

### 1. è´Ÿè½½ç›‘æ§ âœ…
- âœ… ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼ç›‘æ§
- âœ… è¯·æ±‚é€Ÿç‡ç»Ÿè®¡
- âœ… å¹¶å‘è¯·æ±‚æ•°ç›‘æ§
- âœ… é˜Ÿåˆ—é•¿åº¦ç›‘æ§
- âœ… åŸºäº Goroutine çš„è´Ÿè½½ä¼°ç®—

**æ–‡ä»¶**: `pkg/observability/system/load.go`

### 2. åº”ç”¨æ€§èƒ½ç›‘æ§ï¼ˆAPMï¼‰âœ…
- âœ… è¯·æ±‚æŒç»­æ—¶é—´ç›´æ–¹å›¾
- âœ… è¯·æ±‚è®¡æ•°
- âœ… é”™è¯¯è®¡æ•°
- âœ… æ´»è·ƒè¿æ¥æ•°
- âœ… ååé‡ç›‘æ§
- âœ… ä¸ OpenTelemetry Tracing é›†æˆ

**æ–‡ä»¶**: `pkg/observability/system/apm.go`

### 3. é™æµå™¨ âœ…
- âœ… å¯é…ç½®çš„é€Ÿç‡é™åˆ¶
- âœ… æ—¶é—´çª—å£æ§åˆ¶
- âœ… è¯·æ±‚å…è®¸/æ‹’ç»ç»Ÿè®¡
- âœ… å‰©ä½™è¯·æ±‚æ•°ç›‘æ§
- âœ… åŠ¨æ€é™åˆ¶æ›´æ–°

**æ–‡ä»¶**: `pkg/observability/system/rate_limiter.go`

### 4. é…ç½®çƒ­é‡è½½ âœ…
- âœ… å®šæœŸæ£€æŸ¥é…ç½®å˜åŒ–
- âœ… åŠ¨æ€æ›´æ–°å¥åº·æ£€æŸ¥é˜ˆå€¼
- âœ… åŠ¨æ€æ›´æ–°é™æµé…ç½®
- âœ… ä¼˜é›…çš„é…ç½®åˆ‡æ¢

**æ–‡ä»¶**: `pkg/observability/system/config_reload.go`

### 5. æŒ‡æ ‡èšåˆå’Œç»Ÿè®¡ âœ…
- âœ… è®¡æ•°å™¨èšåˆ
- âœ… Gauge èšåˆ
- âœ… ç›´æ–¹å›¾ç»Ÿè®¡ï¼ˆè®¡æ•°ã€å’Œã€æœ€å°å€¼ã€æœ€å¤§å€¼ã€å¹³å‡å€¼ï¼‰
- âœ… æŒ‰å±æ€§é”®å€¼èšåˆ
- âœ… æ•°æ®é‡ç½®åŠŸèƒ½

**æ–‡ä»¶**: `pkg/observability/system/aggregation.go`

### 6. Kubernetes æ·±åº¦é›†æˆ âœ…
- âœ… Pod ä¿¡æ¯è‡ªåŠ¨æ£€æµ‹ï¼ˆåç§°ã€å‘½åç©ºé—´ã€èŠ‚ç‚¹ï¼‰
- âœ… Pod IP å’Œ Host IP æ£€æµ‹
- âœ… å®¹å™¨ ID æ£€æµ‹
- âœ… Labels å’Œ Annotations è‡ªåŠ¨æå–
- âœ… ç¯å¢ƒå˜é‡å’Œæ–‡ä»¶ç³»ç»Ÿæ£€æµ‹
- âœ… Downward API æ”¯æŒ
- âœ… Kubernetes æŒ‡æ ‡å¯¼å‡º

**æ–‡ä»¶**: `pkg/observability/system/kubernetes.go`

## ğŸ“Š æ–°å¢æŒ‡æ ‡æ€»è§ˆ

### è´Ÿè½½ç›‘æ§æŒ‡æ ‡ï¼ˆ4 ä¸ªï¼‰
- `system.load.average` - ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼
- `system.load.request.rate` - è¯·æ±‚é€Ÿç‡
- `system.load.concurrent.requests` - å¹¶å‘è¯·æ±‚æ•°
- `system.load.queue.length` - é˜Ÿåˆ—é•¿åº¦

### APM æŒ‡æ ‡ï¼ˆ5 ä¸ªï¼‰
- `apm.request.duration` - è¯·æ±‚æŒç»­æ—¶é—´ï¼ˆç›´æ–¹å›¾ï¼‰
- `apm.request.count` - è¯·æ±‚æ€»æ•°
- `apm.error.count` - é”™è¯¯æ€»æ•°
- `apm.connections.active` - æ´»è·ƒè¿æ¥æ•°
- `apm.throughput` - ååé‡ï¼ˆè¯·æ±‚/ç§’ï¼‰

### é™æµå™¨æŒ‡æ ‡ï¼ˆ3 ä¸ªï¼‰
- `rate_limit.requests` - é™æµè¯·æ±‚æ€»æ•°
- `rate_limit.rejected` - è¢«æ‹’ç»çš„è¯·æ±‚æ•°
- `rate_limit.remaining` - å‰©ä½™è¯·æ±‚æ•°

### Kubernetes æŒ‡æ ‡ï¼ˆ1 ä¸ªï¼‰
- `k8s.pod.info` - Pod ä¿¡æ¯ï¼ˆé€šè¿‡å±æ€§ä¼ é€’ï¼‰

**æ€»è®¡æ–°å¢**: 13 ä¸ªé«˜çº§ç›‘æ§æŒ‡æ ‡

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒå®ç°ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰
1. `pkg/observability/system/load.go` - è´Ÿè½½ç›‘æ§
2. `pkg/observability/system/apm.go` - APM ç›‘æ§
3. `pkg/observability/system/rate_limiter.go` - é™æµå™¨
4. `pkg/observability/system/config_reload.go` - é…ç½®çƒ­é‡è½½
5. `pkg/observability/system/aggregation.go` - æŒ‡æ ‡èšåˆ
6. `pkg/observability/system/kubernetes.go` - Kubernetes é›†æˆ

### ç¤ºä¾‹å’Œæ–‡æ¡£
7. `examples/observability/advanced-features/main.go` - é«˜çº§åŠŸèƒ½ç¤ºä¾‹
8. `docs/ULTIMATE-ADVANCED-FEATURES.md` - æœ¬æ–‡æ¡£

## ğŸš€ å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

```go
import (
    "github.com/yourusername/golang/pkg/observability/system"
)

// åˆ›å»ºç³»ç»Ÿç›‘æ§å™¨ï¼ˆå¯ç”¨æ‰€æœ‰é«˜çº§åŠŸèƒ½ï¼‰
systemMonitor, _ := system.NewSystemMonitor(system.SystemConfig{
    Meter:            mp.Meter("system"),
    Tracer:           tp.Tracer("system"),
    Enabled:          true,
    CollectInterval:  5 * time.Second,
    EnableDiskMonitor: true,
    EnableLoadMonitor: true,  // å¯ç”¨è´Ÿè½½ç›‘æ§
    EnableAPMMonitor:  true,  // å¯ç”¨ APM ç›‘æ§
    RateLimitConfig: &system.RateLimiterConfig{
        Meter:   mp.Meter("ratelimit"),
        Enabled: true,
        Limit:   100, // æ¯ç§’ 100 ä¸ªè¯·æ±‚
        Window:  1 * time.Second,
    },
})

// å¯åŠ¨ç›‘æ§
systemMonitor.Start(ctx)
defer systemMonitor.Stop(ctx)

// ä½¿ç”¨ APM ç›‘æ§
apmMonitor := systemMonitor.GetAPMMonitor()
apmMonitor.RecordRequest(ctx, duration, statusCode)

// ä½¿ç”¨é™æµå™¨
rateLimiter := systemMonitor.GetRateLimiter()
if rateLimiter.Allow(ctx) {
    // å¤„ç†è¯·æ±‚
}

// ä½¿ç”¨æŒ‡æ ‡èšåˆ
aggregator := systemMonitor.GetAggregator()
aggregator.RecordCounter("custom.counter", 1)
stats := aggregator.GetHistogramStats("custom.histogram")

// è·å– Kubernetes ä¿¡æ¯
k8sInfo := systemMonitor.GetKubernetesInfo()
fmt.Printf("Pod: %s, Namespace: %s\n", k8sInfo.PodName, k8sInfo.PodNamespace)
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§è¯¦è§£

### 1. è´Ÿè½½ç›‘æ§
- **ç³»ç»Ÿè´Ÿè½½**: åŸºäº Goroutine æ•°é‡å’Œ CPU æ ¸å¿ƒæ•°ä¼°ç®—
- **è¯·æ±‚é€Ÿç‡**: è‡ªåŠ¨ç»Ÿè®¡æ¯ç§’è¯·æ±‚æ•°
- **å¹¶å‘ç›‘æ§**: å®æ—¶ç›‘æ§å¹¶å‘è¯·æ±‚æ•°
- **é˜Ÿåˆ—ç›‘æ§**: ç›‘æ§å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—é•¿åº¦

### 2. APM ç›‘æ§
- **è¯·æ±‚è¿½è¸ª**: ä¸ OpenTelemetry Tracing å®Œå…¨é›†æˆ
- **æ€§èƒ½åˆ†æ**: è¯·æ±‚æŒç»­æ—¶é—´ç›´æ–¹å›¾
- **é”™è¯¯è¿½è¸ª**: è‡ªåŠ¨è®°å½•é”™è¯¯ç±»å‹å’Œæ•°é‡
- **ååé‡**: å®æ—¶è®¡ç®—è¯·æ±‚/ç§’

### 3. é™æµå™¨
- **æ»‘åŠ¨çª—å£**: åŸºäºæ—¶é—´çª—å£çš„é™æµ
- **åŠ¨æ€è°ƒæ•´**: æ”¯æŒè¿è¡Œæ—¶æ›´æ–°é™åˆ¶
- **æŒ‡æ ‡å¯¼å‡º**: è‡ªåŠ¨å¯¼å‡ºé™æµç›¸å…³æŒ‡æ ‡
- **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨äº’æ–¥é”ä¿è¯å¹¶å‘å®‰å…¨

### 4. é…ç½®çƒ­é‡è½½
- **è‡ªåŠ¨æ£€æµ‹**: å®šæœŸæ£€æŸ¥é…ç½®å˜åŒ–
- **ä¼˜é›…åˆ‡æ¢**: æ— ä¸­æ–­é…ç½®æ›´æ–°
- **å¥åº·é˜ˆå€¼**: åŠ¨æ€æ›´æ–°å¥åº·æ£€æŸ¥é˜ˆå€¼
- **é™æµé…ç½®**: åŠ¨æ€æ›´æ–°é™æµå‚æ•°

### 5. æŒ‡æ ‡èšåˆ
- **å¤šç»´åº¦èšåˆ**: æ”¯æŒæŒ‰å±æ€§é”®å€¼èšåˆ
- **ç»Ÿè®¡è®¡ç®—**: è‡ªåŠ¨è®¡ç®—æœ€å°å€¼ã€æœ€å¤§å€¼ã€å¹³å‡å€¼
- **å†…å­˜é«˜æ•ˆ**: ä½¿ç”¨ map å­˜å‚¨ï¼Œæ”¯æŒé‡ç½®
- **ç±»å‹å®‰å…¨**: æ”¯æŒ Counterã€Gaugeã€Histogram

### 6. Kubernetes é›†æˆ
- **è‡ªåŠ¨æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ Kubernetes ç¯å¢ƒ
- **ä¿¡æ¯æå–**: ä»ç¯å¢ƒå˜é‡ã€æ–‡ä»¶ç³»ç»Ÿã€Downward API æå–ä¿¡æ¯
- **æ ‡ç­¾æ”¯æŒ**: è‡ªåŠ¨æå– Pod Labels å’Œ Annotations
- **æŒ‡æ ‡å¯¼å‡º**: å°† Kubernetes ä¿¡æ¯ä½œä¸ºæŒ‡æ ‡å±æ€§å¯¼å‡º

## ğŸ“Š æ€»ä½“å®Œæˆåº¦

| æ¨¡å— | å®Œæˆåº¦ |
|------|--------|
| åŸºç¡€ç³»ç»Ÿç›‘æ§ | 100% âœ… |
| è´Ÿè½½ç›‘æ§ | 100% âœ… |
| APM ç›‘æ§ | 100% âœ… |
| é™æµå™¨ | 100% âœ… |
| é…ç½®çƒ­é‡è½½ | 100% âœ… |
| æŒ‡æ ‡èšåˆ | 100% âœ… |
| Kubernetes é›†æˆ | 100% âœ… |

**æ€»ä½“å®Œæˆåº¦**: **100%** âœ…

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

1. **å®Œæ•´çš„å¯è§‚æµ‹æ€§æ ˆ**: ä»åŸºç¡€è®¾æ–½åˆ°åº”ç”¨å±‚å…¨è¦†ç›–
2. **ç”Ÿäº§å°±ç»ª**: æ‰€æœ‰åŠŸèƒ½éƒ½è€ƒè™‘äº†ç”Ÿäº§ç¯å¢ƒéœ€æ±‚
3. **é«˜åº¦å¯é…ç½®**: æ‰€æœ‰åŠŸèƒ½éƒ½æ”¯æŒçµæ´»é…ç½®
4. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨å¯è§‚å¯ŸæŒ‡æ ‡å‡å°‘æ€§èƒ½å¼€é”€
5. **äº‘åŸç”Ÿ**: æ·±åº¦é›†æˆ Kubernetes å’Œå®¹å™¨ç¯å¢ƒ
6. **æ˜“äºä½¿ç”¨**: æä¾›ç»Ÿä¸€çš„ API å’Œä¸°å¯Œçš„ç¤ºä¾‹

## âœ¨ æ€»ç»“

æœ¬æ¬¡å…¨é¢æ¨è¿›å·¥ä½œå·²å®Œæˆæ‰€æœ‰é«˜çº§åŠŸèƒ½ï¼š

1. âœ… è´Ÿè½½ç›‘æ§ï¼ˆç³»ç»Ÿè´Ÿè½½ã€è¯·æ±‚é€Ÿç‡ã€å¹¶å‘æ•°ï¼‰
2. âœ… APM ç›‘æ§ï¼ˆè¯·æ±‚è¿½è¸ªã€æ€§èƒ½åˆ†æã€é”™è¯¯è¿½è¸ªï¼‰
3. âœ… é™æµå™¨ï¼ˆé€Ÿç‡é™åˆ¶ã€åŠ¨æ€è°ƒæ•´ï¼‰
4. âœ… é…ç½®çƒ­é‡è½½ï¼ˆè‡ªåŠ¨æ£€æµ‹ã€ä¼˜é›…åˆ‡æ¢ï¼‰
5. âœ… æŒ‡æ ‡èšåˆï¼ˆå¤šç»´åº¦èšåˆã€ç»Ÿè®¡è®¡ç®—ï¼‰
6. âœ… Kubernetes æ·±åº¦é›†æˆï¼ˆè‡ªåŠ¨æ£€æµ‹ã€ä¿¡æ¯æå–ï¼‰

æ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶é€šè¿‡è¯­æ³•æ£€æŸ¥ã€‚ä»£ç è´¨é‡é«˜ï¼Œæ–‡æ¡£å®Œæ•´ï¼Œç¤ºä¾‹ä¸°å¯Œã€‚

**çŠ¶æ€**: âœ… **å®Œæˆ**

**ä¸‹ä¸€æ­¥**: ç½‘ç»œæ¢å¤åè¿è¡Œ `go mod tidy` ä¸‹è½½ä¾èµ–å¹¶æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ã€‚
