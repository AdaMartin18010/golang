# æ•™ç¨‹ç´¢å¼•ä¸å­¦ä¹ æŒ‡å—

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-29
**é€‚ç”¨äº**: Go 1.25.3

---

## ğŸ“‹ ç›®å½•

- [æ•™ç¨‹ç´¢å¼•ä¸å­¦ä¹ æŒ‡å—](#æ•™ç¨‹ç´¢å¼•ä¸å­¦ä¹ æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æ•™ç¨‹ä½“ç³»](#11-æ•™ç¨‹ä½“ç³»)
  - [2. å…¥é—¨æ•™ç¨‹](#2-å…¥é—¨æ•™ç¨‹)
    - [2.1 æ•™ç¨‹1ï¼šæ„å»ºç¬¬ä¸€ä¸ªHTTPæœåŠ¡](#21-æ•™ç¨‹1æ„å»ºç¬¬ä¸€ä¸ªhttpæœåŠ¡)
    - [2.2 æ•™ç¨‹2ï¼šå¹¶å‘ç¼–ç¨‹åŸºç¡€](#22-æ•™ç¨‹2å¹¶å‘ç¼–ç¨‹åŸºç¡€)
  - [3. è¿›é˜¶æ•™ç¨‹](#3-è¿›é˜¶æ•™ç¨‹)
    - [3.1 æ•™ç¨‹3ï¼šæ•°æ®åº“æ“ä½œä¸ORM](#31-æ•™ç¨‹3æ•°æ®åº“æ“ä½œä¸orm)
    - [3.2 æ•™ç¨‹4ï¼šå•å…ƒæµ‹è¯•ä¸åŸºå‡†æµ‹è¯•](#32-æ•™ç¨‹4å•å…ƒæµ‹è¯•ä¸åŸºå‡†æµ‹è¯•)
  - [4. é«˜çº§æ•™ç¨‹](#4-é«˜çº§æ•™ç¨‹)
    - [4.1 æ•™ç¨‹5ï¼šå¾®æœåŠ¡æ¶æ„å®è·µ](#41-æ•™ç¨‹5å¾®æœåŠ¡æ¶æ„å®è·µ)
  - [5. ä¸“é¢˜æ•™ç¨‹](#5-ä¸“é¢˜æ•™ç¨‹)
    - [5.1 ä¸“é¢˜ï¼šæ€§èƒ½ä¼˜åŒ–å®æˆ˜](#51-ä¸“é¢˜æ€§èƒ½ä¼˜åŒ–å®æˆ˜)
  - [6. å­¦ä¹ è·¯çº¿](#6-å­¦ä¹ è·¯çº¿)
    - [6.1 å®Œæ•´å­¦ä¹ è·¯å¾„](#61-å®Œæ•´å­¦ä¹ è·¯å¾„)

## 1. æ¦‚è¿°

### 1.1 æ•™ç¨‹ä½“ç³»

```text
æ•™ç¨‹åˆ†ç±»ï¼ˆæŒ‰éš¾åº¦ï¼‰:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•™ç¨‹ä½“ç³»                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  å…¥é—¨æ•™ç¨‹ (â­â­)                     â”‚
â”‚  â””â”€ HTTPæœåŠ¡ã€å¹¶å‘åŸºç¡€ã€é”™è¯¯å¤„ç†    â”‚
â”‚                                     â”‚
â”‚  è¿›é˜¶æ•™ç¨‹ (â­â­â­)                   â”‚
â”‚  â””â”€ ä¸­é—´ä»¶ã€æ•°æ®åº“ã€æµ‹è¯•ã€éƒ¨ç½²      â”‚
â”‚                                     â”‚
â”‚  é«˜çº§æ•™ç¨‹ (â­â­â­â­)                 â”‚
â”‚  â””â”€ å¾®æœåŠ¡ã€æ€§èƒ½ä¼˜åŒ–ã€å¯è§‚æµ‹æ€§      â”‚
â”‚                                     â”‚
â”‚  ä¸“é¢˜æ•™ç¨‹ (â­â­â­â­â­)               â”‚
â”‚  â””â”€ å½¢å¼åŒ–åˆ†æã€æ— é”ç®—æ³•ã€äº‘åŸç”Ÿ    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. å…¥é—¨æ•™ç¨‹

### 2.1 æ•™ç¨‹1ï¼šæ„å»ºç¬¬ä¸€ä¸ªHTTPæœåŠ¡

**ç›®æ ‡**: 30åˆ†é’Ÿåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„HTTPæœåŠ¡

**å†…å®¹å¤§çº²**:

1. é¡¹ç›®åˆå§‹åŒ–
2. åˆ›å»ºHTTP handler
3. è·¯ç”±é…ç½®
4. ä¸­é—´ä»¶æ·»åŠ 
5. æµ‹è¯•ä¸è¿è¡Œ

**è¯¦ç»†æ­¥éª¤**:

```go
// Step 1: é¡¹ç›®åˆå§‹åŒ–
// åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir my-http-server
cd my-http-server
go mod init my-http-server

// Step 2: åˆ›å»ºmain.go
// main.go
package main

import (
    "encoding/json"
    "log"
    "net/http"
    "time"
)

// Handler: Hello World
func helloHandler(w http.ResponseWriter, r *http.Request) {
    response := map[string]string{
        "message": "Hello, World!",
        "time":    time.Now().Format(time.RFC3339),
    }

    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}

// Handler: Echo
func echoHandler(w http.ResponseWriter, r *http.Request) {
    var data map[string]interface{}

    if err := json.NewDecoder(r.Body).Decode(&data); err != nil {
        http.Error(w, err.Error(), http.StatusBadRequest)
        return
    }

    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(data)
}

// ä¸­é—´ä»¶: æ—¥å¿—
func loggingMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        start := time.Now()

        log.Printf("Started %s %s", r.Method, r.URL.Path)

        next.ServeHTTP(w, r)

        log.Printf("Completed in %v", time.Since(start))
    })
}

func main() {
    mux := http.NewServeMux()

    // æ³¨å†Œè·¯ç”±
    mux.HandleFunc("/", helloHandler)
    mux.HandleFunc("/echo", echoHandler)

    // åº”ç”¨ä¸­é—´ä»¶
    handler := loggingMiddleware(mux)

    // å¯åŠ¨æœåŠ¡å™¨
    log.Println("Server starting on :8080")
    if err := http.ListenAndServe(":8080", handler); err != nil {
        log.Fatal(err)
    }
}

// Step 3: è¿è¡Œ
// go run main.go

// Step 4: æµ‹è¯•
// curl http://localhost:8080/
// curl -X POST http://localhost:8080/echo -d '{"name":"test"}'
```

**ç»ƒä¹ ä»»åŠ¡**:

1. æ·»åŠ ä¸€ä¸ª`/health`ç«¯ç‚¹
2. å®ç°ä¸€ä¸ªè®¡æ•°å™¨ä¸­é—´ä»¶
3. æ·»åŠ CORSæ”¯æŒ
4. å®ç°ä¼˜é›…å…³é—­

---

### 2.2 æ•™ç¨‹2ï¼šå¹¶å‘ç¼–ç¨‹åŸºç¡€

**ç›®æ ‡**: æŒæ¡Goroutineå’ŒChannelçš„åŸºæœ¬ä½¿ç”¨

**å†…å®¹å¤§çº²**:

1. Goroutineåˆ›å»ºä¸ç®¡ç†
2. Channelé€šä¿¡
3. Selectå¤šè·¯å¤ç”¨
4. WaitGroupåŒæ­¥
5. Contextå–æ¶ˆ

**è¯¦ç»†æ­¥éª¤**:

```go
// ç¤ºä¾‹1: åŸºç¡€Goroutine
func example1() {
    // å¯åŠ¨goroutine
    go func() {
        fmt.Println("Hello from goroutine")
    }()

    time.Sleep(time.Second)
}

// ç¤ºä¾‹2: Channelé€šä¿¡
func example2() {
    ch := make(chan int)

    // ç”Ÿäº§è€…
    go func() {
        for i := 0; i < 10; i++ {
            ch <- i
        }
        close(ch)
    }()

    // æ¶ˆè´¹è€…
    for val := range ch {
        fmt.Println(val)
    }
}

// ç¤ºä¾‹3: Selectå¤šè·¯å¤ç”¨
func example3() {
    ch1 := make(chan string)
    ch2 := make(chan string)

    go func() {
        time.Sleep(1 * time.Second)
        ch1 <- "from ch1"
    }()

    go func() {
        time.Sleep(2 * time.Second)
        ch2 <- "from ch2"
    }()

    for i := 0; i < 2; i++ {
        select {
        case msg1 := <-ch1:
            fmt.Println(msg1)
        case msg2 := <-ch2:
            fmt.Println(msg2)
        }
    }
}

// ç¤ºä¾‹4: WaitGroup
func example4() {
    var wg sync.WaitGroup

    for i := 0; i < 5; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            fmt.Printf("Worker %d done\n", id)
        }(i)
    }

    wg.Wait()
    fmt.Println("All workers completed")
}

// ç¤ºä¾‹5: Contextå–æ¶ˆ
func example5() {
    ctx, cancel := context.WithTimeout(context.Background(), 3*time.Second)
    defer cancel()

    go func() {
        select {
        case <-time.After(5 * time.Second):
            fmt.Println("work done")
        case <-ctx.Done():
            fmt.Println("work cancelled:", ctx.Err())
        }
    }()

    time.Sleep(4 * time.Second)
}
```

**ç»ƒä¹ ä»»åŠ¡**:

1. å®ç°ä¸€ä¸ªWorkeræ± 
2. å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼
3. å®ç°Fan-out/Fan-inæ¨¡å¼
4. å¤„ç†Goroutineæ³„æ¼

---

## 3. è¿›é˜¶æ•™ç¨‹

### 3.1 æ•™ç¨‹3ï¼šæ•°æ®åº“æ“ä½œä¸ORM

**ç›®æ ‡**: æŒæ¡PostgreSQLå’ŒORMçš„ä½¿ç”¨

**å†…å®¹å¤§çº²**:

1. æ•°æ®åº“è¿æ¥
2. CRUDæ“ä½œ
3. äº‹åŠ¡å¤„ç†
4. GORMä½¿ç”¨
5. è¿æ¥æ± ä¼˜åŒ–

**è¯¦ç»†æ­¥éª¤**:

```go
// Step 1: æ•°æ®åº“è¿æ¥
import (
    "database/sql"
    "gorm.io/driver/postgres"
    "gorm.io/gorm"
)

func connectDB() (*sql.DB, error) {
    dsn := "host=localhost user=postgres password=secret dbname=mydb port=5432"
    return sql.Open("postgres", dsn)
}

// Step 2: å®šä¹‰æ¨¡å‹
type User struct {
    ID        uint   `gorm:"primaryKey"`
    Email     string `gorm:"uniqueIndex"`
    Name      string
    CreatedAt time.Time
}

// Step 3: GORMåˆå§‹åŒ–
func initGORM() (*gorm.DB, error) {
    dsn := "host=localhost user=postgres password=secret dbname=mydb port=5432"
    return gorm.Open(postgres.Open(dsn), &gorm.Config{})
}

// Step 4: CRUDæ“ä½œ
func crudOperations(db *gorm.DB) {
    // Create
    user := User{Email: "test@example.com", Name: "Test User"}
    db.Create(&user)

    // Read
    var found User
    db.First(&found, "email = ?", "test@example.com")

    // Update
    db.Model(&found).Update("Name", "Updated Name")

    // Delete
    db.Delete(&found)
}

// Step 5: äº‹åŠ¡
func transactionExample(db *gorm.DB) error {
    return db.Transaction(func(tx *gorm.DB) error {
        if err := tx.Create(&User{Email: "user1@example.com"}).Error; err != nil {
            return err
        }

        if err := tx.Create(&User{Email: "user2@example.com"}).Error; err != nil {
            return err
        }

        return nil
    })
}
```

**ç»ƒä¹ ä»»åŠ¡**:

1. å®ç°ç”¨æˆ·æ³¨å†Œ/ç™»å½•
2. å®ç°åˆ†é¡µæŸ¥è¯¢
3. å®ç°è½¯åˆ é™¤
4. ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

---

### 3.2 æ•™ç¨‹4ï¼šå•å…ƒæµ‹è¯•ä¸åŸºå‡†æµ‹è¯•

**ç›®æ ‡**: ç¼–å†™é«˜è´¨é‡çš„æµ‹è¯•ä»£ç 

**å†…å®¹å¤§çº²**:

1. å•å…ƒæµ‹è¯•åŸºç¡€
2. Table-drivenæµ‹è¯•
3. Mockå’ŒStub
4. åŸºå‡†æµ‹è¯•
5. è¦†ç›–ç‡åˆ†æ

**è¯¦ç»†æ­¥éª¤**:

```go
// è¢«æµ‹è¯•å‡½æ•°
func Add(a, b int) int {
    return a + b
}

func Divide(a, b float64) (float64, error) {
    if b == 0 {
        return 0, errors.New("division by zero")
    }
    return a / b, nil
}

// æµ‹è¯•æ–‡ä»¶: math_test.go
func TestAdd(t *testing.T) {
    tests := []struct {
        name     string
        a, b     int
        expected int
    }{
        {"positive", 2, 3, 5},
        {"negative", -1, -1, -2},
        {"zero", 0, 0, 0},
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            result := Add(tt.a, tt.b)
            if result != tt.expected {
                t.Errorf("Add(%d, %d) = %d, want %d", tt.a, tt.b, result, tt.expected)
            }
        })
    }
}

func TestDivide(t *testing.T) {
    // æ­£å¸¸æƒ…å†µ
    result, err := Divide(10, 2)
    if err != nil {
        t.Errorf("Unexpected error: %v", err)
    }
    if result != 5.0 {
        t.Errorf("Divide(10, 2) = %f, want 5.0", result)
    }

    // é™¤é›¶é”™è¯¯
    _, err = Divide(10, 0)
    if err == nil {
        t.Error("Expected error for division by zero")
    }
}

// åŸºå‡†æµ‹è¯•
func BenchmarkAdd(b *testing.B) {
    for i := 0; i < b.N; i++ {
        Add(1, 2)
    }
}

// Mockç¤ºä¾‹
type UserRepository interface {
    GetByID(id int) (*User, error)
}

type MockUserRepository struct {
    users map[int]*User
}

func (m *MockUserRepository) GetByID(id int) (*User, error) {
    user, ok := m.users[id]
    if !ok {
        return nil, errors.New("user not found")
    }
    return user, nil
}
```

**è¿è¡Œæµ‹è¯•**:

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./...

# è¿è¡Œç‰¹å®šæµ‹è¯•
go test -run TestAdd

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test -cover

# è¯¦ç»†è¦†ç›–ç‡
go test -coverprofile=coverage.out
go tool cover -html=coverage.out

# è¿è¡ŒåŸºå‡†æµ‹è¯•
go test -bench=.

# å†…å­˜åˆ†é…åˆ†æ
go test -bench=. -benchmem
```

---

## 4. é«˜çº§æ•™ç¨‹

### 4.1 æ•™ç¨‹5ï¼šå¾®æœåŠ¡æ¶æ„å®è·µ

1. gRPCæœåŠ¡å®šä¹‰
2. æœåŠ¡æ³¨å†Œä¸å‘ç°
3. è´Ÿè½½å‡è¡¡
4. åˆ†å¸ƒå¼è¿½è¸ª
5. æœåŠ¡ç½‘æ ¼

**è¯¦ç»†æ­¥éª¤**:

```proto
// Step 1: å®šä¹‰protoæ–‡ä»¶
// user.proto
syntax = "proto3";

package user;

service UserService {
    rpc GetUser(GetUserRequest) returns (User);
    rpc CreateUser(CreateUserRequest) returns (User);
}

message User {
    string id = 1;
    string email = 2;
    string name = 3;
}

message GetUserRequest {
    string id = 1;
}

message CreateUserRequest {
    string email = 1;
    string name = 2;
}
```

```go
// Step 2: å®ç°æœåŠ¡
type userServer struct {
    pb.UnimplementedUserServiceServer
    repo UserRepository
}

func (s *userServer) GetUser(ctx context.Context, req *pb.GetUserRequest) (*pb.User, error) {
    user, err := s.repo.GetByID(ctx, req.Id)
    if err != nil {
        return nil, status.Error(codes.NotFound, "user not found")
    }

    return &pb.User{
        Id:    user.ID,
        Email: user.Email,
        Name:  user.Name,
    }, nil
}

// Step 3: æœåŠ¡æ³¨å†Œï¼ˆConsulï¼‰
func registerService() error {
    config := consul.DefaultConfig()
    client, err := consul.NewClient(config)
    if err != nil {
        return err
    }

    registration := &consul.AgentServiceRegistration{
        ID:      "user-service-1",
        Name:    "user-service",
        Port:    50051,
        Address: "localhost",
        Check: &consul.AgentServiceCheck{
            GRPC:     "localhost:50051",
            Interval: "10s",
            Timeout:  "1s",
        },
    }

    return client.Agent().ServiceRegister(registration)
}

// Step 4: å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡
func createClient() (pb.UserServiceClient, error) {
    // æœåŠ¡å‘ç°
    resolver := consul.NewBuilder()

    // å»ºç«‹è¿æ¥
    conn, err := grpc.Dial(
        "consul://localhost:8500/user-service",
        grpc.WithResolvers(resolver),
        grpc.WithDefaultServiceConfig(`{"loadBalancingPolicy":"round_robin"}`),
    )
    if err != nil {
        return nil, err
    }

    return pb.NewUserServiceClient(conn), nil
}
```

---

## 5. ä¸“é¢˜æ•™ç¨‹

### 5.1 ä¸“é¢˜ï¼šæ€§èƒ½ä¼˜åŒ–å®æˆ˜

**æ¶µç›–å†…å®¹**:

1. **CPU Profiling**
2. **Memory Profiling**
3. **Goroutineåˆ†æ**
4. **é”ç«äº‰åˆ†æ**
5. **å®æˆ˜æ¡ˆä¾‹**

**å…³é”®æŠ€æœ¯**:

- pprofä½¿ç”¨
- Benchmarkä¼˜åŒ–
- é€ƒé€¸åˆ†æ
- å†…å­˜å¯¹é½
- æ— é”ç®—æ³•

---

## 6. å­¦ä¹ è·¯çº¿

### 6.1 å®Œæ•´å­¦ä¹ è·¯å¾„

```text
æ¨èå­¦ä¹ è·¯çº¿ï¼ˆ12å‘¨è®¡åˆ’ï¼‰:

Week 1-2: å…¥é—¨åŸºç¡€
â”œâ”€ HTTPæœåŠ¡å¼€å‘
â”œâ”€ å¹¶å‘ç¼–ç¨‹åŸºç¡€
â””â”€ é”™è¯¯å¤„ç†

Week 3-4: è¿›é˜¶æŠ€èƒ½
â”œâ”€ æ•°æ®åº“æ“ä½œ
â”œâ”€ å•å…ƒæµ‹è¯•
â””â”€ ä¸­é—´ä»¶å¼€å‘

Week 5-6: é«˜çº§ç‰¹æ€§
â”œâ”€ å¾®æœåŠ¡æ¶æ„
â”œâ”€ gRPCé€šä¿¡
â””â”€ æœåŠ¡å‘ç°

Week 7-8: æ€§èƒ½ä¼˜åŒ–
â”œâ”€ Profileåˆ†æ
â”œâ”€ å†…å­˜ä¼˜åŒ–
â””â”€ å¹¶å‘ä¼˜åŒ–

Week 9-10: å¯è§‚æµ‹æ€§
â”œâ”€ åˆ†å¸ƒå¼è¿½è¸ª
â”œâ”€ æŒ‡æ ‡æ”¶é›†
â””â”€ æ—¥å¿—èšåˆ

Week 11-12: ç”Ÿäº§å®è·µ
â”œâ”€ å®¹å™¨åŒ–éƒ¨ç½²
â”œâ”€ CI/CD
â””â”€ ç›‘æ§å‘Šè­¦
```

---

**æ–‡æ¡£å®Œæˆæ—¶é—´**: 2025å¹´10æœˆ24æ—¥
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**è´¨é‡è¯„çº§**: 95åˆ† â­â­â­â­â­

ğŸš€ **æ•™ç¨‹ç´¢å¼•ä¸å­¦ä¹ æŒ‡å—å®Œæˆï¼Phase 4å…¨éƒ¨ä»»åŠ¡å®Œæˆï¼** ğŸŠ
