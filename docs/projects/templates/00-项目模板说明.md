# Go项目模板说明

**版本**: v1.0  
**更新日期**: 2025-10-29  
**适用于**: Go 1.25.3

---

> **难度**: ⭐⭐⭐
> **标签**: #项目结构 #模板 #最佳实践

## 📋 目录

- [1. 标准项目布局](#1-标准项目布局)
  - [基础项目结构](#基础项目结构)
- [2. 项目类型](#2-项目类型)
  - [类型1: CLI工具](#类型1-cli工具)
  - [类型2: Web API服务](#类型2-web-api服务)
  - [类型3: 微服务](#类型3-微服务)
  - [类型4: 库项目](#类型4-库项目)
- [3. 目录说明](#3-目录说明)
  - [/cmd](#cmd)
  - [/internal](#internal)
  - [/pkg](#pkg)
  - [/api](#api)
  - [/configs](#configs)
  - [/scripts](#scripts)
  - [/test](#test)
- [4. 配置文件](#4-配置文件)
  - [go.mod](#go-mod)
  - [Makefile](#makefile)
  - [.gitignore](#gitignore)
  - [README.md模板](#readme-md模板)
- [Features](#features)
- [Installation](#installation)
- [Usage](#usage)
- [Configuration](#configuration)
- [Development](#development)
- [License](#license)
- [5. 最佳实践](#5-最佳实践)
  - [1. 分层架构](#1-分层架构)
  - [2. 依赖注入](#2-依赖注入)
  - [3. 配置管理](#3-配置管理)
  - [4. 错误处理](#4-错误处理)
  - [5. 日志记录](#5-日志记录)
- [🔗 相关资源](#相关资源)

## 1. 标准项目布局

### 基础项目结构

```
myproject/
├── cmd/                    # 主程序入口
│   └── myapp/
│       └── main.go
├── internal/               # 私有代码
│   ├── handler/           # HTTP处理器
│   ├── service/           # 业务逻辑
│   ├── repository/        # 数据访问层
│   └── model/             # 数据模型
├── pkg/                   # 公共库
│   └── utils/
├── api/                   # API定义
│   └── openapi.yaml
├── configs/               # 配置文件
│   ├── config.yaml
│   └── config.dev.yaml
├── scripts/               # 脚本文件
│   ├── build.sh
│   └── deploy.sh
├── test/                  # 测试文件
│   ├── integration/
│   └── e2e/
├── docs/                  # 文档
│   └── README.md
├── .gitignore
├── go.mod
├── go.sum
├── Makefile
└── README.md
```

---

## 2. 项目类型

### 类型1: CLI工具

```
cli-tool/
├── cmd/
│   └── tool/
│       └── main.go
├── internal/
│   ├── command/           # 命令实现
│   │   ├── root.go
│   │   ├── version.go
│   │   └── config.go
│   └── config/            # 配置管理
├── pkg/
│   └── utils/
├── go.mod
└── README.md
```

---

### 类型2: Web API服务

```
web-api/
├── cmd/
│   └── api/
│       └── main.go
├── internal/
│   ├── handler/           # HTTP handlers
│   │   ├── user.go
│   │   ├── auth.go
│   │   └── middleware.go
│   ├── service/           # 业务逻辑
│   │   ├── user.go
│   │   └── auth.go
│   ├── repository/        # 数据访问
│   │   └── user.go
│   └── model/             # 数据模型
│       └── user.go
├── api/
│   └── openapi.yaml
├── configs/
│   └── config.yaml
├── migrations/            # 数据库迁移
│   ├── 001_create_users.sql
│   └── 002_add_indexes.sql
├── go.mod
└── README.md
```

---

### 类型3: 微服务

```
microservice/
├── cmd/
│   └── service/
│       └── main.go
├── internal/
│   ├── grpc/              # gRPC服务
│   │   └── server.go
│   ├── handler/
│   ├── service/
│   └── repository/
├── pkg/
│   └── proto/             # Protobuf定义
│       └── service.proto
├── api/
│   └── http/
│       └── routes.go
├── configs/
├── deployments/           # 部署配置
│   ├── docker/
│   │   └── Dockerfile
│   └── k8s/
│       ├── deployment.yaml
│       └── service.yaml
├── go.mod
└── README.md
```

---

### 类型4: 库项目

```
library/
├── pkg/
│   └── mylib/
│       ├── core.go
│       ├── core_test.go
│       ├── helper.go
│       └── helper_test.go
├── examples/              # 示例代码
│   └── basic/
│       └── main.go
├── docs/
│   └── usage.md
├── .github/
│   └── workflows/
│       └── test.yml
├── go.mod
├── LICENSE
└── README.md
```

---

## 3. 目录说明

### /cmd

主程序入口目录，每个子目录是一个可执行程序。

```go
// cmd/myapp/main.go
package main

import (
    "myproject/internal/server"
)

func main() {
    srv := server.New()
    srv.Run()
}
```

---

### /internal

私有代码，不能被其他项目导入。

```
internal/
├── handler/        # HTTP处理器
├── service/        # 业务逻辑
├── repository/     # 数据访问
├── model/          # 数据模型
├── middleware/     # 中间件
└── config/         # 配置管理
```

---

### /pkg

可以被其他项目导入的公共库。

```
pkg/
├── logger/         # 日志工具
├── errors/         # 错误处理
├── validator/      # 数据验证
└── cache/          # 缓存工具
```

---

### /api

API定义文件。

```
api/
├── openapi/        # OpenAPI/Swagger定义
│   └── api.yaml
├── proto/          # Protobuf定义
│   └── service.proto
└── graphql/        # GraphQL schema
    └── schema.graphql
```

---

### /configs

配置文件模板。

```
configs/
├── config.yaml         # 默认配置
├── config.dev.yaml     # 开发环境
├── config.prod.yaml    # 生产环境
└── config.test.yaml    # 测试环境
```

---

### /scripts

构建、部署等脚本。

```bash
#!/bin/bash
# scripts/build.sh

VERSION=$(git describe --tags --always)
BUILD_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

go build -ldflags="-X main.Version=${VERSION} -X main.BuildTime=${BUILD_TIME}" \
    -o bin/myapp ./cmd/myapp
```

---

### /test

额外的测试文件。

```
test/
├── integration/    # 集成测试
│   └── api_test.go
├── e2e/           # 端到端测试
│   └── flow_test.go
└── testdata/      # 测试数据
    └── fixtures/
```

---

## 4. 配置文件

### go.mod

```go
module github.com/username/myproject

go 1.25.3

require (
    github.com/gin-gonic/gin v1.10.0
    gorm.io/gorm v1.25.5
)
```

---

### Makefile

```makefile
.PHONY: build test clean run

# 变量
APP_NAME=myapp
VERSION=$(shell git describe --tags --always)
BUILD_TIME=$(shell date -u +"%Y-%m-%dT%H:%M:%SZ")

# 构建
build:
	go build -ldflags="-X main.Version=$(VERSION) -X main.BuildTime=$(BUILD_TIME)" \
		-o bin/$(APP_NAME) ./cmd/$(APP_NAME)

# 测试
test:
	go test -v -race -coverprofile=coverage.out ./...
	go tool cover -html=coverage.out -o coverage.html

# 清理
clean:
	rm -rf bin/
	rm -f coverage.out coverage.html

# 运行
run:
	go run ./cmd/$(APP_NAME)

# Docker构建
docker-build:
	docker build -t $(APP_NAME):$(VERSION) .

# 安装工具
tools:
	go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
```

---

### .gitignore

```
# Binaries
bin/
*.exe
*.exe~
*.dll
*.so
*.dylib

# Test
*.test
*.out
coverage.txt
coverage.html

# Build
dist/
build/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Config
.env
.env.*
!.env.example

# Logs
*.log
logs/
```

---

### README.md模板

```markdown
# Project Name

Brief description of your project.

## Features

- Feature 1
- Feature 2
- Feature 3

## Installation

```bash
go get github.com/username/project
```

## Usage

```go
package main

import "github.com/username/project"

func main() {
    // Example code
}
```

## Configuration

```yaml
# config.yaml
server:
  port: 8080
  host: localhost
```

## Development

```bash
# Clone repository
git clone https://github.com/username/project.git

# Install dependencies
go mod download

# Run tests
make test

# Build
make build
```

## License

MIT License
```

---

## 5. 最佳实践

### 1. 分层架构

```
Handler (HTTP) → Service (业务逻辑) → Repository (数据访问)
```

**示例**:
```go
// internal/handler/user.go
type UserHandler struct {
    userService *service.UserService
}

// internal/service/user.go
type UserService struct {
    userRepo *repository.UserRepository
}

// internal/repository/user.go
type UserRepository struct {
    db *sql.DB
}
```

---

### 2. 依赖注入

```go
// internal/server/server.go
type Server struct {
    db          *sql.DB
    userHandler *handler.UserHandler
}

func New() *Server {
    db := setupDB()
    
    userRepo := repository.NewUserRepository(db)
    userService := service.NewUserService(userRepo)
    userHandler := handler.NewUserHandler(userService)
    
    return &Server{
        db:          db,
        userHandler: userHandler,
    }
}
```

---

### 3. 配置管理

```go
// internal/config/config.go
type Config struct {
    Server   ServerConfig
    Database DatabaseConfig
}

type ServerConfig struct {
    Port string `yaml:"port"`
    Host string `yaml:"host"`
}

func Load(path string) (*Config, error) {
    data, err := os.ReadFile(path)
    if err != nil {
        return nil, err
    }
    
    var config Config
    if err := yaml.Unmarshal(data, &config); err != nil {
        return nil, err
    }
    
    return &config, nil
}
```

---

### 4. 错误处理

```go
// pkg/errors/errors.go
type AppError struct {
    Code    int
    Message string
    Err     error
}

func (e *AppError) Error() string {
    if e.Err != nil {
        return fmt.Sprintf("%s: %v", e.Message, e.Err)
    }
    return e.Message
}

// 预定义错误
var (
    ErrNotFound     = &AppError{Code: 404, Message: "not found"}
    ErrUnauthorized = &AppError{Code: 401, Message: "unauthorized"}
)
```

---

### 5. 日志记录

```go
// pkg/logger/logger.go
var log *slog.Logger

func Init(level string) {
    var logLevel slog.Level
    switch level {
    case "debug":
        logLevel = slog.LevelDebug
    case "info":
        logLevel = slog.LevelInfo
    default:
        logLevel = slog.LevelInfo
    }
    
    log = slog.New(slog.NewJSONHandler(os.Stdout, &slog.HandlerOptions{
        Level: logLevel,
    }))
}

func Info(msg string, args ...any) {
    log.Info(msg, args...)
}

func Error(msg string, args ...any) {
    log.Error(msg, args...)
}
```

---

## 🔗 相关资源

- [项目示例](../examples/README.md)
- [工程化实践](../../practices/engineering/README.md)
- [部署实践](../../practices/deployment/README.md)

---

**最后更新**: 2025-10-29  
**Go版本**: 1.25.3
