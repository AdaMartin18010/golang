# å¾®æœåŠ¡æ¨¡æ¿

**éš¾åº¦**: ä¸­çº§ | **é¢„è®¡é˜…è¯»**: 15åˆ†é’Ÿ

---

## ğŸ“‹ ç›®å½•


- [1. ğŸ“– å¾®æœåŠ¡æ¶æ„](#1--å¾®æœåŠ¡æ¶æ„)
- [ğŸ¯ æœåŠ¡å…¥å£](#-æœåŠ¡å…¥å£)
- [ğŸ³ Dockeré…ç½®](#-dockeré…ç½®)
- [â˜¸ï¸ K8séƒ¨ç½²](#-k8séƒ¨ç½²)
- [ğŸ“š ç›¸å…³èµ„æº](#-ç›¸å…³èµ„æº)

## 1. ğŸ“– å¾®æœåŠ¡æ¶æ„

```
microservice/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ service/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ handler/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ repository/
â”‚   â””â”€â”€ middleware/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ proto/
â”‚       â””â”€â”€ service.proto
â”œâ”€â”€ deployments/
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ k8s/
â”œâ”€â”€ go.mod
â””â”€â”€ Dockerfile
```

---

## ğŸ¯ æœåŠ¡å…¥å£

```go
package main

import (
    "context"
    "log"
    "net/http"
    "os"
    "os/signal"
    "syscall"
    "time"
)

func main() {
    // åŠ è½½é…ç½®
    cfg := config.Load()
    
    // åˆå§‹åŒ–ä¾èµ–
    db := initDB(cfg.DatabaseURL)
    defer db.Close()
    
    cache := initRedis(cfg.RedisURL)
    defer cache.Close()
    
    // åˆ›å»ºæœåŠ¡
    svc := service.New(db, cache)
    
    // HTTPæœåŠ¡å™¨
    srv := &http.Server{
        Addr:    ":8080",
        Handler: routes(svc),
    }
    
    // å¯åŠ¨æœåŠ¡å™¨
    go func() {
        log.Println("Server starting...")
        if err := srv.ListenAndServe(); err != http.ErrServerClosed {
            log.Fatal(err)
        }
    }()
    
    // ä¼˜é›…å…³é—­
    quit := make(chan os.Signal, 1)
    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
    <-quit
    
    log.Println("Shutting down...")
    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()
    
    if err := srv.Shutdown(ctx); err != nil {
        log.Fatal(err)
    }
    
    log.Println("Server stopped")
}
```

---

## ğŸ³ Dockeré…ç½®

```dockerfile
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY go.* ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 go build -o server cmd/service/main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/server .
EXPOSE 8080
CMD ["./server"]
```

---

## â˜¸ï¸ K8séƒ¨ç½²

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myservice
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myservice
  template:
    metadata:
      labels:
        app: myservice
    spec:
      containers:
      - name: myservice
        image: myservice:latest
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
---
apiVersion: v1
kind: Service
metadata:
  name: myservice
spec:
  selector:
    app: myservice
  ports:
  - port: 80
    targetPort: 8080
  type: LoadBalancer
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [Microservices Pattern](https://microservices.io/)

**ä¸‹ä¸€æ­¥**: [03-Webåº”ç”¨æ¨¡æ¿](./03-Webåº”ç”¨æ¨¡æ¿.md)

---

**æœ€åæ›´æ–°**: 2025-10-28

