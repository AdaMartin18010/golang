# Go 项目框架功能总览

**版本**: v1.0
**更新日期**: 2025-11-11
**适用于**: Go 1.25.3

---

## 📋 目录

- [Go 项目框架功能总览](#go-项目框架功能总览)
  - [📋 目录](#-目录)
  - [1. 概述](#1-概述)
    - [1.1 框架特点](#11-框架特点)
    - [1.2 技术栈](#12-技术栈)
  - [2. 核心框架](#2-核心框架)
    - [2.1 统一错误处理框架 (`pkg/errors`)](#21-统一错误处理框架-pkgerrors)
    - [2.2 统一响应格式框架 (`pkg/http/response`)](#22-统一响应格式框架-pkghttpresponse)
    - [2.3 结构化日志框架 (`pkg/logger`)](#23-结构化日志框架-pkglogger)
    - [2.4 请求验证框架 (`pkg/validator`)](#24-请求验证框架-pkgvalidator)
    - [2.5 JWT认证框架 (`pkg/auth/jwt`)](#25-jwt认证框架-pkgauthjwt)
  - [3. 中间件系统](#3-中间件系统)
    - [3.1 认证授权中间件](#31-认证授权中间件)
    - [3.2 限流中间件](#32-限流中间件)
    - [3.3 熔断器中间件](#33-熔断器中间件)
    - [3.4 请求追踪中间件](#34-请求追踪中间件)
    - [3.5 性能监控中间件](#35-性能监控中间件)
    - [3.6 恢复中间件](#36-恢复中间件)
    - [3.7 CORS中间件](#37-cors中间件)
  - [4. 服务治理](#4-服务治理)
    - [4.1 服务注册中心 (`pkg/registry`)](#41-服务注册中心-pkgregistry)
    - [4.2 负载均衡器 (`pkg/loadbalancer`)](#42-负载均衡器-pkgloadbalancer)
    - [4.3 健康检查框架 (`pkg/health`)](#43-健康检查框架-pkghealth)
  - [5. 高级功能](#5-高级功能)
    - [5.1 事务管理框架 (`pkg/transaction`)](#51-事务管理框架-pkgtransaction)
    - [5.2 事件总线框架 (`pkg/eventbus`)](#52-事件总线框架-pkgeventbus)
    - [5.3 RBAC权限控制 (`pkg/rbac`)](#53-rbac权限控制-pkgrbac)
  - [6. 工具库](#6-工具库)
    - [6.1 重试工具 (`pkg/utils/retry`)](#61-重试工具-pkgutilsretry)
    - [6.2 缓存工具 (`pkg/utils/cache`)](#62-缓存工具-pkgutilscache)
    - [6.3 字符串工具 (`pkg/utils/strings`)](#63-字符串工具-pkgutilsstrings)
    - [6.4 时间工具 (`pkg/utils/time`)](#64-时间工具-pkgutilstime)
    - [6.5 ID生成工具 (`pkg/utils/id`)](#65-id生成工具-pkgutilsid)
    - [6.6 加密工具 (`pkg/utils/crypto`)](#66-加密工具-pkgutilscrypto)
    - [6.7 JSON工具 (`pkg/utils/json`)](#67-json工具-pkgutilsjson)
    - [6.8 HTTP客户端工具 (`pkg/utils/httpclient`)](#68-http客户端工具-pkgutilshttpclient)
    - [6.9 文件操作工具 (`pkg/utils/file`)](#69-文件操作工具-pkgutilsfile)
  - [7. 使用场景](#7-使用场景)
    - [7.1 微服务开发](#71-微服务开发)
    - [7.2 API开发](#72-api开发)
    - [7.3 数据处理](#73-数据处理)
    - [7.4 安全开发](#74-安全开发)
  - [8. 相关资源](#8-相关资源)

---

## 1. 概述

本项目提供了一个完整的Go语言企业级开发框架，包含核心框架、中间件系统、服务治理、高级功能和丰富的工具库。

### 1.1 框架特点

- ✅ **开箱即用**: 提供完整的框架组件，无需从零开始
- ✅ **生产就绪**: 包含完整的中间件和服务治理支持
- ✅ **高度可扩展**: 清晰的架构和模块化设计
- ✅ **安全可靠**: 完整的认证授权和权限控制
- ✅ **易于使用**: 完整的使用指南和示例代码

### 1.2 技术栈

- **Go版本**: 1.25.3
- **架构模式**: Clean Architecture
- **HTTP框架**: Chi
- **认证**: JWT
- **追踪**: OpenTelemetry
- **日志**: slog

---

## 2. 核心框架

### 2.1 统一错误处理框架 (`pkg/errors`)

提供统一的错误处理机制，包括：

- 扩展错误代码定义（10+种错误类型）
- 错误分类系统（Client/Server/Business）
- 增强的AppError结构
- 详细信息、追踪ID、可重试标记支持
- HTTP状态码自动映射

**使用示例**:

```go
err := errors.NewNotFoundError("user", "123")
err.WithDetails("field", "value")
err.WithTraceID("trace-123")
```

### 2.2 统一响应格式框架 (`pkg/http/response`)

提供统一的HTTP响应格式：

- 标准响应结构
- 分页响应支持
- 元数据支持
- 追踪ID支持
- 错误处理框架集成

**使用示例**:

```go
response.Success(w, http.StatusOK, data)
response.Error(w, http.StatusNotFound, err)
response.Paginated(w, http.StatusOK, data, page, pageSize, total)
```

### 2.3 结构化日志框架 (`pkg/logger`)

基于slog的结构化日志：

- 配置支持（JSON/Text格式）
- 上下文支持（TraceID、SpanID、UserID）
- 请求日志记录
- 错误日志记录

**使用示例**:

```go
log := logger.NewLogger(slog.LevelInfo)
log.WithContext(ctx).Info("Processing request")
log.LogRequest(ctx, "GET", "/users", 200, duration)
```

### 2.4 请求验证框架 (`pkg/validator`)

提供请求参数验证：

- 结构体标签验证
- 多种验证规则（required、min、max、email、url、uuid等）
- ValidationError类型
- 字段验证功能

**使用示例**:

```go
validator := validator.NewValidator()
if !validator.Validate(req) {
    validationErrors := validator.ValidateStruct(req)
}
```

### 2.5 JWT认证框架 (`pkg/auth/jwt`)

JWT Token认证：

- Access Token和Refresh Token生成
- Token验证和刷新
- 支持HMAC和RSA签名算法
- Claims扩展支持

**使用示例**:

```go
j, _ := jwt.NewJWT(jwt.Config{...})
token, _ := j.GenerateAccessToken("user-123", "john", []string{"user"}, "john@example.com")
claims, _ := j.ValidateToken(token)
```

---

## 3. 中间件系统

### 3.1 认证授权中间件

- JWT Token验证
- 用户信息注入到Context
- 角色权限验证（RequireRole、RequireAnyRole、RequireAllRoles）
- 可选认证支持
- 路径跳过支持

### 3.2 限流中间件

- 令牌桶算法实现
- 基于IP的限流
- 自定义限流键支持
- 路径跳过支持

### 3.3 熔断器中间件

- 三种状态（关闭、开启、半开）
- 失败阈值和成功阈值配置
- 自动恢复机制
- 状态变更回调

### 3.4 请求追踪中间件

- OpenTelemetry集成
- 自动提取和传播追踪上下文
- 请求和响应属性记录
- 追踪ID注入到响应头

### 3.5 性能监控中间件

- 请求计数统计
- 请求耗时统计
- 错误计数统计
- 活跃请求数统计
- 性能指标响应头

### 3.6 恢复中间件

- Panic恢复
- 堆栈信息记录
- 错误响应格式化
- 可配置堆栈大小

### 3.7 CORS中间件

- 可配置的允许源
- 支持预检请求
- 凭证支持
- 自定义请求头和响应头

---

## 4. 服务治理

### 4.1 服务注册中心 (`pkg/registry`)

- 服务注册和注销
- 服务发现
- 服务监听（Watch）
- 健康检查
- 过期服务自动清理

### 4.2 负载均衡器 (`pkg/loadbalancer`)

- 轮询算法（Round Robin）
- 随机算法（Random）
- 加权轮询算法（Weighted Round Robin）
- 最少连接算法（Least Connections）
- 服务选择器（与服务注册中心集成）

### 4.3 健康检查框架 (`pkg/health`)

- 多种检查类型（简单、超时、定期、聚合）
- 健康状态管理（健康、不健康、降级）
- 检查结果缓存
- 检查聚合

---

## 5. 高级功能

### 5.1 事务管理框架 (`pkg/transaction`)

- 统一事务接口
- SQL事务管理器
- Context集成
- 自动回滚支持

### 5.2 事件总线框架 (`pkg/eventbus`)

- 发布订阅模式
- 事件过滤支持
- 异步事件处理
- 指标统计

### 5.3 RBAC权限控制 (`pkg/rbac`)

- 角色管理
- 权限管理
- 权限分配
- 权限检查
- Context集成

---

## 6. 工具库

### 6.1 重试工具 (`pkg/utils/retry`)

- 指数退避策略
- 线性退避策略
- 固定延迟策略
- Context支持
- 回调支持

### 6.2 缓存工具 (`pkg/utils/cache`)

- 内存缓存实现
- TTL支持
- 自动清理过期项
- 线程安全
- GetOrSet模式

### 6.3 字符串工具 (`pkg/utils/strings`)

- 基础操作（截断、反转、填充等）
- 包含检查
- 命名转换（驼峰/蛇形）
- 掩码处理（邮箱、手机号等）
- 随机生成

### 6.4 时间工具 (`pkg/utils/time`)

- 时间戳获取（秒、毫秒、微秒、纳秒）
- 时间格式化和解析
- 时间计算（添加天数、月数、年数）
- 时间范围（开始/结束时间）
- 时间比较和判断
- 人性化显示

### 6.5 ID生成工具 (`pkg/utils/id`)

- UUID生成（标准UUID、短UUID）
- NanoID生成（高性能短ID）
- 雪花ID生成（分布式唯一ID）
- 时间戳ID生成
- 随机ID生成（十六进制、Base64）
- 顺序ID生成

### 6.6 加密工具 (`pkg/utils/crypto`)

- 密码哈希（bcrypt）
- AES加密（AES-256-GCM）
- 密钥生成
- 哈希函数（SHA256）
- HMAC计算
- 密钥派生（PBKDF2）

### 6.7 JSON工具 (`pkg/utils/json`)

- 基础操作（序列化、反序列化、美化打印）
- 验证和检查
- 路径操作（Get、Set）
- 合并和转换
- 扁平化操作
- 文件操作
- 流操作

### 6.8 HTTP客户端工具 (`pkg/utils/httpclient`)

- GET、POST、PUT、DELETE、PATCH请求支持
- 请求参数和查询参数支持
- 请求头管理
- 超时控制
- Context支持
- JSON响应解析

### 6.9 文件操作工具 (`pkg/utils/file`)

- 文件检查（存在、类型判断）
- 文件读写（读取、写入、追加、行操作）
- 文件操作（复制、移动、删除）
- 目录操作（创建、列出、遍历）
- 路径操作（扩展名、文件名、路径连接等）
- 文件信息（大小、权限等）

---

## 7. 使用场景

### 7.1 微服务开发

- 使用服务注册中心进行服务发现
- 使用负载均衡器进行请求分发
- 使用健康检查框架监控服务状态
- 使用事件总线进行服务间通信

### 7.2 API开发

- 使用统一错误处理和响应格式
- 使用请求验证框架验证输入
- 使用JWT认证框架进行身份验证
- 使用中间件系统提供横切关注点支持

### 7.3 数据处理

- 使用事务管理框架保证数据一致性
- 使用缓存工具提升性能
- 使用重试工具处理临时失败
- 使用JSON工具处理数据转换

### 7.4 安全开发

- 使用加密工具保护敏感数据
- 使用RBAC权限控制进行访问控制
- 使用JWT认证框架进行身份验证
- 使用掩码工具保护隐私信息

---

## 8. 相关资源

- [框架使用指南](./00-框架使用指南.md)
- [框架拓展计划](./00-框架拓展计划.md)
- [框架拓展进度报告](./00-框架拓展进度报告.md)
- [框架集成总结](./00-框架集成总结.md)

---

**更新日期**: 2025-11-11
