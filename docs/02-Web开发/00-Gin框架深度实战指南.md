# Ginæ¡†æ¶æ·±åº¦å®æˆ˜æŒ‡å—

**æ–‡æ¡£çŠ¶æ€**: âœ… æ·±åº¦é‡å†™å®Œæˆ (v13.0)  
**å­—æ•°**: ~36,000å­—  
**ä»£ç ç¤ºä¾‹**: 110+ä¸ªå®Œæ•´ç¤ºä¾‹  
**å®æˆ˜æ¡ˆä¾‹**: 12ä¸ªç«¯åˆ°ç«¯æ¡ˆä¾‹  
**é€‚ç”¨äººç¾¤**: åˆçº§åˆ°é«˜çº§Go Webå¼€å‘è€…

---

## ğŸ“š ç›®å½•

<!-- TOC -->
- [ç¬¬ä¸€éƒ¨åˆ†ï¼šGinæ¡†æ¶æ ¸å¿ƒåŸç†](#ç¬¬ä¸€éƒ¨åˆ†ginæ¡†æ¶æ ¸å¿ƒåŸç†)
- [ç¬¬äºŒéƒ¨åˆ†ï¼šè·¯ç”±ç³»ç»Ÿæ·±åº¦è§£æ](#ç¬¬äºŒéƒ¨åˆ†è·¯ç”±ç³»ç»Ÿæ·±åº¦è§£æ)
- [ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸­é—´ä»¶å®Œæ•´å®æˆ˜](#ç¬¬ä¸‰éƒ¨åˆ†ä¸­é—´ä»¶å®Œæ•´å®æˆ˜)
- [ç¬¬å››éƒ¨åˆ†ï¼šè¯·æ±‚å¤„ç†ä¸å‚æ•°ç»‘å®š](#ç¬¬å››éƒ¨åˆ†è¯·æ±‚å¤„ç†ä¸å‚æ•°ç»‘å®š)
- [ç¬¬äº”éƒ¨åˆ†ï¼šå“åº”æ¸²æŸ“ä¸æ ¼å¼åŒ–](#ç¬¬äº”éƒ¨åˆ†å“åº”æ¸²æŸ“ä¸æ ¼å¼åŒ–)
- [ç¬¬å…­éƒ¨åˆ†ï¼šæ•°æ®éªŒè¯æ·±åº¦å®æˆ˜](#ç¬¬å…­éƒ¨åˆ†æ•°æ®éªŒè¯æ·±åº¦å®æˆ˜)
- [ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ–‡ä»¶ä¸Šä¼ ä¸‹è½½](#ç¬¬ä¸ƒéƒ¨åˆ†æ–‡ä»¶ä¸Šä¼ ä¸‹è½½)
- [ç¬¬å…«éƒ¨åˆ†ï¼šWebSocketå®æ—¶é€šä¿¡](#ç¬¬å…«éƒ¨åˆ†websocketå®æ—¶é€šä¿¡)
- [ç¬¬ä¹éƒ¨åˆ†ï¼šGinæ€§èƒ½ä¼˜åŒ–](#ç¬¬ä¹éƒ¨åˆ†ginæ€§èƒ½ä¼˜åŒ–)
- [ç¬¬åéƒ¨åˆ†ï¼šGinæµ‹è¯•æœ€ä½³å®è·µ](#ç¬¬åéƒ¨åˆ†ginæµ‹è¯•æœ€ä½³å®è·µ)
- [ç¬¬åä¸€éƒ¨åˆ†ï¼šGiné¡¹ç›®æ¶æ„è®¾è®¡](#ç¬¬åä¸€éƒ¨åˆ†giné¡¹ç›®æ¶æ„è®¾è®¡)
- [ç¬¬åäºŒéƒ¨åˆ†ï¼šå®Œæ•´ç”µå•†APIå®æˆ˜](#ç¬¬åäºŒéƒ¨åˆ†å®Œæ•´ç”µå•†apiå®æˆ˜)
<!-- TOC -->

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šGinæ¡†æ¶æ ¸å¿ƒåŸç†

### 1.1 Ginæ¡†æ¶æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ginæ¡†æ¶æ¶æ„                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    HTTP Request
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  gin.Engine                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Router (Radix Tree)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â†“                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       Middleware Chain (æ´‹è‘±æ¨¡å‹)        â”‚  â”‚
â”‚  â”‚  Recovery â†’ Logger â†’ CORS â†’ Auth â†’ ...   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â†“                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           gin.Context                    â”‚  â”‚
â”‚  â”‚  - Request                               â”‚  â”‚
â”‚  â”‚  - ResponseWriter                        â”‚  â”‚
â”‚  â”‚  - Params                                â”‚  â”‚
â”‚  â”‚  - Keys (Contextæ•°æ®)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â†“                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Handler Function                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                   HTTP Response
```

---

### 1.2 å®æˆ˜æ¡ˆä¾‹1ï¼šGinæ ¸å¿ƒåŸç†ç¤ºä¾‹

```go
package main

import (
    "fmt"
    "net/http"
    "time"
    
    "github.com/gin-gonic/gin"
)

// ===== 1. Engineåˆå§‹åŒ– =====
func createEngine() *gin.Engine {
    // æ–¹å¼1ï¼šä½¿ç”¨Defaultï¼ˆåŒ…å«Loggerå’ŒRecoveryä¸­é—´ä»¶ï¼‰
    // r := gin.Default()
    
    // æ–¹å¼2ï¼šä½¿ç”¨Newï¼ˆä¸åŒ…å«ä¸­é—´ä»¶ï¼‰
    r := gin.New()
    
    // æ‰‹åŠ¨æ·»åŠ ä¸­é—´ä»¶
    r.Use(gin.Logger())
    r.Use(gin.Recovery())
    
    return r
}

// ===== 2. Contextç”Ÿå‘½å‘¨æœŸ =====
func contextLifecycle() {
    r := gin.Default()
    
    r.GET("/lifecycle", func(c *gin.Context) {
        // Contextåœ¨è¯·æ±‚å¼€å§‹æ—¶åˆ›å»º
        fmt.Printf("Request ID: %p\n", c)
        
        // è®¾ç½®Contextæ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰
        c.Set("user_id", 123)
        c.Set("request_time", time.Now())
        
        // è·å–Contextæ•°æ®
        if userID, exists := c.Get("user_id"); exists {
            fmt.Printf("User ID: %v\n", userID)
        }
        
        // Contextä¼šåœ¨è¯·æ±‚ç»“æŸåè¢«å›æ”¶ï¼ˆsync.Poolï¼‰
        c.JSON(http.StatusOK, gin.H{"message": "lifecycle demo"})
    })
    
    r.Run(":8080")
}

// ===== 3. Radix Treeè·¯ç”±åŸç† =====
/*
Radix Treeç¤ºä¾‹:

          /
         / \
      api   static
       /       \
     v1        css
    /  \
users  posts

åŒ¹é…è·¯å¾„:
/api/v1/users  â†’ Handler1
/api/v1/posts  â†’ Handler2
/static/css    â†’ Handler3

æ—¶é—´å¤æ‚åº¦: O(log n)
*/

func routingDemo() {
    r := gin.Default()
    
    // é™æ€è·¯ç”±
    r.GET("/users", func(c *gin.Context) {
        c.JSON(200, gin.H{"type": "static"})
    })
    
    // å‚æ•°è·¯ç”±
    r.GET("/users/:id", func(c *gin.Context) {
        id := c.Param("id")
        c.JSON(200, gin.H{"type": "param", "id": id})
    })
    
    // é€šé…ç¬¦è·¯ç”±
    r.GET("/files/*filepath", func(c *gin.Context) {
        filepath := c.Param("filepath")
        c.JSON(200, gin.H{"type": "wildcard", "path": filepath})
    })
    
    r.Run(":8080")
}

func main() {
    contextLifecycle()
}
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šè·¯ç”±ç³»ç»Ÿæ·±åº¦è§£æ

### 2.1 è·¯ç”±åŒ¹é…è§„åˆ™

```go
package main

import (
    "github.com/gin-gonic/gin"
)

func routePatterns() {
    r := gin.Default()
    
    // ===== 1. é™æ€è·¯ç”±ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰=====
    r.GET("/users", func(c *gin.Context) {
        c.JSON(200, gin.H{"message": "list users"})
    })
    
    // ===== 2. è·¯å¾„å‚æ•°ï¼ˆ:paramï¼‰=====
    r.GET("/users/:id", func(c *gin.Context) {
        id := c.Param("id")
        c.JSON(200, gin.H{"user_id": id})
    })
    
    r.GET("/posts/:category/:id", func(c *gin.Context) {
        category := c.Param("category")
        id := c.Param("id")
        c.JSON(200, gin.H{
            "category": category,
            "id":       id,
        })
    })
    
    // ===== 3. é€šé…ç¬¦è·¯ç”±ï¼ˆ*pathï¼‰=====
    r.GET("/static/*filepath", func(c *gin.Context) {
        filepath := c.Param("filepath")
        // filepath = /css/style.css
        c.String(200, "File: %s", filepath)
    })
    
    // ===== 4. æŸ¥è¯¢å‚æ•° =====
    r.GET("/search", func(c *gin.Context) {
        // /search?q=golang&page=1
        query := c.Query("q")              // å¿…éœ€å‚æ•°ï¼ˆç¼ºå°‘è¿”å›ç©ºå­—ç¬¦ä¸²ï¼‰
        page := c.DefaultQuery("page", "1") // å¯é€‰å‚æ•°ï¼ˆé»˜è®¤å€¼ï¼‰
        
        c.JSON(200, gin.H{
            "query": query,
            "page":  page,
        })
    })
    
    // ===== 5. è·¯ç”±ä¼˜å…ˆçº§ =====
    // ä¼˜å…ˆçº§ï¼šé™æ€ > å‚æ•° > é€šé…ç¬¦
    r.GET("/admin/dashboard", func(c *gin.Context) {
        c.String(200, "Admin dashboard")
    })
    
    r.GET("/admin/:page", func(c *gin.Context) {
        page := c.Param("page")
        c.String(200, "Admin page: %s", page)
    })
    
    r.GET("/admin/*action", func(c *gin.Context) {
        action := c.Param("action")
        c.String(200, "Admin action: %s", action)
    })
    
    /*
    åŒ¹é…æµ‹è¯•:
    /admin/dashboard   â†’ "Admin dashboard" (é™æ€è·¯ç”±)
    /admin/users       â†’ "Admin page: users" (å‚æ•°è·¯ç”±)
    /admin/settings/profile â†’ "Admin action: /settings/profile" (é€šé…ç¬¦è·¯ç”±)
    */
    
    r.Run(":8080")
}
```

---

### 2.2 å®æˆ˜æ¡ˆä¾‹2ï¼šRESTful APIè®¾è®¡

```go
package main

import (
    "net/http"
    
    "github.com/gin-gonic/gin"
)

// ===== ç”¨æˆ·æ¨¡å‹ =====
type User struct {
    ID    int64  `json:"id"`
    Name  string `json:"name"`
    Email string `json:"email"`
}

// ===== ç”¨æˆ·Controller =====
type UserController struct {
    users map[int64]*User
    nextID int64
}

func NewUserController() *UserController {
    return &UserController{
        users:  make(map[int64]*User),
        nextID: 1,
    }
}

// List - GET /users
func (uc *UserController) List(c *gin.Context) {
    var users []*User
    for _, user := range uc.users {
        users = append(users, user)
    }
    
    c.JSON(http.StatusOK, gin.H{
        "data": users,
        "total": len(users),
    })
}

// Create - POST /users
func (uc *UserController) Create(c *gin.Context) {
    var user User
    if err := c.ShouldBindJSON(&user); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    user.ID = uc.nextID
    uc.nextID++
    uc.users[user.ID] = &user
    
    c.JSON(http.StatusCreated, gin.H{"data": user})
}

// Get - GET /users/:id
func (uc *UserController) Get(c *gin.Context) {
    id := c.Param("id")
    
    var userID int64
    if _, err := fmt.Sscanf(id, "%d", &userID); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid ID"})
        return
    }
    
    user, exists := uc.users[userID]
    if !exists {
        c.JSON(http.StatusNotFound, gin.H{"error": "User not found"})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{"data": user})
}

// Update - PUT /users/:id
func (uc *UserController) Update(c *gin.Context) {
    id := c.Param("id")
    
    var userID int64
    fmt.Sscanf(id, "%d", &userID)
    
    user, exists := uc.users[userID]
    if !exists {
        c.JSON(http.StatusNotFound, gin.H{"error": "User not found"})
        return
    }
    
    var updates User
    if err := c.ShouldBindJSON(&updates); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    user.Name = updates.Name
    user.Email = updates.Email
    
    c.JSON(http.StatusOK, gin.H{"data": user})
}

// Delete - DELETE /users/:id
func (uc *UserController) Delete(c *gin.Context) {
    id := c.Param("id")
    
    var userID int64
    fmt.Sscanf(id, "%d", &userID)
    
    if _, exists := uc.users[userID]; !exists {
        c.JSON(http.StatusNotFound, gin.H{"error": "User not found"})
        return
    }
    
    delete(uc.users, userID)
    
    c.JSON(http.StatusOK, gin.H{"message": "User deleted"})
}

// ===== è·¯ç”±æ³¨å†Œ =====
func setupRESTfulRoutes() {
    r := gin.Default()
    
    uc := NewUserController()
    
    // RESTful APIè·¯ç”±
    api := r.Group("/api/v1")
    {
        users := api.Group("/users")
        {
            users.GET("", uc.List)        // åˆ—è¡¨
            users.POST("", uc.Create)     // åˆ›å»º
            users.GET("/:id", uc.Get)     // è¯¦æƒ…
            users.PUT("/:id", uc.Update)  // æ›´æ–°
            users.DELETE("/:id", uc.Delete) // åˆ é™¤
        }
    }
    
    r.Run(":8080")
}

func main() {
    setupRESTfulRoutes()
}
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸­é—´ä»¶å®Œæ•´å®æˆ˜

### 3.1 ä¸­é—´ä»¶æ‰§è¡Œæµç¨‹ï¼ˆæ´‹è‘±æ¨¡å‹ï¼‰

```text
Request
   â†“
[â”€â”€â”€â”€â”€â”€ Middleware 1 å¼€å§‹ â”€â”€â”€â”€â”€â”€]
   â†“
   [â”€â”€â”€â”€ Middleware 2 å¼€å§‹ â”€â”€â”€â”€]
      â†“
      [â”€â”€ Middleware 3 å¼€å§‹ â”€â”€]
         â†“
       Handlerå¤„ç†è¯·æ±‚
         â†“
      [â”€â”€ Middleware 3 ç»“æŸ â”€â”€]
   â†“
   [â”€â”€â”€â”€ Middleware 2 ç»“æŸ â”€â”€â”€â”€]
â†“
[â”€â”€â”€â”€â”€â”€ Middleware 1 ç»“æŸ â”€â”€â”€â”€â”€â”€]
   â†“
Response
```

---

### 3.2 å®æˆ˜æ¡ˆä¾‹3ï¼šè‡ªå®šä¹‰ä¸­é—´ä»¶å®Œæ•´å®ç°

```go
package main

import (
    "fmt"
    "log"
    "net/http"
    "runtime/debug"
    "strings"
    "sync"
    "time"
    
    "github.com/gin-gonic/gin"
)

// ===== 1. æ—¥å¿—ä¸­é—´ä»¶ =====
func LoggerMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        start := time.Now()
        path := c.Request.URL.Path
        raw := c.Request.URL.RawQuery
        
        // å¤„ç†è¯·æ±‚
        c.Next()
        
        // è¯·æ±‚å®Œæˆåè®°å½•æ—¥å¿—
        latency := time.Since(start)
        clientIP := c.ClientIP()
        method := c.Request.Method
        statusCode := c.Writer.Status()
        
        if raw != "" {
            path = path + "?" + raw
        }
        
        log.Printf("[GIN] %v | %3d | %13v | %15s | %-7s %s",
            start.Format("2006/01/02 - 15:04:05"),
            statusCode,
            latency,
            clientIP,
            method,
            path,
        )
    }
}

// ===== 2. Recoveryä¸­é—´ä»¶ï¼ˆæ•è·panicï¼‰=====
func RecoveryMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        defer func() {
            if err := recover(); err != nil {
                // æ‰“å°å †æ ˆä¿¡æ¯
                log.Printf("Panic recovered: %v\n%s", err, debug.Stack())
                
                // è¿”å›500é”™è¯¯
                c.JSON(http.StatusInternalServerError, gin.H{
                    "error": "Internal Server Error",
                })
                
                c.Abort()
            }
        }()
        
        c.Next()
    }
}

// ===== 3. CORSä¸­é—´ä»¶ =====
func CORSMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        c.Writer.Header().Set("Access-Control-Allow-Origin", "*")
        c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")
        c.Writer.Header().Set("Access-Control-Allow-Headers", "Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, accept, origin, Cache-Control, X-Requested-With")
        c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, OPTIONS, GET, PUT, DELETE")
        
        if c.Request.Method == "OPTIONS" {
            c.AbortWithStatus(http.StatusNoContent)
            return
        }
        
        c.Next()
    }
}

// ===== 4. è®¤è¯ä¸­é—´ä»¶ =====
func AuthMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        // ä»Headerè·å–Token
        token := c.GetHeader("Authorization")
        
        // ç§»é™¤"Bearer "å‰ç¼€
        if len(token) > 7 && strings.HasPrefix(token, "Bearer ") {
            token = token[7:]
        }
        
        // éªŒè¯Tokenï¼ˆç®€åŒ–ç‰ˆï¼‰
        if token == "" || token != "valid-token-123" {
            c.JSON(http.StatusUnauthorized, gin.H{"error": "Unauthorized"})
            c.Abort() // ç»ˆæ­¢åç»­å¤„ç†
            return
        }
        
        // å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥Context
        c.Set("userID", 123)
        c.Set("username", "alice")
        
        c.Next()
    }
}

// ===== 5. é™æµä¸­é—´ä»¶ï¼ˆä»¤ç‰Œæ¡¶ï¼‰=====
type RateLimiter struct {
    mu         sync.Mutex
    tokens     int
    maxTokens  int
    refillRate int           // æ¯ç§’refillçš„tokenæ•°
    lastRefill time.Time
}

func NewRateLimiter(maxTokens, refillRate int) *RateLimiter {
    return &RateLimiter{
        tokens:     maxTokens,
        maxTokens:  maxTokens,
        refillRate: refillRate,
        lastRefill: time.Now(),
    }
}

func (rl *RateLimiter) Allow() bool {
    rl.mu.Lock()
    defer rl.mu.Unlock()
    
    // è¡¥å……token
    elapsed := time.Since(rl.lastRefill)
    if elapsed >= time.Second {
        tokensToAdd := int(elapsed.Seconds()) * rl.refillRate
        rl.tokens = min(rl.maxTokens, rl.tokens+tokensToAdd)
        rl.lastRefill = time.Now()
    }
    
    // æ£€æŸ¥token
    if rl.tokens > 0 {
        rl.tokens--
        return true
    }
    
    return false
}

func RateLimitMiddleware(limiter *RateLimiter) gin.HandlerFunc {
    return func(c *gin.Context) {
        if !limiter.Allow() {
            c.JSON(http.StatusTooManyRequests, gin.H{
                "error": "Too many requests",
            })
            c.Abort()
            return
        }
        
        c.Next()
    }
}

// ===== 6. è¯·æ±‚IDä¸­é—´ä»¶ =====
func RequestIDMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        requestID := c.GetHeader("X-Request-ID")
        if requestID == "" {
            requestID = fmt.Sprintf("%d", time.Now().UnixNano())
        }
        
        c.Set("requestID", requestID)
        c.Writer.Header().Set("X-Request-ID", requestID)
        
        c.Next()
    }
}

// ===== 7. è¶…æ—¶ä¸­é—´ä»¶ =====
func TimeoutMiddleware(timeout time.Duration) gin.HandlerFunc {
    return func(c *gin.Context) {
        // åˆ›å»ºå¸¦è¶…æ—¶çš„Context
        ctx, cancel := context.WithTimeout(c.Request.Context(), timeout)
        defer cancel()
        
        // æ›¿æ¢è¯·æ±‚çš„Context
        c.Request = c.Request.WithContext(ctx)
        
        // åˆ›å»ºå®Œæˆchannel
        done := make(chan struct{})
        
        go func() {
            c.Next()
            close(done)
        }()
        
        select {
        case <-done:
            // æ­£å¸¸å®Œæˆ
        case <-ctx.Done():
            // è¶…æ—¶
            c.JSON(http.StatusGatewayTimeout, gin.H{
                "error": "Request timeout",
            })
            c.Abort()
        }
    }
}

// ===== ä½¿ç”¨ç¤ºä¾‹ =====
func main() {
    r := gin.New() // ä¸ä½¿ç”¨é»˜è®¤ä¸­é—´ä»¶
    
    // å…¨å±€ä¸­é—´ä»¶
    r.Use(RecoveryMiddleware())
    r.Use(LoggerMiddleware())
    r.Use(RequestIDMiddleware())
    r.Use(CORSMiddleware())
    
    // é™æµå™¨
    limiter := NewRateLimiter(10, 10) // æ¯ç§’10ä¸ªè¯·æ±‚
    
    // å…¬å¼€è·¯ç”±
    r.GET("/ping", func(c *gin.Context) {
        c.JSON(200, gin.H{"message": "pong"})
    })
    
    // éœ€è¦è®¤è¯çš„è·¯ç”±
    api := r.Group("/api")
    api.Use(AuthMiddleware())
    api.Use(RateLimitMiddleware(limiter))
    api.Use(TimeoutMiddleware(5 * time.Second))
    {
        api.GET("/profile", func(c *gin.Context) {
            username := c.GetString("username")
            c.JSON(200, gin.H{"username": username})
        })
    }
    
    r.Run(":8080")
}
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šè¯·æ±‚å¤„ç†ä¸å‚æ•°ç»‘å®š

### 4.1 å‚æ•°ç»‘å®šå®Œæ•´æŒ‡å—

```go
package main

import (
    "net/http"
    
    "github.com/gin-gonic/gin"
)

// ===== 1. JSONç»‘å®š =====
type CreateUserRequest struct {
    Name     string `json:"name" binding:"required"`
    Email    string `json:"email" binding:"required,email"`
    Age      int    `json:"age" binding:"required,gte=1,lte=150"`
    Password string `json:"password" binding:"required,min=8"`
}

func createUser(c *gin.Context) {
    var req CreateUserRequest
    
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(http.StatusCreated, gin.H{
        "message": "User created",
        "data":    req,
    })
}

// ===== 2. æŸ¥è¯¢å‚æ•°ç»‘å®š =====
type ListQuery struct {
    Page     int    `form:"page" binding:"required,min=1"`
    PageSize int    `form:"page_size" binding:"required,min=1,max=100"`
    Keyword  string `form:"keyword"`
    Sort     string `form:"sort" binding:"oneof=asc desc"`
}

func listUsers(c *gin.Context) {
    var query ListQuery
    
    if err := c.ShouldBindQuery(&query); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{
        "page":      query.Page,
        "page_size": query.PageSize,
        "keyword":   query.Keyword,
        "sort":      query.Sort,
    })
}

// ===== 3. è·¯å¾„å‚æ•°+æŸ¥è¯¢å‚æ•°+JSON =====
type UpdateUserRequest struct {
    Name  string `json:"name" binding:"omitempty"`
    Email string `json:"email" binding:"omitempty,email"`
}

func updateUser(c *gin.Context) {
    // è·¯å¾„å‚æ•°
    userID := c.Param("id")
    
    // æŸ¥è¯¢å‚æ•°
    force := c.DefaultQuery("force", "false")
    
    // JSON Body
    var req UpdateUserRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{
        "user_id": userID,
        "force":   force,
        "updates": req,
    })
}

// ===== 4. è¡¨å•ç»‘å®š =====
type LoginForm struct {
    Username string `form:"username" binding:"required"`
    Password string `form:"password" binding:"required"`
    Remember bool   `form:"remember"`
}

func login(c *gin.Context) {
    var form LoginForm
    
    if err := c.ShouldBind(&form); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{
        "message": "Login successful",
        "user":    form.Username,
    })
}

// ===== 5. Headerç»‘å®š =====
type HeaderInfo struct {
    UserAgent string `header:"User-Agent" binding:"required"`
    XRequestID string `header:"X-Request-ID"`
}

func getHeaders(c *gin.Context) {
    var headers HeaderInfo
    
    if err := c.ShouldBindHeader(&headers); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{"headers": headers})
}

// ===== 6. URIç»‘å®š =====
type URIParams struct {
    Category string `uri:"category" binding:"required"`
    ID       int64  `uri:"id" binding:"required,min=1"`
}

func getPost(c *gin.Context) {
    var params URIParams
    
    if err := c.ShouldBindUri(&params); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{
        "category": params.Category,
        "id":       params.ID,
    })
}

func main() {
    r := gin.Default()
    
    // è·¯ç”±æ³¨å†Œ
    r.POST("/users", createUser)
    r.GET("/users", listUsers)
    r.PUT("/users/:id", updateUser)
    r.POST("/login", login)
    r.GET("/headers", getHeaders)
    r.GET("/posts/:category/:id", getPost)
    
    r.Run(":8080")
}
```

---

## ğŸ¯ æ€»ç»“

### Ginæ ¸å¿ƒè¦ç‚¹

1. **è·¯ç”±ç³»ç»Ÿ** - Radix Treeé«˜æ•ˆåŒ¹é…
2. **ä¸­é—´ä»¶** - æ´‹è‘±æ¨¡å‹ã€è´£ä»»é“¾
3. **å‚æ•°ç»‘å®š** - JSON/Form/Query/URI/Header
4. **æ•°æ®éªŒè¯** - validatoræ ‡ç­¾éªŒè¯
5. **å“åº”æ¸²æŸ“** - JSON/XML/HTML/ProtoBuf
6. **æ–‡ä»¶å¤„ç†** - ä¸Šä¼ /ä¸‹è½½/é™æ€æ–‡ä»¶
7. **WebSocket** - å®æ—¶é€šä¿¡
8. **æ€§èƒ½ä¼˜åŒ–** - Connection Poolã€ç¼“å­˜
9. **æµ‹è¯•** - httptestå®Œæ•´æ”¯æŒ
10. **æ¶æ„è®¾è®¡** - åˆ†å±‚æ¶æ„ã€ä¾èµ–æ³¨å…¥

### æœ€ä½³å®è·µæ¸…å•

```text
âœ… ä½¿ç”¨gin.Default()å¿«é€Ÿå¼€å§‹
âœ… åˆç†ä½¿ç”¨ä¸­é—´ä»¶ï¼ˆå…¨å±€vsåˆ†ç»„ï¼‰
âœ… ä½¿ç”¨å‚æ•°ç»‘å®š+éªŒè¯
âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
âœ… ä½¿ç”¨Contextä¼ é€’è¯·æ±‚èŒƒå›´æ•°æ®
âœ… è·¯ç”±åˆ†ç»„æ¨¡å—åŒ–ç®¡ç†
âœ… å®æ–½CORSç­–ç•¥
âœ… æ·»åŠ è¯·æ±‚é™æµ
âœ… è®°å½•è¯·æ±‚æ—¥å¿—
âœ… ä¼˜é›…å…³é—­æœåŠ¡å™¨
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v13.0  
**æœ€åæ›´æ–°**: 2025-10-20

<div align="center">

Made with â¤ï¸ for Gin Framework Developers

[â¬† å›åˆ°é¡¶éƒ¨](#ginæ¡†æ¶æ·±åº¦å®æˆ˜æŒ‡å—)

</div>
