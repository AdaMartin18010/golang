# ğŸ“š æœ€ä½³å®è·µæŒ‡å—

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-25  
**æ–‡æ¡£ç±»å‹**: æœ€ä½³å®è·µæŒ‡å—

---

<div align="center">

## ğŸ¯ ç»è¿‡éªŒè¯çš„æœ€ä½³å®è·µ

**ä»£ç è´¨é‡** | **æ€§èƒ½ä¼˜åŒ–** | **å½¢å¼åŒ–éªŒè¯** | **å¹¶å‘å®‰å…¨**

åŸºäº2,765+ç¤ºä¾‹å’Œ545+è¯æ˜çš„å®æˆ˜ç»éªŒæ€»ç»“ï¼

</div>

---

## ğŸ“‹ ç›®å½•

1. [ä»£ç ç¼–å†™æœ€ä½³å®è·µ](#-ä»£ç ç¼–å†™æœ€ä½³å®è·µ)
2. [å½¢å¼åŒ–éªŒè¯æœ€ä½³å®è·µ](#-å½¢å¼åŒ–éªŒè¯æœ€ä½³å®è·µ)
3. [å¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ](#-å¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ)
4. [æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](#-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ)
5. [å·¥å…·ä½¿ç”¨æœ€ä½³å®è·µ](#-å·¥å…·ä½¿ç”¨æœ€ä½³å®è·µ)
6. [CI/CDé›†æˆæœ€ä½³å®è·µ](#-cicdé›†æˆæœ€ä½³å®è·µ)
7. [å›¢é˜Ÿåä½œæœ€ä½³å®è·µ](#-å›¢é˜Ÿåä½œæœ€ä½³å®è·µ)

---

## ğŸ’» ä»£ç ç¼–å†™æœ€ä½³å®è·µ

### 1. ç±»å‹å®‰å…¨ç¼–ç 

#### âœ… DO: ä½¿ç”¨æ˜ç¡®çš„ç±»å‹

```go
// å¥½: æ˜ç¡®çš„ç±»å‹å®šä¹‰
type UserID int64
type OrderID int64

func ProcessOrder(userID UserID, orderID OrderID) error {
    // ç±»å‹ç³»ç»Ÿé˜²æ­¢æ··æ·†
    return nil
}
```

#### âŒ DON'T: ä½¿ç”¨è£¸ç±»å‹

```go
// ä¸å¥½: å®¹æ˜“æ··æ·†
func ProcessOrder(userID int64, orderID int64) error {
    // userIDå’ŒorderIDå¯èƒ½è¢«æ··æ·†
    return nil
}
```

#### ğŸ“– ç†è®ºä¾æ®

- [ç±»å‹ç³»ç»Ÿ](./01-è¯­è¨€åŸºç¡€/00-Go-1.25.3å½¢å¼åŒ–ç†è®ºä½“ç³»/02-ç±»å‹ç³»ç»Ÿ.md)
- [ç±»å‹å®‰å…¨è¯æ˜](./01-è¯­è¨€åŸºç¡€/00-Go-1.25.3å½¢å¼åŒ–ç†è®ºä½“ç³»/12-ç±»å‹å®‰å…¨è¯æ˜.md)

---

### 2. é”™è¯¯å¤„ç†

#### âœ… DO: æ˜ç¡®çš„é”™è¯¯å¤„ç†

```go
// å¥½: æ˜ç¡®å¤„ç†æ¯ä¸ªé”™è¯¯
func ReadFile(path string) ([]byte, error) {
    data, err := os.ReadFile(path)
    if err != nil {
        return nil, fmt.Errorf("failed to read %s: %w", path, err)
    }
    return data, nil
}

func main() {
    data, err := ReadFile("config.yaml")
    if err != nil {
        log.Fatalf("Error: %v", err)
    }
    // ä½¿ç”¨data
}
```

#### âŒ DON'T: å¿½ç•¥é”™è¯¯

```go
// ä¸å¥½: å¿½ç•¥é”™è¯¯
func ReadFile(path string) []byte {
    data, _ := os.ReadFile(path)  // é”™è¯¯è¢«å¿½ç•¥
    return data
}
```

#### ğŸ¯ æœ€ä½³å®è·µ

- æ€»æ˜¯æ£€æŸ¥å’Œå¤„ç†é”™è¯¯
- ä½¿ç”¨`fmt.Errorf`åŒ…è£…é”™è¯¯æ·»åŠ ä¸Šä¸‹æ–‡
- åœ¨é€‚å½“çš„å±‚çº§å¤„ç†é”™è¯¯
- ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ç±»å‹è¡¨è¾¾ç‰¹å®šé”™è¯¯

---

### 3. æ¥å£è®¾è®¡

#### âœ… DO: å°è€Œä¸“æ³¨çš„æ¥å£

```go
// å¥½: å•ä¸€èŒè´£çš„æ¥å£
type Reader interface {
    Read(p []byte) (n int, err error)
}

type Writer interface {
    Write(p []byte) (n int, err error)
}

type ReadWriter interface {
    Reader
    Writer
}
```

#### âŒ DON'T: å¤§è€Œå…¨çš„æ¥å£

```go
// ä¸å¥½: è¿‡å¤§çš„æ¥å£
type DataProcessor interface {
    Read(p []byte) (n int, err error)
    Write(p []byte) (n int, err error)
    Process() error
    Validate() bool
    Transform() error
    // ... æ›´å¤šæ–¹æ³•
}
```

#### ğŸ¯ æœ€ä½³å®è·µ

- æ¥å£åº”è¯¥å°è€Œä¸“æ³¨
- ä¼˜å…ˆç»„åˆå°æ¥å£
- éµå¾ªæ¥å£éš”ç¦»åŸåˆ™
- æ¥å—æ¥å£ï¼Œè¿”å›ç»“æ„ä½“

---

## ğŸ”¬ å½¢å¼åŒ–éªŒè¯æœ€ä½³å®è·µ

### 1. ä½¿ç”¨Formal Verifier

#### âœ… DO: é…ç½®åˆç†çš„éªŒè¯è§„åˆ™

```yaml
# .fv.yaml
strict_mode: true

verification:
  cfg: true
  ssa: true
  dataflow: true
  concurrency:
    enabled: true
    goroutine_leaks: true
    channel_deadlocks: true
    data_races: true
  type_safety: true
  compiler_optimization:
    escape: true
    inline: true
    bce: true

thresholds:
  max_cyclomatic_complexity: 10
  max_cognitive_complexity: 15
  max_function_lines: 50
```

#### ğŸ¯ éªŒè¯æµç¨‹

```bash
# 1. æœ¬åœ°éªŒè¯
fv verify . --config .fv.yaml

# 2. ç”ŸæˆæŠ¥å‘Š
fv verify . --report-format html --output fv-report.html

# 3. CIé›†æˆ
fv verify . --report-format json --output fv-report.json --exit-code
```

#### ğŸ“Š è§£è¯»éªŒè¯ç»“æœ

```text
âœ… é€šè¿‡çš„æ£€æŸ¥ï¼š
  - CFGæ„å»ºæ­£å¸¸
  - æ— æ•°æ®ç«äº‰
  - æ— channelæ­»é”
  - ç±»å‹å®‰å…¨

âš ï¸ è­¦å‘Šï¼š
  - å‡½æ•°å¤æ‚åº¦è¿‡é«˜ (å‡½æ•°X: å¤æ‚åº¦15)
  - å¯èƒ½çš„goroutineæ³„æ¼ (å‡½æ•°Y)

âŒ é”™è¯¯ï¼š
  - æ£€æµ‹åˆ°æ•°æ®ç«äº‰ (æ–‡ä»¶Z:è¡Œ123)
```

#### ğŸ”§ ä¿®å¤ç­–ç•¥

1. **ä¼˜å…ˆä¿®å¤é”™è¯¯** (âŒ)
2. **è¯„ä¼°è­¦å‘Šçš„ä¸¥é‡æ€§** (âš ï¸)
3. **é‡æ„å¤æ‚ä»£ç **
4. **é‡æ–°éªŒè¯**

---

### 2. ç¼–å†™å¯éªŒè¯çš„ä»£ç 

#### âœ… DO: æ¸…æ™°çš„ä»£ç ç»“æ„

```go
// å¥½: æ¸…æ™°çš„æ§åˆ¶æµ
func ProcessData(data []int) ([]int, error) {
    if len(data) == 0 {
        return nil, errors.New("empty data")
    }
    
    result := make([]int, 0, len(data))
    for _, v := range data {
        if v < 0 {
            continue
        }
        result = append(result, v*2)
    }
    
    return result, nil
}
```

#### âŒ DON'T: å¤æ‚çš„æ§åˆ¶æµ

```go
// ä¸å¥½: å¤æ‚çš„åµŒå¥—å’Œè·³è½¬
func ProcessData(data []int) ([]int, error) {
    result := make([]int, 0)
    for i := 0; i < len(data); i++ {
        if data[i] >= 0 {
            if data[i]%2 == 0 {
                if data[i] < 100 {
                    result = append(result, data[i]*2)
                    continue
                }
            }
            goto skip
        }
        skip:
        continue
    }
    return result, nil
}
```

#### ğŸ¯ å¯éªŒè¯æ€§åŸåˆ™

- é¿å…è¿‡æ·±çš„åµŒå¥— (â‰¤3å±‚)
- å‡å°‘åœˆå¤æ‚åº¦ (â‰¤10)
- æ˜ç¡®çš„æ§åˆ¶æµ
- é¿å…gotoè¯­å¥

---

## ğŸš€ å¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ

### 1. Goroutineç®¡ç†

#### âœ… DO: ä½¿ç”¨WaitGroupæˆ–Context

```go
// å¥½: ä½¿ç”¨WaitGroupç®¡ç†goroutineç”Ÿå‘½å‘¨æœŸ
func ProcessConcurrently(items []Item) {
    var wg sync.WaitGroup
    
    for _, item := range items {
        wg.Add(1)
        go func(it Item) {
            defer wg.Done()
            process(it)
        }(item)
    }
    
    wg.Wait()  // ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ
}

// æ›´å¥½: ä½¿ç”¨Contextæ§åˆ¶è¶…æ—¶
func ProcessWithTimeout(ctx context.Context, items []Item) error {
    var wg sync.WaitGroup
    errCh := make(chan error, 1)
    
    for _, item := range items {
        wg.Add(1)
        go func(it Item) {
            defer wg.Done()
            select {
            case <-ctx.Done():
                return
            default:
                if err := process(it); err != nil {
                    select {
                    case errCh <- err:
                    default:
                    }
                }
            }
        }(item)
    }
    
    wg.Wait()
    close(errCh)
    
    return <-errCh
}
```

#### âŒ DON'T: æ— æ§åˆ¶çš„goroutine

```go
// ä¸å¥½: æ²¡æœ‰ç­‰å¾…goroutineå®Œæˆ
func ProcessConcurrently(items []Item) {
    for _, item := range items {
        go process(item)  // goroutineå¯èƒ½æ³„æ¼
    }
    // å‡½æ•°ç«‹å³è¿”å›ï¼Œgoroutineå¯èƒ½è¿˜åœ¨è¿è¡Œ
}
```

#### ğŸ“– å½¢å¼åŒ–ä¾æ®

- [Goroutineè¯­ä¹‰](./01-è¯­è¨€åŸºç¡€/00-Go-1.25.3å½¢å¼åŒ–ç†è®ºä½“ç³»/09-å¹¶å‘è¯­ä¹‰.md)
- [CSPæ¨¡å‹](./02-å¹¶å‘ç¼–ç¨‹/01-å¹¶å‘åŸºç¡€/CSP-Model.md)

---

### 2. Channelä½¿ç”¨

#### âœ… DO: æ˜ç¡®çš„channelæ‰€æœ‰æƒ

```go
// å¥½: æ˜ç¡®çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼
func Producer(ch chan<- int) {
    defer close(ch)  // ç”Ÿäº§è€…è´Ÿè´£å…³é—­
    
    for i := 0; i < 10; i++ {
        ch <- i
    }
}

func Consumer(ch <-chan int) {
    for v := range ch {  // rangeä¼šåœ¨channelå…³é—­æ—¶é€€å‡º
        process(v)
    }
}

func main() {
    ch := make(chan int, 10)
    go Producer(ch)
    Consumer(ch)
}
```

#### âŒ DON'T: ä¸æ¸…æ¥šçš„channelç®¡ç†

```go
// ä¸å¥½: ä¸æ¸…æ¥šè°è´Ÿè´£å…³é—­channel
func Process(ch chan int) {
    for {
        select {
        case v := <-ch:
            if v == 0 {  // ä½¿ç”¨ç‰¹æ®Šå€¼è¡¨ç¤ºç»“æŸï¼Œä¸æ¨è
                return
            }
            process(v)
        }
    }
}
```

#### ğŸ¯ Channelæœ€ä½³å®è·µ

- ç”Ÿäº§è€…è´Ÿè´£å…³é—­channel
- ä½¿ç”¨æœ‰å‘channelæ˜ç¡®æ–¹å‘
- ä½¿ç”¨å¸¦ç¼“å†²çš„channelé¿å…é˜»å¡
- ä½¿ç”¨`select`å¤„ç†å¤šä¸ªchannel
- é¿å…å…³é—­å·²å…³é—­çš„channel

---

### 3. æ•°æ®ç«äº‰é˜²æŠ¤

#### âœ… DO: ä½¿ç”¨åŒæ­¥åŸè¯­ä¿æŠ¤å…±äº«æ•°æ®

```go
// å¥½: ä½¿ç”¨Mutexä¿æŠ¤å…±äº«çŠ¶æ€
type Counter struct {
    mu    sync.Mutex
    value int
}

func (c *Counter) Increment() {
    c.mu.Lock()
    defer c.mu.Unlock()
    c.value++
}

func (c *Counter) Value() int {
    c.mu.Lock()
    defer c.mu.Unlock()
    return c.value
}

// æ›´å¥½: ä½¿ç”¨atomicæ“ä½œ
type AtomicCounter struct {
    value atomic.Int64
}

func (c *AtomicCounter) Increment() {
    c.value.Add(1)
}

func (c *AtomicCounter) Value() int64 {
    return c.value.Load()
}
```

#### âŒ DON'T: æ— ä¿æŠ¤çš„å…±äº«æ•°æ®è®¿é—®

```go
// ä¸å¥½: æ•°æ®ç«äº‰
type Counter struct {
    value int
}

func (c *Counter) Increment() {
    c.value++  // æ•°æ®ç«äº‰ï¼
}
```

#### ğŸ” æ£€æµ‹æ•°æ®ç«äº‰

```bash
# ä½¿ç”¨race detector
go test -race ./...
go run -race main.go

# ä½¿ç”¨FVæ£€æµ‹
fv verify . --concurrency.data_races=true
```

#### ğŸ“– å½¢å¼åŒ–ä¾æ®

- [å†…å­˜æ¨¡å‹](./01-è¯­è¨€åŸºç¡€/00-Go-1.25.3å½¢å¼åŒ–ç†è®ºä½“ç³»/10-å†…å­˜æ¨¡å‹.md)
- [æ•°æ®ç«äº‰](./02-å¹¶å‘ç¼–ç¨‹/04-å¹¶å‘å®‰å…¨/Race-Conditions.md)

---

### 4. ä½¿ç”¨å¹¶å‘æ¨¡å¼

#### âœ… DO: ä½¿ç”¨CPGç”Ÿæˆç»è¿‡éªŒè¯çš„æ¨¡å¼

```bash
# ç”ŸæˆWorker Poolæ¨¡å¼
cpg generate worker-pool --workers 4 --verify --output worker-pool.go

# ç”ŸæˆFan-Out-Fan-Inæ¨¡å¼
cpg generate fan-out-fan-in --workers 8 --verify --output fan-out-fan-in.go

# ç”ŸæˆPipelineæ¨¡å¼
cpg generate pipeline --stages 3 --verify --output pipeline.go
```

#### ğŸ¯ é€‰æ‹©åˆé€‚çš„æ¨¡å¼

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | CSPæ¨¡å‹ | æ­»é”è‡ªç”± |
|------|---------|---------|---------|
| **Worker Pool** | ä»»åŠ¡å¹¶è¡Œå¤„ç† | âœ… | âœ… |
| **Pipeline** | æµå¼æ•°æ®å¤„ç† | âœ… | âœ… |
| **Fan-Out-Fan-In** | åˆ†æ•£-èšåˆè®¡ç®— | âœ… | âœ… |
| **Pub-Sub** | äº‹ä»¶åˆ†å‘ | âœ… | âœ… |
| **Semaphore** | èµ„æºé™åˆ¶ | âœ… | âœ… |

#### ğŸ“– æ¨¡å¼æ–‡æ¡£

- [å¹¶å‘æ¨¡å¼ç›®å½•](../tools/concurrency-pattern-generator/docs/patterns-catalog.md)
- [CSPå½¢å¼åŒ–](./02-å¹¶å‘ç¼–ç¨‹/05-å½¢å¼åŒ–éªŒè¯/Process-Algebra.md)

---

## âš¡ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

### 1. é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…

#### âœ… DO: é‡ç”¨å¯¹è±¡

```go
// å¥½: ä½¿ç”¨sync.Poolé‡ç”¨å¯¹è±¡
var bufferPool = sync.Pool{
    New: func() interface{} {
        return new(bytes.Buffer)
    },
}

func ProcessData(data []byte) []byte {
    buf := bufferPool.Get().(*bytes.Buffer)
    defer func() {
        buf.Reset()
        bufferPool.Put(buf)
    }()
    
    buf.Write(data)
    // å¤„ç†...
    return buf.Bytes()
}
```

#### âŒ DON'T: é¢‘ç¹åˆ†é…

```go
// ä¸å¥½: æ¯æ¬¡è°ƒç”¨éƒ½åˆ†é…æ–°buffer
func ProcessData(data []byte) []byte {
    buf := new(bytes.Buffer)  // é¢‘ç¹åˆ†é…
    buf.Write(data)
    return buf.Bytes()
}
```

---

### 2. æ§åˆ¶é€ƒé€¸

#### âœ… DO: æ ˆä¸Šåˆ†é…

```go
// å¥½: å€¼ç±»å‹ï¼Œæ ˆä¸Šåˆ†é…
func Sum(nums []int) int {
    var sum int  // æ ˆä¸Šåˆ†é…
    for _, n := range nums {
        sum += n
    }
    return sum  // è¿”å›å€¼ï¼Œä¸é€ƒé€¸
}
```

#### âŒ DON'T: ä¸å¿…è¦çš„å †åˆ†é…

```go
// ä¸å¥½: è¿”å›æŒ‡é’ˆå¯¼è‡´é€ƒé€¸
func Sum(nums []int) *int {
    sum := 0  // é€ƒé€¸åˆ°å †
    for _, n := range nums {
        sum += n
    }
    return &sum  // è¿”å›æŒ‡é’ˆ
}
```

#### ğŸ” åˆ†æé€ƒé€¸

```bash
# æŸ¥çœ‹é€ƒé€¸åˆ†æ
go build -gcflags="-m" main.go

# è¯¦ç»†é€ƒé€¸ä¿¡æ¯
go build -gcflags="-m=2" main.go

# ä½¿ç”¨FVåˆ†æ
fv verify . --compiler_optimization.escape=true
```

#### ğŸ“– ç†è®ºä¾æ®

- [Escape Analysis](./03-å†…å­˜ç®¡ç†/04-ç¼–è¯‘å™¨ä¼˜åŒ–/Escape-Analysis.md)

---

### 3. è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤

#### âœ… DO: å¸®åŠ©ç¼–è¯‘å™¨æ¶ˆé™¤è¾¹ç•Œæ£€æŸ¥

```go
// å¥½: æ˜ç¡®çš„é•¿åº¦æ£€æŸ¥
func Sum(nums []int) int {
    if len(nums) == 0 {
        return 0
    }
    
    sum := 0
    for i := 0; i < len(nums); i++ {  // ç¼–è¯‘å™¨èƒ½æ¶ˆé™¤è¾¹ç•Œæ£€æŸ¥
        sum += nums[i]
    }
    return sum
}

// æ›´å¥½: ä½¿ç”¨range
func Sum(nums []int) int {
    sum := 0
    for _, n := range nums {  // æ— è¾¹ç•Œæ£€æŸ¥
        sum += n
    }
    return sum
}
```

#### ğŸ” æ£€æŸ¥BCE

```bash
# æŸ¥çœ‹BCEä¼˜åŒ–
go build -gcflags="-d=ssa/check_bce/debug=1" main.go

# ä½¿ç”¨FVåˆ†æ
fv verify . --compiler_optimization.bce=true
```

---

### 4. å†…è”ä¼˜åŒ–

#### âœ… DO: ç¼–å†™é€‚åˆå†…è”çš„å°å‡½æ•°

```go
// å¥½: ç®€å•å‡½æ•°ï¼Œæ˜“äºå†…è”
func Max(a, b int) int {
    if a > b {
        return a
    }
    return b
}

// ä½¿ç”¨å†…è”æŒ‡ä»¤
//go:inline
func FastMax(a, b int) int {
    if a > b {
        return a
    }
    return b
}
```

#### âŒ DON'T: è¿‡å¤§çš„å‡½æ•°

```go
// ä¸å¥½: å‡½æ•°è¿‡å¤§ï¼Œæ— æ³•å†…è”
func ComplexOperation(data []int) int {
    // 100+ è¡Œä»£ç ...
    // æ— æ³•å†…è”
}
```

#### ğŸ” æ£€æŸ¥å†…è”

```bash
# æŸ¥çœ‹å†…è”å†³ç­–
go build -gcflags="-m=2" main.go

# ä½¿ç”¨FVåˆ†æ
fv verify . --compiler_optimization.inline=true
```

---

## ğŸ› ï¸ å·¥å…·ä½¿ç”¨æœ€ä½³å®è·µ

### 1. Formal Verifieré›†æˆ

#### å¼€å‘æµç¨‹

```text
1. ç¼–ç  â†’ 2. æœ¬åœ°éªŒè¯ â†’ 3. ä¿®å¤é—®é¢˜ â†’ 4. æäº¤ â†’ 5. CIéªŒè¯
   â†“           â†“             â†“          â†“         â†“
  ç¼–å†™      fv verify      ä¿®å¤ä»£ç     git push   è‡ªåŠ¨éªŒè¯
  ä»£ç         .           é‡æ–°éªŒè¯    ä»£ç        ç”ŸæˆæŠ¥å‘Š
```

#### é…ç½®åˆ†å±‚

```yaml
# .fv.yaml (å¼€å‘ç¯å¢ƒ - å®½æ¾)
strict_mode: false
verification:
  cfg: true
  concurrency:
    enabled: true
    
# .fv-ci.yaml (CIç¯å¢ƒ - ä¸¥æ ¼)
strict_mode: true
verification:
  cfg: true
  ssa: true
  dataflow: true
  concurrency:
    enabled: true
    goroutine_leaks: true
    channel_deadlocks: true
    data_races: true
  type_safety: true
  
# .fv-strict.yaml (å‘å¸ƒå‰ - æœ€ä¸¥æ ¼)
strict_mode: true
verification:
  # å¯ç”¨æ‰€æœ‰æ£€æŸ¥
  ...
thresholds:
  max_cyclomatic_complexity: 8
  max_cognitive_complexity: 12
```

---

### 2. Pattern Generatorä½¿ç”¨

#### é€‰æ‹©æ¨¡å¼

```bash
# 1. åˆ—å‡ºæ‰€æœ‰æ¨¡å¼
cpg list

# 2. æŸ¥çœ‹æ¨¡å¼è¯¦æƒ…
cpg describe worker-pool

# 3. ç”Ÿæˆå¸¦æ–‡æ¡£çš„ä»£ç 
cpg generate worker-pool \
  --workers 4 \
  --buffer-size 10 \
  --with-docs \
  --with-tests \
  --verify \
  --output pkg/workers/pool.go
```

#### è‡ªå®šä¹‰æ¨¡å¼

```bash
# 1. å¯¼å‡ºæ¨¡æ¿
cpg export-template worker-pool > my-pattern.yaml

# 2. ä¿®æ”¹æ¨¡æ¿
# ç¼–è¾‘ my-pattern.yaml

# 3. ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿
cpg generate --template my-pattern.yaml --output custom.go
```

---

## ğŸ”„ CI/CDé›†æˆæœ€ä½³å®è·µ

### GitHub Actionsç¤ºä¾‹

```yaml
# .github/workflows/verification.yml
name: Formal Verification

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  verify:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.25.3'
      
      - name: Install Formal Verifier
        run: |
          cd tools/formal-verifier
          go install ./cmd/fv
      
      - name: Run Verification
        run: |
          fv verify . \
            --config .fv-ci.yaml \
            --report-format json \
            --output fv-report.json \
            --exit-code
      
      - name: Upload Report
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: verification-report
          path: fv-report.json
      
      - name: Comment PR
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const report = JSON.parse(fs.readFileSync('fv-report.json'));
            
            let comment = '## ğŸ”¬ Formal Verification Report\n\n';
            comment += `- âœ… Passed: ${report.passed}\n`;
            comment += `- âš ï¸ Warnings: ${report.warnings}\n`;
            comment += `- âŒ Errors: ${report.errors}\n`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
```

---

## ğŸ‘¥ å›¢é˜Ÿåä½œæœ€ä½³å®è·µ

### 1. ä»£ç å®¡æŸ¥æ¸…å•

#### å½¢å¼åŒ–éªŒè¯æ£€æŸ¥

- [ ] FVéªŒè¯å…¨éƒ¨é€šè¿‡
- [ ] æ— æ•°æ®ç«äº‰
- [ ] æ— goroutineæ³„æ¼
- [ ] æ— channelæ­»é”
- [ ] åœˆå¤æ‚åº¦â‰¤10
- [ ] å‡½æ•°è¡Œæ•°â‰¤50

#### å¹¶å‘å®‰å…¨æ£€æŸ¥

- [ ] å…±äº«æ•°æ®æœ‰ä¿æŠ¤
- [ ] Goroutineæœ‰ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [ ] Channelæœ‰æ˜ç¡®çš„æ‰€æœ‰æƒ
- [ ] ä½¿ç”¨race detectoræµ‹è¯•é€šè¿‡

#### æ€§èƒ½æ£€æŸ¥

- [ ] æ— ä¸å¿…è¦çš„å†…å­˜åˆ†é…
- [ ] å…³é”®è·¯å¾„æ— é€ƒé€¸
- [ ] Benchmarkæµ‹è¯•é€šè¿‡
- [ ] Profileåˆ†ææ­£å¸¸

---

### 2. æ–‡æ¡£è§„èŒƒ

#### åŒ…æ–‡æ¡£

```go
// Package workers æä¾›äº†ä¸€ä¸ªç»è¿‡å½¢å¼åŒ–éªŒè¯çš„Worker Poolå®ç°ã€‚
//
// Worker Poolæ¨¡å¼å…è®¸å¹¶å‘å¤„ç†å¤šä¸ªä»»åŠ¡ï¼ŒåŒæ—¶é™åˆ¶å¹¶å‘æ•°é‡ã€‚
// æœ¬å®ç°å·²é€šè¿‡CSPå½¢å¼åŒ–å»ºæ¨¡ï¼Œè¯æ˜å…¶æ­»é”è‡ªç”±å’Œæ•°æ®ç«äº‰è‡ªç”±ã€‚
//
// ç¤ºä¾‹:
//
//     pool := workers.New(4)  // 4ä¸ªworker
//     defer pool.Close()
//
//     for _, task := range tasks {
//         pool.Submit(task)
//     }
//     pool.Wait()
//
// å½¢å¼åŒ–éªŒè¯ç»“æœ:
//   - CSPæ¨¡å‹: PASS
//   - Happens-Beforeåˆ†æ: PASS
//   - æ­»é”åˆ†æ: PASS
//   - æ•°æ®ç«äº‰åˆ†æ: PASS
package workers
```

#### å‡½æ•°æ–‡æ¡£

```go
// Submit æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°worker poolã€‚
//
// Submitæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥ä»å¤šä¸ªgoroutineå¹¶å‘è°ƒç”¨ã€‚
// å¦‚æœpoolå·²å…³é—­ï¼ŒSubmitä¼šè¿”å›ErrPoolClosedé”™è¯¯ã€‚
//
// å½¢å¼åŒ–æ€§è´¨:
//   - æ— æ•°æ®ç«äº‰ (é€šè¿‡FVéªŒè¯)
//   - æ— é˜»å¡ (ä½¿ç”¨å¸¦ç¼“å†²channel)
//   - çº¿æ€§æ—¶é—´å¤æ‚åº¦ O(1)
//
// ç¤ºä¾‹:
//
//     err := pool.Submit(func() {
//         // ä»»åŠ¡é€»è¾‘
//     })
//     if err != nil {
//         log.Printf("Submit failed: %v", err)
//     }
func (p *Pool) Submit(task func()) error {
    // ...
}
```

---

## ğŸ¯ æ€»ç»“ï¼šæœ€ä½³å®è·µå¿«é€Ÿæ£€æŸ¥è¡¨

### ä»£ç è´¨é‡ âœ…

- [ ] ä½¿ç”¨æ˜ç¡®çš„ç±»å‹
- [ ] æ‰€æœ‰é”™è¯¯éƒ½è¢«å¤„ç†
- [ ] æ¥å£å°è€Œä¸“æ³¨
- [ ] å‡½æ•°å¤æ‚åº¦â‰¤10
- [ ] å‡½æ•°è¡Œæ•°â‰¤50

### å½¢å¼åŒ–éªŒè¯ âœ…

- [ ] FVéªŒè¯å…¨éƒ¨é€šè¿‡
- [ ] é…ç½®åˆç†çš„éªŒè¯è§„åˆ™
- [ ] å®šæœŸè¿è¡ŒéªŒè¯
- [ ] CIé›†æˆéªŒè¯
- [ ] æŸ¥çœ‹å¹¶ä¿®å¤æ‰€æœ‰è­¦å‘Š

### å¹¶å‘ç¼–ç¨‹ âœ…

- [ ] Goroutineæœ‰ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [ ] Channelæœ‰æ˜ç¡®æ‰€æœ‰æƒ
- [ ] ä½¿ç”¨åŒæ­¥åŸè¯­ä¿æŠ¤å…±äº«æ•°æ®
- [ ] Race detectoræµ‹è¯•é€šè¿‡
- [ ] ä½¿ç”¨ç»è¿‡éªŒè¯çš„å¹¶å‘æ¨¡å¼

### æ€§èƒ½ä¼˜åŒ– âœ…

- [ ] é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…
- [ ] æ§åˆ¶é€ƒé€¸åˆ°å †
- [ ] è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤
- [ ] å…³é”®å‡½æ•°å†…è”
- [ ] Profileåˆ†ææ­£å¸¸

### å·¥å…·ä½¿ç”¨ âœ…

- [ ] æœ¬åœ°å¼€å‘ä½¿ç”¨FV
- [ ] CI/CDé›†æˆFVå’ŒCPG
- [ ] ä½¿ç”¨CPGç”Ÿæˆå¹¶å‘ä»£ç 
- [ ] é…ç½®åˆ†å±‚ç®¡ç†
- [ ] å®šæœŸæ›´æ–°å·¥å…·

---

<div align="center">

## ğŸŠ éµå¾ªæœ€ä½³å®è·µï¼Œç¼–å†™é«˜è´¨é‡ä»£ç 

### ç›¸å…³èµ„æº

ğŸ“š [å¿«é€Ÿèµ·æ­¥æŒ‡å—](./ğŸš€-å¿«é€Ÿèµ·æ­¥å®Œæ•´æŒ‡å—-2025-10-25.md) | ğŸ“– [å­¦ä¹ è·¯å¾„](./ğŸ“š-å­¦ä¹ è·¯å¾„æ¨èç³»ç»Ÿ-2025-10-25.md) | ğŸ—ºï¸ [å¯¼èˆªåœ°å›¾](./ğŸ—ºï¸-Go-1.25.3é¡¹ç›®å¯¼èˆªåœ°å›¾-2025-10-25.md)

---

**æŒç»­æ”¹è¿›ï¼Œè¿½æ±‚å“è¶Šï¼**

</div>
