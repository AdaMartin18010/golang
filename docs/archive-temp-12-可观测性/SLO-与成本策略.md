
## 指标体系与基线

- RED（请求级）：Rate、Errors、Duration（P50/P90/P99）
- USE（资源级）：Utilization、Saturation、Errors
- 基线：
  - API 可用性 99.9%，错误率 < 0.1%
  - P99 延迟 < 500ms（关键路径），一般路径 < 800ms

## 采样与留存

- Trace：默认 5% head；关键路径 100%；异常/高延迟启用 tail 提升
- Logs：按等级/关键字采样；Debug 在问题窗口临时开启
- Metrics：限制高基数标签；长尾指标下沉日志
- 保留：热 7 天、温 30 天、冷归档 180 天（可因环境调整）

## 告警策略

- 急性告警：
  - 错误率 > 阈值且持续 5 分钟
  - P99 > 阈值且持续 5 分钟
  - QPS 暴涨/突降超出异常检测阈值
- 慢性告警：
  - 资源利用率长期高位（CPU/内存/FD/GC）
  - Collector 队列溢出、导出失败比例升高

## 成本控制

- 采样优先，避免盲目全量；对高成本后端按环境与服务分流
- 标签治理：剔除高基数标签（UserID、UUID、IP）
- 查询治理：看板视图预设聚合，限制自由查询时间范围与分辨率

## 演练与验收

- 每月演练一次：注入延迟/错误，验证告警拉起与排障路径（Trace→Logs→Profile）
- 验收：5 分钟内定位根因；成本月度不超预算阈值

## 目标

- 在保障用户体验与问题定位效率的前提下，使用采样与治理手段将可观测性成本保持在可控范围内。

## SLI/SLO 模型

- 核心 SLI：可用性、延迟（P50/P90/P99）、错误率（5xx）、饱和度（资源利用）
- 目标 SLO（API 类）：30 天 99.9% 可用性；P99 < 500ms；错误率 < 0.1%
- 误差预算：0.1%（~43.2 分钟/月）：用于灰度、演练与突发容错

## 采样与基数治理

- 追踪采样：默认 1-5% Head；关键路径 100%；Collector Tail 采样对异常/高延迟提升
- 指标治理：限制标签（cardinality）与动态维度；长尾降级为事件/日志；避免 user-id、request-id 这类高基数标签
- 日志采样：按等级与路径采样；批量与压缩；敏感字段脱敏

## 存储与保留策略

- 热数据：Trace/Logs 3-7 天；Metrics 15-30 天（按业务）
- 温数据：降采样与聚合（汇总、直方图）
- 冷数据：归档到低成本存储（对象存储），仅离线分析使用

## 成本监控

- 指标：摄入速率、存储增长、查询 QPS/延迟、失败率
- 单位成本：每百万 span/日志条目/时间序列的成本；按团队或租户记账

## 变更与演练

- 应用变更需评估新增标签/事件对基数与成本影响
- 定期进行“可观测性失效演练”（禁用某 exporter/队列阻塞），验证回退与告警有效性
