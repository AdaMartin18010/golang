# 2.1.1 ä¸­é—´ä»¶æ¨¡å¼

<!-- TOC START -->
- [2.1.1 ä¸­é—´ä»¶æ¨¡å¼](#ä¸­é—´ä»¶æ¨¡å¼)
  - [2.1.1.1 ğŸ“š **ç†è®ºåˆ†æ**](#ğŸ“š-**ç†è®ºåˆ†æ**)
    - [2.1.1.1.1 **ä¸­é—´ä»¶è®¾è®¡åŸç†**](#**ä¸­é—´ä»¶è®¾è®¡åŸç†**)
    - [2.1.1.1.2 **é“¾å¼è°ƒç”¨æ¨¡å‹**](#**é“¾å¼è°ƒç”¨æ¨¡å‹**)
      - [2.1.1.1.2.1 **ä¼ªä»£ç **](#**ä¼ªä»£ç **)
    - [2.1.1.1.3 **Goå®ç°æ–¹å¼**](#**goå®ç°æ–¹å¼**)
  - [2.1.1.2 ğŸ’» **ä»£ç ç¤ºä¾‹**](#ğŸ’»-**ä»£ç ç¤ºä¾‹**)
    - [2.1.1.2.1 **æ ‡å‡†åº“ä¸­é—´ä»¶å®ç°**](#**æ ‡å‡†åº“ä¸­é—´ä»¶å®ç°**)
    - [2.1.1.2.2 **Ginä¸­é—´ä»¶ç”¨æ³•**](#**ginä¸­é—´ä»¶ç”¨æ³•**)
    - [2.1.1.2.3 **Echoä¸­é—´ä»¶ç”¨æ³•**](#**echoä¸­é—´ä»¶ç”¨æ³•**)
    - [2.1.1.2.4 **Fiberä¸­é—´ä»¶ç”¨æ³•**](#**fiberä¸­é—´ä»¶ç”¨æ³•**)
  - [2.1.1.3 ğŸ§ª **æµ‹è¯•ä»£ç **](#ğŸ§ª-**æµ‹è¯•ä»£ç **)
  - [2.1.1.4 ğŸ¯ **æœ€ä½³å®è·µ**](#ğŸ¯-**æœ€ä½³å®è·µ**)
  - [2.1.1.5 ğŸ” **å¸¸è§é—®é¢˜**](#ğŸ”-**å¸¸è§é—®é¢˜**)
  - [2.1.1.6 ğŸ“š **æ‰©å±•é˜…è¯»**](#ğŸ“š-**æ‰©å±•é˜…è¯»**)
<!-- TOC END -->














## 2.1.1.1 ğŸ“š **ç†è®ºåˆ†æ**

### 2.1.1.1.1 **ä¸­é—´ä»¶è®¾è®¡åŸç†**

- ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æ˜¯Webå¼€å‘ä¸­ç”¨äºå¤„ç†è¯·æ±‚/å“åº”æµç¨‹çš„å¯æ’æ‹”ç»„ä»¶ã€‚
- é‡‡ç”¨é“¾å¼è°ƒç”¨ï¼ˆæ´‹è‘±æ¨¡å‹ï¼‰ï¼Œæ¯ä¸ªä¸­é—´ä»¶å¯åœ¨è¯·æ±‚å‰åæ‰§è¡Œé€»è¾‘ã€‚
- å…¸å‹ç”¨é€”ï¼šæ—¥å¿—ã€è®¤è¯ã€é™æµã€CORSã€é”™è¯¯æ¢å¤ã€è¯·æ±‚ä¿®æ”¹ç­‰ã€‚

### 2.1.1.1.2 **é“¾å¼è°ƒç”¨æ¨¡å‹**

- æ¯ä¸ªä¸­é—´ä»¶æ¥æ”¶ä¸‹ä¸€ä¸ªå¤„ç†å™¨ä½œä¸ºå‚æ•°ï¼Œå†³å®šæ˜¯å¦ç»§ç»­ä¼ é€’
- æ´‹è‘±æ¨¡å‹ï¼šå¤–å±‚ä¸­é—´ä»¶åŒ…è£¹å†…å±‚ï¼Œå…ˆè¿›åå‡º

#### 2.1.1.1.2.1 **ä¼ªä»£ç **

```text
func Middleware(next Handler) Handler {
    return func(w, r) {
        // å‰ç½®é€»è¾‘
        next(w, r)
        // åç½®é€»è¾‘
    }
}
```

### 2.1.1.1.3 **Goå®ç°æ–¹å¼**

- æ ‡å‡†åº“ï¼šé€šè¿‡`http.Handler`åŒ…è£…å®ç°
- Gin/Echo/Fiberç­‰æ¡†æ¶ï¼šé€šè¿‡`Use()`æ³¨å†Œé“¾å¼ä¸­é—´ä»¶

## 2.1.1.2 ğŸ’» **ä»£ç ç¤ºä¾‹**

### 2.1.1.2.1 **æ ‡å‡†åº“ä¸­é—´ä»¶å®ç°**

```go
package main
import (
    "log"
    "net/http"
    "time"
)
func Logging(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        start := time.Now()
        next.ServeHTTP(w, r)
        log.Printf("%s %s %v", r.Method, r.URL.Path, time.Since(start))
    })
}
func main() {
    mux := http.NewServeMux()
    mux.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
        w.Write([]byte("Hello"))
    })
    http.ListenAndServe(":8080", Logging(mux))
}
```

### 2.1.1.2.2 **Ginä¸­é—´ä»¶ç”¨æ³•**

```go
package main
import (
    "github.com/gin-gonic/gin"
    "log"
    "time"
)
func Logger() gin.HandlerFunc {
    return func(c *gin.Context) {
        t := time.Now()
        c.Next()
        log.Printf("%s %s %v", c.Request.Method, c.Request.URL.Path, time.Since(t))
    }
}
func main() {
    r := gin.New()
    r.Use(Logger())
    r.GET("/", func(c *gin.Context) {
        c.String(200, "Hello with middleware")
    })
    r.Run(":8080")
}
```

### 2.1.1.2.3 **Echoä¸­é—´ä»¶ç”¨æ³•**

```go
package main
import (
    "github.com/labstack/echo/v4"
    "github.com/labstack/echo/v4/middleware"
)
func main() {
    e := echo.New()
    e.Use(middleware.Logger())
    e.Use(middleware.Recover())
    e.GET("/", func(c echo.Context) error {
        return c.String(200, "Hello with middleware")
    })
    e.Logger.Fatal(e.Start(":8080"))
}
```

### 2.1.1.2.4 **Fiberä¸­é—´ä»¶ç”¨æ³•**

```go
package main
import (
    "github.com/gofiber/fiber/v2"
    "github.com/gofiber/fiber/v2/middleware/logger"
)
func main() {
    app := fiber.New()
    app.Use(logger.New())
    app.Get("/", func(c *fiber.Ctx) error {
        return c.SendString("Hello with middleware")
    })
    app.Listen(":8080")
}
```

## 2.1.1.3 ğŸ§ª **æµ‹è¯•ä»£ç **

```go
package main
import (
    "net/http"
    "net/http/httptest"
    "testing"
)
func TestLoggingMiddleware(t *testing.T) {
    mux := http.NewServeMux()
    mux.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
        w.Write([]byte("OK"))
    })
    handler := Logging(mux)
    req := httptest.NewRequest("GET", "/", nil)
    w := httptest.NewRecorder()
    handler.ServeHTTP(w, req)
    if w.Body.String() != "OK" {
        t.Errorf("unexpected response: %s", w.Body.String())
    }
}
```

## 2.1.1.4 ğŸ¯ **æœ€ä½³å®è·µ**

- æ—¥å¿—ã€æ¢å¤ã€è®¤è¯ç­‰é€šç”¨åŠŸèƒ½å»ºè®®ç”¨ä¸­é—´ä»¶å®ç°
- ä¸­é—´ä»¶é¡ºåºå½±å“æ‰§è¡Œé€»è¾‘ï¼Œéœ€åˆç†å®‰æ’
- é”™è¯¯å¤„ç†å’Œå“åº”å»ºè®®åœ¨ä¸­é—´ä»¶ç»Ÿä¸€å¤„ç†
- ç”Ÿäº§ç¯å¢ƒå…³é—­debugä¸­é—´ä»¶ï¼Œåˆç†é…ç½®æ—¥å¿—

## 2.1.1.5 ğŸ” **å¸¸è§é—®é¢˜**

- Q: ä¸­é—´ä»¶å’ŒHandleræœ‰ä½•åŒºåˆ«ï¼Ÿ
  A: ä¸­é—´ä»¶å¯åŒ…è£¹Handlerï¼Œå¤„ç†è¯·æ±‚å‰åé€»è¾‘
- Q: å¦‚ä½•å®ç°å…¨å±€ä¸è·¯ç”±çº§ä¸­é—´ä»¶ï¼Ÿ
  A: å…¨å±€ç”¨`Use()`æ³¨å†Œï¼Œè·¯ç”±çº§ç›´æ¥åŒ…è£¹Handler
- Q: ä¸­é—´ä»¶å¦‚ä½•ç»ˆæ­¢è¯·æ±‚é“¾ï¼Ÿ
  A: Gin/Echo/Fiberä¸­å¯ç›´æ¥è¿”å›å“åº”æˆ–è°ƒç”¨`Abort()`

## 2.1.1.6 ğŸ“š **æ‰©å±•é˜…è¯»**

- [Goå®˜æ–¹æ–‡æ¡£-http.Handler](https://golang.org/pkg/net/http/#Handler)
- [Ginä¸­é—´ä»¶æ–‡æ¡£](https://gin-gonic.com/docs/examples/middleware/)
- [Echoä¸­é—´ä»¶æ–‡æ¡£](https://echo.labstack.com/middleware/)
- [Fiberä¸­é—´ä»¶æ–‡æ¡£](https://docs.gofiber.io/api/middleware/)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AI Assistant  
**æœ€åæ›´æ–°**: 2024å¹´6æœˆ27æ—¥  
**æ–‡æ¡£çŠ¶æ€**: å®Œæˆ
