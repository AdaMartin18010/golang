# 2.1.1 APIå®‰å…¨å®è·µ

<!-- TOC START -->
- [2.1.1 APIå®‰å…¨å®è·µ](#211-apiå®‰å…¨å®è·µ)
  - [2.1.1.1 ğŸ“š **ç†è®ºåˆ†æ**](#2111--ç†è®ºåˆ†æ)
    - [2.1.1.1.1 **APIå®‰å…¨æ ¸å¿ƒè¦ç´ **](#21111-apiå®‰å…¨æ ¸å¿ƒè¦ç´ )
    - [2.1.1.1.2 **å¸¸è§æ”»å‡»é˜²æŠ¤**](#21112-å¸¸è§æ”»å‡»é˜²æŠ¤)
  - [2.1.1.2 ğŸ’» **ä»£ç ç¤ºä¾‹**](#2112--ä»£ç ç¤ºä¾‹)
    - [2.1.1.2.1 **JWTè®¤è¯ï¼ˆGinï¼‰**](#21121-jwtè®¤è¯gin)
    - [2.1.1.2.2 **Echoé™æµä¸­é—´ä»¶**](#21122-echoé™æµä¸­é—´ä»¶)
    - [2.1.1.2.3 **Fiber CORSä¸CSRFé˜²æŠ¤**](#21123-fiber-corsä¸csrfé˜²æŠ¤)
  - [2.1.1.3 ğŸ¯ **æœ€ä½³å®è·µ**](#2113--æœ€ä½³å®è·µ)
  - [2.1.1.4 ğŸ” **å¸¸è§é—®é¢˜**](#2114--å¸¸è§é—®é¢˜)
  - [2.1.1.5 ğŸ“š **æ‰©å±•é˜…è¯»**](#2115--æ‰©å±•é˜…è¯»)
<!-- TOC END -->

## 2.1.1.1 ğŸ“š **ç†è®ºåˆ†æ**

### 2.1.1.1.1 **APIå®‰å…¨æ ¸å¿ƒè¦ç´ **

- è®¤è¯ï¼ˆAuthenticationï¼‰ï¼šç¡®è®¤ç”¨æˆ·èº«ä»½
- æˆæƒï¼ˆAuthorizationï¼‰ï¼šæ§åˆ¶èµ„æºè®¿é—®æƒé™
- è¾“å…¥æ ¡éªŒä¸è¾“å‡ºç¼–ç ï¼Œé˜²æ­¢æ³¨å…¥å’ŒXSS
- HTTPSåŠ å¯†ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»
- æ—¥å¿—ä¸ç›‘æ§ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸

### 2.1.1.1.2 **å¸¸è§æ”»å‡»é˜²æŠ¤**

- SQLæ³¨å…¥ï¼šå‚æ•°åŒ–æŸ¥è¯¢ï¼ŒORMé˜²æŠ¤
- XSSï¼šè¾“å‡ºç¼–ç ï¼ŒContent-Typeè®¾ç½®
- CSRFï¼šTokenæ ¡éªŒï¼ŒSameSite Cookie
- æš´åŠ›ç ´è§£ï¼šé™æµã€éªŒè¯ç 
- æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ï¼šæ—¥å¿—è„±æ•ã€åŠ å¯†å­˜å‚¨

## 2.1.1.2 ğŸ’» **ä»£ç ç¤ºä¾‹**

### 2.1.1.2.1 **JWTè®¤è¯ï¼ˆGinï¼‰**

```go
package main
import (
    "github.com/gin-gonic/gin"
    "github.com/golang-jwt/jwt/v4"
    "net/http"
    "time"
)
var secret = []byte("secret")
func main() {
    r := gin.Default()
    r.POST("/login", func(c *gin.Context) {
        // çœç•¥ç”¨æˆ·æ ¡éªŒ
        token := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{
            "user": "alice",
            "exp": time.Now().Add(time.Hour).Unix(),
        })
        tokenStr, _ := token.SignedString(secret)
        c.JSON(200, gin.H{"token": tokenStr})
    })
    r.GET("/secure", func(c *gin.Context) {
        auth := c.GetHeader("Authorization")
        t, err := jwt.Parse(auth, func(token *jwt.Token) (interface{}, error) { return secret, nil })
        if err != nil || !t.Valid {
            c.JSON(http.StatusUnauthorized, gin.H{"error": "unauthorized"})
            return
        }
        c.JSON(200, gin.H{"msg": "secure data"})
    })
    r.Run(":8080")
}
```

### 2.1.1.2.2 **Echoé™æµä¸­é—´ä»¶**

```go
package main
import (
    "github.com/labstack/echo/v4"
    "github.com/labstack/echo/v4/middleware"
)
func main() {
    e := echo.New()
    e.Use(middleware.RateLimiter(middleware.NewRateLimiterMemoryStore(20)))
    e.GET("/", func(c echo.Context) error {
        return c.String(200, "ok")
    })
    e.Logger.Fatal(e.Start(":8080"))
}
```

### 2.1.1.2.3 **Fiber CORSä¸CSRFé˜²æŠ¤**

```go
package main
import (
    "github.com/gofiber/fiber/v2"
    "github.com/gofiber/fiber/v2/middleware/cors"
    "github.com/gofiber/fiber/v2/middleware/csrf"
)
func main() {
    app := fiber.New()
    app.Use(cors.New())
    app.Use(csrf.New())
    app.Get("/", func(c *fiber.Ctx) error {
        return c.SendString("ok")
    })
    app.Listen(":8080")
}
```

## 2.1.1.3 ğŸ¯ **æœ€ä½³å®è·µ**

- æ‰€æœ‰APIå¼ºåˆ¶HTTPS
- è®¤è¯ä¸æˆæƒåˆ†ç¦»ï¼Œæœ€å°æƒé™åŸåˆ™
- è¾“å…¥è¾“å‡ºä¸¥æ ¼æ ¡éªŒä¸ç¼–ç 
- æ—¥å¿—è„±æ•ï¼Œæ•æ„Ÿä¿¡æ¯åŠ å¯†
- é…ç½®é™æµã€CORSã€CSRFç­‰ä¸­é—´ä»¶

## 2.1.1.4 ğŸ” **å¸¸è§é—®é¢˜**

- Q: JWTå¦‚ä½•å®‰å…¨å­˜å‚¨ï¼Ÿ
  A: å»ºè®®å­˜å‚¨äºHttpOnly Cookieï¼Œé˜²æ­¢XSS
- Q: å¦‚ä½•é˜²æ­¢CSRFï¼Ÿ
  A: ä½¿ç”¨CSRF Tokenå’ŒSameSite Cookie
- Q: å¦‚ä½•é˜²æ­¢æš´åŠ›ç ´è§£ï¼Ÿ
  A: é…ç½®é™æµã€éªŒè¯ç 

## 2.1.1.5 ğŸ“š **æ‰©å±•é˜…è¯»**

- [OWASP API Security Top 10](https://owasp.org/API-Security/)
- [Ginå®‰å…¨æ–‡æ¡£](https://gin-gonic.com/docs/examples/authentication/)
- [Echoå®‰å…¨æ–‡æ¡£](https://echo.labstack.com/middleware/)
- [Fiberå®‰å…¨æ–‡æ¡£](https://docs.gofiber.io/api/middleware/)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AI Assistant  
**æœ€åæ›´æ–°**: 2024å¹´6æœˆ27æ—¥  
**æ–‡æ¡£çŠ¶æ€**: å®Œæˆ
