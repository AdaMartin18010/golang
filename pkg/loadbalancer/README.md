# è´Ÿè½½å‡è¡¡å™¨

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-11
**é€‚ç”¨äº**: Go 1.25.3

---

## ğŸ“‹ ç›®å½•

- [è´Ÿè½½å‡è¡¡å™¨](#è´Ÿè½½å‡è¡¡å™¨)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. æ”¯æŒçš„ç®—æ³•](#2-æ”¯æŒçš„ç®—æ³•)
    - [2.1 è½®è¯¢ç®—æ³• (Round Robin)](#21-è½®è¯¢ç®—æ³•-round-robin)
    - [2.2 éšæœºç®—æ³• (Random)](#22-éšæœºç®—æ³•-random)
    - [2.3 åŠ æƒè½®è¯¢ (Weighted Round Robin)](#23-åŠ æƒè½®è¯¢-weighted-round-robin)
    - [2.4 æœ€å°‘è¿æ¥ (Least Connections)](#24-æœ€å°‘è¿æ¥-least-connections)
  - [3. ä½¿ç”¨ç¤ºä¾‹](#3-ä½¿ç”¨ç¤ºä¾‹)
    - [3.1 åŸºæœ¬ä½¿ç”¨](#31-åŸºæœ¬ä½¿ç”¨)
    - [3.2 ä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒé›†æˆ](#32-ä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒé›†æˆ)
    - [3.3 æœ€å°‘è¿æ¥ç®—æ³•](#33-æœ€å°‘è¿æ¥ç®—æ³•)
    - [3.4 åŠ æƒè½®è¯¢](#34-åŠ æƒè½®è¯¢)
  - [4. æœ€ä½³å®è·µ](#4-æœ€ä½³å®è·µ)
    - [4.1 DO's âœ…](#41-dos-)
    - [4.2 DON'Ts âŒ](#42-donts-)
  - [5. ç›¸å…³èµ„æº](#5-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

è´Ÿè½½å‡è¡¡å™¨æä¾›äº†å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼š

- âœ… **è½®è¯¢ç®—æ³•**: ä¾æ¬¡é€‰æ‹©æœåŠ¡å®ä¾‹
- âœ… **éšæœºç®—æ³•**: éšæœºé€‰æ‹©æœåŠ¡å®ä¾‹
- âœ… **åŠ æƒè½®è¯¢**: æ ¹æ®æƒé‡é€‰æ‹©æœåŠ¡å®ä¾‹
- âœ… **æœ€å°‘è¿æ¥**: é€‰æ‹©è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å®ä¾‹

---

## 2. æ”¯æŒçš„ç®—æ³•

### 2.1 è½®è¯¢ç®—æ³• (Round Robin)

ä¾æ¬¡é€‰æ‹©æœåŠ¡å®ä¾‹ï¼Œé€‚åˆæ‰€æœ‰æœåŠ¡å®ä¾‹æ€§èƒ½ç›¸è¿‘çš„åœºæ™¯ã€‚

### 2.2 éšæœºç®—æ³• (Random)

éšæœºé€‰æ‹©æœåŠ¡å®ä¾‹ï¼Œé€‚åˆæœåŠ¡å®ä¾‹æ€§èƒ½ç›¸è¿‘ä¸”è¯·æ±‚åˆ†å¸ƒå‡åŒ€çš„åœºæ™¯ã€‚

### 2.3 åŠ æƒè½®è¯¢ (Weighted Round Robin)

æ ¹æ®æœåŠ¡å®ä¾‹çš„æƒé‡é€‰æ‹©ï¼Œé€‚åˆæœåŠ¡å®ä¾‹æ€§èƒ½ä¸åŒçš„åœºæ™¯ã€‚

### 2.4 æœ€å°‘è¿æ¥ (Least Connections)

é€‰æ‹©å½“å‰è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å®ä¾‹ï¼Œé€‚åˆé•¿è¿æ¥åœºæ™¯ã€‚

---

## 3. ä½¿ç”¨ç¤ºä¾‹

### 3.1 åŸºæœ¬ä½¿ç”¨

```go
import (
    "context"
    "github.com/yourusername/golang/pkg/loadbalancer"
    "github.com/yourusername/golang/pkg/registry"
)

// åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨
lb := loadbalancer.NewRoundRobin()

// é€‰æ‹©æœåŠ¡
services := []*registry.Service{
    {ID: "service-1", Name: "user-service"},
    {ID: "service-2", Name: "user-service"},
}

selected, err := lb.Select(context.Background(), services)
if err != nil {
    // å¤„ç†é”™è¯¯
}
```

### 3.2 ä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒé›†æˆ

```go
// åˆ›å»ºæœåŠ¡é€‰æ‹©å™¨
reg := registry.NewInMemoryRegistry()
lb := loadbalancer.NewRoundRobin()
selector := loadbalancer.NewServiceSelector(reg, lb, "user-service")

// é€‰æ‹©æœåŠ¡
service, err := selector.Select(context.Background())
if err != nil {
    // å¤„ç†é”™è¯¯
}

// ä½¿ç”¨æœåŠ¡
url := fmt.Sprintf("http://%s:%d", service.Address, service.Port)
```

### 3.3 æœ€å°‘è¿æ¥ç®—æ³•

```go
lb := loadbalancer.NewLeastConnections()

// é€‰æ‹©æœåŠ¡
service, err := lb.Select(context.Background(), services)
if err != nil {
    // å¤„ç†é”™è¯¯
}

// ä½¿ç”¨æœåŠ¡åé‡Šæ”¾è¿æ¥
defer lb.Release(service.ID)
```

### 3.4 åŠ æƒè½®è¯¢

```go
lb := loadbalancer.NewWeightedRoundRobin()

services := []*registry.Service{
    {
        ID: "service-1",
        Name: "user-service",
        Metadata: map[string]string{"weight": "3"},
    },
    {
        ID: "service-2",
        Name: "user-service",
        Metadata: map[string]string{"weight": "1"},
    },
}

selected, err := lb.Select(context.Background(), services)
```

---

## 4. æœ€ä½³å®è·µ

### 4.1 DO's âœ…

1. **é€‰æ‹©åˆé€‚çš„ç®—æ³•**: æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„è´Ÿè½½å‡è¡¡ç®—æ³•
2. **å¥åº·æ£€æŸ¥**: ç»“åˆå¥åº·æ£€æŸ¥è¿‡æ»¤ä¸å¥åº·çš„æœåŠ¡
3. **è¿æ¥ç®¡ç†**: ä½¿ç”¨æœ€å°‘è¿æ¥ç®—æ³•æ—¶è®°å¾—é‡Šæ”¾è¿æ¥
4. **æƒé‡é…ç½®**: æ ¹æ®æœåŠ¡å®ä¾‹æ€§èƒ½é…ç½®åˆç†çš„æƒé‡

### 4.2 DON'Ts âŒ

1. **ä¸è¦å¿½ç•¥é”™è¯¯**: é€‰æ‹©æœåŠ¡å¯èƒ½å¤±è´¥
2. **ä¸è¦å¿˜è®°é‡Šæ”¾è¿æ¥**: ä½¿ç”¨æœ€å°‘è¿æ¥ç®—æ³•æ—¶å¿…é¡»é‡Šæ”¾è¿æ¥
3. **ä¸è¦ä½¿ç”¨è¿‡æ—¶çš„æœåŠ¡åˆ—è¡¨**: å®šæœŸæ›´æ–°æœåŠ¡åˆ—è¡¨

---

## 5. ç›¸å…³èµ„æº

- [æœåŠ¡æ³¨å†Œä¸­å¿ƒ](../registry/README.md)
- [æ¡†æ¶æ‹“å±•è®¡åˆ’](../../docs/00-æ¡†æ¶æ‹“å±•è®¡åˆ’.md)

---

**æ›´æ–°æ—¥æœŸ**: 2025-11-11
